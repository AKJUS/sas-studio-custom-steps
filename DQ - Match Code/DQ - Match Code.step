{"creationTimeStamp":"2022-07-11T08:03:56.301Z","modifiedTimeStamp":"2023-07-25T06:56:50.380Z","createdBy":"italot","modifiedBy":"italot","name":"DQ - Match Code.step","displayName":"DQ - Match Code.step","localDisplayName":"DQ - Match Code.step","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/a97ac91d-a88c-4e1a-a157-b1b092d46d5d","uri":"/dataFlows/steps/a97ac91d-a88c-4e1a-a157-b1b092d46d5d","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/a97ac91d-a88c-4e1a-a157-b1b092d46d5d","uri":"/dataFlows/steps/a97ac91d-a88c-4e1a-a157-b1b092d46d5d","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/a97ac91d-a88c-4e1a-a157-b1b092d46d5d","uri":"/dataFlows/steps/a97ac91d-a88c-4e1a-a157-b1b092d46d5d","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/a97ac91d-a88c-4e1a-a157-b1b092d46d5d","uri":"/dataFlows/steps/a97ac91d-a88c-4e1a-a157-b1b092d46d5d"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/a97ac91d-a88c-4e1a-a157-b1b092d46d5d","uri":"/dataFlows/steps/a97ac91d-a88c-4e1a-a157-b1b092d46d5d","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/a97ac91d-a88c-4e1a-a157-b1b092d46d5d","uri":"/dataFlows/steps/a97ac91d-a88c-4e1a-a157-b1b092d46d5d","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[{"name":"inputtable1","displayName":"inputtable1","localDisplayName":"inputtable1","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table"},{"name":"dm_madef","displayName":"dm_madef","localDisplayName":"dm_madef","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table"}],"outputPorts":[{"name":"outputtable1","displayName":"outputtable1","localDisplayName":"outputtable1","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table","columnDelta":{"updateColumnArguments":["outcol1","outcol2","outcol3","outcol4","outcol5","outcol6","outcol7","outcol8","outcol9","outcol10"],"automaticMapping":[{"inputPort":"inputtable1","inputPortName":"inputtable1"}]},"supportsView":false,"requiresStructure":false}]},"ui":"{\"showPageContentOnly\":true,\"pages\":[{\"id\":\"page1\",\"type\":\"page\",\"label\":\"MatchCode Options\",\"children\":[{\"id\":\"outputtable1\",\"type\":\"outputtable\",\"label\":\"Output table label\",\"required\":true,\"placeholder\":\"\",\"visible\":\"\"},{\"id\":\"inputtable1\",\"type\":\"inputtable\",\"label\":\"Input table label\",\"required\":true,\"placeholder\":\"\",\"visible\":\"\"},{\"id\":\"dm_madef\",\"type\":\"inputtable\",\"label\":\"DM_MADEF\",\"required\":true,\"placeholder\":\"\",\"visible\":false,\"readonly\":true},{\"id\":\"dm_desc\",\"type\":\"columnselector\",\"label\":\"DM_DESC\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":null,\"visible\":false,\"readonly\":true,\"table\":\"dm_madef\"},{\"id\":\"locale\",\"type\":\"dropdown\",\"label\":\"Locale:\",\"items\":{\"ref\":\"dm_desc\"},\"required\":true,\"placeholder\":\"\",\"visible\":\"\"},{\"id\":\"matchcode0\",\"type\":\"section\",\"label\":\"Matchcode\",\"open\":true,\"visible\":\"\",\"children\":[{\"id\":\"columnselector1\",\"type\":\"columnselector\",\"label\":\"Column selector label 1\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":null,\"visible\":false,\"readonly\":true,\"table\":\"dm_madef\"},{\"id\":\"def1\",\"type\":\"dropdown\",\"label\":\"Definition:\",\"items\":{\"ref\":\"columnselector1\"},\"required\":false,\"placeholder\":\"\",\"visible\":\"\"},{\"id\":\"col1\",\"type\":\"columnselector\",\"label\":\"Select Column\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":0,\"visible\":\"\",\"table\":\"inputtable1\"},{\"id\":\"outcol1\",\"type\":\"newcolumn\",\"label\":\"Match Column\",\"required\":false,\"placeholder\":\"if empty will be used input col with _MC suffix\",\"hideproperties\":false,\"readonly\":false},{\"id\":\"sens1\",\"type\":\"numstepper\",\"label\":\"Sensitivity\",\"required\":false,\"integer\":false,\"min\":50,\"max\":95,\"stepsize\":5}]},{\"id\":\"matchcode1\",\"type\":\"section\",\"label\":\"Matchcode 1\",\"open\":true,\"visible\":\"$col1\",\"children\":[{\"id\":\"columnselector2\",\"type\":\"columnselector\",\"label\":\"Column selector label 2\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":null,\"visible\":false,\"readonly\":true,\"table\":\"dm_madef\"},{\"id\":\"def2\",\"type\":\"dropdown\",\"label\":\"Definition:\",\"items\":{\"ref\":\"columnselector2\"},\"required\":false,\"placeholder\":\"\",\"visible\":\"\"},{\"id\":\"col2\",\"type\":\"columnselector\",\"label\":\"Select Column\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":0,\"visible\":\"\",\"table\":\"inputtable1\"},{\"id\":\"outcol2\",\"type\":\"newcolumn\",\"label\":\"Match Column\",\"required\":false,\"placeholder\":\"if empty will be used input col with _MC suffix\",\"hideproperties\":false,\"readonly\":false},{\"id\":\"sens2\",\"type\":\"numstepper\",\"label\":\"Sensitivity\",\"required\":false,\"integer\":false,\"min\":50,\"max\":95,\"stepsize\":5}]},{\"id\":\"matchcode2\",\"type\":\"section\",\"label\":\"Matchcode 2\",\"open\":true,\"visible\":\"$col2\",\"children\":[{\"id\":\"columnselector3\",\"type\":\"columnselector\",\"label\":\"Column selector label 3\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":null,\"visible\":false,\"readonly\":true,\"table\":\"dm_madef\"},{\"id\":\"def3\",\"type\":\"dropdown\",\"label\":\"Definition:\",\"items\":{\"ref\":\"columnselector3\"},\"required\":false,\"placeholder\":\"\",\"visible\":\"\"},{\"id\":\"col3\",\"type\":\"columnselector\",\"label\":\"Select Column\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":0,\"visible\":\"\",\"table\":\"inputtable1\"},{\"id\":\"outcol3\",\"type\":\"newcolumn\",\"label\":\"Match Column\",\"required\":false,\"placeholder\":\"if empty will be used input col with _MC suffix\",\"hideproperties\":false,\"readonly\":false},{\"id\":\"sens3\",\"type\":\"numstepper\",\"label\":\"Sensitivity\",\"required\":false,\"integer\":false,\"min\":50,\"max\":95,\"stepsize\":5}]},{\"id\":\"matchcode3\",\"type\":\"section\",\"label\":\"Matchcode 3\",\"open\":true,\"visible\":\"$col3\",\"children\":[{\"id\":\"columnselector4\",\"type\":\"columnselector\",\"label\":\"Column selector label 4\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":null,\"visible\":false,\"readonly\":true,\"table\":\"dm_madef\"},{\"id\":\"def4\",\"type\":\"dropdown\",\"label\":\"Definition:\",\"items\":{\"ref\":\"columnselector4\"},\"required\":false,\"placeholder\":\"\",\"visible\":\"\"},{\"id\":\"col4\",\"type\":\"columnselector\",\"label\":\"Select Column\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":0,\"visible\":\"\",\"table\":\"inputtable1\"},{\"id\":\"outcol4\",\"type\":\"newcolumn\",\"label\":\"Match Column\",\"required\":false,\"placeholder\":\"if empty will be used input col with _MC suffix\",\"hideproperties\":false,\"readonly\":false},{\"id\":\"sens4\",\"type\":\"numstepper\",\"label\":\"Sensitivity\",\"required\":false,\"integer\":false,\"min\":50,\"max\":95,\"stepsize\":5}]},{\"id\":\"matchcode4\",\"type\":\"section\",\"label\":\"Matchcode 4\",\"open\":true,\"visible\":\"$col4\",\"children\":[{\"id\":\"columnselector5\",\"type\":\"columnselector\",\"label\":\"Column selector label 5\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":null,\"visible\":false,\"readonly\":true,\"table\":\"dm_madef\"},{\"id\":\"def5\",\"type\":\"dropdown\",\"label\":\"Definition:\",\"items\":{\"ref\":\"columnselector5\"},\"required\":false,\"placeholder\":\"\",\"visible\":\"\"},{\"id\":\"col5\",\"type\":\"columnselector\",\"label\":\"Select Column\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":0,\"visible\":\"\",\"table\":\"inputtable1\"},{\"id\":\"outcol5\",\"type\":\"newcolumn\",\"label\":\"Match Column\",\"required\":false,\"placeholder\":\"if empty will be used input col with _MC suffix\",\"hideproperties\":false,\"readonly\":false},{\"id\":\"sens5\",\"type\":\"numstepper\",\"label\":\"Sensitivity\",\"required\":false,\"integer\":false,\"min\":50,\"max\":95,\"stepsize\":5}]},{\"id\":\"matchcode5\",\"type\":\"section\",\"label\":\"Matchcode 5\",\"open\":true,\"visible\":\"$col5\",\"children\":[{\"id\":\"columnselector6\",\"type\":\"columnselector\",\"label\":\"Column selector label 6\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":null,\"visible\":false,\"readonly\":true,\"table\":\"dm_madef\"},{\"id\":\"def6\",\"type\":\"dropdown\",\"label\":\"Definition:\",\"items\":{\"ref\":\"columnselector6\"},\"required\":false,\"placeholder\":\"\",\"visible\":\"\"},{\"id\":\"col6\",\"type\":\"columnselector\",\"label\":\"Select Column\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":0,\"visible\":\"\",\"table\":\"inputtable1\"},{\"id\":\"outcol6\",\"type\":\"newcolumn\",\"label\":\"Match Column\",\"required\":false,\"placeholder\":\"if empty will be used input col with _MC suffix\",\"hideproperties\":false,\"readonly\":false},{\"id\":\"sens6\",\"type\":\"numstepper\",\"label\":\"Sensitivity\",\"required\":false,\"integer\":false,\"min\":50,\"max\":95,\"stepsize\":5}]},{\"id\":\"matchcode6\",\"type\":\"section\",\"label\":\"Matchcode 6\",\"open\":true,\"visible\":\"$col6\",\"children\":[{\"id\":\"columnselector7\",\"type\":\"columnselector\",\"label\":\"Column selector label 7\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":null,\"visible\":false,\"readonly\":true,\"table\":\"dm_madef\"},{\"id\":\"def7\",\"type\":\"dropdown\",\"label\":\"Definition:\",\"items\":{\"ref\":\"columnselector7\"},\"required\":false,\"placeholder\":\"\",\"visible\":\"\"},{\"id\":\"col7\",\"type\":\"columnselector\",\"label\":\"Select Column\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":0,\"visible\":\"\",\"table\":\"inputtable1\"},{\"id\":\"outcol7\",\"type\":\"newcolumn\",\"label\":\"Match Column\",\"required\":false,\"placeholder\":\"if empty will be used input col with _MC suffix\",\"hideproperties\":false,\"readonly\":false},{\"id\":\"sens7\",\"type\":\"numstepper\",\"label\":\"Sensitivity\",\"required\":false,\"integer\":false,\"min\":50,\"max\":95,\"stepsize\":5}]},{\"id\":\"matchcode7\",\"type\":\"section\",\"label\":\"Matchcode 7\",\"open\":true,\"visible\":\"$col7\",\"children\":[{\"id\":\"columnselector8\",\"type\":\"columnselector\",\"label\":\"Column selector label 8\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":null,\"visible\":false,\"readonly\":true,\"table\":\"dm_madef\"},{\"id\":\"def8\",\"type\":\"dropdown\",\"label\":\"Definition:\",\"items\":{\"ref\":\"columnselector8\"},\"required\":false,\"placeholder\":\"\",\"visible\":\"\"},{\"id\":\"col8\",\"type\":\"columnselector\",\"label\":\"Select Column\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":0,\"visible\":\"\",\"table\":\"inputtable1\"},{\"id\":\"outcol8\",\"type\":\"newcolumn\",\"label\":\"Match Column\",\"required\":false,\"placeholder\":\"if empty will be used input col with _MC suffix\",\"hideproperties\":false,\"readonly\":false},{\"id\":\"sens8\",\"type\":\"numstepper\",\"label\":\"Sensitivity\",\"required\":false,\"integer\":false,\"min\":50,\"max\":95,\"stepsize\":5}]},{\"id\":\"matchcode8\",\"type\":\"section\",\"label\":\"Matchcode 8\",\"open\":true,\"visible\":\"$col8\",\"children\":[{\"id\":\"columnselector9\",\"type\":\"columnselector\",\"label\":\"Column selector label 9\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":null,\"visible\":false,\"readonly\":true,\"table\":\"dm_madef\"},{\"id\":\"def9\",\"type\":\"dropdown\",\"label\":\"Definition:\",\"items\":{\"ref\":\"columnselector9\"},\"required\":false,\"placeholder\":\"\",\"visible\":\"\"},{\"id\":\"col9\",\"type\":\"columnselector\",\"label\":\"Select Column\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":0,\"visible\":\"\",\"table\":\"inputtable1\"},{\"id\":\"outcol9\",\"type\":\"newcolumn\",\"label\":\"Match Column\",\"required\":false,\"placeholder\":\"if empty will be used input col with _MC suffix\",\"hideproperties\":false,\"readonly\":false},{\"id\":\"sens9\",\"type\":\"numstepper\",\"label\":\"Sensitivity\",\"required\":false,\"integer\":false,\"min\":50,\"max\":95,\"stepsize\":5}]},{\"id\":\"matchcode9\",\"type\":\"section\",\"label\":\"Matchcode 9\",\"open\":true,\"visible\":\"$col9\",\"children\":[{\"id\":\"columnselector10\",\"type\":\"columnselector\",\"label\":\"Column selector label 10\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":null,\"visible\":false,\"readonly\":true,\"table\":\"dm_madef\"},{\"id\":\"def10\",\"type\":\"dropdown\",\"label\":\"Definition:\",\"items\":{\"ref\":\"columnselector10\"},\"required\":false,\"placeholder\":\"\",\"visible\":\"\"},{\"id\":\"col10\",\"type\":\"columnselector\",\"label\":\"Select Column\",\"order\":false,\"columntype\":\"a\",\"max\":1,\"min\":0,\"visible\":\"\",\"table\":\"inputtable1\"},{\"id\":\"outcol10\",\"type\":\"newcolumn\",\"label\":\"Match Column\",\"required\":false,\"placeholder\":\"if empty will be used input col with _MC suffix\",\"hideproperties\":false,\"readonly\":false},{\"id\":\"sens10\",\"type\":\"numstepper\",\"label\":\"Sensitivity\",\"required\":false,\"integer\":false,\"min\":50,\"max\":95,\"stepsize\":5}]}]},{\"id\":\"about\",\"type\":\"page\",\"label\":\"About\",\"children\":[{\"id\":\"text1\",\"type\":\"text\",\"text\":\"The DQ - Match Code step allows you to create a column match code based on a locale and a match code definition using the dqMatch function. This version uses SASDQREF tables, support all locales defined in QKB  and it is possible to standardize up to 10 columns. Prompts take advantage of dynamic prompt lists and hierarchies.\\n\\nChange Log:\\n\\nVersion 2.0 (20JUL2023)\\n * Adds support for all locales in QKB definition using SASDQREF library (require Viya 2023.06)\\n\\nVersion 1.2 (22NOV2022)\\n * Adds support for Canadian locales (ENCAN, FRCAN)\\n\\nVersion 1.1 (22SEP2022)\\n  * Fixes execution errors when using a locale other than English - United States (ENUSA) \\n\\nVersion 1.0 (14SEP2022)  \\n  * Initial version  \",\"visible\":\"\"}]}],\"values\":{\"outputtable1\":{\"library\":\"\",\"table\":\"\"},\"inputtable1\":{\"library\":\"\",\"table\":\"\"},\"dm_madef\":{\"library\":\"SASDQREF\",\"table\":\"DM_MADEF\"},\"dm_desc\":[{\"value\":\"DM_DESC\"}],\"locale\":null,\"columnselector1\":[{\"value\":\"DM_NAME\"}],\"def1\":null,\"col1\":[],\"outcol1\":{\"length\":256},\"sens1\":85,\"columnselector2\":[{\"value\":\"DM_NAME\"}],\"def2\":null,\"col2\":[],\"outcol2\":{\"length\":256},\"sens2\":85,\"columnselector3\":[{\"value\":\"DM_NAME\"}],\"def3\":null,\"col3\":[],\"outcol3\":{\"length\":256},\"sens3\":85,\"columnselector4\":[{\"value\":\"DM_NAME\"}],\"def4\":null,\"col4\":[],\"outcol4\":{\"length\":256},\"sens4\":85,\"columnselector5\":[{\"value\":\"DM_NAME\"}],\"def5\":null,\"col5\":[],\"outcol5\":{\"length\":256},\"sens5\":85,\"columnselector6\":[{\"value\":\"DM_NAME\"}],\"def6\":null,\"col6\":[],\"outcol6\":{\"length\":256},\"sens6\":85,\"columnselector7\":[{\"value\":\"DM_NAME\"}],\"def7\":null,\"col7\":[],\"outcol7\":{\"length\":256},\"sens7\":85,\"columnselector8\":[{\"value\":\"DM_NAME\"}],\"def8\":null,\"col8\":[],\"outcol8\":{\"length\":256},\"sens8\":85,\"columnselector9\":[{\"value\":\"DM_NAME\"}],\"def9\":null,\"col9\":[],\"outcol9\":{\"length\":256},\"sens9\":85,\"columnselector10\":[{\"value\":\"DM_NAME\"}],\"def10\":null,\"col10\":[],\"outcol10\":{\"length\":256},\"sens10\":85},\"promptHierarchies\":[{\"name\":\"PromptHierarchy1\",\"levels\":[\"locale\",\"def1\"]},{\"name\":\"PromptHierarchy2\",\"levels\":[\"locale\",\"def2\"]},{\"name\":\"PromptHierarchy3\",\"levels\":[\"locale\",\"def3\"]},{\"name\":\"PromptHierarchy4\",\"levels\":[\"locale\",\"def4\"]},{\"name\":\"PromptHierarchy5\",\"levels\":[\"locale\",\"def5\"]},{\"name\":\"PromptHierarchy6\",\"levels\":[\"locale\",\"def6\"]},{\"name\":\"PromptHierarchy7\",\"levels\":[\"locale\",\"def7\"]},{\"name\":\"PromptHierarchy8\",\"levels\":[\"locale\",\"def8\"]},{\"name\":\"PromptHierarchy9\",\"levels\":[\"locale\",\"def9\"]},{\"name\":\"PromptHierarchy10\",\"levels\":[\"locale\",\"def10\"]}],\"syntaxversion\":\"1.3.0\"}","templates":{"SAS":"/* SAS templated code goes here */\n%macro usr_dqmatch(maxcol=10) ;\n\n\n\tproc sql noprint ;\n\t\tselect distinct dm_locale into:qkblocale\n\t\tfrom &dm_madef\n\t\twhere dm_desc=\"&locale\" \n\t;quit;\n\n\t%put NOTE: Locale used &qkblocale ;\n\n\t%DQLOAD(DQLOCALE=(&qkblocale));\n\t%do i=1 %to &maxcol ;\n\t\t%if &&col&i._count gt 0 %then %do ;\n\n\t\t\t%if &&outcol&i._name = %then %do ;\n\n\t\t\t\t%let wsn=%sysfunc(index(&&col&i._1_name.,%str( ))) ;\n\t\t\t\t\n\t\t\t\t%if &wsn gt 0 %then %do ;\n\t\t\t\t\t%let newname=%sysfunc(putc(&&col&i._1_name_base,$50.)) ;\n\t\t\t\t\t%let newname=%str(\"&newname._MC\"n);\n\t\t\t\t%end ;\n\t\t\t\t%else %do ;\n\t\t\t\t\t%let newname=&&col&i._1_name._MC ;\n\t\t\t\t%end ;\n\n\t\t\t\t%if &&outcol&i._rawlength eq %then %let dl=256 ;\n\t\t\t\t%else %let dl=&&outcol&i._rawlength ;\n\t\t\t\t%let lg&i=%str(length &newname $&dl..) ;\n\t\t\t\t%let mc&i=%str(&newname = dqMatch(&&col&i._1_name. , \"&&def&i.\", &&sens&i., \"&qkblocale\" )) ;\n\t\t\t%end ;\n\t\t\t%else %do ;\n\t\t\t\t%if &&outcol&i._rawlength eq %then %let dl=256 ;\n\t\t\t\t%else %let dl=&&outcol&i._rawlength ;\n\t\t\t\t%let lg&i=%str(length &&outcol&i._name $&dl..) ;\n\t\t\t\t%let mc&i=%str(&&outcol&i._name = dqMatch(&&col&i._1_name. , \"&&def&i.\", &&sens&i., \"&qkblocale\" )) ;\n\t\t\t%end ;\n\t\t\t\n\t\t%end ;\n\t%end ;\n\tdata &outputtable1 ;\n\t\tset &inputtable1 ;\n\t\t%do i=1 %to &maxcol ;\n\t\t\t%if &&col&i._count gt 0 %then %do ;\n\t\t\t\t%if &&outcol&i._name ne &&col&i._1_name. %then %do ;\n\t\t\t\t\t&&lg&i ;\n                %end ;\n\t\t\t\t&&mc&i ;\n\t\t\t%end ;\n\t\t%end ;\t\n\trun ;\n%mend ;\n%usr_dqmatch() ;\n\n\n"}}