{"creationTimeStamp":"2023-08-25T13:59:18.961Z","modifiedTimeStamp":"2024-01-15T13:55:15.742Z","createdBy":"gerdaw","modifiedBy":"gerdaw","name":"Catalog - List Agents.step","displayName":"Catalog - List Agents.step","localDisplayName":"Catalog - List Agents.step","description":"List all SAS Information Catalog agents that are available in the SAS Viya environment as a table.","localDescription":"List all SAS Information Catalog agents that are available in the SAS Viya environment as a table.","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/15c3a73c-42db-47f9-abbb-2efa65095d1b","uri":"/dataFlows/steps/15c3a73c-42db-47f9-abbb-2efa65095d1b","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/15c3a73c-42db-47f9-abbb-2efa65095d1b","uri":"/dataFlows/steps/15c3a73c-42db-47f9-abbb-2efa65095d1b","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/15c3a73c-42db-47f9-abbb-2efa65095d1b","uri":"/dataFlows/steps/15c3a73c-42db-47f9-abbb-2efa65095d1b","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/15c3a73c-42db-47f9-abbb-2efa65095d1b","uri":"/dataFlows/steps/15c3a73c-42db-47f9-abbb-2efa65095d1b"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/15c3a73c-42db-47f9-abbb-2efa65095d1b","uri":"/dataFlows/steps/15c3a73c-42db-47f9-abbb-2efa65095d1b","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/15c3a73c-42db-47f9-abbb-2efa65095d1b","uri":"/dataFlows/steps/15c3a73c-42db-47f9-abbb-2efa65095d1b","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[],"outputPorts":[{"name":"outputtable1","displayName":"outputtable1","localDisplayName":"outputtable1","description":"This table contains all currently defined SAS Information Catalog agents","localDescription":"This table contains all currently defined SAS Information Catalog agents","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table","columnDelta":{"updateColumnArguments":["newcolumn1","newcolumn2"]},"supportsView":false,"requiresStructure":false}]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"pageDefinition\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Definition\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text2\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Get a table containing all SAS Information Catalog agents that are defined in the SAS Viya environment. The output table will contain two columns:\\n- ID of the SAS Information Catalog agent\\n- Name of the SAS Information Catalog agent\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"outputtable1\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Output table of all agents in the environment\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"newcolumn1\",\n\t\t\t\t\t\"type\": \"newcolumn\",\n\t\t\t\t\t\"label\": \"ID\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"hideproperties\": false,\n\t\t\t\t\t\"readonly\": true,\n\t\t\t\t\t\"visible\": false\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"newcolumn2\",\n\t\t\t\t\t\"type\": \"newcolumn\",\n\t\t\t\t\t\"label\": \"Name\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"hideproperties\": false,\n\t\t\t\t\t\"readonly\": true,\n\t\t\t\t\t\"visible\": false\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"pageAbout\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"textAbout\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Catalog - List Agents step\\n==========\\n\\nThe \\\" Catalog - List Agents\\\" custom steps queries the /catalog/bots API-endpoint to return all agents that are defined in an environment.\\n\\nThe output table will contain two columns:\\n- ID of the SAS Information Catalog agent\\n- Name of the SAS Information Catalog agent\\n\\nThis step can be used in combination with the Catalog - Run Agent step.\\n\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionPrereqs\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Pre-requisites\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textPrereqs\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"You need to part of the SAS Administrator group or a Custom Group that can maintain the Information Catalog agents, see this documentation page for more details: https://go.documentation.sas.com/doc/en/infocatcdc/default/infocatag/n1xniiffqq05c9n1n31o997vvdwu.htm?requestorId=1c9d26e9-68e7-4041-bb09-d33447b2d3ca#n0kvrjp9o1ntfen1hqeaec4cwidz\\n\\nTested on Viya version Stable 2023.12\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionDocumentation\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Documentation\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textDocumentation\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"* Agent REST-API documentation can be found here (https://developer.sas.com/apis/rest/DataManagement/#get-agents)\\n* Maintaining agents via a custom group (https://go.documentation.sas.com/doc/en/infocatcdc/default/infocatag/n1xniiffqq05c9n1n31o997vvdwu.htm?requestorId=1c9d26e9-68e7-4041-bb09-d33447b2d3ca#n0kvrjp9o1ntfen1hqeaec4cwidz)\\n* General information about agents (https://go.documentation.sas.com/doc/en/infocatcdc/default/infocatag/n19g2478yryor8n1hub3q3sxw7st.htm?requestorId=1c9d26e9-68e7-4041-bb09-d33447b2d3ca)\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionChangelog\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Changelog\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textChangelog\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"* Version: 1.0 (15JAN2024)\\n      - Initial version\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"outputtable1\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"newcolumn1\": {\n\t\t\t\"value\": \"id\",\n\t\t\t\"label\": \"ID of the SAS Information Catalog Agent\",\n\t\t\t\"length\": 36,\n\t\t\t\"format\": \"$36\"\n\t\t},\n\t\t\"newcolumn2\": {\n\t\t\t\"value\": \"name\",\n\t\t\t\"label\": \"Name of the SAS Information Catalog Agent\",\n\t\t\t\"length\": 256,\n\t\t\t\"format\": \"$256\"\n\t\t}\n\t}\n}","templates":{"SAS":"%let _la_viyaHost=%sysfunc(getoption(SERVICESBASEURL));\n\n* Macro to recursivly get all SAS Information Catalog agents;\n%macro _la_pagination(_la_start=0, _la_limit=10);\n\t%local\n\t\t_la_start\n\t\t_la_limit\n\t\t_la_ds_nobs\n\t\t_la_nvar\n\t\t_la_new_start;\n\n\tfilename _la_agt temp;\n\tproc http\n\t\tmethod='get'\n\t\turl=\"&_la_viyaHost./catalog/bots?start=&_la_start%nrstr(&)limit=&_la_limit.\"\n\t\toauth_bearer = sas_services\n\t\tout=_la_agt;\n\t\theaders 'Accept' = 'application/json';\n\tquit;\n\t\n\tlibname _la_agt json;\n\n\t* Get the number of observations where one obs = one agent;\n\tproc sql noprint;\n\t\tselect count(*) into :_la_ds_nobs trimmed\n\t\t\tfrom _la_agt.items;\n\tquit;\n\n\t* Get the number of columns;\n\tproc sql noprint;\n\t    select nvar into :_la_nvar trimmed\n\t\t\tfrom dictionary.tables where libname='_LA_AGT' and memname='ITEMS';\n\tquit;\n\n\t* Handle the first iteration and subsequent requests;\n\t%if &_la_start. eq 0 %then %do;\n\t\tdata &outputtable1.;\n\t\t\tlength id $36. name $256.;\n\t\t\tlabel id = 'ID of the SAS Information Catalog Agent'\n\t\t\t\tname = 'Name of the SAS Information Catalog Agent';\n\t\t\tset _la_agt.items(keep=id name);\n\t\trun;\n\t%end;\n\t%else %do;\n\t\t%if &_la_nvar. gt 2 %then %do;\n\t\t\tproc append base=&outputtable1. data=_la_agt.items(keep=id name);\n\t\t\tquit;\n\t\t%end;\n\t%end;\n\n\tlibname _la_agt clear;\n\tfilename _la_agt clear;\n\n\t* Check if a another iteration is needed;\n\t%if &_la_ds_nobs eq &_la_limit and &_la_nvar. gt 2 %then %do;\n\t\t%put NOTE: Getting more agents;\n\t\t%let _la_new_start = %eval(&_la_start+&_la_limit);\n\t\t%_la_pagination(_la_start=&_la_new_start, _la_limit=&_la_limit);\n\t%end;\n%mend _la_pagination;\n\n%_la_pagination();\n\n* Clean up;\n%symdel _la_viyaHost;\n%sysmacdelete _la_pagination;"}}