{"creationTimeStamp":"2022-07-19T09:36:05.089Z","modifiedTimeStamp":"2022-12-06T12:14:28.550Z","createdBy":"dubain","modifiedBy":"sukaxl","name":"Python - Load python module.step","displayName":"Python - Load python module.step","localDisplayName":"Python - Load python module.step","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/139afef4-cd7c-4fdf-8963-d6488f4f88e5","uri":"/dataFlows/steps/139afef4-cd7c-4fdf-8963-d6488f4f88e5","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/139afef4-cd7c-4fdf-8963-d6488f4f88e5","uri":"/dataFlows/steps/139afef4-cd7c-4fdf-8963-d6488f4f88e5","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/139afef4-cd7c-4fdf-8963-d6488f4f88e5","uri":"/dataFlows/steps/139afef4-cd7c-4fdf-8963-d6488f4f88e5","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/139afef4-cd7c-4fdf-8963-d6488f4f88e5","uri":"/dataFlows/steps/139afef4-cd7c-4fdf-8963-d6488f4f88e5"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/139afef4-cd7c-4fdf-8963-d6488f4f88e5","uri":"/dataFlows/steps/139afef4-cd7c-4fdf-8963-d6488f4f88e5","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/139afef4-cd7c-4fdf-8963-d6488f4f88e5","uri":"/dataFlows/steps/139afef4-cd7c-4fdf-8963-d6488f4f88e5","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[],"outputPorts":[]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"page1\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"General\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text1\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"This utility step enables you to add a python module (and it's dependencies) for your user. The module will persist in the folder you choose to download it into but will not persist on the pythonpath between sessions so you will need to use the add_python_path step to ensure it is on your path before running a step or code with that dependency.\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"inputfield1\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Choose a python module to add:\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"fileorfolderselector1\",\n\t\t\t\t\t\"type\": \"path\",\n\t\t\t\t\t\"label\": \"Choose a folder location to save the module:\",\n\t\t\t\t\t\"pathtype\": \"folder\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"page2\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text2\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"This step loads a python module to the selected file path and adds that path to the PYTHONPATH environment variable if it's not already there.\\n\\nVersion 1.0 - Initial Release - 2022/12/06\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"inputfield1\": \"\",\n\t\t\"fileorfolderselector1\": \"\"\n\t},\n\t\"promptHierarchies\": []\n}","templates":{"SAS":"/*\nAuthor: Duncan Bain\nWith assistance from:\nAngus Looney\nHary Snart\nCasey Smith\n*/\nproc python;\nsubmit;\n#First run will take a while especially if there are lot of dependencies- be patient\n\nimport os\nimport sys\nimport subprocess\nimport pkg_resources\nimport importlib\n\n# check for directory first and if not create it\n\nlocalpip = SAS.symget(\"fileorfolderselector1\").split(sep=':')[1]\n\ntry:\n\tos.makedirs(localpip, exist_ok = True)\n\tprint(\"Directory created successfully\")\nexcept OSError as error:\n\tprint(\"Directory can not be created\")\n\n#then append it to the python path if necessary\n\nif not localpip in sys.path:\n\tsys.path.append(localpip)\n\n#now check to see if the package is installed and if not install it.\n\ntry:\n\timportlib.import_module(SAS.symget('inputfield1'))\n\tprint(SAS.symget('inputfield1') + ' already exists - not replacing')\nexcept ImportError:\n\tprint(SAS.symget('inputfield1') + ' does not exist. Attempting to fetch from pip.')\n\tpython = sys.executable\n\ttarget = \"--target=\"+localpip\n\tsubprocess.check_call([python, '-m', 'pip', 'install',  target, SAS.symget('inputfield1'), '--no-cache-dir'])\nfinally:\n\timportlib.import_module(SAS.symget('inputfield1'))\n\tprint(SAS.symget('inputfield1') + ' loaded successfully.')\n\nendsubmit;\nrun;"}}