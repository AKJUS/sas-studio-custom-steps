{"creationTimeStamp":"2022-04-13T14:35:28.949Z","modifiedTimeStamp":"2022-09-12T21:54:23.621Z","createdBy":"Stephan.Weigandt@sas.com","modifiedBy":"Stephan.Weigandt@sas.com","name":"Data Ingestion Auto Pilot DIAP Light for External Files.step","displayName":"Data Ingestion Auto Pilot DIAP Light for External Files.step","localDisplayName":"Data Ingestion Auto Pilot DIAP Light for External Files.step","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/b4831b71-2af6-45ba-b270-dc9724847f5a","uri":"/dataFlows/steps/b4831b71-2af6-45ba-b270-dc9724847f5a","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/b4831b71-2af6-45ba-b270-dc9724847f5a","uri":"/dataFlows/steps/b4831b71-2af6-45ba-b270-dc9724847f5a","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/b4831b71-2af6-45ba-b270-dc9724847f5a","uri":"/dataFlows/steps/b4831b71-2af6-45ba-b270-dc9724847f5a","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/b4831b71-2af6-45ba-b270-dc9724847f5a","uri":"/dataFlows/steps/b4831b71-2af6-45ba-b270-dc9724847f5a"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/b4831b71-2af6-45ba-b270-dc9724847f5a","uri":"/dataFlows/steps/b4831b71-2af6-45ba-b270-dc9724847f5a","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/b4831b71-2af6-45ba-b270-dc9724847f5a","uri":"/dataFlows/steps/b4831b71-2af6-45ba-b270-dc9724847f5a","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[],"outputPorts":[]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"Essentials\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Essentials\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"diap_guided_auto_fl_loc_ui\",\n\t\t\t\t\t\"type\": \"path\",\n\t\t\t\t\t\"label\": \"Provide CSV File that contains detailed DIAP execution instructions (create a template by choosing \\\"3 - Create Guided Automation Control File Template\\\")\",\n\t\t\t\t\t\"pathtype\": \"file\",\n\t\t\t\t\t\"placeholder\": \"Select CSV file that describes execution (create a template by choosing \\\"3 - Create Guided Automation Control File Template\\\")\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$DIAP_mode_selection_ui\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"2\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"root_directory_ui\",\n\t\t\t\t\t\"type\": \"path\",\n\t\t\t\t\t\"label\": \"Provide Root Directory (can be from within SAS Server or SAS Content)\",\n\t\t\t\t\t\"pathtype\": \"folder\",\n\t\t\t\t\t\"placeholder\": \"Select Root Directory\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$DIAP_mode_selection_ui\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"1\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"controlfile_target_location_ui\",\n\t\t\t\t\t\"type\": \"path\",\n\t\t\t\t\t\"label\": \"Target Path for Template Creation (Option 3 or 4)\",\n\t\t\t\t\t\"pathtype\": \"folder\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\"$DIAP_mode_selection_ui\",\n\t\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\t\"4\"\n\t\t\t\t\t\t],\n\t\t\t\t\t\t\"|\",\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\"$DIAP_mode_selection_ui\",\n\t\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\t\"3\"\n\t\t\t\t\t\t]\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"DIAP_mode_selection_ui\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Select DIAP Execution Mode\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"1\",\n\t\t\t\t\t\t\t\"label\": \"1 - Fully Automated\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"2\",\n\t\t\t\t\t\t\t\"label\": \"2 - Guided Automated Execution via Explicit File List\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"3\",\n\t\t\t\t\t\t\t\"label\": \"3 - Create Guided Automation Control File Template\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"4\",\n\t\t\t\t\t\t\t\"label\": \"4 - Create Fixed Width Control File Template\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"Extension_ui\",\n\t\t\t\t\t\"type\": \"dropdown\",\n\t\t\t\t\t\"label\": \"Extension\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"*\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"XLSX\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"XLSM\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"JMP\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"CSV\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"TXT\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"JSON\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"SHP\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"NEF\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"CUSTOM\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"target_libname_ui\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Target Libname (CAS or 94, needs to exist)\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"General\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"General\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"root_directory_overwrite_ui\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Provide Root Directory Manually (must be a physical file storage)\",\n\t\t\t\t\t\"placeholder\": \"If provided, this will overwrite Root Directory from Essentials\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"diap_traverse_directories_ui\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Traverse Subdirectories?\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"1\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"0\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"make_imported_data_persistent_ui\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Make Ingested Data Persistent\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"1\",\n\t\t\t\t\t\t\t\"label\": \"Yes\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"0\",\n\t\t\t\t\t\t\t\"label\": \"No\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"force_upload_of_all_files_ui\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Force upload of all files, even if already uploaded?\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"1\",\n\t\t\t\t\t\t\t\"label\": \"Yes\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"0\",\n\t\t\t\t\t\t\t\"label\": \"No\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"chck_4_spcl_char_in_vars_ui\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Clean up variable name from weird characters (like #, $, !, blanks, etc, ...)?\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"1\",\n\t\t\t\t\t\t\t\"label\": \"Yes\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"0\",\n\t\t\t\t\t\t\t\"label\": \"No\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"prefix_4_suspicious_src_fl_ui\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Provide Filename Prefix added if source file shows flaws\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"Source_specific\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Source Specific\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"skip_files_starting_with_seq_ui\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Provide list of filename beginnings that should be excluded from ingesting (separated by #)\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"skip_files_ending_with_seq_ui\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Provide list of filename endings that should be excluded from ingesting (separated by #)\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"csv_big_data_mode_ui\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Anticipate more than 2k vars for CSV?\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"1\",\n\t\t\t\t\t\t\t\"label\": \"Yes\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"0\",\n\t\t\t\t\t\t\t\"label\": \"No\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"check_csv_4_num_ui\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Check character fields in CSV Files for numeric?\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"1\",\n\t\t\t\t\t\t\t\"label\": \"Yes\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"0\",\n\t\t\t\t\t\t\t\"label\": \"No\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"special_chrctr_seq_2_chck_inhex2\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Provide list of characters in hex format to check in text files (sep by #)\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$check_txt_file_4_special_chrctui\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"1\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"spcl_chrctr_check_rplcmnt_inhex2\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Provide characters in hex format to replace with\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$check_txt_file_4_special_chrctui\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"1\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"check_txt_file_4_special_chrctui\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Check for special characters in text files and replace?\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"1\",\n\t\t\t\t\t\t\t\"label\": \"Yes\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"0\",\n\t\t\t\t\t\t\t\"label\": \"No\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"Target_Specific\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Target Specific\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"substitute_string_seq_ui\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Provide Characters to be Omitted in Target Names if too long!\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"max_table_length_ui\",\n\t\t\t\t\t\"type\": \"numberfield\",\n\t\t\t\t\t\"label\": \"Max Tablename Length\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"max\": 32,\n\t\t\t\t\t\"min\": 15,\n\t\t\t\t\t\"excludemin\": false,\n\t\t\t\t\t\"excludemax\": false,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"drop_missing_vars_ui\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Drop Missing Variables?\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"0\",\n\t\t\t\t\t\t\t\"label\": \"(0) Keep All\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"1\",\n\t\t\t\t\t\t\t\"label\": \"(1) Drop All\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"2\",\n\t\t\t\t\t\t\t\"label\": \"(2) Drop only vars with missing varnames AND all miss. values\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"3\",\n\t\t\t\t\t\t\t\"label\": \"(3) Same as (1) w/o Upload, Execute Only on Already Uploaded Data\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"4\",\n\t\t\t\t\t\t\t\"label\": \"(4) Same as (2) w/o Upload, Execute Only on Already Uploaded Data.\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"stringseq_2_cutout_from_fn_ui\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Target Filename: Provide String that Should be Cut Out (sep by #)\",\n\t\t\t\t\t\"placeholder\": \"string1#string2\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"stringseq_2_cutout_from_vn_ui\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Target Variablename: Provide String that Should be Cut Out (sep by #)\",\n\t\t\t\t\t\"placeholder\": \"string1#string2\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"diap_create_unique_target_tblnm2\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Create unique final dataset name for different source files/sheets with the same name (in different locations)?\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"1\",\n\t\t\t\t\t\t\t\"label\": \"Yes\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"0\",\n\t\t\t\t\t\t\t\"label\": \"No\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"fnl_ds_name_4_all_extfiles_ui\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"If string provided, all external files will be read into ONE table with the name of this string.\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"diap_fnl_tblname_from_sheetonly2\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"For Multi Table Files (e.g. XLSX, XML, JSON), derive final dataset name from sheet only?\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"1\",\n\t\t\t\t\t\t\t\"label\": \"Yes\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"0\",\n\t\t\t\t\t\t\t\"label\": \"No\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"Admin\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Admin\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"meta_centralized_ui\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Store Metadata Centralized?\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"1\",\n\t\t\t\t\t\t\t\"label\": \"Yes\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"0\",\n\t\t\t\t\t\t\t\"label\": \"No\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"libname_meta_centralized_ui\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Libname for Centralized DIAP Metadata\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$meta_centralized_ui\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"1\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"debug_mode_ui\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Debug Mode\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"1\",\n\t\t\t\t\t\t\t\"label\": \"Yes\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"0\",\n\t\t\t\t\t\t\t\"label\": \"No\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"log_file_path_ui\",\n\t\t\t\t\t\"type\": \"path\",\n\t\t\t\t\t\"label\": \"Path for logfile creation\",\n\t\t\t\t\t\"pathtype\": \"folder\",\n\t\t\t\t\t\"placeholder\": \"If kept blank, log file still goes to standard output.\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$write_log_into_file_ui\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"1\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"write_log_into_file_ui\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Write Log into File\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"1\",\n\t\t\t\t\t\t\t\"label\": \"Yes\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"0\",\n\t\t\t\t\t\t\t\"label\": \"No\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"max_lgth_of_suspicious_str_ui\",\n\t\t\t\t\t\"type\": \"numberfield\",\n\t\t\t\t\t\"label\": \"Max allowed length for Prefix in Filename for suspicious filenames.\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"max\": 8,\n\t\t\t\t\t\"min\": 2,\n\t\t\t\t\t\"excludemin\": false,\n\t\t\t\t\t\"excludemax\": false,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"options_seq_ui\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Provide options to be applied for this run (only single options allowed like mprint, nosource, etc).\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"About\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text1\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"DIAP: Data Ingestion Auto Pilot:\\nDIAP allows to ingest (LOTS) of external data into the SAS ecosystem QUICKLY by only setting a few parameters and pushing a button while increasing the quality and confidence into data insights by handlilng many potential data inconistencies automatically. \\n\\nHINTS:\\nONLY set mandatory options in \\\"Essentials\\\" and everything else can be left at default.\\n\\nIf you have any questions, suggestions, ideas or any unexpected behavior, please contact:\\nstephan.weigandt@sas.com.\\n\\nHere is an overview of the available parameters:\\n\\nroot_directory (In Custom Step Version: \\\"Select DIAP Execution Mode -> (1)\\\")\\nsuggested default value: if there is a default landing area, this could be provided here.\\nprovide the top level directory that DIAP should use to start looking for files. DIAP will then traverse through the whole directory structure and find all the files below this top level directory.\\nIf the root directory is in the SAS Server area, this has to start out with: sasserver: (e.g. example value for root_directory: sasserver:/mnt/desired/path/for/files_to_be_readin/from/SASServer/).\\nIf the root directory is in the SAS Content area, this has to start out with: sascontent: (e.g. example value for root_directory: sascontent:/Public/desired_path_for/files/in/SASContent/).\\n\\ndiap_traverse_directories (In Custom Step Version: \\\"Traverse Subdirectories?\\\")\\nsuggested default value: 1\\nIf set to 1, DIAP traverses through all subdirectories recursively that can be found under root_directory.\\nIf set to 0, DIAP only checks for files in the provided root_directory.\\n\\nextension (In Custom Step Version: \\\"Extension\\\")\\nsuggested default value: *\\nThis parameter determines which files are considered to be imported. Use the wildcard “*” (without quotes) for any files that can be ingested by DIAP, or any extension. The following extensions are supported as of now:\\n•\\tXLSX\\n•\\tXLSM\\n•\\tCSV\\n•\\tJMP\\n•\\tSHP\\n•\\tTXT\\n•\\tNEF\\n•\\tJSON\\n•\\tCustom (Fixed Width/XML)\\n\\nTarget_libname (In Custom Step Version: \\\"Target Libname\\\")\\nsuggested default value: any libname, that is used for testing, e.g. WORK.\\nProvide the SAS or CAS libname, where the imported files are stored at. It needs to be preassigned or assigned within the session.\\n\\nprovide_default_log_path (In Custom Step Version: \\\"Path for logfile creation\\\")\\nsuggested default value: empty/missing.\\nThis parameter is only relevant when the parameter “write_log_into_file” is set to 1.\\nProvide a default path for all runs: as soon as a path is provided, this path is being used for ALL runs.\\nIf the log directory is in the SAS Server area, this has to start out with: sasserver: (e.g. example value for provide_default_log_path: sasserver:/mnt/desired/path/for/log_files_to_be_saved/on/SASServer/).\\nIf the log directory is in the SAS Content area, this has to start out with: sascontent: (e.g. example value for provide_default_log_path: sascontent:/Public/desired_path_for/logfiles/in/SASContent/).\\n\\nwrite_log_into_file (In Custom Step Version: \\\"Write Log into File\\\")\\nsuggested default value: 1\\nIf set to 0, log is written into default SAS log location.\\nIf set to 1, log is written to location as provided under the parameter “provide_default_log_path”.\\n\\nprofiling_execution_option (NOT AVAILABLE FOR THE CUSTOM STEP VERSION OF DIAP)\\nSuggested default value: No\\nSelect between the following 3 options:\\n\\n\\nNO: this is the default, in case the AUTOPROFILING component is not installed, or it is not desired to execute anything into the AUTOPROFILING section.\\n\\n\\nDICT_ONLY: in this mode, all the uploaded table are only loaded into the profiling dictionary, ready to be profiled, but no profiling is executed.\\n\\n\\nPROFILE: this option creates some default dictionary entries and creates the corresponding profiles.\\n\\n\\n\\nprfl_cd_lctn_in_content_area (NOT NEEDED FOR THE CUSTOM STEP VERSION OF DIAP)\\nSuggested default value: leave empty.\\nThis provides the location of the AUTOPROFILING component for the program files (e.g. “/Public/DM_Assets/SAS_DQ_AUTOPROFILE/Programs” (without the quotes))\\n\\nprfl_dict_lctn_in_content_area (NOT NEEDED FOR THE CUSTOM STEP VERSION OF DIAP)\\nSuggested default value: leave empty.\\nIMPORTANT: if “Data Quality Monitoring (CDQM)” is not installed, leave empty. When empty, DIAP will ignore the “profiling_execution_option”.\\nThis provides the location of the AUTOPROFILING CDQM (Data Quality Monitoring solution) component for the dictionary files (e.g. “/Public/DM_Assets/SAS_DQ_AUTOPROFILE/Imports” (without the quotes))\\n\\npath_2_python_shape_script (NOT NEEDED FOR THE CUSTOM STEP VERSION OF DIAP)\\nsuggested default value: leave empty/missing.\\nIf missing, the app uses the SAS way to read in SHAPE files, otherwise this is the full file path to the python script (which would also include setting up the python environment).\\nExperience shows that certain shape file setups might cause an undesired output when using the SAS way. Using the python script allows to deal with a few more exceptions.\\nFor this to work, Python has to be set up on the system. One example location could be as follows: “/mnt/viyashare/tools/run_shapeshift.sh” (without the quotes).\\n\\nmax_table_name_length (In Custom Step Version: \\\"Max Tablename Length\\\")\\nsuggested default value: 27\\nThis determines the maximum allowed table name length.  E.g. in the case of uploading XLSX files to SAS94, the final table name is built by concatenating Excel-filename and Sheetname.\\nSo this can easily lead to a datasetname that is too long.\\nAlso take into consideration that the concatenated name for multiple tables could potentially the same in the abbreviated form.\\nThe system checks for that and adds a counter to the table name.\\nSo, leave at least 2 characters for a counter.\\n\\ncheck_txt_file_4_special_chrct (In Custom Step Version: \\\"Check for special characters in text files and replace?\\\")\\nsuggested default value: 0\\nIf set to 0, the text file is read in as-is.\\nIf set to 1, then text files is examined before reading for the characthers as outlined in parameter \\\"special_chrctr_seq_2_chck_in_hex\\\", and replaced with the character as outlined in parameter \\\"spcl_chrctr_check_rplcmnt_in_hex\\\".\\nThis might need to be required, especially if files have NOTES or DESCRIPTION columns, that could contain carriage returns. Those carriage returns would then cause the file to be read in with a few errors, wherever those carriage returns occur.\\n\\nspecial_chrctr_seq_2_chck_in_hex (In Custom Step Version: \\\"Provide list of characters in hex format to check in text files (sep by #)\\\")\\nsuggested default value: 0A#0D\\nThis parameter has to be set to one or a sequence of # separated hex formats of a character.\\n0A#0D: checks for new line feed (0A) and carriage return (0D)\\nsee asciitable.com for an overview of all characters in hex format.\\n\\nspcl_chrctr_check_rplcmnt_in_hex (In Custom Step Version: \\\"Provide characters in hex format to replace with\\\")\\nsuggested default value: 00\\nPlease provide the characters that should be used to replace the special characters as defined in special_chrctr_seq_2_chck_in_hex\\nThe characters value is provided in hex format.\\nsee asciitable.com for an overview of all characters in hex format.\\n\\nsubstitute_string_seq (In Custom Step Version: \\\"Provide Characters to be Omitted in Target Names if too long!\\\")\\nsuggested default value: aeiouAEIOU\\nIf the target table name is too long, this string determines which characters are taken out from the target name to shorten the name further, before the truncation process kicks in.\\nE.g. when substitute_string_seq = aeAEoO, then a table name of \\\"ThisIsAVeryLongTableNameThatIsTooLong\\\" and a max_table_name_length = 29\\nwould be first changed to the following: \\\"ThisIsVryLngTblNmThtIsTLng\\\" which would be short enough without any further action needed by DIAP.\\n\\nskip_files_starting_with_seq (In Custom Step Version: \\\"Provide list of filename beginnings that should be excluded from ingesting (separated by #)\\\")\\ndefault value: _DIAP_Special_File_Definition.csv\\nIf not missing, DIAP will skip all the files that start out with the sequence of string snippets separated by #.\\nE.g. if set to:\\n_DIAP_Special_File_Definition.csv#filebe ginning1#filebeginning2\\nAll files that start out with either _DIAP_Special_File_Definition.csv filebeginning1 or filebeginning2 will NOT be ingested.\\n_DIAP_Special_File_Definition.csv is the default value used by DIAP to describe fixed width or XML definitions and wouldn't be needed to be read into the target libname.\\n\\nskip_files_ending_with_seq (In Custom Step Version: \\\"Provide list of filename endings that should be excluded from ingesting (separated by #)\\\")\\ndefault value: empty/missing\\nIf not missing, DIAP will skip all the files that end with the sequence of string snippets separated by #.\\nE.g. if set to:\\nfile_ending1#file_ending2#csv\\nAll files that end with either file_ending1 or file_ending2 or csv will NOT be ingested.\\nE.g. in this example all csv files would be skipped.\\n\\nmeta_centralized (In Custom Step Version: \\\"Store Metadata Centralized?\\\")\\nsuggested default value: 1\\nThis value goes closely with the next parameter “libname_meta_centralized”.\\nIf set to 1, all meta information generated by DIAP (e.g. data around upload activity, variable name, table names, etc) will be stored in predetermined tables (_UPLOAD_LOG, _VARIABLE_DICTIONARY) under the libname that is provided under “libname_meta_centralized”.\\nIf set to 0, all meta information generated by DIAP (e.g. data around upload activity, variable name, table names, etc) will be stored in predetermined tables (_UPLOAD_LOG, _VARIABLE_DICTIONARY) under the libname that is provided under “target_libname”.\\n\\nlibname_meta_centralized (In Custom Step Version: \\\"Libname for Centralized DIAP Metadata\\\")\\nPlease provide a libname (SAS or CAS), that can be used as a central storage for the metainformation that is generated for all DIAP activities, when the “meta_centralized” parameter is set to 1.\\nIMPORTANT:\\nIf the Data Quality Monitoring Solution is installed as well and being used with DIAP, then please here the same libname as being used there for the dictionary location.\\n\\ndebug_mode (In Custom Step Version: \\\"Debug Mode\\\")\\nSuggested default value: 1\\nIf set to 1, DIAP writes out more information out to the log, that might be helpful for further investigations.\\nIf set to 0, DIAP just writes out the default SAS log output, depending on the settings of the options mprint, source and notes.\\n\\nshp_enrich_with_zip (NOT AVAILABLE FOR THE CUSTOM STEP VERSION OF DIAP)\\nsuggested default value: 0\\nIf set to 0, shp files are read in as-is.\\nIf set to 1, DIAP will attempt to merge in zip-code information to the location information of the shp files.\\nFor this to work, this would require further installation steps, e.g. providing the zip-code lookup table. If desired, please contact Stephan Weigandt directly for inquiry about further steps to take.\\n\\nCASHOST (NOT NEEDED FOR THE CUSTOM STEP VERSION OF DIAP)\\nThis parameter is set during the installation steps. Please don’t change it afterwards. Provide the hostname that is used for this Viya installation.\\n\\nCASPORT (NOT NEEDED FOR THE CUSTOM STEP VERSION OF DIAP)\\nThis parameter is set during the installation steps. Please don’t change it afterwards. Provide the port that is used for this Viya installation.\\nDIAP_viyaversion\\nThis parameter is set during the installation steps. Please don’t change it afterwards. At this point leave the parameter set to 35.\\n\\nDIAP_viyaversion (NOT NEEDED FOR THE CUSTOM STEP VERSION OF DIAP)\\nsuggested default value: 35\\nThis parameter might be dropped at some point.\\nAt this point the default value is the only valid value and should not be changed.\\n\\ncsv_big_data_mode (In Custom Step Version: \\\"Anticipate more than 2k vars for CSV?\\\")\\nsuggested default value: 0.\\nIf set to 0, csv files are read in with default mode (e.g. normal proc import stuff with guessing the format and such).\\nIf set to 1, csv files are read in with the “big data mode”. It can happen that files are provided that contain more than 2000 variables. So when the anticipated number of variables is over 2000, then it is suggested to set this to 1. This will allow to read in the file completely, but the formats might not be in the desired state. DIAP will try to identify numeric columns and change the format for those from character to numeric.\\n\\ndrop_missing_vars (In Custom Step Version: \\\"Drop Missing Variables?\\\")\\nsuggested default value: 0\\nThe following values are possible:\\nIf set to 0, missing variables are NOT dropped.\\nIf set to 1, all variables that have ALL missing variables are dropped.\\nIf set to 2, only variables with missing variables names AND all missing values will be dropped.\\nIf set to 3, the same as setting to (1), but no data is being uploaded. So, when it is set to 3, the already uploaded files are treated accordingly.\\nIf set to 4, the same as setting to (2), but no data is being uploaded. So, when it is set to 3, the already uploaded files are treated accordingly.\\n\\nstringseq_2_cutout_from_fn (In Custom Step Version: \\\"Target Filename: Provide String that Should be Cut Out (sep by #)\\\")\\nsuggested default value: empty/missing.\\nProvide a sequence of characters strings that should be omitted in the target filename.This prevents the target table name of getting too long.\\nThe sequence is separated by #\\n\\nstringseq_2_cutout_from_vn (In Custom Step Version: \\\"Target Variablename: Provide String that Should be Cut Out (sep by #)\\\")\\nsuggested default value: empty/missing.\\nProvide a sequence of characters strings that should be omitted in the target variable name. This  prevents the variable table name of getting too long.\\nThe sequence is separated by #\\n\\nprefix_4_suspicious_src_fl (In Custom Step Version: \\\"Provide Filename Prefix if source file is suspicious.\\\")\\nsuggested default value: empty/missing.\\nA string can be provided (max of length LEN as provided in parameter “wof2l_max_lgth_of_suspicious_str”), that will be added and replace the first LEN characters of the table name, if the content seems suspicious.\\nThis would then suggest to check on the source file to understand what is going on.\\nPossible causes for suspicion:\\n\\nMissing variable names\\nDuplicate variable names\\nIf variables are completely missing.\\n\\n\\nmax_lgth_of_suspicious_str (In Custom Step Version: \\\"Max allowed length for Prefix in Filename for suspicious filenames.\\\")\\nsuggested default value: 4\\nThis parameter determines the maximum length of an allowed prefix for suspicious files.\\n\\ncheck_csv_4_num (In Custom Step Version: \\\"Check character fields in CSV Files for numeric?\\\")\\nsuggested default value: 0\\n0 (default): this means csv file is read in as-is\\n1: in cases when it is a \\\"quoted\\\" csv files (e.g. happens when come of the content contains the separator), then when this is turned on, the process will perform an additional check on the data that was read in to check of some of the variables that were read in as character actually should be numeric.\\n\\nforce_upload_of_all_files (In Custom Step Version: \\\"Force upload of all files, even if already uploaded?\\\")\\nsuggested default value: 0\\n0 (default): Files are only uploaded if they were updated since last upload\\n1: All files are uploaded no matter if they were uploaded before or not. No date check happening with this option.\\n\\ndiap_fnl_tblname_from_sheetonly (In Custom Step Version: \\\"For Multi Table Files (e.g. XLSX, XML, JSON), derive final dataset name from sheet only?\\\")\\nsuggested default value: 0\\n0 (default): The final dataset name is determined using the filename AND the sheetname (same principles are applied for XLSX, JSON and XML files).\\n1: The final dataset name is determined using ONLY the sheetname (same principles are applied for XLSX, JSON and XML files), ignoring the filename.\\n\\ndiap_create_unique_target_tblnm (In Custom Step Version: \\\"Create unique final dataset name for different source files/sheets with the same name (in different locations)?\\\")\\nsuggested default value: 1\\n0 : when creating the final dataset name, and the final dataset name ends up being the same for 2 or more source files, then DIAP will try to append all those different source files into one target dataset.\\n1 (default): when creating the final dataset name, and the final dataset name ends up being the same for 2 or more source files, then DIAP will add a unique counter to the final dataset name, so that the content of each source file is written in its own final dataset.\\n\\nchck_4_spcl_char_in_vars (In Custom Step Version: \\\"Clean up variable name from weird characters?\\\")\\nsuggested default value: 1\\n0 : variable names are only checked for minimal \\\"weird\\\" characters (like: &, ', \\\", %, #, ','). With this, option validvarname =any has to be set when wanting to work/see dataset from SAS Studio.\\n1 (default): all weird characters are replace with underscore (_) to create a clean variable name.\\n\\nfnl_ds_name_4_all_extfiles (In Custom Step Version: \\\"If string provided, all external files will be read into ONE table with the name of this string.\\\")\\nsuggested default value: blank(keep empty)\\nif this field is non blank, then the string provided with this macrovariables is used as the target table name and DIAP will try to combine all external files that are read in, into this one table.\\nThis table will be created (or if existent already, all the new data appended) in the provided target libname.\\nMaximum characters allowed are 32.\\nIf a string/tablename is set here, the setting of diap_create_unique_target_tblnm is ignored.\\n\\nONLY AVAILABLE IN CUSTOM STEP: \\\"Select DIAP Execution Mode\\\"\\nThere are 4 execution modes available:\\n\\n(1) Fully Automated\\n(2) Guided Automated Execution via Explicit File List (using specific structured CSV file)\\n(3) Create Guided Automation Control File Template\\n(4) Create Fixed Width Control File Template\\n\\nIf (3) is selected: The name of the file created in the selected directory is: \\\"_DIAP_guided_execution.csv\\\".\\nIf (4) is selected: The name of the file created in the selected directory is: \\\"_DIAP_Special_File_Definition.csv\\\".\\nWhen (3) or (4) is selected, as a next step please download the template csv files on your local machine for customized settings of the fields.\\nThe provided content that is created in the template is merely an example and SHOULD be deleted and replaced with the settings needed to read in fixed with files or xml files (with defintion files).\\nThen upload the customized CSV files to the server, so that DIAP can process them accordingly.\\n\\ndiap_guided_automation_fl_loc (In Custom Step Version: \\\"Select DIAP Execution Mode -> (2)\\\")\\nsuggested default value: blank (keep empty)\\nIf this parameter is NOT empty, DIAP will try to read instructions from this file and will ignore any settings in root_directory.\\nThis path can point to a file under SAS Server or under SAS Content.\\nDepending on where it is located, the provided path has to look like the following:\\n\\nif located under SAS SERVER: sasserver:/specific/path/to/file/under/sasserver/guided_execution_instructions.csv\\nif located under SAS CONTENT: sascontent:/specific/path/to/file/under/sascontent/guided_execution_instructions.csv\\n\\n\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"diap_guided_auto_fl_loc_ui\": \"\",\n\t\t\"root_directory_ui\": \"\",\n\t\t\"controlfile_target_location_ui\": \"\",\n\t\t\"DIAP_mode_selection_ui\": {\n\t\t\t\"value\": \"1\",\n\t\t\t\"label\": \"1 - Fully Automated\"\n\t\t},\n\t\t\"Extension_ui\": {\n\t\t\t\"value\": \"*\"\n\t\t},\n\t\t\"target_libname_ui\": \"work\",\n\t\t\"root_directory_overwrite_ui\": \"\",\n\t\t\"diap_traverse_directories_ui\": {\n\t\t\t\"value\": \"1\"\n\t\t},\n\t\t\"make_imported_data_persistent_ui\": {\n\t\t\t\"value\": \"1\",\n\t\t\t\"label\": \"Yes\"\n\t\t},\n\t\t\"force_upload_of_all_files_ui\": {\n\t\t\t\"value\": \"0\",\n\t\t\t\"label\": \"No\"\n\t\t},\n\t\t\"chck_4_spcl_char_in_vars_ui\": {\n\t\t\t\"value\": \"1\",\n\t\t\t\"label\": \"Yes\"\n\t\t},\n\t\t\"prefix_4_suspicious_src_fl_ui\": \"\",\n\t\t\"skip_files_starting_with_seq_ui\": \"\",\n\t\t\"skip_files_ending_with_seq_ui\": \"\",\n\t\t\"csv_big_data_mode_ui\": {\n\t\t\t\"value\": \"0\",\n\t\t\t\"label\": \"No\"\n\t\t},\n\t\t\"check_csv_4_num_ui\": {\n\t\t\t\"value\": \"0\",\n\t\t\t\"label\": \"No\"\n\t\t},\n\t\t\"special_chrctr_seq_2_chck_inhex2\": \"0A#0D\",\n\t\t\"spcl_chrctr_check_rplcmnt_inhex2\": \"00\",\n\t\t\"check_txt_file_4_special_chrctui\": {\n\t\t\t\"value\": \"0\",\n\t\t\t\"label\": \"No\"\n\t\t},\n\t\t\"substitute_string_seq_ui\": \"aeioAEOI\",\n\t\t\"max_table_length_ui\": 27,\n\t\t\"drop_missing_vars_ui\": {\n\t\t\t\"value\": \"0\",\n\t\t\t\"label\": \"(0) Keep All\"\n\t\t},\n\t\t\"stringseq_2_cutout_from_fn_ui\": \"\",\n\t\t\"stringseq_2_cutout_from_vn_ui\": \"\",\n\t\t\"diap_create_unique_target_tblnm2\": {\n\t\t\t\"value\": \"1\",\n\t\t\t\"label\": \"Yes\"\n\t\t},\n\t\t\"fnl_ds_name_4_all_extfiles_ui\": \"\",\n\t\t\"diap_fnl_tblname_from_sheetonly2\": {\n\t\t\t\"value\": \"0\",\n\t\t\t\"label\": \"No\"\n\t\t},\n\t\t\"meta_centralized_ui\": {\n\t\t\t\"value\": \"0\",\n\t\t\t\"label\": \"No\"\n\t\t},\n\t\t\"libname_meta_centralized_ui\": \"Public\",\n\t\t\"debug_mode_ui\": {\n\t\t\t\"value\": \"0\",\n\t\t\t\"label\": \"No\"\n\t\t},\n\t\t\"log_file_path_ui\": \"\",\n\t\t\"write_log_into_file_ui\": {\n\t\t\t\"value\": \"0\",\n\t\t\t\"label\": \"No\"\n\t\t},\n\t\t\"max_lgth_of_suspicious_str_ui\": 3,\n\t\t\"options_seq_ui\": \"nonotes nomprint nosource\"\n\t},\n\t\"promptHierarchies\": []\n}","templates":{"SAS":"data work._diap_option_setting_storage;\n\tlength\n\t\tnew_setting $24.\n\t\toriginal_setting $24.\n\t\tnew_setting_seq $256.\n\t\t;\n\tnew_setting = \"\";\n\toriginal_setting = \"\";\n\tnew_setting_seq = \"\";\n\tnumberofsettings = 0;\n\tif 0;\nrun;\n%let _DIAP_option_validvarname_org = %sysfunc(getoption(validvarname));\noption validvarname = any;\n%if \"&options_seq_ui\" ne \"\" %then\n%do;\ndata _diap_option_setting_storage;\n\tlength new_setting $24.;\n\tnew_setting_seq = strip(\"&options_seq_ui\");\n\tnumberofsettings = count(new_setting_seq, \" \") + 1;\n\t\n\tdo i = 1 to numberofsettings;\n\t\tnew_setting = \"\";\n\t\tnew_setting = scan(new_setting_seq, i, \" \");\n\t\tif not missing(new_setting) then\n\t\tdo;\n\t\t\toriginal_setting = getoption(new_setting);\n\t\t\tcall execute(\"option \"||new_Setting||\";\");\n\t\n\t\t\toutput;\n\t\tend;\n\tend;\n\trun;\t\n%end;\n \n \n%let production_mode = 1;\n%let fcmp_run_indicator = 0;\n%let install_mode_in_SAS_Content = 0;\n \n \n%let diap_delimiter = ;\n%macro set_os_dependent_values(\n\tsodv_delimiter = diap_delimiter\n\t);\n\t%if %upcase(&SYSSCP) = WIN %then\n\t%do;\n\t\t%let &sodv_delimiter = \\;\n\t%end; %else\n\t%do;\n\t\t%let &sodv_delimiter = /;\n\t%end;\n%mend;\n%set_os_dependent_values(\n\tsodv_delimiter = diap_delimiter\n\t);\n \n \n%let DIAP_root = /mnt/downloads/production_code/;\n \n%let macro_root_directory = &DIAP_root.macros&diap_delimiter.;\n%let wrapper_root_directory = &DIAP_root.wrapper&diap_delimiter.;\n \n%let development = ;\n%let development_wrapper = ;\n%macro check_4_development(\n\tmacro_variable_name_wrapper = development_wrapper,\n\tmacro_variable_name_macros = development,\n\tc4d_production_mode = 0,\n\tc4d_delimiter = /\n\t);\n\t%if \"&c4d_production_mode\" ne \"1\" %then\n\t%do;\n\t\t%let &macro_variable_name_wrapper = development_wrapper&c4d_delimiter;\n\t\t%let &macro_variable_name_macros = development_macros&c4d_delimiter;\n\t%end;\n%mend;\n%check_4_development(\n\tmacro_variable_name_wrapper = development_wrapper,\n\tmacro_variable_name_macros = development,\n\tc4d_production_mode = &production_mode,\n\tc4d_delimiter = &diap_delimiter.\n);\n/******************************************************************************\n\t\t\t\t01_default_setting_wrapper_import_files_into_viya.sas\nDefault settings for\nwrapper_import_files_into_viya.sas\n________\n \n \nThis is part of DIAP.\n \n \n______________________________________________________________________________\n \n \nUSAGE:       Please follow DIAP usage guide.\n \n______________________________________________________________________________\n \nDESCRIPTION:\n \nThis contains all the default settings for DIAP.\n \n______________________________________________________________________________\n \n \nINPUT PARAMETERS AND KEYWORDS:\n \nroot_directory:\n\t\tprovide the root directory to start checking for\nextension:\n\t\tuse wildcard for any files (*) or a specific one as outlined above\ntarget_libname:\n\t\tprovide SAS or CAS libname, needs to be preassigned, or assigned\n\t\twithin the session\n \n \n \n______________________________________________________________________________\n \nNOTES: (Initials, date, summary)\n \nStephan Weigandt     \t20200406\tFirst officially Released Version\nStephan Weigandt     \t20200420\tadded functionality and fixes\nStephan Weigandt\t\t20210326\tcreate dynamic include statement depending on install location\n______________________________________________________________________________\n \n*******************************************************************************/\n/* option validvarname = any; */\n%let root_directory = /mnt/downloads/ZZ_Testing/top_folder/fixed_width/;\n%let extension = *;\n%let target_libname = ZZ_Tstng;\n%let target_libname = work;\n%let diap_traverse_directories = 1;\n/**\nwifiv_write_log_into_file:\n\tset to 1 if the log should be written out into a file.\n\tset to 0 if the log should go to the default output (e.g. log windows).\nwifiv_provide_default_log_path:\n\tleave empty, then the log is written to a file which is created in the provided top level directory.\n\tprovide a default path for all runs: as soon as a path is provided, this path is being used for ALL runs.\n**/\n \n%let provide_default_log_path = /mnt/downloads/production_code/Logs_of_Runs/;\n%let write_log_into_file = 1;\n \n/*****\nprofiling_execution_option:\nSelect between the following 3 options:\nNO: this is the default, in case the AUTOPROFILING component is not installed, or it is not desired\n\tto execute anything into the AUTOPROFILING section.\nDICT_ONLY:\n\tin this mode, all the uploaded table are only loaded into the profiling dictionary, ready to be p\n\tprofiled, but no profliling is executed.\nPROFILE:\n\tthis option creates some default dictionary entries and also creates the corresponding profiles.\n \nprfl_dict_lctn_in_content_area:\n\tIMPORTANT: LEAVE EMPTY IF CDQM(Data Quality Management System) IS NOT INSTALLED. Then DIAP will\n\t\t\tignore \"profiling_execution_option\" parameter.\n\tIf installed: provide path to dictionary area (must be in SAS CONTENT area, otherwise please\n\tcontact DIAP developement team)\nprfl_cd_lctn_in_content_area\n\tIf CDQM is installed, provide path to code/program area (must be in SAS CONTENT area, otherwise please\n\tcontact DIAP developement team)\n*****/\n \n%let profiling_execution_option = No;\n%let prfl_cd_lctn_in_content_area = /Public/DM_Assets/SAS_DQ_AUTOPROFILE/Programs;\n%let prfl_dict_lctn_in_content_area = /Public/DM_Assets/SAS_DQ_AUTOPROFILE/Imports;\n%let prfl_cd_lctn_in_content_area = ;\n%let prfl_dict_lctn_in_content_area = ;\n \n/******\npath_2_python_shape_script\n\t\tif missing, the app uses the SAS way to read in SHAPE files, otherwise this\n\t\tis the full file path to the python script (which would also include setting up the\n\t\tpython environment).\n******/\n \n%let path_2_python_shape_script = /mnt/viyashare/tools/run_shapeshift.sh;\n%let path_2_python_shape_script = ;\n \n/****\nmax_table_name_length:\nthis determines the maximum allowed table name length.\nE.g. in the case of uploading XLSX files to SAS94, the final table name\nis built by concatenating Excel-filename and Sheetname.\nSo this can easily lead to a datasetname that is too long.\nAlso take into consideration that the concatenated name for multiple tables could\npotentially the same in the abbreviated form.\nThe system checks for that and adds a counter to the table name.\nSo leave at least 2 characters for a counter.\n****/\n \n%let max_table_name_length = 27;\n \n \n/****\ncheck_txt_file_4_special_chrct\ndefault value: 0\n\t0: read text files in as-is\n\t1: before reading in, check text files for special characters within quotes as provided in special_chrctr_seq_2_chck_in_hex and replace\n\t\twith character as provided in spcl_chrctr_check_rplcmnt_in_hex\n \nspecial_chrctr_seq_2_chck_in_hex\ndefault value: 0A#0D\nthis is only used when parameter check_txt_file_4_special_chrct is set to 1\nPlease provide special character in a #-delimited sequence in hex format.\nExample:\n0A#0D: checks for new line feed (0A) and carriage return (0D)\nsee asciitable.com\n \nspcl_chrctr_check_rplcmnt_in_hex\ndefault value: 00\nPlease provide the characters that should be used to replace the special characters as defined in special_chrctr_seq_2_chck_in_hex\nThe characters value is provided in hex format.\n****/\n \n%let check_txt_file_4_special_chrct = 0;\n%let special_chrctr_seq_2_chck_in_hex = 0A#0D;\n%let spcl_chrctr_check_rplcmnt_in_hex = 00;\n \n \n/****\nskip_files_starting_with_seq\ndefault value:\n\tif not missing, DIAP will skip all the files that start out with the sequence of string snippets\n\tseparated by #.\nE.g. if set to:\nfilebeginning1#filebeginning2\nAll files that start out with either filebeginning1 or filebeginning2 will NOT be ingested.\n \nskip_files_ending_with_seq\n\tif not missing, DIAP will skip all the files that end out with the sequence of string snippets\n\tseparated by #.\nE.g. if set to:\nfile_ending1#file_ending2#csv\nAll files that end with either file_ending1 or file_ending2 or csv will NOT be ingested.\nE.g. in this example all csv files will be skipped.\n \n****/\n \n%let skip_files_starting_with_seq = _DIAP_Special_File_Definition.csv;\n%let skip_files_ending_with_seq = ;\n \n/****\nsubstitute_string_seq:\nIf the target table name is too long, this string determines which\ncharacters are taken out from the targeet name to shorten the name further,\nbefore the truncation process kicks in.\nE.g. when substitute_string_seq = aeAEoO\nthen a table name of\n\"ThisIsAVeryLongTableNameThatIsTooLong\" and a\nmax_table_name_length = 29\nwould be first changed to the following:\n\"ThisIsVryLngTblNmThtIsTLng\" which would be short enough\n****/\n \n%let substitute_string_seq = aeiouAEIOU;\n \n%let meta_centralized = 1;\n%let libname_meta_centralized = DM_DtMrt;\n%let libname_meta_centralized = Public;\n \n%let debug_mode = 1;\n \n/**************\nPlease change all parameters above this section as needed.\nSee the meaning of the keywords in the headersection.\nDon't change anything below this section!!\nSet below values to missing if DIAP is executed in 94 environment\n***************/\n \n%let shp_enrich_with_zip = 0;\n \n%let _DIAP_CASHOST_ = controller.viya.sas;\n%let _DIAP_CASPORT_ = 5570;\n%let DIAP_viyaversion = 35;\n%let _DIAP_CASPORT_ = ;\n%let _DIAP_CASHOST_ = ;\n%let DIAP_viyaversion = ;\n \n \n/*****\ncsv_big_data_mode\n\t0: read in with default mode (normal proc import stuff)\n\t1: in big data mode, for anticipated number of variables greater than 2000+, depending of the vector gets bigger than 32k\n*****/\n \n%let csv_big_data_mode = 0;\n \n \n/*****\nmake_imported_data_persistent\n\t0: imported data is only written to memory (promoted)\n\t1: imported data is written to memory (promoted) and also written to disk (persistent)\n*****/\n \n%let make_imported_data_persistent = 1;\n \n/****\ndrop_missing_vars:\n\t0: Don't Drop Missing Variables.\n\t1: Drop ALL Variables with ALL missing values.\n\t2: Drop only vars with miss. varnames AND all miss. values.\n\t3: Same as (1), without uploading data.\n\t4: Same as (2), without uploading data.\n*****/\n \n%let drop_missing_vars = 0;\n \n/****\nstringseq_2_cutout_from_fn\nstringseq_2_cutout_from_vn\n\tfor both parameters: provide a sequence of characters strings that should be either\n\tomitted in the target filename, or the target variable name.\n\tThe sequence is separated by #\n*****/\n \n%let stringseq_2_cutout_from_fn = ;\n%let stringseq_2_cutout_from_vn = ;\n \n/********\n\tprefix_4_suspicious_src_fl\n\t\there a string can be provided (max of length LEN as provided in parameter wof2l_max_lgth_of_suspicious_str), that will be added and replace\n\t\tthe first LEN characters of the table name, is the content seems suspicious and suggests to check on the source file\n\tmax_lgth_of_suspicious_str\n\t\tthe max length is set to 4 by default\n \n*********/\n \n%let prefix_4_suspicious_src_fl=;\n%let max_lgth_of_suspicious_str=4;\n \n/******\n\tcheck_csv_4_num\n\t\t0 (default): this means csv file is read in as-is\n\t\t1: in cases when it is a \"quoted\" csv files (e.g. happens when come of the content contains the separator), then when this is\n\t\t\tturned on, the process will perform an andditional check on the data that was read in to check of some of the variables that\n\t\t\twere read in as character actually should be numeric.\n*****/\n \n%let check_csv_4_num = 0;\n \n/******\n\tforce_upload_of_all_files\n\t\t0 (default): Files are only uploaded if they were updated since last upload\n\t\t1: All files are uploaded independent if they were uploaded before or not. No date check happening with this option.\n*****/\n \n%let force_upload_of_all_files = 0;\n \n/******\n\tdiap_fnl_tblname_from_sheetonly\n\t\t0 (default): The final dataset name is determined using the filename AND the sheetname (same principles are applied for\n\t\t\t\t\tXLSX, JSON and XML files).\n\t\t1: The final dataset name is determined using ONLY the sheetname (same principles are applied for\n\t\t\t\t\tXLSX, JSON and XML files), ignoring the filename.\n*****/\n \n%let diap_fnl_tblname_from_sheetonly = 0;\n \n/******\n\tdiap_create_unique_target_tblnm\n\t\t0 : when creating the final dataset name, and the final dataset name ends up being the same for 2 or more source files,\n\t\t\tthen DIAP will try to append all those different source files into one target dataset.\n\t\t1 (default): when creating the final dataset name, and the final dataset name ends up being the same for 2 or more source files,\n\t\t\tthen DIAP will add a unique counter to the final dataset name, so that the content of each source file is written in its\n\t\t\town final dataset.\n*****/\n \n%let diap_create_unique_target_tblnm = 1;\n \n/******\n\tchck_4_spcl_char_in_vars\n\t\t0 : variable names are only checked for minimal \"weird\" characters (like: &, ', \", %, #, ','). With this, option validvarname =any has to be set\n\t\t\twhen wanting to work/see dataset from SAS Studio.\n\t\t1 (default): all weird characters are replace with underscore (_) to create a clean variable name.\n*****/\n \n%let chck_4_spcl_char_in_vars = 1;\n \n/******\n\tfnl_ds_name_4_all_extfiles\n\t\tif this field is non blank, then the string provided with this macrovariables is used as the target table name and DIAP will try to\n\t\tcombine all external files that are read in, into this one table.\n\t\tThis table will be created (or if existent already, all the new data appended) in the provided target libname.\n\t\tMaximum characters allowed are 32.\n\t\n\t\tIf a string/tablename is set here, the setting of diap_create_unique_target_tblnm is ignored.\n*****/\n \n%let fnl_ds_name_4_all_extfiles = ;\n \n \n/******\n\tdiap_guided_automation_fl_loc\n\t\tif this field is blank files that need to be uploaded are discovered automatically by traversing through all the directories\n\t\tthat can be found under the root directory.\n\t\n\t\tOtherwise please provide the full path starting out either with \"SASSERVER:\" if the file is located on the sasserver, or with\n\t\t\"SASCONTENT:\" if the file is located in SAS Content.\n*****/\n \n%let diap_guided_automation_fl_loc = ;\n/******************************************************************************\n \n%list_all_files\n________\n \n \ncreates a list of files, based on the provided extensions, that are available\nwithin a root directory. It automatically also checks all subdirectories.\n \n______________________________________________________________________________\n \n \nUSAGE:                         see testing section on the bottom of this code\n \n______________________________________________________________________________\n \nDESCRIPTION:\n \nThis macro creates a SAS dataset that lists all files that can be found within a\nroot directory and all subdirectories under the provided root directory. This can be\napplied to all available files (by choosing \"*\" as extension), or for specific extensions.\n______________________________________________________________________________\n \n \nINPUT PARAMETERS AND KEYWORDS:\n \nlaf_root_dir                  provide the top level directory from where to search for files.\nlaf_extenstion_to_check       can be the wildcard \"*\" or any extension, e.g. \"CSV\", \"XLM\" etc\n\t\t\t\t\t\t\t\t(provide without quotes)\nlaf_output_ds_file_overview   provide SAS datasets providing LIBNAME and SAS Dataset name\n______________________________________________________________________________\n \nNOTES: (Initials, date, summary)\n \nStephan Weigandt    20200406  First officially Released Version\nStephan Weigandt    20220610  expanded functionality to also cover SAS Content objects\n______________________________________________________________________________\n \n*******************************************************************************/\n \n%macro list_all_files(\n\tlaf_root_dir,\n\tlaf_extenstion_to_check,\n\tlaf_output_ds_file_overview,\n\tlaf_debug_mode = 0,\n\tlaf_directory_separator = /,\n\tlaf_traverse_directories = 1,\n\tlaf_is_sas_content_directory = 0,\n\tlaf_iteration_number = 0_0,\n\tlaf_include_directories = 0\n\t);\n\t%local\n\t\tfilrf\n\t\trc\n\t\tdid\n\t\tmemcnt\n\t\tname\n\t\tlal_append_flag\n\t\tlal_length\n\t\ttot_obs\n\t\ttable_append_seq\n\t\tlaf_full_file_name\n\t\ti;\n \n \n\t%let lal_length = %length(&laf_root_dir);\n\t%if \"%substr(%trim(%left(&laf_root_dir)), &lal_length, 1)\" ne \"%trim(%left(&laf_directory_separator))\" %then\n\t%do;\n\t\t%let laf_root_dir = %trim(%left(&laf_root_dir))&laf_directory_separator;\n\t%end;\n\t%if &laf_iteration_number = 0_0 %then\n\t%do;\n\t\tproc datasets lib= work;\n\t\t\tdelete _DIAP_spcl_list_files_:;\n\t\tquit;\n\t%end;\n\t%let laf_do_processing = 1;\n\t%if &laf_is_sas_content_directory = 0 %then\n\t%do;\n\t\tfilename f&laf_iteration_number \"&laf_root_dir\";\n\t%end; %else\n\t%do;\n\t\t%let laf_rc = 1;\n\t\tdata _null_;\n\t\t\tlength fref $ 8 folderPath $ 1024;\n\t\t\tfolderPath = \"&laf_root_dir\";\n\t\t\tfref=\"__isdir\";\n\t\t\trcf = filename(fref, , \"filesrvc\", cats('folderpath=',quote(strip(folderPath))));\n\t\t\tput rcf;\n\t\t\tcall symput (\"laf_rc\", strip(rcf));\n\t\trun;\n \n\t \t%if &laf_rc = 0 %then\n\t\t%do;\n\t\t\tfilename f&laf_iteration_number filesrvc folderpath=\"&laf_root_dir\";\n\t\t%end; %else\n\t\t%do;\n\t\t\t%let laf_do_processing = 0;\n\t\t%end;\n\t%end;\n\t%let laf_next_iteration = %eval(%scan(&laf_iteration_number, 1, '_') + 1);\n\t%let lal_append_flag = 0;\n\t%if %sysfunc(exist(work._DIAP_spcl_list_files_&laf_iteration_number)) %then\n\t%do;\n\t\tdata work._DIAP_spcl_list_files_&laf_iteration_number._inter;\n\t\t\tset work._DIAP_spcl_list_files_&laf_iteration_number\n\t\t\t%if %sysfunc(exist(work._DIAP_spcl_list_files_&laf_iteration_number._inter)) %then\n\t\t\t%do;\n\t\t\t\twork._DIAP_spcl_list_files_&laf_iteration_number._inter\n\t\t\t%end;\n\t\t\t;\n\t\trun;\n\t\t%let lal_append_flag = 1;\n\t%end;\n\tdata work._DIAP_spcl_list_files_&laf_iteration_number ;\n\t\tkeep\n\t\t\tdirectory_path\n\t\t\tfull_file_name\t\n\t\t\tfile_name\n\t\t\tis_in_SAS_Content_flag\n\t\t\t%if &laf_include_directories = 1 %then\n\t\t\t%do;\n\t\t\t\tobject_type\n\t\t\t%end;\n\t\t\t;\n\t\tlength\n\t\t\tdirectory_path $768\n\t\t\tfile_name $256\n\t\t\tfull_file_name $1024\n\t\t\t%if &laf_include_directories = 1 %then\n\t\t\t%do;\n\t\t\t\tobject_type $12\n\t\t\t%end;\n\t\t\t;\n\t\tis_in_SAS_Content_flag = &laf_is_sas_content_directory;\n\t\tdirectory_path = symget(\"laf_root_dir\");\n\t%if &laf_do_processing = 1 %then\n\t%do;\n\t\tdid = dopen(\"f&laf_iteration_number\");\n\t\tmcount = dnum(did);\n\t\t/**\n\t\tcheck if directory exists or the correct area is chosen.\n\t\tif not set to 0 to prevent error message\n\t\t**/\n\t\tif missing(mcount) then\n\t\t\tmcount = 0;\n\t\tdo i=1 to mcount;\n\t\t\tfile_name = dread(did, i);\n\t\t\tfid = mopen(did, file_name);\n\t\t\tfileext = find(file_name,'.');\n\t\t\textension = scan(file_name, -1, '.');\n\t\t\t/* fid=0 means directory in most cases */\n\t\t\tfull_file_name = STRIP(directory_path)||STRIP(file_name);\n\t\t\tif fid > 0 or fileext then\n\t\t\tdo;\n\t\t\t\tif \"&laf_extenstion_to_check\" = \"*\" or\t\n\t\t\t\tupcase(extension) = %upcase(\"&laf_extenstion_to_check\") then\n\t\t\t\tdo;\n\t\t\t\t\t%if &laf_debug_mode %then\n\t\t\t\t\t%do;\n\t\t\t        \tput \"INFORMATION: Found following file:\" full_file_name;\n\t\t\t\t\t%end;\n\t\t\t\t\t%if &laf_include_directories = 1 %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\tobject_type = \"file\";\n\t\t\t\t\t%end;\n\t\t\t\t\toutput;\n\t\t\t\tend;\n\t\t\t\t%if &laf_debug_mode %then\n\t\t\t\t%do;\n\t\t\t\t\telse\n\t\t\t\t\tdo;\n\t\t\t\t\t\tput \"INFORMATION: Skipping due to extension:\" full_file_name;\n\t\t\t\t\tend;\n\t\t\t\t%end;\n\t\t\tend;\n\t\t\t%if &laf_traverse_directories = 1 %then\n\t\t\t%do;\n\t\t\t\telse\n\t\t\t\tdo;\n\t\t\t\t\t%if &laf_debug_mode %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\tput 'INFORMATION: Scanning next directory:' full_file_name;\n\t\t\t\t\t%end;\n\t\t\t\t\t%if &laf_include_directories = 1 %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\tobject_type = \"folder\";\n\t\t\t\t\t\toutput;\n\t\t\t\t\t%end;\t\t\t\t\t\n\t\t\t\t\targ1 = cats('%nrstr(%list_all_files(', full_file_name, \", &laf_extenstion_to_check,\");\n\t\t\t\t\targ2 = cats(\"&laf_output_ds_file_overview,\n\t\t\t\t\tlaf_debug_mode = &laf_debug_mode,\");\n\t\t\t\t\targ3 = cats(\"laf_directory_separator = &laf_directory_separator,\n\t\t\t\t\tlaf_traverse_directories = &laf_traverse_directories,\");\n\t\t\t\t\targ3b = cats(\"laf_include_directories = &laf_include_directories, \");\n\t\t\t\t\targ4 = cats(\"laf_is_sas_content_directory = &laf_is_sas_content_directory,\n\t\t\t\t\tlaf_iteration_number = &laf_next_iteration._\",i,\"))\");\n\t\t\t\t\tcall execute(strip(arg1)||strip(arg2)||strip(arg3)||strip(arg3b)||strip(arg4));\n \n \n\t\t\t\tend;\n\t\t\t%end;\n\t\tend;\n\t\trc = dclose(did);\n\t%end;\n%else\n\t%do;\n\t\tfull_file_name = STRIP(substr(directory_path, 1, length(directory_path)-1));\n\t\t%if &laf_include_directories = 1 %then\n\t\t%do;\n\t\t\tobject_type = \"file\";\n\t\t%end;\n \n\t\toutput;\n\t%end;\n\trun;\n \n \n\t%let tot_obs = 0;\n\tproc sql noprint;\n\t\tselect nobs into :tot_obs\n\t\tfrom dictionary.tables\n\t\twhere upcase(libname)='WORK' and upcase(memname)=\"_DIAP_SPCL_LIST_FILES_&laf_iteration_number\";\n\tquit;\n\t%put total records = &tot_obs.;\t\n\t%if &tot_obs = 0 %then\n\t%do;\n\t\tproc datasets lib= work;\n\t\t\tdelete _DIAP_SPCL_LIST_FILES_&laf_iteration_number;\n\t\tquit;\n\t\t%if lal_append_flag = 1 %then\n\t\t%do;\n\t\t\tdata work._DIAP_spcl_list_files_&laf_iteration_number.;\n\t\t\t\tset work._DIAP_spcl_list_files_&laf_iteration_number._inter;\n\t\t\trun;\n\t\t\tproc datasets lib= work;\n\t\t\t\tdelete _DIAP_spcl_list_files_&laf_iteration_number._inter;\n\t\t\tquit;\n\t\t%end;\n\t%end; %else\n\t%do;\n\t\t%if lal_append_flag = 1 %then\n\t\t%do;\n\t\t\tdata work._DIAP_spcl_list_files_&laf_iteration_number.;\n\t\t\t\tset work._DIAP_spcl_list_files_&laf_iteration_number.\n\t\t\t\t\twork._DIAP_spcl_list_files_&laf_iteration_number._inter;\n\t\t\trun;\n\t\t\tproc datasets lib= work;\n\t\t\t\tdelete _DIAP_spcl_list_files_&laf_iteration_number._inter;\n\t\t\tquit;\n\t\t%end;\n\t%end;\n\t\n\t%if &laf_iteration_number = 0_0 %then\n\t%do;\n\t\t%let table_append_seq = ;\n\t\tproc sql noprint;\n\t\t\tselect memname into :table_append_seq separated by \" \"\n\t\t\tfrom dictionary.tables\n\t\t\twhere upcase(libname)='WORK' and upcase(memname)contains\"_DIAP_SPCL_LIST_FILES_\";\n\t\tquit;\n\t\t%if \"&table_append_seq\" ne \"\" %then\n\t\t%do;\n\t\t\tdata work._laf_file_overview_sort;\n\t\t\t\tset &table_append_seq;\n\t\t\trun;\n\t\t\tproc sort data =work._laf_file_overview_sort;\n\t\t\t\tby full_file_name\n\t\t\t\t%if &laf_include_directories = 1 %then\n\t\t\t\t%do;\n\t\t\t\t\tdescending object_type\n\t\t\t\t%end;\t\t\t\t\n\t\t\t\t;\n\t\t\tquit;\n\t\t\t\n\t\t\tdata &laf_output_ds_file_overview;\n\t\t\t\tset work._laf_file_overview_sort;\n\t\t\t\tby full_file_name;\n\t\t\t\t%if &laf_include_directories = 1 %then\n\t\t\t\t%do;\n\t\t\t\t\tif first.full_file_name ne last.full_file_name  then\n\t\t\t\t\tdo;\n\t\t\t\t\tobject_type = \"file\";\n\t\t\t\t\tend;\n\t\t\t\t%end;\n\t\t\t\tif first.full_file_name;\n\t\t\trun;\n\t\t%end;\n \n \n\t%end;\n \n\t%if &laf_do_processing = 1 %then\n\t%do;\n\t\tfilename f&laf_iteration_number clear;\n\t%end;\n%mend list_all_files;\n/** FOR TESTING ***\n \n \noption mprint source notes;\n%let root_directory = /Users/<<MYUSERID>>/My Folder/SAS Videos;\n%let is_content_dir = 0;\n%let delimiter = /;\n%let delimiter = \\;\n%let include_directories = 1;\n%let extension = *;\n%let overview_ds = work.file_overview;\n%let traverse_directories = 1;\n%list_all_files(\n\t&root_directory,\n\t&extension,\n\t&overview_ds,\n\tlaf_traverse_directories = &traverse_directories,\n\tlaf_debug_mode = 1,\n\tlaf_directory_separator = /,\n\tlaf_is_sas_content_directory = &is_content_dir,\n\tlaf_include_directories = &include_directories\n\t);\n \n*********************/\n/******************************************************************************\n \n%write_out_files_2_libname\n________\n \n \nuploads a list of files that are listed in a \"#\"-separated sequence (without quotes).\n \n______________________________________________________________________________\n \n \nUSAGE:                         see testing section on the bottom of this code\n \n______________________________________________________________________________\n \nDESCRIPTION:\n \nThis macro uploads all files that are listed in a #-separated macro sequence into CAS.\nIt takes care of the following formats:\n- CSV\n- JMP\n- XLSX.\n______________________________________________________________________________\n \n \nINPUT PARAMETERS AND KEYWORDS:\n \nwof2l_full_filename_path_seq:\n\t\tThis is a # separated sequence of filenames with full path information.\n\t\tSo the sequence is like: path1/filename1 # path2/filename2 # and so on...\n\twof2l_cas_target_libname:\n\t\tprovide a SAS or CAS libname where the files that are found in the directory should be uploaded to.\n\t\tThe system can handle SAS or CAS libnames.\n\twof2l_fn_as_in_fxd_wdth_def_seq:\n\t\tIt is either blank, or a sequence of filenames separated by # as found\n\t\tin the special definition file\n\twof2l_directory_path_seq:\n\t\tThis is a # separated sequence of path that correspond to wof2l_full_filename_path_seq\n\t\tparameter.\n\t\tSo the sequence is like: path1 # path2 # and so on...\t\t\n\twof2l_guessing_row:\n\t\tdefault set to 5000,\n\t\tthis number is used to determine how many rows are used for the text files\n\t\tto determine the type of the columns that need to be read in.\n\twof2l_target_environment:\n\t\tdefault set to  AUTO,\n\t\tit is recommended to let it set to AUTO, otherwise it has to correspond to the\n\t\ttype of the provided target library\t\t\n\twof2l_upload_activation:\n\t\tdefault set to 1,\n\t\tThis parameter should only be changed when the program is used to test certain\n\t\tfunctionality that would not need to trigger the actual upload process.\n\t\tSet to 0 otherwise.\n\twof2l_max_name_length:\n\t\tmax allowed length of the table name, default value set to 29.\n\t\tIn case table name are the same because of truncation, and automated counter\n\t\tis inserted.\n\twof2l_debug_mode:\n\t\tdefault: 0\n\t\t1: writes out additional detail information about the process to the log window.\n\t\t0: no additional information is written out.\n\twof2l_upload_log_ds:\n\t\tdefault is set to work._Upload_log\n\t\tThis determines the dataset (full dataset name including the library) where the\n\t\tmetadata of the process is being stored with regards to uploaded files.\n\twof2l_shp_enrich_with_zip:\n\t\tdefault: 0\n\t\t0: Shape files are read in as is.\n\t\t1: additional zip information is merged into the SHAPE files assuming that they contain lattitude and longitude\n\t\t\tinformation. It also needs a specific lookup table for the process to be available.\t\t\n\twof2l_variable_dict_dataset:\n\t\tdefault is set to work._Variable_Dictionary\n\t\tThis determines the dataset (full dataset name including the library) where the\n\t\tmetadata of the process is being stored with regards to specifically variable names.\n\twof2l_substitute_string_seq:\n\t\tdefault: aeiouAEIOU\n\t\tThis sequence of characters determine which characters will be omitted if the target file name or variable name\n\t\tneeds to be truncated.\n\twof2l_fixed_file_definition_ds:\n\t\tcontains the full dataset name, that reflects the special file definitions as outlined\n\t\tin the csv file(s) within the subdirectory(s).\n\twof2l_do_profiling:\n\t\tdefault: NO\n\t\tNO: no additional processing is done for profiling purposes. This is also automatically chosen if the underlying\n\t\t\tparameters are not set that are needed for the processing of profiling.\n\t\tDICT_ONLY:  only fills in the default dictionary entries needed for the\n\t\t\tAUTOPROFILING app. The actual profiling needs to be triggered separatedly.\n\t\tPROFILE:\tThis option fills in the default dictionary entries AND also\n\t\t\ttriggers the execution of creating the actual profiles.\t\n\t\tPROFILE_ONLY_NO_UPLOAD:\tThis option fills in the default dictionary entries AND also\n\t\t\ttriggers the execution of creating the actual profiles. And it will skip the upload\n\t\t\tprocess, it will only profile the tables that it can find in the provided libname.\t\n\t\tThe last 2 options require the \"Autoprofiling\" application to be included with DIAP. For details check\n\t\tthe installation instructions.\n\twof2l_profile_dict_location:\n\t\tThis parameter is NOT used at this point.\n\twof2l_path_2_gis2zip_dataset4shp\n\t\tdefault: /mnt/downloads/production_data/metadata\n\t\tthis is the path that points to the dataset that contains GIS to ZIP data.\n\t\tThe name of that dataset has to be: GIS_2_ZCTA\n\t\tand contains the following 3 columns:\n\t\t\tx: longitude\n\t\t\ty: latitude\n\t\t\tzip_zcta: zipcode\n\twof2l_path_2_python_shape_script\n\t\tif missing, the app uses the SAS way to read in SHAPE files, otherwise this\n\t\tis the full file path to the python script (which would also include setting up the\n\t\tpython environment).\n\twof2l_drop_missing_vars\n\t\t0 (default): don't drop missing variables based on missing values\n\t\t1: drop all the variables that contain only missing values\n\t\t2: drop only the variables that have only missing values AND contain \"ZZ_MISSING_VARNAME_\" in their variable name\n\twof2l_stringseq_2_cutout_from_fn\n\t\there a sequence of strings can be provided (separated by #), that will be cut out when the target TABLE name is created.\n\twof2l_stringseq_2_cutout_from_vn\n\t\there a sequence of strings can be provided (separated by #), that will be cut out when the target VARIABLE name is created.\n\twof2l_prefix_4_suspicious_src_fl\n\t\there a string can be provided (max of length LEN as provided in parameter wof2l_max_lgth_of_suspicious_str), that will be added and replace\n\t\tthe first LEN characters of the table name, is the content seems suspicious and suggests to check on the source file\n\twof2l_max_lgth_of_suspicious_str\n\t\tthe max length is set to 4 by default\n\twof2l_check_csv_4_num\n\t\t0 (default): this means csv file is read in as-is\n\t\t1: in cases when it is a \"quoted\" csv files (e.g. happens when come of the content contains the separator), then when this is\n\t\t\tturned on, the process will perform an andditional check on the data that was read in to check of some of the variables that\n\t\t\twere read in as character actually should be numeric.\n______________________________________________________________________________\n \nNOTES: (Initials, date, summary)\n \nStephan Weigandt    20200406  First officially Released Version\n______________________________________________________________________________\n \n*******************************************************************************/\n \n%macro write_out_files_2_libname(\n\twof2l_full_filename_path_seq,\n\twof2l_cas_target_libname,\n\twof2l_fn_as_in_fxd_wdth_def_seq,\n\twof2l_directory_path_seq = ,\n\twof2l_guessing_row = 50000,\n\twof2l_target_environment = AUTO,\n\twof2l_upload_activation = 1,\n\twof2l_max_name_length = 29,\n\twof2l_debug_mode = 0,\n\twof2l_upload_log_ds = work._Upload_log,\n\twof2l_shp_enrich_with_zip = 1,\n\twof2l_variable_dict_dataset = work._VARIABLE_DICTIONARY,\n\twof2l_substitute_string_seq = aeiouAEIOU,\n\twof2l_fixed_file_definition_ds = ,\n\twof2l_do_profiling = NO,\n\twof2l_profile_dict_location = ,\n\twof2l_path_2_gis2zip_dataset4shp = /mnt/downloads/production_data/metadata,\n\twof2l_path_2_python_shape_script = ,\n\twof2l_csv_big_data_mode = 0,\n\twof2l_drop_missing_vars = 0,\n\twof2l_stringseq_2_cutout_from_fn = ,\n\twof2l_stringseq_2_cutout_from_vn = ,\n\twof2l_prefix_4_suspicious_src_fl = CHK,\n\twof2l_max_lgth_of_suspicious_str = 4,\n\twof2l_check_csv_4_num = 0,\n\twof2l_viyaversion = 35,\n\twof2l_chck_txt_fl_4_spcl_chrct = 0,\n\twof2l_spcl_chrctr_sq2chck_in_hex = 0A#0D,\n\twof2l_spcl_chrct_chck_rplcmnt_hx = 00,\n\twof2l_make_imported_data_prsstnt = 1,\n\twof2l_force_upload_of_all_files = 0,\n\twof2l_skip_files_start_with_seq =  ,\n\twof2l_skip_files_end_with_seq = ,\n\twof2l_fnl_tblname_from_sheetonly = 1,\n\twof2l_create_unique_target_tblnm = 0,\n\twof2l_delimiter = /,\n\twof2l_chck_4_spcl_char_in_vars = 1,\n\twof2l_fnl_ds_name_4_all_extfiles = ,\n\twof2l_diap_guided_automation = 0,\n\twof2l_gddauto_upd_fls_del_seq = ,\n\twof2l_gddauto_upd_fls_sht_seq = ,\n\twof2l_gddauto_upd_fls_cntt_flg =,\n\twof2l_gddauto_upd_fls_hdr_seq = ,\n\twof2l_gddauto_upd_fls_tgt_seq =\n\t);\n \n \n \n \n%local\t\n\two2c_full_file_name\n\two2c_file_extension\n\twof2l_filename\n\twof2l_table_name\n\twof2l_excel_table_seq\n\twof2l_xlsx_table_count\n\twof2l_full_table_name\n\twof2l_first_char\n\twof2l_full_fname_path_2_load_seq\n\twof2l_extension_2_load_seq\n\twof2l_target_table_name_seq\n\twof2l_sheet_name_seq\n\twof2l_table_to_process_check\n\twof2l_xlsx_varname_seq\n\twof2l_file_delimiter\n\twof2l_has_header\n\twof2l_delimiter_seq\n\twof2l_has_header_seq\n\twof2l_lrec_length\n\tvariable_count\n\tvariable_counter\n\twof2l_special_file_type\n\tfwf_directory_seq\n\tfwf_filename_seq\n\tfwf_incl_fn_in_table_out_seq\n\tfwf_file_type_seq\n\tfwf_variable_name_seq\n\tfwf_variable_label_seq\n\tfwf_variable_type_seq\n\tfwf_variable_length_seq\n\tfwf_variable_format_seq\n\tfwf_variable_informat_seq\n\tfwf_variable_start_position_seq\n\tfwf_variable_end_position_seq\n\twof2l_skip_mssng_vrnm_in_xls\n\twof2l_ds_2_profile_seq\n\twof2l_caslib_temp\n\twof2l_castable_temp\n\twof2l_final_ds_name\n\twof2l_chk_strng_in_var_4_missing\n\twof2l_output_dataset_name\t\n\twof2l_string_seq_cut_count\n\twof2l_string_seq_cut_counter\n\twof2l_path_for_sas_content_seq\n\twof2l_file_header_flag_seq\n\twof2l_header_flag_guided\n\twof2l_filepath_for_sas_content\n\twof2l_file_delimiter_guided\n\twof2l_file_delimiter_seq\n\t;\n/*********\nFirst determining if the libname points to a Viya or 94 environment.\nthis determines how the tables are uploaded in detail.\n*********/\n \n%let wof2l_string_seq_cut_count = 0;\n%let wof2l_string_seq_cut_count = %wordcnt(&wof2l_stringseq_2_cutout_from_vn, \"#\");\n \n%let wof2l_lrec_length = 32760;\n%let wof2l_max_var_name_length_target = 28;\n%if %upcase(&wof2l_target_environment) = AUTO %then\n%do;\n\tproc sql noprint;\n\t\tselect distinct(engine)\n\t\tinto :wof2l_target_environment\n\t\tfrom dictionary.libnames\n\t\twhere upcase(libname) = \"%upcase(&wof2l_cas_target_libname)\"\n\t\t;\n\tquit;\n%end;\n \n \n/*****\nCheck here if only profiling is desired withouth any upload activity,\nif so we jump to the end.\n******/\n%let wof2l_ds_2_profile_seq = ;\n \n \n%let wof2l_chk_strng_in_var_4_missing = ZZ_MISSING_VARNAME_;\n%if \"%upcase(&wof2l_do_profiling)\" = \"PROFILE_ONLY_NO_UPLOAD\" or\n\t&wof2l_drop_missing_vars gt 2 %then\n%do;\n\tproc sql;\n\t\tselect\n\t\t\tcat(trim(left(library)),\".\",trim(left(adjusted_table_name)))\n\t\tinto\n\t\t\t:wof2l_ds_2_profile_seq\tseparated by \" #\"\n\t\tfrom\n\t\t\t&wof2l_upload_log_ds\n\t\twhere\t\n\t\t\tupcase(library) =  \"%upcase(&wof2l_cas_target_libname)\" and\n\t\t\tnot missing(load_date);\n\tquit;\n\t%let wof2l_table_count_4_profiling = %wordcnt(&wof2l_ds_2_profile_seq, '#');\n\t%if &wof2l_debug_mode %then\n\t%do;\n\t\t%put INFORMATION: There are &wof2l_table_count_4_profiling tables that will be profiled only:.;\n\t\t%put INFORMATION: &=wof2l_ds_2_profile_seq ;\n\t%end;\n\t%if \"%upcase(&wof2l_do_profiling)\" = \"PROFILE_ONLY_NO_UPLOAD\" %then\n\t\t%let wof2l_do_profiling = PROFILE;\n \n\t%if &wof2l_drop_missing_vars gt 2 %then\n\t%do;\n\t\t%if &wof2l_drop_missing_vars eq 3 %then\n\t\t\t%let wof2l_drop_missing_vars = 1; %else\n\t\t%if &wof2l_drop_missing_vars eq 4 %then\n\t\t\t%let wof2l_drop_missing_vars = 2;\n\t%end;\n \n\t%if &wof2l_drop_missing_vars ne 0 %then\n\t%do;\n\t\t%let wof2l_ds2_prfl_seq_count = %wordcnt(&wof2l_ds_2_profile_seq, '#');\n\t\t%do wof2l_ds2_prfl_seq_counter = 1 %to &wof2l_ds2_prfl_seq_count;\n\t\t\t%let wof2l_ds_to_process = %scan(&wof2l_ds_2_profile_seq , &wof2l_ds2_prfl_seq_counter, '#');\n\t\t\t%let wof2l_final_table_name = %scan(&wof2l_ds_to_process , 2, '.');\n\t\t\t%let wof2l_cas_target_libname = %scan(&wof2l_ds_to_process , 1, '.');\n\t\t\tdata work.&wof2l_final_table_name;\n\t\t\t\tset &wof2l_ds_to_process;\n\t\t\trun;\n\t\t\t%if &wof2l_target_environment eq CAS %then\n\t\t\t%do;\n\t\t\t\tproc casutil;\n\t\t\t\t\tdroptable casdata = \"&wof2l_final_table_name\" incaslib = \"&wof2l_cas_target_libname\" quiet;\n\t\t\t\t\tdroptable casdata = \"&wof2l_final_table_name\" incaslib = \"&wof2l_cas_target_libname\" quiet;\n\t\t\t\tquit;\n\t\t\t%end;\n\t\t\t%DIAP_handling_missings_vars(\n\t\t\t\tdhm_missing_handling_option = &wof2l_drop_missing_vars,\n\t\t\t\tdhm_dataset_2_check = work.&wof2l_final_table_name,\n\t\t\t\tdhm_dataset_2_check_output = &wof2l_ds_to_process,\n\t\t\t\tdhm_dataset_2_write_out_results = _DIAP_only_missing_analysis_&wof2l_ds2_prfl_seq_counter,\n\t\t\t\tdhm_stg_2_chk_var_b4_drop = &wof2l_chk_strng_in_var_4_missing\n\t\t\t\t);\t\t\t\n\t\t\t%if &wof2l_target_environment eq CAS %then\n\t\t\t%do;\n\t\t\t\tproc casutil;\n\t\t\t\t\tpromote casdata=\"&wof2l_final_table_name\" incaslib=\"&wof2l_cas_target_libname\"\n\t\t\t\t\t\t\toutcaslib=\"&wof2l_cas_target_libname\" casout=\"&wof2l_final_table_name\";\n\t\t\t\t\t%if &wof2l_make_imported_data_prsstnt = 1 %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\tsave casdata=\"&wof2l_final_table_name\" incaslib=\"&wof2l_cas_target_libname\"\n\t\t\t\t\t\t\t\toutcaslib=\"&wof2l_cas_target_libname\" casout=\"&wof2l_final_table_name\" replace;\n\t\t\t\t\t%end;\n\t\t\t\tquit;\n\t\t\t%end;\n\t\t%end;\n\t%end;\n \n \n \n\t%if \"%upcase(&wof2l_do_profiling)\" ne \"NO\" %then\n\t%do;\n\t\t%automated_profiling_4_DIAP(\n\t\t\tap4d_table_2_prep_4_prof_seq = &wof2l_ds_2_profile_seq,\n\t\t\tap4d_dict_source_file_path = &wof2l_profile_dict_location,\n\t\t\tap4d_prof_execution_option = &wof2l_do_profiling,\n\t\t\tap4d_libname_4_dictionaries = %scan(&wof2l_upload_log_ds, 1, '.'),\n\t\t\tap4d_viyaversion = &wof2l_viyaversion\n\t\t\t);\n\t%end;\n%end; %else\n%do;\n \n\t%if &wof2l_shp_enrich_with_zip = 1 %then\n\t%do;\n\t\tlibname _meta_94 \"&wof2l_path_2_gis2zip_dataset4shp\";\n\t%end;\n\t/*********\n\tNow go through all the files that need to be read in.\n\tone by one going through the list...\n\t*********/\n \n\t%let wof2l_variable_length_max = 256;\n\t/***\n\twof2l_skip_mssng_vrnm_in_xls\n\t\tif set to 1, columns with missing varnames in EXCEL files will be dropped in the target table\n\t***/\n\t%let wof2l_skip_mssng_vrnm_in_xls = 1;\n\t%let wp2c_file_count = %wordcnt(&wof2l_full_filename_path_seq, '#');\n\t%put INFORMATION: There are &wp2c_file_count files to be examined to be read in!;\n\t/*********************************************\n\t**********************************************\n \n\tNow at first prepare the upload log dataset and determine\n\twhich files need to be uploaded.\n \n\t**********************************************\n\t*********************************************/\n \n\t%let wof2l_full_fname_path_2_load_seq = ;\n\t%let wof2l_extension_2_load_seq = ;\n\t%let wof2l_target_table_name_seq = ;\n\t%let wof2l_sheet_name_seq = ;\n\t%let wof2l_original_filename_seq = ;\n \n\t%if &wof2l_debug_mode %then\n\t%do;\n\t\t%put INFORMATION: Just before log_dataset_4_upload_maintenance() macro with following inflow:;\n\t\t%put INFORMATION: &=wof2l_upload_log_ds;\n\t\t%put INFORMATION: &=wof2l_full_filename_path_seq;\n\t\t%put INFORMATION: &=wof2l_directory_path_seq;\n\t\t%put INFORMATION: &=wof2l_fnl_ds_name_4_all_extfiles;\n\t\t%put INFORMATION: &=wof2l_diap_guided_automation;\n\t\t%put INFORMATION: &=wof2l_gddauto_upd_fls_del_seq;\n\t\t%put INFORMATION: &=wof2l_gddauto_upd_fls_sht_seq;\n\t\t%put INFORMATION: &=wof2l_gddauto_upd_fls_cntt_flg;\n\t\t%put INFORMATION: &=wof2l_gddauto_upd_fls_tgt_seq;\n\t\t%put INFORMATION: &=wof2l_gddauto_upd_fls_hdr_seq;\n\t%end;\n \n \n \n\t%log_dataset_4_upload_maintenance(\n\t\t&wof2l_upload_log_ds,\n\t\t&wof2l_full_filename_path_seq,\n\t\tld4um_directory_path_seq = &wof2l_directory_path_seq,\n\t\tld4um_debug_mode = &wof2l_debug_mode,\n\t\tld4um_fn_in_fxd_wdth_def_fl_seq = &wof2l_fn_as_in_fxd_wdth_def_seq,\n\t\tld4um_substitute_string_seq = &wof2l_substitute_string_seq,\n\t\tld4um_max_name_length = &wof2l_max_name_length,\n\t\tld4um_stringseq_2_cutout_from_fn = &wof2l_stringseq_2_cutout_from_fn,\n\t\tld4um_force_upload_of_all_files = &wof2l_force_upload_of_all_files,\n\t\tld4um_fnl_tblname_from_sheetonly = &wof2l_fnl_tblname_from_sheetonly,\n\t\tld4um_create_unique_target_tblnm = &wof2l_create_unique_target_tblnm,\n\t\tld4um_delimiter = &wof2l_delimiter,\n\t\tld4um_fnl_ds_name_4_all_extfiles = &wof2l_fnl_ds_name_4_all_extfiles,\n\t\tld4um_diap_guided_automation = &wof2l_diap_guided_automation,\n\t\tld4um_gddauto_upd_fls_del_seq = &wof2l_gddauto_upd_fls_del_seq,\n\t\tld4um_gddauto_upd_fls_sht_seq = &wof2l_gddauto_upd_fls_sht_seq,\n\t\tld4um_gddauto_upd_fls_cntt_flg = &wof2l_gddauto_upd_fls_cntt_flg,\n\t\tld4um_gddauto_upd_fls_hdr_seq = &wof2l_gddauto_upd_fls_hdr_seq,\n\t\tld4um_gddauto_upd_fls_tgt_seq = &wof2l_gddauto_upd_fls_tgt_seq\n\t\t);\n \n\t/*****************\n\tsort descending by sheetname to have them loaded first\n\tand to prevent to have missing sheentname in the sequence first\n\t*****************/\n\tdata work._DIAP_working_upload_log_ds;\n\t\tset &wof2l_upload_log_ds.;\n\trun;\n \n\t%if \"&wof2l_skip_files_start_with_seq\" ne \"\" or\n\t\t\"&wof2l_skip_files_end_with_seq\" ne \"\" %then\n\t%do;\n\t\t%let wof2l_skip_files_start_count = %wordcnt(&wof2l_skip_files_start_with_seq, \"#\");\n\t\t%let wof2l_skip_files_end_count = %wordcnt(&wof2l_skip_files_end_with_seq, \"#\");\n \n\t\tdata work._DIAP_working_upload_log_ds;\n\t\t\tset work._DIAP_working_upload_log_ds;\n\t\t\tlength_name = length(original_sheetname);\n\t\t\tdrop length_name;\n\t\t\t%do wof2l_skip_counter = 1 %to &wof2l_skip_files_start_count;\n\t\t\t\t%let wof2l_skip_files_start_with = %scan(&wof2l_skip_files_start_with_seq, &wof2l_skip_counter, \"#\");\n\t\t\t\t%let wof2l_skip_files_start_length = %length(&wof2l_skip_files_start_with);\n\t\t\t\tif length_name >= &wof2l_skip_files_start_length then\n\t\t\t\tdo;\n\t\t\t\t\tif upcase(substr(original_sheetname, 1, &wof2l_skip_files_start_length)) = %upcase(\"&wof2l_skip_files_start_with\") then delete;\t\t\t\n\t\t\t\tend;\n\t\t\t%end;\n\t\t\t%do wof2l_skip_counter = 1 %to &wof2l_skip_files_end_count;\n\t\t\t\t%let wof2l_skip_files_end_with = %scan(&wof2l_skip_files_end_with_seq, &wof2l_skip_counter, \"#\");\n\t\t\t\t%let wof2l_skip_files_end_length = %length(&wof2l_skip_files_end_with);\n\t\t\t\tif length_name >= &wof2l_skip_files_end_length then\n\t\t\t\tdo;\n\t\t\t\t\tif upcase(substr(original_sheetname, length_name - &wof2l_skip_files_end_length + 1, &wof2l_skip_files_end_length)) = %upcase(\"&wof2l_skip_files_end_with\") then delete;\t\t\t\n\t\t\t\tend;\n\t\t\t%end;\n\t\trun;\t\t\t\n\t%end;\n\tproc sort\n\t\tdata=work._DIAP_working_upload_log_ds;\n\t\tby load_date descending original_sheetname;\n\tquit;\n \n\t/*********************************************\n\tAll the files where the load date is missing\n\tneed to be read in.\n\t*********************************************/\n \n \n\tproc sql noprint;\n\t\tselect\n\t\t\tfile_path_full_name,\n\t\t\tadjusted_table_name,\n\t\t\tdirectory_path,\n\t\t\t%if \"&wof2l_fixed_file_definition_ds\" ne \"\" %then\n\t\t\t%do;\n\t\t\t\tfilename_asin_fxd_wdth_def_fl,\n\t\t\t\toriginal_filename,\n\t\t\t%end;\n\t\t\toriginal_sheetname,\n\t\t\tfile_delimiter,\n\t\t\tfilepath_is_for_sas_content,\n\t\t\tvariable_name_is_in_header,\n\t\t\textension\n\t\tinto\n\t\t\t:wof2l_full_fname_path_2_load_seq separated by \" #\",\n\t\t\t:wof2l_target_table_name_seq separated by \" #\",\n\t\t\t:wof2l_directory_path_seq separated by \" #\",\n\t\t\t%if \"&wof2l_fixed_file_definition_ds\" ne \"\" %then\n\t\t\t%do;\n\t\t\t\t:wof2l_fn_as_in_fxd_wdth_def_seq separated by \" #\",\n\t\t\t\t:wof2l_original_filename_seq separated by \" #\",\n\t\t\t%end;\n\t\t\t:wof2l_sheet_name_seq separated by \" #\",\n\t\t\t:wof2l_file_delimiter_seq separated by \" #\",\n\t\t\t:wof2l_path_for_sas_content_seq separated by \" #\",\n\t\t\t:wof2l_file_header_flag_seq separated by \" #\",\n\t\t\t:wof2l_extension_2_load_seq separated by \" #\"\n\t\tfrom\n\t\t\twork._DIAP_working_upload_log_ds\n\t\twhere\n\t\t\tmissing(load_date);\n\tquit;\n \n\t%if &wof2l_debug_mode %then\n\t%do;\n\t\t%put INFORMATION: This is the original files to be uploaded:;\n\t\t%put &=wof2l_full_fname_path_2_load_seq;\n\t\t%put INFORMATION: This is the corresponding target table sequence to be uploaded: ;\n\t\t%put &=wof2l_target_table_name_seq;\n\t\t%put INFORMATION: This is the corresponding sheet name sequence to be uploaded:;\n\t\t%put &=wof2l_sheet_name_seq;\n\t\t%put INFORMATION: This is the corresponding extension sequence to be uploaded:;\n\t\t%put &=wof2l_extension_2_load_seq;\n\t\t%put INFORMATION: This is the special file definition sequence if existent to be uploaded:;\n\t\t%put &=wof2l_fn_as_in_fxd_wdth_def_seq;\n\t\t%put INFORMATION: This is the directory path sequence belonging to special defined files sequence if existent to be uploaded:;\n\t\t%put &=wof2l_directory_path_seq;\n\t\t%put INFORMATION: This is the provided delimiter sequence showing the suggested delimiter for file to be uploaded:;\n\t\t%put &=wof2l_file_delimiter_seq;\n\t\t%put INFORMATION: This is the sas content flag indicator sequence showing if file to be uploaded is located in SAS Content area:;\n\t\t%put &=wof2l_path_for_sas_content_seq;\n\t\t%put INFORMATION: This is the original filename sequence sequence if existent to be uploaded:;\n\t\t%put &=wof2l_original_filename_seq;\n\t\t%put INFORMATION: This is the flag sequence to indicate if variable name is in header if existent to be uploaded:;\n\t\t%put &=wof2l_file_header_flag_seq;\n\t%end;\n \n\t%let wp2c_file_count = %wordcnt(&wof2l_full_fname_path_2_load_seq, '#');\n\t%put INFORMATION: There are &wp2c_file_count files to be examined to be read in!;\n\t%if &wp2c_file_count = 0 %then\n\t%do;\n\t\t%put INFORMATION GENERAL: No data uploaded since either no updates to the existing uploaded data;\n\t\t%put INFORMATION GENERAL: or no files in directory structure;\n\t\t%put INFORMATION GENERAL: Check Load Dates in Upload log and compare with modified date of files to be uploaded;\n\t%end; %else\n\t%do;\n\t%do wo2c_file_counter = 1 %to &wp2c_file_count;\n\t/*********\n\tFirst check the length of the filename and such, since that will become the table name.\n\tExcel will be treated separately, since one XLS file can contain multiple sheets.\n\t*********/\n\t\t%let wof2l_directory_path = %scan(&wof2l_directory_path_seq, &wo2c_file_counter, '#');\n\t\t%let wo2c_full_file_name = %scan(&wof2l_full_fname_path_2_load_seq, &wo2c_file_counter, '#');\n\t\t%let wo2c_file_extension = %scan(&wof2l_extension_2_load_seq, &wo2c_file_counter, '#');\n\t\t%let wof2l_sheet_name = %scan(&wof2l_sheet_name_seq, &wo2c_file_counter, '#');\n\t\t%let wof2l_final_table_name = %scan(&wof2l_target_table_name_seq, &wo2c_file_counter, '#');\n\t\t%let wof2l_filepath_for_sas_content = %scan(&wof2l_path_for_sas_content_seq, &wo2c_file_counter, '#');\n\t\t%let wof2l_file_delimiter_guided = %scan(&wof2l_file_delimiter_seq, &wo2c_file_counter, '#');\n\t\t%let wof2l_header_flag_guided = %scan(&wof2l_file_header_flag_seq, &wo2c_file_counter, '#');\n \n\t\t%if &wof2l_filepath_for_sas_content = 0 %then\n\t\t%do;\n\t\t\tfilename inf&wo2c_file_counter \"&wo2c_full_file_name\";\n\t\t%end; %else\n\t\t%do;\n\t\t\t%let wof2l_temp_filename_only = %scan(&wo2c_full_file_name, -1, \"&wof2l_delimiter\");\n\t\t\tfilename inf&wo2c_file_counter \t\n\t\t\t\t\tfilesrvc \t\n\t\t\t\t\tfolderpath \t= \"&wof2l_directory_path\"\n\t\t\t\t\tfilename\t= \"&wof2l_temp_filename_only\";\n\t\t%end;\n \n\t\t%local wof2l_check_source_fl_flag_&wo2c_file_counter;\n\t\t%let wof2l_check_source_fl_flag_&wo2c_file_counter = 0;\n \n\t/*********************************************\n\twe are double checking the load time which is needed\n\tin case we have special definitions that are processed first.\n\tafter they are processed, they don't need to be processed again\n\twhen reading in the \"normal\" files.\n\t*********************************************/\n\t\t\n \n\t\t%let wof2l_table_to_process_check = .;\n \n\t\tproc sql;\n\t\t\tselect load_date\n\t\t\tinto :wof2l_table_to_process_check\n\t\t\tfrom work._DIAP_working_upload_log_ds\n\t\t\twhere\n\t\t\t\tupcase(file_path_full_name) = \"%upcase(&wo2c_full_file_name)\" and\t\t\n\t\t\t\tupcase(adjusted_table_name) = \"%upcase(&wof2l_final_table_name)\"\t\t\n\t\t\t;\n\t\tquit;\n \n \n \n\t\t%if &wof2l_table_to_process_check = . %then\n\t\t%do;\n/*\t\t\tfilename REFFILE DISK \"&wo2c_full_file_name.\";*/\n \n\t\t/******\n\t\t*******\n\t\tIn the following section the variable names are checked and made SAS compliant.\n\t\t*******\n\t\t*******/\n\t\t\n\t\t\t%let wof2l_max_varnumber_&wo2c_file_counter = ;\n\t\t\n\t\t\t%if &wof2l_debug_mode %then\n\t\t\t\t%put INFORMATION: Using &wof2l_guessing_row rows to guess column details.;\n \n\t/*********************************************\n\tFirst check if this is the run to read in the files\n\tthat are defined via the special definition file.\n\t*********************************************/\n \n \n\t\t\t%if \"&wof2l_fixed_file_definition_ds\" ne \"\" %then\n\t\t\t%do;\n\t\t\t\t%let wof2l_fm_from_def_ds = %scan(&wof2l_fn_as_in_fxd_wdth_def_seq, &wo2c_file_counter, '#');\n\t\t\t\t%let wof2l_orig_fn = %scan(&wof2l_original_filename_seq, &wo2c_file_counter, '#');\n \n \n \n\t\t\t\t%let fwf_directory_seq = ;\n\t\t\t\t%let fwf_filename_seq = ;\n\t\t\t\t%let fwf_incl_fn_in_table_out_seq = ;\n\t\t\t\t%let fwf_file_type_seq = ;\n\t\t\t\t%let fwf_variable_name_seq = ;\n\t\t\t\t%let fwf_variable_label_seq = ;\n\t\t\t\t%let fwf_variable_type_seq = ;\n\t\t\t\t%let fwf_variable_length_seq = ;\n\t\t\t\t%let fwf_variable_format_seq = ;\n\t\t\t\t%let fwf_variable_informat_seq = ;\n\t\t\t\t%let fwf_variable_start_position_seq = ;\n\t\t\t\t%let fwf_variable_end_position_seq = ;\n\t\t\t\t%let wof2l_max_start_pos_value = ;\n\t/*********************************************\n\treading in the definition from the special definition file\n \n\t*********************************************/\n\t\t\t\t\n\t\t\t\tproc sql;\n\t\t\t\t\tselect\n\t\t\t\t\t\tdirectory,\n\t\t\t\t\t\tfilename,\n\t\t\t\t\t\tinclude_fn_in_table_output,\n\t\t\t\t\t\tfile_type,\n\t\t\t\t\t\tvariable_name,\n\t\t\t\t\t\tvariable_label,\n\t\t\t\t\t\tvariable_type,\n\t\t\t\t\t\tvariable_length,\n\t\t\t\t\t\tvariable_format,\n\t\t\t\t\t\tvariable_informat,\n\t\t\t\t\t\tvariable_start_position,\n\t\t\t\t\t\tvariable_end_position,\n\t\t\t\t\t\tmax(variable_start_position)\n\t\t\t\t\tinto\n\t\t\t\t\t\t:fwf_directory_seq separated by ' #',\n\t\t\t\t\t\t:fwf_filename_seq separated by ' #',\n\t\t\t\t\t\t:fwf_incl_fn_in_table_out_seq separated by ' #',\n\t\t\t\t\t\t:fwf_file_type_seq separated by ' #',\n\t\t\t\t\t\t:fwf_variable_name_seq separated by ' #',\n\t\t\t\t\t\t:fwf_variable_label_seq separated by ' #',\n\t\t\t\t\t\t:fwf_variable_type_seq separated by ' #',\n\t\t\t\t\t\t:fwf_variable_length_seq separated by ' #',\n\t\t\t\t\t\t:fwf_variable_format_seq separated by ' #',\n\t\t\t\t\t\t:fwf_variable_informat_seq separated by ' #',\n\t\t\t\t\t\t:fwf_variable_start_position_seq separated by ' #',\n\t\t\t\t\t\t:fwf_variable_end_position_seq separated by ' #',\n\t\t\t\t\t\t:wof2l_max_start_pos_value\n\t\t\t\t\tfrom\t\n\t\t\t\t\t\t&wof2l_fixed_file_definition_ds\n\t\t\t\t\twhere\n\t\t\t\t\t\tfilename = \"&wof2l_fm_from_def_ds\" and\n\t\t\t\t\t\tdirectory = \"&wof2l_directory_path\"\t\t\t\n\t\t\t\t\t;\n\t\t\t\tquit;\n\t\t\t\t\n\t\t\t\t%put &=fwf_directory_seq;\n\t\t\t\t%put &=fwf_filename_seq;\n\t\t\t\t%put &=fwf_incl_fn_in_table_out_seq;\n\t\t\t\t%put &=fwf_file_type_seq;\n\t\t\t\t%put &=fwf_variable_name_seq;\n\t\t\t\t%put &=fwf_variable_label_seq;\n\t\t\t\t%put &=fwf_variable_type_seq;\n\t\t\t\t%put &=fwf_variable_length_seq;\n\t\t\t\t%put &=fwf_variable_format_seq;\n\t\t\t\t%put &=fwf_variable_informat_seq;\n\t\t\t\t%put &=fwf_variable_start_position_seq;\n\t\t\t\t%put &=fwf_variable_end_position_seq;\n\t\t\t\t%put &=wof2l_max_start_pos_value;\n \n\t/*********************************************\n\tdepending on the type the information is read in.\n\tSee the different cases, e.g. FIX or XML...\n\there the variable names are provided via the definition file.\n\t*********************************************/\n \n/*\t\t\t\t%let wof2l_input_file_&wo2c_file_counter = \"&wo2c_full_file_name\";*/\n\t\t\t\t%let wof2l_input_file_&wo2c_file_counter = inf&wo2c_file_counter;\n\t\t\t\t%if &wof2l_chck_txt_fl_4_spcl_chrct = 1 %then\n\t\t\t\t%do;\n\t\t\t\t\tfilename cf&wo2c_file_counter temp;\n\t\t\t\t\t%let wof2l_count_of_chrct_2_chk = %wordcnt(&wof2l_spcl_chrctr_sq2chck_in_hex, '#');\n\t\t\t\t\t%let wof2l_hex_chrct_2_chck = %trim(%left(%scan(&wof2l_spcl_chrctr_sq2chck_in_hex, 1, '#')));\n\t\t\t\t\t/* MAGIC preprocessing step */\n\t\t\t\t\tdata _null_;\n\t\t\t\t\t\tinfile &&wof2l_input_file_&wo2c_file_counter recfm=n;\n\t\t\t\t\t\tfile cf&wo2c_file_counter recfm=n;\n\t\t\t\t\t\tinput a $char1.;\n\t\t\t\t\t\tretain open 0;\n\t\t\t\t\t\tif a='\"' then\n\t\t\t\t\t\t\topen = not open;\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\ta=\"&wof2l_hex_chrct_2_chck\"x\n\t\t\t\t\t\t\t%do wof2l_counter_of_chrct_2_chk = 2 %to &wof2l_count_of_chrct_2_chk;\n\t\t\t\t\t\t\t\t\t%let wof2l_hex_chrct_2_chck = %trim(%left(%scan(&wof2l_spcl_chrctr_sq2chck_in_hex, &wof2l_counter_of_chrct_2_chk, '#')));\n\t\t\t\t\t\t\t\tor a=\"&wof2l_hex_chrct_2_chck\"x\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\tand open then\n\t\t\t\t\t\t\tput \"%trim(%left(&wof2l_spcl_chrct_chck_rplcmnt_hx))\"x @;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tput a $char1. @;\n\t\t\t\t\trun;\n\t\t\t\t\t%let wof2l_input_file_&wo2c_file_counter = cf&wo2c_file_counter;\n\t\t\t\t\n\t\t\t\t%end;\n \n\t\t\t\t%let variable_count = %wordcnt(&fwf_variable_name_seq, '#');\n\t\t\t\t%let wof2l_special_file_type = %scan(&fwf_file_type_seq, 1, '#');\n\t/***\n\tfile_type variable is also used to determine from which row the data\n\tinformation starts (e.g. if first row is variable name, then data\n\twould start with row 2.\n\tso in this case, file_type would contain fix-2 as a value.\n\tDefault is starting from row 1. (e.g. if this information is missing.)\n\t****/\n\t\t\t\t%let wof2l_special_file_data_strt = %scan(&wof2l_special_file_type, 2, '-');\n\t\t\t\t%let wof2l_special_file_type = %scan(&wof2l_special_file_type, 1, '-');\n \n\t\t\t\t%if %upcase(%trim(%left(&wof2l_special_file_type))) = FIX %then\n\t\t\t\t%do;\n\t\t\t\t\tdata get_table_info_&wo2c_file_counter;\n\t\t\t\t\t\tinfile &&wof2l_input_file_&wo2c_file_counter truncover DSD lrecl=&wof2l_lrec_length;\n\t\t\t\t\t\tinput @1\n\t\t\t\t\t\t%let fwf_fn_include_indicator = 0;\n\t\t\t\t\t\t%do variable_counter = 1 %to &variable_count;\n\t\t\t\t\t\t\t%let variable_name = %scan(&fwf_variable_name_seq, &variable_counter, '#');\n\t\t\t\t\t\t\t%let fwf_include_fn_in_output = %scan(&fwf_incl_fn_in_table_out_seq, &variable_counter, '#');\n\t\t\t\t\t\t\t%let variable_type = %scan(&fwf_variable_type_seq, &variable_counter, '#');\n\t\t\t\t\t\t\t%if \"&fwf_include_fn_in_output\" = \"1\" %then\n\t\t\t\t\t\t\t\t%let fwf_fn_include_indicator =  1;\n\t\t\t\t\t\t\t%put &=variable_type;\n\t\t\t\t\t\t\t%let variable_start_pos = %scan(&fwf_variable_start_position_seq, &variable_counter, '#');\n\t\t\t\t\t\t\t%let variable_end_pos = %scan(&fwf_variable_end_position_seq, &variable_counter, '#');\n\t\t\t\t\t\t\tvar_&wo2c_file_counter._&variable_counter\n\t\t\t\t\t\t\t\t%if \"%upcase(&variable_type)\" = \"CHAR\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\t$\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t&variable_start_pos. - &variable_end_pos.\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t;\n\t\t\t\t\t\t%if &fwf_fn_include_indicator = 1 %then\n\t\t\t\t\t\t%do;\t\t\n\t\t\t\t\t\t\t%let variable_counter = %eval(&variable_count + 1);\n\t\t\t\t\t\t\tlength var_&wo2c_file_counter._&variable_counter $100.;\n\t\t\t\t\t\t\tvar_&wo2c_file_counter._&variable_counter = \"&wof2l_orig_fn\";\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t%if \"&wof2l_special_file_data_strt\" ne \"\" %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tif _n_ >= &wof2l_special_file_data_strt;\n\t\t\t\t\t\t%end;\n\t\t\t\t\trun;\n\t\t\t\t%end;\n\t\t\t\t%if %upcase(%trim(%left(&wof2l_special_file_type))) = XML %then\n\t\t\t\t%do;\n\t\t\t\t\tdata get_table_info_&wo2c_file_counter;\n\t\t\t\t\t\tretain\n\t\t\t\t\t\t%do variable_counter = 1 %to &variable_count;\n\t\t\t\t\t\t\tvar_&wo2c_file_counter._&variable_counter\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t;\n\t\t\t\t\t\tlength\n\t\t\t\t\t\t\twhole_line $ 32000\n\t\t\t\t\t\t%do variable_counter = 1 %to &variable_count;\n\t\t\t\t\t\t\t%let variable_length = %scan(&fwf_variable_length_seq, &variable_counter, '#');\n\t\t\t\t\t\t\t%let fwf_include_fn_in_output = %scan(&fwf_incl_fn_in_table_out_seq, &variable_counter, '#');\n\t\t\t\t\t\t\t%let variable_type = %scan(&fwf_variable_type_seq, &variable_counter, '#');\n\t\t\t\t\t\t\t%if \"&fwf_include_fn_in_output\" = \"1\" %then\n\t\t\t\t\t\t\t\t%let fwf_fn_include_indicator =  1;\n\t\t\t\t\t\t\t%let variable_start_pos = %scan(&fwf_variable_start_position_seq, &variable_counter, '#');\n\t\t\t\t\t\t\t%let variable_end_pos = %scan(&fwf_variable_end_position_seq, &variable_counter, '#');\n\t\t\t\t\t\t\tvar_&wo2c_file_counter._&variable_counter\n\t\t\t\t\t\t\t\t%if \"%upcase(&variable_type)\" = \"CHAR\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\t$\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t&variable_length\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t;\n\t\t\t\t\t\tinfile &&wof2l_input_file_&wo2c_file_counter truncover DSD lrecl=&wof2l_lrec_length;\n\t\t\t\t\t\tinput @1 whole_line;\n\t\t\t\t\t\toutput_ok = 0;\n\t\t\t\t\t\tdrop\n\t\t\t\t\t\t\twhole_line\n\t\t\t\t\t\t\texist\n\t\t\t\t\t\t\tposition_start\n\t\t\t\t\t\t\tposition_end\n\t\t\t\t\t\t\tdifference\n\t\t\t\t\t\t\toutput_ok\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t%let fwf_fn_include_indicator = 0;\n\t\t\t\t\t\t%do variable_counter = 1 %to &variable_count;\n\t\t\t\t\t\t\t%let variable_name = %scan(&fwf_variable_name_seq, &variable_counter, '#');\n\t\t\t\t\t\t\t%let fwf_include_fn_in_output = %scan(&fwf_incl_fn_in_table_out_seq, &variable_counter, '#');\n\t\t\t\t\t\t\t%let variable_type = %scan(&fwf_variable_type_seq, &variable_counter, '#');\n\t\t\t\t\t\t\t%if \"&fwf_include_fn_in_output\" = \"1\" %then\n\t\t\t\t\t\t\t\t%let fwf_fn_include_indicator =  1;\n\t\t\t\t\t\t\t%put &=variable_type;\n\t\t\t\t\t\t\t%let variable_start_pos = %scan(&fwf_variable_start_position_seq, &variable_counter, '#');\n\t\t\t\t\t\t\t%let variable_end_pos = %scan(&fwf_variable_end_position_seq, &variable_counter, '#');\n\t\t\t\t\t\t\texist = index(upcase(whole_line), \"%upcase(&variable_name)\");\n\t\t\t\t\t\t\tif exist then\n\t\t\t\t\t\t\tdo;\n\t\t\t\t\t\t\t\tposition_start = index(whole_line, \">\");\n\t\t\t\t\t\t\t\tposition_end = index(whole_line, \"</\");\n\t\t\t\t\t\t\t\tdifference = position_end - position_start - 1;\n\t\t\t\t\t\t\t\tvar_&wo2c_file_counter._&variable_counter = substr(whole_line,position_start+1, difference);\n\t\t\t\t\t\t\t\t%if &variable_start_pos = &wof2l_max_start_pos_value %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\toutput_ok = 1;\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t%if &fwf_fn_include_indicator = 1 %then\n\t\t\t\t\t\t%do;\t\t\n\t\t\t\t\t\t\t%let variable_counter = %eval(&variable_count + 1);\n\t\t\t\t\t\t\tlength var_&wo2c_file_counter._&variable_counter $100.;\n\t\t\t\t\t\t\tvar_&wo2c_file_counter._&variable_counter = \"&wof2l_orig_fn\";\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\tif output_ok then\n\t\t\t\t\t\t\toutput;\n\t\t\t\t\trun;\n\t\t\t\t%end;\n \n\t\t\t\t%if &wof2l_debug_mode %then\n\t\t\t\t%do;\n\t\t\t\t\tdata get_table_info_fwf_&wo2c_file_counter;\n\t\t\t\t\t\tset get_table_info_&wo2c_file_counter;\n\t\t\t\t\trun;\n\t\t\t\t%end;\n \n\t\t\t%end;\n\t\t\t%else\n\t\t\t%do;\n\t/*********************************************\n\totherwise read in the \"normal\" cases..\n\t*********************************************/\n \n\t\t\t\t%if &wo2c_file_extension eq CSV or\t\n\t\t\t\t\t&wo2c_file_extension eq TXT or\n\t\t\t\t\t((\"&wof2l_file_delimiter_guided\" ne \"\" and %upcase(\"&wof2l_file_delimiter_guided\") ne \"_DIAP_NA_\") and\n\t\t\t\t\t&wof2l_diap_guided_automation = 1) %then\n\t\t\t\t%do;\n\t\t\t\t\toptions obs = &wof2l_guessing_row;\n\t\t\t\t\t%let wof2l_file_delimiter = ;\n\t\t\t\t\t%let wof2l_has_header = 1;\n\t/*********************************************\n\tbased on the first row, the delimiter is determined.\n\tMaximum occurence wins.\n \n\tAnother test is performed for the header row.\n\tif the very first character is a number, then it is assumed\n\tthat there is no header row.\n\t*********************************************/\n/*\t\t\t\t\t%let wof2l_input_file_&wo2c_file_counter = \"&wo2c_full_file_name\";*/\n\t\t\t\t\t%let wof2l_input_file_&wo2c_file_counter = inf&wo2c_file_counter;\n\t\t\t\t\t%if &wof2l_chck_txt_fl_4_spcl_chrct = 1 %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\tfilename cf&wo2c_file_counter temp;\n\t\t\t\t\t\t%let wof2l_count_of_chrct_2_chk = %wordcnt(&wof2l_spcl_chrctr_sq2chck_in_hex, '#');\n\t\t\t\t\t\t%let wof2l_hex_chrct_2_chck = %trim(%left(%scan(&wof2l_spcl_chrctr_sq2chck_in_hex, 1, '#')));\n\t\t\t\t\t\t/* MAGIC preprocessing step */\n\t\t\t\t\t\tdata _null_;\n\t\t\t\t\t\t\tinfile &&wof2l_input_file_&wo2c_file_counter recfm=n;\n\t\t\t\t\t\t\tfile cf&wo2c_file_counter recfm=n;\n\t\t\t\t\t\t\tinput a $char1.;\n\t\t\t\t\t\t\tretain open 0;\n\t\t\t\t\t\t\tif a='\"' then\n\t\t\t\t\t\t\t\topen = not open;\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\ta=\"&wof2l_hex_chrct_2_chck\"x\n\t\t\t\t\t\t\t\t%do wof2l_counter_of_chrct_2_chk = 2 %to &wof2l_count_of_chrct_2_chk;\n\t\t\t\t\t\t\t\t\t\t%let wof2l_hex_chrct_2_chck = %trim(%left(%scan(&wof2l_spcl_chrctr_sq2chck_in_hex, &wof2l_counter_of_chrct_2_chk, '#')));\n\t\t\t\t\t\t\t\t\tor a=\"&wof2l_hex_chrct_2_chck\"x\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\tand open then\n\t\t\t\t\t\t\t\tput \"%trim(%left(&wof2l_spcl_chrct_chck_rplcmnt_hx))\"x @;\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tput a $char1. @;\n\t\t\t\t\t\trun;\n\t\t\t\t\t\t%let wof2l_input_file_&wo2c_file_counter = cf&wo2c_file_counter;\n\t\t\t\t\t\n\t\t\t\t\t%end;\n \n\t\t\t\t\tdata _null_;\n\t\t\t\t\t\tinfile &&wof2l_input_file_&wo2c_file_counter dsd truncover LRECL=&wof2l_lrec_length obs = 1;\n\t\t\t\t\t\tinput line $&wof2l_lrec_length..;\n\t\t\t\t\t\tif _n_ = 1;\n\t\t\t\t\t\tcount_comma = countc(line,',');\n\t\t\t\t\t\tcount_semikolon = countc(line, ';');\n\t\t\t\t\t\tcount_blank = countc(strip(line),' ');\n\t\t\t\t\t\tcount_tab = countc(line, '09'X);\n\t\t\t\t\t\tcount_pipe = countc(line, '|');\n\t\t\t\t\t\thas_no_headerrow = anydigit(substr(line, 1,1));\n\t\t\t\t\t\tif has_no_headerrow then\n\t\t\t\t\t\t\tcall symput('wof2l_has_header', 0);\n\t\t\t\t\t\tmax_count = max(count_comma, count_semikolon, count_tab, count_pipe, count_blank);\n\t\t\t\t\t\tif max_count = count_comma then call symput('wof2l_file_delimiter', ','); else\n\t\t\t\t\t\tif max_count = count_semikolon then call symput('wof2l_file_delimiter', ';'); else\n\t\t\t\t\t\tif max_count = count_tab then call symput('wof2l_file_delimiter', \"TAB\"); else\n\t\t\t\t\t\tif max_count = count_pipe then call symput('wof2l_file_delimiter', '|');  else\n\t\t\t\t\t\tif max_count = count_blank then call symput('wof2l_file_delimiter', 'BLANK');\n\t\t\t\t\trun;\n\t\t\n\t\t\t\t\t%let wof2l_source_fl_nmbr_rows_&wo2c_file_counter = 0;\n\t\t\t\t\tdata _null_;\n\t\t\t\t\t  infile &&wof2l_input_file_&wo2c_file_counter end=eof;\n\t\t\t\t\t  input;\n\t\t\t\t\t  if eof then call symput(\"wof2l_source_fl_nmbr_rows_&wo2c_file_counter\", _n_);\n\t\t\t\t\trun;\n \n\t\t\t\t\t%let wof2l_source_fl_nmbr_rows_&wo2c_file_counter = %trim(%left(&&wof2l_source_fl_nmbr_rows_&wo2c_file_counter));\n \n\t\t\t\t\t%local\t\t\n\t\t\t\t\t\twof2l_delimiter_file_no_&wo2c_file_counter\n\t\t\t\t\t\twof2l_has_header_file_no_&wo2c_file_counter\n\t\t\t\t\t\t;\n\t\t\t\t\t%if \"&wof2l_file_delimiter_guided\" ne \"\" and\n\t\t\t\t\t\t\"&wof2l_file_delimiter_guided\" ne \"_DIAP_NA_\" %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\t%let wof2l_file_delimiter = &wof2l_file_delimiter_guided;\n\t\t\t\t\t%end;\n\t\t\t\t\t%let wof2l_delimiter_file_no_&wo2c_file_counter = &wof2l_file_delimiter;\n\t\t\t\t\t%if \"&wof2l_header_flag_guided\" ne \"\" %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\t%let wof2l_has_header = &wof2l_header_flag_guided;\n\t\t\t\t\t%end;\n\t\t\t\t\t%let wof2l_has_header_file_no_&wo2c_file_counter = &wof2l_has_header;\n\t\t\t\t\t%put INFORMATION GENERAL: For file &wo2c_full_file_name the delimiter is: \"&wof2l_file_delimiter\";\n\t\t\t\t\t%put INFORMATION GENERAL: There are &&wof2l_source_fl_nmbr_rows_&wo2c_file_counter rows to read in.;\n \n\t\t\t\t\t%if &wof2l_csv_big_data_mode = 0 %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\tproc import\n\t\t\t\t\t\t\tdatafile=&&wof2l_input_file_&wo2c_file_counter\n\t\t\t\t\t\t\tout=get_table_info_&wo2c_file_counter\n\t\t\t\t\t\t\tdbms=dlm replace;\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"TAB\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = '09'x ;\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"BLANK\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = ' ' ;\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"COMMA\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = ',' ;\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"SEMICOLON\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = ';' ;\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"PIPE\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = '|' ;\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = \"&&wof2l_delimiter_file_no_&wo2c_file_counter\" ;\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t%if &&wof2l_has_header_file_no_&wo2c_file_counter and\n\t\t\t\t\t\t\t\t&&wof2l_source_fl_nmbr_rows_&wo2c_file_counter gt 1 %then\n\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\tdatarow = 2;\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t%else\n\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\tdatarow = 1;\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\tguessingrows = &wof2l_guessing_row;\n\t\t\t\t\t\t \tgetnames=no;\n\t\t\t\t\t\trun;\n \n \n\t\t\t\t\t\t%let wof2l_char_seq = ;\n\t\t\t\t\t\t%let wof2l_char_seq_total = ;\n\t\t\t\t\t\t%if &wof2l_check_csv_4_num = 1 %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tproc sql;\n\t\t\t\t\t\t\t\tselect \t\t\n\t\t\t\t\t\t\t\t\tname\n\t\t\t\t\t\t\t\tinto\n\t\t\t\t\t\t\t\t\t:wof2l_char_seq separated by \" \"\n\t\t\t\t\t\t\t\tfrom\n\t\t\t\t\t\t\t\t\tdictionary.columns\n\t\t\t\t\t\t\t\twhere\n\t\t\t\t\t\t\t\t\tupcase(libname) = \"WORK\" and\n\t\t\t\t\t\t\t\t\tupcase(memname) = \"%upcase(get_table_info_&wo2c_file_counter)\" and\t\n\t\t\t\t\t\t\t\t\tupcase(type) contains \"CHAR\"\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\tselect \t\t\n\t\t\t\t\t\t\t\t\tname\n\t\t\t\t\t\t\t\tinto\n\t\t\t\t\t\t\t\t\t:wof2l_char_seq_total separated by \" \"\n\t\t\t\t\t\t\t\tfrom\n\t\t\t\t\t\t\t\t\tdictionary.columns\n\t\t\t\t\t\t\t\twhere\n\t\t\t\t\t\t\t\t\tupcase(libname) = \"WORK\" and\n\t\t\t\t\t\t\t\t\tupcase(memname) = \"%upcase(get_table_info_&wo2c_file_counter)\"\t\t\n\t\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\tquit;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t%let wof2l_var_count_temp = %wordcnt(&wof2l_char_seq, ' ');\n\t\t\t\t\t\t\t%let wof2l_var_count_total_temp = %wordcnt(&wof2l_char_seq_total, ' ');\n\t\t\t\t\t\t\t%do wof2l_var_counter_temp = 1 %to &wof2l_var_count_temp;\n\t\t\t\t\t\t\t\t%let wof2l_num_flag_varnumber_&wof2l_var_counter_temp = 1;\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\tdata get_table_info_&wo2c_file_counter ;\n\t\t\t\t\t\t\t\tset get_table_info_&wo2c_file_counter ;\n\t\t\t\t\t\t\t\tdrop\n\t\t\t\t\t\t\t\t\tDIAP_temp_val\n\t\t\t\t\t\t\t\t\tDIAP_temp_dotcount\n\t\t\t\t\t\t\t\t\tDIAP_temp_dashcount\n\t\t\t\t\t\t\t\t\tDIAP_temp_dash_position\n\t\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\t%do wof2l_var_counter_temp = 1 %to &wof2l_var_count_temp;\n\t\t\t\t\t\t\t\t\t%let varname = %scan(&wof2l_char_seq, &wof2l_var_counter_temp, ' ');\n\t\t\t\t\t\t\t\t\tDIAP_temp_val = compress(&varname, \".-\", 'd');\n\t\t\t\t\t\t\t\t\tDIAP_temp_dotcount = count(&varname, \".\");\n\t\t\t\t\t\t\t\t\tDIAP_temp_dashcount = count(&varname, \"-\");\n\t\t\t\t\t\t\t\t\tDIAP_temp_dash_position = index(&varname, \"-\");\n\t\t\t\t\t\t\t\t\tif lengthn(DIAP_temp_val) ne 0 or\n\t\t\t\t\t\t\t\t\t\tDIAP_temp_dotcount > 1 or\n\t\t\t\t\t\t\t\t\t\tDIAP_temp_dashcount > 1 or\n\t\t\t\t\t\t\t\t\t\tDIAP_temp_dash_position > 1 then\n\t\t\t\t\t\t\t\t\tdo;\n\t\t\t\t\t\t\t\t\t\tcall symput(\"wof2l_num_flag_varnumber_&wof2l_var_counter_temp\",  0);\n\t\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\trun;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t%let wof2l_temp_varnum_counter = 0;\n\t\t\t\t\t\t\tdata get_table_info_&wo2c_file_counter ;\n\t\t\t\t\t\t\t\tset get_table_info_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t%do wof2l_var_counter_temp = 1 %to &wof2l_var_count_temp;\n\t\t\t\t\t\t\t\t\t%let varname = %scan(&wof2l_char_seq, &wof2l_var_counter_temp, ' ');\n\t\t\t\t\t\t\t\t\t\t%if &&wof2l_num_flag_varnumber_&wof2l_var_counter_temp = 1 %then\n\t\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\t\t_&varname = &varname * 1;\n\t\t\t\t\t\t\t\t\t\tdrop &varname;\n\t\t\t\t\t\t\t\t\t\t%let wof2l_temp_varnum_counter = 1;\n\t\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\trun;\n\t\t\t\t\t\t\t%if &wof2l_temp_varnum_counter = 1 %then\n\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\tproc datasets library=work nolist;\n\t\t\t\t\t\t\t\t   modify get_table_info_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t      rename\n\t\t\t\t\t\t\t\t\t\t%do wof2l_var_counter_temp = 1 %to &wof2l_var_count_temp;\n\t\t\t\t\t\t\t\t\t\t\t%let varname = %scan(&wof2l_char_seq, &wof2l_var_counter_temp, ' ');\n\t\t\t\t\t\t\t\t\t\t\t%if &&wof2l_num_flag_varnumber_&wof2l_var_counter_temp = 1 %then\n\t\t\t\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\t\t\t\t_&varname = &varname \t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\t\t\t%end;\t\n\t\t\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\tquit;\n \n\t\t\t\t\t\t\t\tdata get_table_info_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t\tretain\n\t\t\t\t\t\t\t\t\t\t%do wof2l_var_counter_temp = 1 %to &wof2l_var_count_total_temp;\n\t\t\t\t\t\t\t\t\t\t\t%let varname = %scan(&wof2l_char_seq_total, &wof2l_var_counter_temp, ' ');\n\t\t\t\t\t\t\t\t\t\t\t&varname\n\t\t\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\t\tset get_table_info_&wo2c_file_counter;\n\t\t\t\t\t\t\t\trun;\n\t\t\t\t\t\t\t%end;\t\n\t\t\t\t\t\t%end;\n\t\t\t\t\t%end;\n \n\t\t\t\t\toptions obs = max;\n\t\t\t\t\t%if &wof2l_csv_big_data_mode = 1 %then\n\t\t\t\t\t%do;\n \n \n\t\t\t\t\t\tdata _DIAP_csv_big_data_names_&wo2c_file_counter ;\n\t\t\t\t\t\t\tinfile  &&wof2l_input_file_&wo2c_file_counter lrecl=5000000  dsd\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"TAB\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = '09'x\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"BLANK\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = ' '\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"COMMA\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = ','\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"SEMICOLON\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = ';'\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"PIPE\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = '|'\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = \"&&wof2l_delimiter_file_no_&wo2c_file_counter\"\n\t\t\t\t\t\t\t\t%end;\n \n\t\t\t\t\t\t\t\tobs=1 ;\n\t\t\t\t\t\t\t\tdrop varnum;\n\t\t\t\t\t\t\t\tdo varnum=1 by 1 ;\n\t\t\t\t\t\t\t\t\tlength name $32 ;\n\t\t\t\t\t\t\t\t\tinput name @;\n\t\t\t\t\t\t\t\t\toutput;\n\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\trun;\n\t\t\t\t\t\t%let wof2l_max_varnumber_&wo2c_file_counter = ;\n\t\t\t\t\t\tproc sql noprint;\n\t\t\t\t\t\t\tselect\n\t\t\t\t\t\t\t\tnobs into :wof2l_max_varnumber_&wo2c_file_counter\n\t\t\t\t\t\t\tfrom dictionary.tables\n\t\t\t\t\t\t\twhere\n\t\t\t\t\t\t\t\tupcase(libname) = 'WORK' and\n\t\t\t\t\t\t\t\tupcase(memname) = \"%upcase(_DIAP_csv_big_data_names_&wo2c_file_counter)\";\n\t\t\t\t\t\tquit;\n\t\t\t\t\t\t%let wof2l_max_varnumber_&wo2c_file_counter = %trim(%left(&&wof2l_max_varnumber_&wo2c_file_counter));\n \n\t\t\t\t\t\t%do wof2l_var_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t%let wof2l_num_flag_varnumber_&wof2l_var_counter = 1;\n\t\t\t\t\t\t\t%local wof2l_num_flag_varnumber_&wof2l_var_counter ;\n\t\t\t\t\t\t%end;\n \n\t\t\t\t\t\tdata get_table_info_&wo2c_file_counter ;\n\t\t\t\t\t\t\tinfile  &&wof2l_input_file_&wo2c_file_counter lrecl=5000000  dsd\n\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"TAB\" %then\n\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\tdelimiter = '09'x\n\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"BLANK\" %then\n\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\tdelimiter = ' '\n\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"COMMA\" %then\n\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\tdelimiter = ','\n\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"SEMICOLON\" %then\n\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\tdelimiter = ';'\n\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"PIPE\" %then\n\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\tdelimiter = '|'\n\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\tdelimiter = \"&&wof2l_delimiter_file_no_&wo2c_file_counter\"\n\t\t\t\t\t\t\t%end;\n \n\t\t\t\t\t\t\t%if &&wof2l_has_header_file_no_&wo2c_file_counter and\n\t\t\t\t\t\t\t\t&&wof2l_source_fl_nmbr_rows_&wo2c_file_counter gt 1 %then\n\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\tfirstobs = 2;\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t%else\n\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\tfirstobs = 1;\n\t\t\t\t\t\t\t%end;\n \n\t\t\t\t\t\t\tformat\n\t\t\t\t\t\t\t%do wof2l_var_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\tvar&wof2l_var_counter $64.\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\tinformat\n\t\t\t\t\t\t\t%do wof2l_var_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\tvar&wof2l_var_counter $64.\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\tarray varplaceholder{&&wof2l_max_varnumber_&wo2c_file_counter} $ &wof2l_variable_length_max var1-var&&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\tlength name  $ &wof2l_variable_length_max ;\n\t\t\t\t\t\t\tdrop\n\t\t\t\t\t\t\t\tname\n\t\t\t\t\t\t\t\trow_counter\n\t\t\t\t\t\t\t\tvarnum\n\t\t\t\t\t\t\t\ttemp_val\n\t\t\t\t\t\t\t\ttemp_dotcount\t\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\tdo varnum=1 by 1 ;\n\t\t\t\t\t\t\t\tinput name @;\n\t\t\t\t\t\t\t\trow_counter = mod(varnum, &&wof2l_max_varnumber_&wo2c_file_counter);\n\t\t\t\t\t\t\t\tif row_counter = 0 then\n\t\t\t\t\t\t\t\tdo;\n\t\t\t\t\t\t\t\t\trow_counter = &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\t\tvarplaceholder{row_counter}= name;\n\t\t\t\t\t\t\t\ttemp_val = compress(name, \"-.\", 'd');\n\t\t\t\t\t\t\t\ttemp_dotcount = count(name, \".\");\n\t\t\t\t\t\t\t\tif lengthn(temp_val) ne 0 or\n\t\t\t\t\t\t\t\t\ttemp_dotcount > 1 then\n\t\t\t\t\t\t\t\tdo;\n\t\t\t\t\t\t\t\t\tcall symput(cats(\"wof2l_num_flag_varnumber_\", row_counter), 0);\n\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\t\tif row_counter = &&wof2l_max_varnumber_&wo2c_file_counter then\n\t\t\t\t\t\t\t\tdo;\n\t\t\t\t\t\t\t\t\toutput;\n\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\trun;\t\t\t\t\n\t\t\t\t\t\t%let wof2l_temp_varnum_counter = 0;\n\t\t\t\t\t\tdata get_table_info_&wo2c_file_counter ;\n\t\t\t\t\t\t\tset get_table_info_&wo2c_file_counter;\n\t\t\t\t\t\t\t%do wof2l_var_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t%if &&wof2l_num_flag_varnumber_&wof2l_var_counter = 1 %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\t_var&wof2l_var_counter = var&wof2l_var_counter * 1;\n\t\t\t\t\t\t\t\t\tdrop var&wof2l_var_counter;\n\t\t\t\t\t\t\t\t\t%let wof2l_temp_varnum_counter = 1;\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\trun;\n\t\t\t\t\t\t%if &wof2l_temp_varnum_counter = 1 %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tproc datasets library=work nolist;\n\t\t\t\t\t\t\t   modify get_table_info_&wo2c_file_counter;\n\t\t\t\t\t\t\t      rename\n\t\t\t\t\t\t\t\t\t%do wof2l_var_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t\t\t%if &&wof2l_num_flag_varnumber_&wof2l_var_counter = 1 %then\n\t\t\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\t\t\t_var&wof2l_var_counter = var&wof2l_var_counter \t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\t\t%end;\t\n\t\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\tquit;\n\t\t\t\t\t\t%end;\t\n\t\t\t\t\t%end;\n\t\t\t\t\t%if &&wof2l_source_fl_nmbr_rows_&wo2c_file_counter = 1 and\n\t\t\t\t\t\t&&wof2l_has_header_file_no_&wo2c_file_counter %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\tdata get_table_info_&wo2c_file_counter;\n\t\t\t\t\t\t\tset get_table_info_&wo2c_file_counter;\n\t\t\t\t\t\t\tif 0;\n\t\t\t\t\t\trun;\n\t\t\t\t\t%end;\n\t\t\t\t%end; %else\n\t\t\t\t%if &wo2c_file_extension eq XLSX or\n\t\t\t\t\t(&wo2c_file_extension eq XLS and &wof2l_diap_guided_automation = 1) %then\n\t\t\t\t%do;\n\t\t\t\t\tproc import\n\t\t\t\t\t\tdatafile=inf&wo2c_file_counter\n\t\t\t\t\t\tout=get_table_info_&wo2c_file_counter\n\t\t\t\t\t\tdbms=&wo2c_file_extension replace;\n\t\t\t\t\t\tdatarow = 2;\n\t\t\t\t\t\tsheet = \"&wof2l_sheet_name\";\n\t\t\t\t\t \tgetnames=no;\n\t\t\t\t\trun;\n\t\t\t\t%end;%else\n\t\t\t\t%if &wo2c_file_extension eq XML %then\n\t\t\t\t%do;\n\t\t\t\t\tfilename  tpxmllib \"&wo2c_full_file_name.\";\n\t\t\t\t\tfilename  tpxmlmap \"%substr(&wo2c_full_file_name, 1, %eval(%length(&wo2c_full_file_name) - 3))map\";\n\t/* \t\t\t\tlibname tpxmllib xmlv2 automap=replace xmlmap=tpxmlmap;  */\n\t\t\t\t\n\t\t\t\t\tlibname tpxmllib xmlv2 xmlmap=tpxmlmap access=READONLY;\n\t\t\t\t\t%let wo2c_temp_filename_only = %scan(%scan(&wo2c_full_file_name, -1, \"&wof2l_delimiter\"), 1, '.');\n\t\t\t\t\tdata get_table_info_&wo2c_file_counter;\n\t\t\t\t\t\tset tpxmllib.&wof2l_sheet_name;\n\t\t\t\t\t\tlength _diap_generated_filename_id $64.;\n\t\t\t\t\t\t_diap_generated_filename_id = \"&wo2c_temp_filename_only\";\n\t\t\t\t\trun;\n \n\t\t\t\t%end;%else\n\t\t\t\t%if &wo2c_file_extension eq JMP %then\n\t\t\t\t%do;\n\t\t\t\t\tproc import\n\t\t\t\t\t\tdatafile=inf&wo2c_file_counter\n\t\t\t\t\t\tout= get_table_info_&wo2c_file_counter\n\t\t\t\t\t\tdbms=JMP replace;\n\t\t\t\t\trun;\n\t\t\t\t%end;%else\n\t\t\t\t%if &wo2c_file_extension eq JSON %then\n\t\t\t\t%do;\n\t\t\t\t\tlibname _json json \"&wo2c_full_file_name\";\n\t\t\t\t\tdata get_table_info_&wo2c_file_counter;\n\t\t\t\t\t\tset _json.&wof2l_sheet_name;\n\t\t\t/*\t\t\tdrop\n\t\t\t\t\t\t\tordinal_root\n\t\t\t\t\t\t\tordinal_results\n\t\t\t\t\t\t\t;\n\t\t\t*/\t\trun;\n\t\t\t\t%end;%else\n\t\t\t\t%if &wo2c_file_extension eq SHP %then\n\t\t\t\t%do;\n \n\t\t\t\t\t%if &wof2l_viyaversion = 41 %then\n\t\t\t\t\t%do;\n \n \n\t\t\t\t\t%end; %else\n\t\t\t\t\t%if \"&wof2l_path_2_python_shape_script\" ne \"\" %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\t%let wof2l_length_dir = %length(&wof2l_directory_path);\n\t\t\t\t\t\t%let wof2l_adjusted_dir_name = %substr(&wof2l_directory_path, 1, %eval(&wof2l_length_dir - 1));\n\t\t\t\t\t\t%put INFORMATION GENERAL: Processing Shape file # &wo2c_file_counter &wo2c_full_file_name with Python script;\n\t\t\t\t\t\tx %unquote(%bquote(')&wof2l_path_2_python_shape_script -g\n\t\t\t\t\t\t\t-i \"&wo2c_full_file_name\"\n\t\t\t\t\t\t\t-C \"&wof2l_adjusted_dir_name\"\n\t\t\t\t\t\t\t-l \"&wof2l_directory_path._wof2l_temp_shapeshift.log\"%bquote('));\n\t\t\t\t\t\t%let wof2l_temp_log_filename = ;\n \n\t\t\t\t\t\tdata work.wof2l_temp_storage_logname;\t\n\t\t\t\t\t\t\tlength\n\t\t\t\t\t\t\t\tfilename_target $512\n\t\t\t\t\t\t\t\tfilename_source $512;\n\t\t\t\t\t\t\t\tinfile \"&wof2l_directory_path._wof2l_temp_shapeshift.log\"\n\t\t\t\t\t\t\t\tdelimiter = \",\" MISSOVER firstobs=1 dsd lrecl=32000;\n\t\t\t\t\t\t\t\tinput\n\t\t\t\t\t\t\t\t\tfilename_source $\n\t\t\t\t\t\t\t\t\tfilename_target $;\n\t\t\t\t\t\t\t\tcall symput(\"wof2l_temp_log_filename\", filename_target);\n\t\t\t\t\t\trun;\n\t\t\t\t\t\t%let wof2l_temp_log_filename = %trim(%left(&wof2l_temp_log_filename));\n\t\t\t\t\t\tproc import\n\t\t\t\t\t\t\tdatafile=\"&wof2l_temp_log_filename\"\n\t\t\t\t\t\t\tout=get_table_info_&wo2c_file_counter\n\t\t\t\t\t\t\tdbms=dlm replace;\n\t\t\t\t\t\t\tdelimiter = \",\" ;\n\t\t\t\t\t\t\t\tdatarow = 2;\n\t\t\t\t\t\t\tguessingrows = &wof2l_guessing_row;\n\t\t\t\t\t\t \tgetnames=yes;\n\t\t\t\t\t\trun;\n \n\t\t\t\t\t\tx %unquote(%bquote(')rm \"&wof2l_directory_path._wof2l_temp_shapeshift.log\"%bquote('));\n\t\t\t\t\t\tx %unquote(%bquote(')rm \"&wof2l_temp_log_filename\"%bquote('));\n\t\t\t\t\t%end; %else\n\t\t\t\t\t%do;\n\t\t\t\t\t\t%put INFORMATION GENERAL: Processing Shape file # &wo2c_file_counter &wo2c_full_file_name with SAS procedure script;\n\t\t\t\t\t\tproc mapimport\n\t\t\t\t\t\t\tdatafile=inf&wo2c_file_counter\n\t\t\t\t\t\t\tout=get_table_info_&wo2c_file_counter;\n\t\t\t\t\t\trun;\n\t\t\t\t\t\tproc datasets lib=work nolist;\n\t\t\t\t\t\t\tmodify get_table_info_&wo2c_file_counter;\n\t\t\t\t\t\t\t\trename segment = segment_org;\n\t\t\t\t\t\tquit;\n\t\t\t\t\t%end;\n\t\t\t\t\t%if &wof2l_shp_enrich_with_zip = 1 %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\tproc ginside\n\t\t\t\t\t\t\tdata = get_table_info_&wo2c_file_counter\n\t\t\t\t\t\t\tmap=_meta_94.gis_2_zcta out = get_table_info_&wo2c_file_counter;\n\t\t\t\t\t\t\tid zip_zcta;\n\t\t\t\t\t\tquit;\t\n\t\t\t\t\t%end;\n\t\t\n\t\t\t\t%end;\n\t\t\t%end;\n\t\t/**********\n\t\twriting that meta information out into macro variables for processing down the road.\n\t\there the variable names are captured\t\t\n\t\t**********/\n\t\t\t%let wof2l_max_varnumber_&wo2c_file_counter = 0;\n\t\t\t%if %sysfunc(exist(get_table_info_&wo2c_file_counter)) %then\n\t\t\t%do;\n\t\t\t\tproc sql noprint;\n\t\t\t\t\tcreate table columns_&wo2c_file_counter as\n\t\t\t\t\tselect\n\t\t\t\t\t\tlibname,\n\t\t\t\t\t\tmemname,\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tlength,\n\t\t\t\t\t\ttype,\n\t\t\t\t\t\tvarnum,\n\t\t\t\t\t\tformat,\n\t\t\t\t\t\tinformat\n\t\t\t\t\tfrom\n\t\t\t\t\t\tdictionary.columns\n\t\t\t\t\twhere\n\t\t\t\t\t\tupcase(libname) = \"WORK\" and\n\t\t\t\t\t\tupcase(memname) = \"GET_TABLE_INFO_&wo2c_file_counter\"\n\t\t\t\t\t;\n\t\t\t\tquit;\n\t\t\t\n\t\t\t\tdata columns_&wo2c_file_counter;\n\t\t\t\t\tset columns_&wo2c_file_counter;\n\t\t\t\t\tif missing(format) and\n\t\t\t\t\t\tmissing(informat) then\n\t\t\t\t\tdo;\n\t\t\t\t\t\tif trim(left(upcase(type))) = \"NUM\" then\n\t\t\t\t\t\tdo;\n\t \t\t\t\t\t\tinformat = \"best12.\";\n\t \t\t\t\t\t\tformat = \"best12.\";\n\t\t\t\t\t\tend; else\n\t\t\t\t\t\tdo;\n\t \t\t\t\t\t\tinformat = \"$32.\";\n\t \t\t\t\t\t\tformat = \"$32.\";\n\t\t\t\t\t\tend;\n\t\t\t\t\tend; else\n\t\t\t\t\tdo;\n\t\t\t\t\t\tif missing(format) then format = informat;\n\t\t\t\t\t\tif missing(informat) then informat = format;\n\t\t\t\t\tend;\n\t\t\t\trun;\n \n\t\t\t\t%let wof2l_max_varnumber_&wo2c_file_counter = ;\n\t\t\t\tproc sql noprint;\n\t\t\t\t\tselect\n\t\t\t\t\t\tnobs into :wof2l_max_varnumber_&wo2c_file_counter\n\t\t\t\t\tfrom dictionary.tables\n\t\t\t\t\twhere\n\t\t\t\t\t\tlibname = 'WORK' and\n\t\t\t\t\t\tmemname = \"COLUMNS_&wo2c_file_counter\";\n\t\t\t\tquit;\n\t\t\t\t%let wof2l_max_varnumber_&wo2c_file_counter = %trim(%left(&&wof2l_max_varnumber_&wo2c_file_counter));\n \n\t/*****\n\tDoing the next step to align the manual chosen variable names by DIAP\n\twith the automatic provided ones.\n\t*****/\n\t\t\t\t%if &wo2c_file_extension eq CSV or\t\t\n\t\t\t\t\t&wo2c_file_extension eq TXT or\n\t\t\t\t\t((\"&wof2l_file_delimiter_guided\" ne \"\" and %upcase(\"&wof2l_file_delimiter_guided\") ne \"_DIAP_NA_\") and\n\t\t\t\t\t\t&wof2l_diap_guided_automation = 1) %then\n\t\t\t\t%do;\n \n\t\t\t\t\tproc datasets library=work nolist;\n\t\t\t\t\t   modify get_table_info_&wo2c_file_counter;\n\t\t\t\t\t      rename\n\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\tvar&wof2c_variable_counter = var_&wo2c_file_counter._&wof2c_variable_counter \t\t\t\t\t\n\t\t\t\t\t\t\t%end;\t\n\t\t\t\t\t\t\t;\n\t\t\t\t\tquit;\n\t\t\t\t\tproc sql noprint;\n\t\t\t\t\t\tcreate table columns_&wo2c_file_counter as\n\t\t\t\t\t\tselect\n\t\t\t\t\t\t\tlibname,\n\t\t\t\t\t\t\tmemname,\n\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\tlength,\n\t\t\t\t\t\t\ttype,\n\t\t\t\t\t\t\tvarnum,\n\t\t\t\t\t\t\tformat,\n\t\t\t\t\t\t\tinformat\n\t\t\t\t\t\tfrom\n\t\t\t\t\t\t\tdictionary.columns\n\t\t\t\t\t\twhere\n\t\t\t\t\t\t\tupcase(libname) = \"WORK\" and\n\t\t\t\t\t\t\tupcase(memname) = \"GET_TABLE_INFO_&wo2c_file_counter\"\n\t\t\t\t\t\t;\n\t\t\t\t\tquit;\n\t\t\t\t\tdata columns_&wo2c_file_counter;\n\t\t\t\t\t\tset columns_&wo2c_file_counter;\n\t\t\t\t\t\tif missing(format) and\n\t\t\t\t\t\t\tmissing(informat) then\n\t\t\t\t\t\tdo;\n\t\t\t\t\t\t\tif trim(left(upcase(type))) = \"NUM\" then\n\t\t\t\t\t\t\tdo;\n\t\t \t\t\t\t\t\tinformat = \"best12.\";\n\t\t \t\t\t\t\t\tformat = \"best12.\";\n\t\t\t\t\t\t\tend; else\n\t\t\t\t\t\t\tdo;\n\t\t \t\t\t\t\t\tinformat = \"$32.\";\n\t\t \t\t\t\t\t\tformat = \"$32.\";\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\tend; else\n\t\t\t\t\t\tdo;\n\t\t\t\t\t\t\tif missing(format) then format = informat;\n\t\t\t\t\t\t\tif missing(informat) then informat = format;\n\t\t\t\t\t\tend;\n\t\t\t\t\trun;\n \n\t\t\t\t%end;\n \n\t\t\t\t%if &wof2l_debug_mode %then\n\t\t\t\t\t\t\t%put INFORMATION: The number of columns of table # &wo2c_file_counter to read in is: &&wof2l_max_varnumber_&wo2c_file_counter;\n \n\t\t\t\t\n\t\t\t\t%do wof2l_var_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t%local\n\t\t\t\t\t\twof2l_varname_seq_&wo2c_file_counter._&wof2l_var_counter\n\t\t\t\t\t\twof2l_varnum_seq_&wo2c_file_counter._&wof2l_var_counter\n\t\t\t\t\t\twof2l_format_seq_&wo2c_file_counter._&wof2l_var_counter\n\t\t\t\t\t\twof2l_informat_seq_&wo2c_file_counter._&wof2l_var_counter\n\t\t\t\t\t\twof2l_length_seq_&wo2c_file_counter._&wof2l_var_counter\n\t\t\t\t\t\twof2l_type_seq_&wo2c_file_counter._&wof2l_var_counter\n\t\t\t\t\t\t;\n\t\t\t\t\t%let wof2l_varname_seq_&wo2c_file_counter._&wof2l_var_counter = ;\n\t\t\t\t\t%let wof2l_varnum_seq_&wo2c_file_counter._&wof2l_var_counter = ;\n\t\t\t\t\t%let wof2l_format_seq_&wo2c_file_counter._&wof2l_var_counter = ;\n\t\t\t\t\t%let wof2l_informat_seq_&wo2c_file_counter._&wof2l_var_counter = ;\n\t\t\t\t\t%let wof2l_length_seq_&wo2c_file_counter._&wof2l_var_counter = ;\n\t\t\t\t\t%let wof2l_type_seq_&wo2c_file_counter._&wof2l_var_counter = ;\n\t\t\t\t%end;\n\t\t\t\tdata _null_;\n\t\t\t\t\tset columns_&wo2c_file_counter;\n\t\t\t\t\tsuffix = put(_n_, 6.);\n\t\t\t\t\tcall symput(cats(\"wof2l_varname_seq_&wo2c_file_counter._\", suffix), name);\n\t\t\t\t\tcall symput(cats(\"wof2l_varnum_seq_&wo2c_file_counter._\", suffix), varnum);\n\t\t\t\t\tcall symput(cats(\"wof2l_format_seq_&wo2c_file_counter._\", suffix), format);\n\t\t\t\t\tcall symput(cats(\"wof2l_informat_seq_&wo2c_file_counter._\", suffix), informat);\n\t\t\t\t\tcall symput(cats(\"wof2l_length_seq_&wo2c_file_counter._\", suffix), length);\n\t\t\t\t\tcall symput(cats(\"wof2l_type_seq_&wo2c_file_counter._\", suffix), type);\n\t\t\t\trun;\n \n\t\t\t\t%do wof2l_var_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t%let wof2l_varname_seq_&wo2c_file_counter._&wof2l_var_counter = %trim(%left(&&wof2l_varname_seq_&wo2c_file_counter._&wof2l_var_counter));\n\t\t\t\t\t%let wof2l_varnum_seq_&wo2c_file_counter._&wof2l_var_counter = %trim(%left(&&wof2l_varnum_seq_&wo2c_file_counter._&wof2l_var_counter));\n\t\t\t\t\t%let wof2l_format_seq_&wo2c_file_counter._&wof2l_var_counter = %trim(%left(&&wof2l_format_seq_&wo2c_file_counter._&wof2l_var_counter));\n\t\t\t\t\t%let wof2l_informat_seq_&wo2c_file_counter._&wof2l_var_counter = %trim(%left(&&wof2l_informat_seq_&wo2c_file_counter._&wof2l_var_counter));\n\t\t\t\t\t%let wof2l_length_seq_&wo2c_file_counter._&wof2l_var_counter = %trim(%left(&&wof2l_length_seq_&wo2c_file_counter._&wof2l_var_counter));\n\t\t\t\t\t%let wof2l_type_seq_&wo2c_file_counter._&wof2l_var_counter = %trim(%left(&&wof2l_type_seq_&wo2c_file_counter._&wof2l_var_counter));\n\t\t\t\t%end;\n \n \n\t\t\t\t%let wof2l_varname_seq_count = &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t%if &wof2l_debug_mode %then\n\t\t\t\t%do;\n\t\t\t\t\t%do wof2l_var_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t%put INFORMATION: wof2l_varname_seq_&wo2c_file_counter._&wof2l_var_counter = &&wof2l_varname_seq_&wo2c_file_counter._&wof2l_var_counter;\n\t\t\t\t\t\t%put INFORMATION: wof2l_varnum_seq_&wo2c_file_counter._&wof2l_var_counter = &&wof2l_varnum_seq_&wo2c_file_counter._&wof2l_var_counter;\n\t\t\t\t\t\t%put INFORMATION: wof2l_format_seq_&wo2c_file_counter._&wof2l_var_counter = &&wof2l_format_seq_&wo2c_file_counter._&wof2l_var_counter;\n\t\t\t\t\t\t%put INFORMATION: wof2l_informat_seq_&wo2c_file_counter._&wof2l_var_counter = &&wof2l_informat_seq_&wo2c_file_counter._&wof2l_var_counter;\n\t\t\t\t\t\t%put INFORMATION: wof2l_length_seq_&wo2c_file_counter._&wof2l_var_counter = &&wof2l_length_seq_&wo2c_file_counter._&wof2l_var_counter;\n\t\t\t\t\t\t%put INFORMATION: wof2l_type_seq_&wo2c_file_counter._&wof2l_var_counter = &&wof2l_type_seq_&wo2c_file_counter._&wof2l_var_counter;\n\t\t\t\t\t%end;\n\t\t\t\t%end;\n\t\t\t%end;\n \n\t/*********************************************\n\tprocess special definition cases...\n\t*********************************************/\n \n\t\t\t%if \"&wof2l_fixed_file_definition_ds\" ne \"\" %then\n\t\t\t%do;\n\t\t\t\t%if %upcase(%trim(%left(&wof2l_special_file_type))) = FIX or\n\t\t\t\t\t%upcase(%trim(%left(&wof2l_special_file_type))) = XML %then\n\t\t\t\t%do;\n \n\t\t\t\t\tdata work.varnames_&wo2c_file_counter._2  ;\n\t\t\t\t\t\tlength\n\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &variable_count;\n\t\t\t\t\t\t\tvar_&wo2c_file_counter._&wof2c_variable_counter $ &wof2l_variable_length_max\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t%if &fwf_fn_include_indicator = 1 %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t%let wof2c_variable_counter = %eval(&variable_count + 1);\n\t\t\t\t\t\t\tvar_&wo2c_file_counter._&wof2c_variable_counter $ &wof2l_variable_length_max\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t;\n\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &variable_count;\n\t\t\t\t\t\t\t%let original_varname_fwf = %trim(%left(%scan(&fwf_variable_name_seq, &wof2c_variable_counter, '#')));\n \n\t\t\t\t\t\t\tvar_&wo2c_file_counter._&wof2c_variable_counter = \"&original_varname_fwf\";\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t%if &fwf_fn_include_indicator = 1 %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t%let wof2c_variable_counter = %eval(&variable_count + 1);\n\t\t\t\t\t\t\tvar_&wo2c_file_counter._&wof2c_variable_counter = \"_diap_gen_source_file_name\";\n\t\t\t\t\t\t%end;\n \n\t\t\t\t\trun;\n\t\t\t\t%end;\n\t\t\t\tdata work.varnames_&wo2c_file_counter._2 ;\n \n\t\t\t\t\tset work.varnames_&wo2c_file_counter._2 ;\n\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\tif missing(var_&wo2c_file_counter._&wof2c_variable_counter) or\n\t\t\t\t\t\t\tvar_&wo2c_file_counter._&wof2c_variable_counter = \"_\" then\n\t\t\t\t\t\tdo;\n\t\t\t\t\t\t\tvar_&wo2c_file_counter._&wof2c_variable_counter = \"ZZ_MISSING_VARNAME_&wof2c_variable_counter._FILE_&&wo2c_file_counter.\";\t\t\t\t\t\n\t\t\t\t\t\t\tcall symput(\"wof2l_check_source_fl_flag_&wo2c_file_counter\", 1);\n\t\t\t\t\t\tend;\n\t\t\t\t\t%end;\t\n\t\t\t\trun;\n\t\t\t\t%if &wof2l_debug_mode %then\n\t\t\t\t%do;\n\t\t\t\t\tdata work.varnames_fwf_&wo2c_file_counter._2 ;\n\t\t\t\t\t\tset work.varnames_&wo2c_file_counter._2 ;\n\t\t\t\t\trun;\n\t\t\t\t%end;\n \n\t\t\t%end;\n\t\t\t%else\n\t\t\t%do;\n \n\t/*********************************************\n\tnow process the variable names for all the other cases...\n\t*********************************************/\n \n\t\t\n\t\t\t\t%if &wo2c_file_extension eq CSV or\t\n\t\t\t\t\t&wo2c_file_extension eq TXT or\n\t\t\t\t\t((\"&wof2l_file_delimiter_guided\" ne \"\" and %upcase(\"&wof2l_file_delimiter_guided\") ne \"_DIAP_NA_\") and\n\t\t\t\t\t&wof2l_diap_guided_automation = 1) %then\n\t\t\t\t%do;\n\t\t\t\t\t%if &&wof2l_has_header_file_no_&wo2c_file_counter %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\t%if &wof2l_csv_big_data_mode = 0 %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tdata work.varnames_&wo2c_file_counter._2  ;\n\t\t\t\t\t\t\t%let _EFIERR_ = 0;\n\t\t\t\t\t\t\t\tinfile &&wof2l_input_file_&wo2c_file_counter\n \n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"TAB\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = '09'x\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"BLANK\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = ' '\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"COMMA\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = ','\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"SEMICOLON\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = ';'\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"PIPE\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = '|'\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = \"&&wof2l_delimiter_file_no_&wo2c_file_counter\"\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\n\t\t\t\t\t\t\t\tMISSOVER DSD lrecl=&wof2l_lrec_length obs = 1;\n\t\t\t\t\t\t\t\tlength\n\t\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t\tvar_&wo2c_file_counter._&wof2c_variable_counter $ &wof2l_variable_length_max\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\tinput\n\t\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t\tvar_&wo2c_file_counter._&wof2c_variable_counter $\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\trun;\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t%if &wof2l_csv_big_data_mode = 1 %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tdata work.varnames_&wo2c_file_counter._2 ;\n\t\t\t\t\t\t\t\tinfile  &&wof2l_input_file_&wo2c_file_counter lrecl=5000000  dsd\n \n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"TAB\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = '09'x\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"BLANK\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = ' '\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"COMMA\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = ','\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"SEMICOLON\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = ';'\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"PIPE\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = '|'\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = \"&&wof2l_delimiter_file_no_&wo2c_file_counter\"\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\tobs = 1;\n\t\t\t\t\t\t\t\tarray varplaceholder{&&wof2l_max_varnumber_&wo2c_file_counter} $ &wof2l_variable_length_max var_&wo2c_file_counter._1-var_&wo2c_file_counter._&&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\tlength name  $ &wof2l_variable_length_max ;\n\t\t\t\t\t\t\t\tdrop name row_counter varnum;\n\t\t\t\t\t\t\t\tdo varnum=1 by 1 ;\n\t\t\t\t\t\t\t\t\tinput name @;\n\t\t\t\t\t\t\t\t\trow_counter = mod(varnum, &&wof2l_max_varnumber_&wo2c_file_counter);\n\t\t\t\t\t\t\t\t\tif row_counter = 0 then\n\t\t\t\t\t\t\t\t\tdo;\n\t\t\t\t\t\t\t\t\t\trow_counter = &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\t\t\tvarplaceholder{row_counter}= name;\n\t\t\t\t\t\t\t\t\tif row_counter = &&wof2l_max_varnumber_&wo2c_file_counter then\n\t\t\t\t\t\t\t\t\tdo;\n\t\t\t\t\t\t\t\t\t\toutput;\n\t\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\trun;\t\t\t\t\t\n\t\t\t\t\t\t%end;\n\t\t\t\t\t%end; %else\n\t\t\t\t\t%do;\n\t\t\t\t\t\tdata work.varnames_&wo2c_file_counter._2  ;\n\t\t\t\t\t\t%let _EFIERR_ = 0;\n\t\t\t\t\t\t\tlength\n\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\tvar_&wo2c_file_counter._&wof2c_variable_counter $ &wof2l_variable_length_max\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\tvar_&wo2c_file_counter._&wof2c_variable_counter = \"DIAP_varname_gnrtd_&wof2c_variable_counter._FILE_&&wo2c_file_counter.\";\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\trun;\n\t\t\t\t\t\t%let wof2l_check_source_fl_flag_&wo2c_file_counter = 2;\n\t\t\t\t\t%end;\n\t\t\t\t\tdata work.varnames_&wo2c_file_counter._2 ;\n \n\t\t\t\t\t\tset work.varnames_&wo2c_file_counter._2 ;\n\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\tif missing(var_&wo2c_file_counter._&wof2c_variable_counter) or\n\t\t\t\t\t\t\t\tvar_&wo2c_file_counter._&wof2c_variable_counter = \"_\" then\n\t\t\t\t\t\t\tdo;\n\t\t\t\t\t\t\t\tvar_&wo2c_file_counter._&wof2c_variable_counter = \"ZZ_MISSING_VARNAME_&wof2c_variable_counter._FILE_&&wo2c_file_counter.\";\t\t\t\t\t\n\t\t\t\t\t\t\t\tcall symput(\"wof2l_check_source_fl_flag_&wo2c_file_counter\", 1);\n\t\t\t\t\t\t\tend;\n \n\t\t\t\t\t\t%end;\t\n\t\t\t\t\trun;\n\t\t\t\t%end; %else\n\t\t\t\t%if &wo2c_file_extension eq XLSX  or\n\t\t\t\t\t(&wo2c_file_extension eq XLS and &wof2l_diap_guided_automation = 1) %then\n\t\t\t\t%do;\n\t\t\t\t\t%let wof2l_final_column_name = ;\n\t\t\t\t\t%let wof2l_xlsx_varname_seq = ;\n\t\t\t\t\tproc sql noprint;\n\t\t\t\t\t\tselect\n\t\t\t\t\t\t\tname\n\t\t\t\t\t\tinto\n\t\t\t\t\t\t\t:wof2l_final_column_name\n\t\t\t\t\t\tfrom\t\n\t\t\t\t\t\t\tdictionary.columns\n\t\t\t\t\t\twhere\t\t\n\t\t\t\t\t\t\tupcase(libname) = \"WORK\" and\t\n\t\t\t\t\t\t\tupcase(memname) = \"%upcase(get_table_info_&wo2c_file_counter)\" and\t\n\t\t\t\t\t\t\tvarnum = &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\tquit;\n\t\t\t\t\tproc import\n\t\t\t\t\t\tdatafile=inf&wo2c_file_counter\n\t\t\t\t\t\tout=work.varnames_&wo2c_file_counter._2\n\t\t\t\t\t\tdbms=&wo2c_file_extension replace;\n\t\t\t\t\t\tdatarow = 1;\n\t\t\t\t\t\trange=\"&wof2l_sheet_name$A1:%trim(%left(&wof2l_final_column_name.))1\";\n\t\t\t\t\t \tgetnames=no;\n\t\t\t\t\trun;\n \n\t\t\t\t\tdata work.varnames_&wo2c_file_counter._2 ;\n\t\t\t\t\t\tlength\n\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t_&&wof2l_varname_seq_&wo2c_file_counter._&wof2c_variable_counter $ &wof2l_variable_length_max\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t;\t\n\t\t\t\t\t\tset work.varnames_&wo2c_file_counter._2 ;\n\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\tdrop &&wof2l_varname_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t_&&wof2l_varname_seq_&wo2c_file_counter._&wof2c_variable_counter = &&wof2l_varname_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\tif missing(_&&wof2l_varname_seq_&wo2c_file_counter._&wof2c_variable_counter) or\n\t\t\t\t\t\t\t\t_&&wof2l_varname_seq_&wo2c_file_counter._&wof2c_variable_counter = \"_\" then\n\t\t\t\t\t\t\tdo;\n\t\t\t\t\t\t\t\t_&&wof2l_varname_seq_&wo2c_file_counter._&wof2c_variable_counter = \"ZZ_MISSING_VARNAME_&wof2c_variable_counter._FILE_&&wo2c_file_counter.\";\t\t\t\n\t\t\t\t\t\t\t\tcall symput(\"wof2l_check_source_fl_flag_&wo2c_file_counter\", 1);\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t%end;\t\n\t\t\t\t\trun;\n\t\t\t\t\tdata work.varnames_&wo2c_file_counter._2 ;\n\t\t\t\t\t\tlength\n\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t&&wof2l_varname_seq_&wo2c_file_counter._&wof2c_variable_counter $ &wof2l_variable_length_max\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t;\t\n\t\t\t\t\t\tset work.varnames_&wo2c_file_counter._2 ;\n\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\tdrop _&&wof2l_varname_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t&&wof2l_varname_seq_&wo2c_file_counter._&wof2c_variable_counter = _&&wof2l_varname_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t%end;\t\n\t\t\t\t\trun;\n\t\t\t\n\t\t\t\t%end; %else\n\t\t\t\t%if &wo2c_file_extension eq JMP or\t\t\n\t\t\t\t\t&wo2c_file_extension eq SHP or\t\t\n\t\t\t\t\t&wo2c_file_extension eq JSON or\t\t\n\t\t\t\t\t&wo2c_file_extension eq XML %then\n\t\t\t\t%do;\n\t\t\t\t\tdata work.varnames_&wo2c_file_counter._2;\n\t\t\t\t\t\tlength\n\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\tvar&&wof2l_varnum_seq_&wo2c_file_counter._&wof2c_variable_counter $256.\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\tvar&&wof2l_varnum_seq_&wo2c_file_counter._&wof2c_variable_counter = \"&&wof2l_varname_seq_&wo2c_file_counter._&wof2c_variable_counter\";\n\t\t\t\t\t\t\t\tif missing(var&&wof2l_varnum_seq_&wo2c_file_counter._&wof2c_variable_counter) or\n\t\t\t\t\t\t\t\t\tvar&&wof2l_varnum_seq_&wo2c_file_counter._&wof2c_variable_counter = \"_\" then\n\t\t\t\t\t\t\t\tdo;\n\t\t\t\t\t\t\t\t\tvar&&wof2l_varnum_seq_&wo2c_file_counter._&wof2c_variable_counter = \"ZZ_MISSING_VARNAME_&wof2c_variable_counter._FILE_&&wo2c_file_counter.\";\t\t\t\n\t\t\t\t\t\t\t\t\tcall symput(\"wof2l_check_source_fl_flag_&wo2c_file_counter\", 1);\n\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\trun;\n\t\t\t/****\n\t\t\tthe next step is just there to align the jump case with the other cases.\n\t\t\tAnd also, just in case if the variable name needs to get changed, this would take care of it.\n\t\t\t****/\n\t\t\t\t\tdata get_table_info_&wo2c_file_counter;\n\t\t\t\t\t\tset get_table_info_&wo2c_file_counter;\n\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\tvar&&wof2l_varnum_seq_&wo2c_file_counter._&wof2c_variable_counter = &&wof2l_varname_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t\tdrop &&wof2l_varname_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t%end;\n\t\t\t\n\t\t\t\t\trun;\n\t\t\t\t\t%let wof2l_max_var_name_length_target = 29;\n\t\t\t\n\t\t\t\t%end;\t\n\t\t\t%end;\n\t\t\n\t\t\t%if &wof2l_debug_mode %then\n\t\t\t\t\t\t%put INFORMATION: File &wo2c_full_file_name contains &&wof2l_max_varnumber_&wo2c_file_counter variables;\n\t\t/**********\n\t\ttransposing to get all the variable names into one column\n\t\t**********/\n\t\t\t%if %sysfunc(exist(work.varnames_&wo2c_file_counter._2)) %then\n\t\t\t%do;\t\n\t\t\t\tproc transpose\n\t\t\t\t\tdata = work.varnames_&wo2c_file_counter._2\n\t\t\t\t\tout = varnames_transposed_&wo2c_file_counter;\n\t\t\t\t \tvar _all_;\n\t\t\t\trun;\n\t\t\t/**********\n\t\t\tadjusting the variable name and in one first step replacing the \"&\" to reduce headaches\n\t\t\tdownstream\n\t\t\t**********/\n\t\t\t\n\t\t\t\tdata work.varnames_transposed_&wo2c_file_counter._exp;\n\t\t\t\t\tlength\n\t\t\t\t\t\tvarname_first_29char $32.\n\t\t\t\t\t\tnew_varname $32.\n\t\t\t\t\t\tcurrent_varname $32.\n\t\t\t\t\t\toriginal_varname $256.\n\t\t\t\t\t\tfilename_1st_occurence $256.\n\t\t\t\t\t\tformat_value $32.\n\t\t\t\t\t\tinformat_value $32.\n\t\t\t\t\t\t;\n\t\t\t\t\tdrop\t\n\t\t\t\t\t\t_name_\n\t\t\t\t\t\t%if &wof2l_string_seq_cut_count eq 0 %then\n\t\t\t\t\t\t%do;\t\t\t\t\t\n\t\t\t\t\t\t\tcol1\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t;\n\t\t\t\t\tset varnames_transposed_&wo2c_file_counter;\n\t\t\t\t\toriginal_order = _n_;\n\t\t\t\t\toriginal_varname = upcase(col1);\n\t\t\t\t\tnew_varname = \"\";\n\t\t\t\t\tcurrent_varname = _name_;\n\t\t\t\t\t%if &wof2l_string_seq_cut_count eq 0 %then\n\t\t\t\t\t%do;\t\t\t\t\t\n\t\t\t\t\t\tif notalpha(substr(col1, 1, 1)) then col1 = \"V\"||col1;\n\t\t\t\t\t%end;\n\t\t\t\t\tvarname_first_29char = substr(upcase(col1), 1, &wof2l_max_var_name_length_target);\n\t\t\t\t\tfilename_1st_occurence = \"&wo2c_full_file_name\";\n\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\tif upcase(trim(left(current_varname))) = \"%trim(%left(%upcase(&&wof2l_varname_seq_&wo2c_file_counter._&wof2c_variable_counter)))\" then\t\n\t\t\t\t\t\tdo;\n\t\t\t\t\t\t\tformat_value = \"%trim(%left(&&wof2l_format_seq_&wo2c_file_counter._&wof2c_variable_counter))\";\n\t\t\t\t\t\t\tinformat_value = \"%trim(%left(&&wof2l_informat_seq_&wo2c_file_counter._&wof2c_variable_counter))\";\n\t\t\t\t\t\tend;\n\t\t\t\t\t%end;\n\t\t\t\trun;\n\t\t\t\n\t/******\n\tthe next segment cuts out unwanted characters strings from the variable names\n\t*******/\n \n\t\t\t\t%if &wof2l_string_seq_cut_count ne 0 %then\n\t\t\t\t%do;\n\t\t\t\t\t%do wof2l_string_seq_cut_counter = 1 %to &wof2l_string_seq_cut_count;\n\t\t\t\t\t\t%let wof2l_string_2_cut = %scan(&wof2l_stringseq_2_cutout_from_vn, &wof2l_string_seq_cut_counter, \"#\");\t\t\t\n \n\t\t\t\t\t\tdata work.varnames_transposed_&wo2c_file_counter._exp;\n\t\t\t\t\t\t\tset work.varnames_transposed_&wo2c_file_counter._exp;\n\t\t\t\t\t\t\tdrop\n\t\t\t\t\t\t\t\twof2l_string_2_cut\n\t\t\t\t\t\t\t\tposition\n\t\t\t\t\t\t\t\tlength_chk\n\t\t\t\t\t\t\t\tlength_org\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\twof2l_string_2_cut = \"&wof2l_string_2_cut\";\n\t\t\t\t\t\t\tlength_chk = length(wof2l_string_2_cut);\n\t\t\t\t\t\t\tlength_org = length(col1);\n\t\t\t\t\t\t\tposition = 0;\n\t\t\t\t\t\t\tposition = index(upcase(col1), upcase(wof2l_string_2_cut));\n\t\t\t\t\t\t\tif position ne 0 then\n\t\t\t\t\t\t\tdo;\n\t\t\t\t\t\t\t\tif position = 1 and length_chk ne length_org then\n\t\t\t\t\t\t\t\t\tcol1 = trim(left(substr(col1, position + length_chk)));\n\t\t\t\t\t\t\t\telse if position = 1 and length_chk eq length_org then\n\t\t\t\t\t\t\t\t\tcol1 = \"\";\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tcol1 = trim(left(trim(left(substr(col1, 1, position - 1)))||trim(left(substr(col1, position + length_chk)))));\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\tif notalpha(substr(col1, 1, 1)) then col1 = \"V\"||trim(left(col1));\n\t\t\t\t\t\t\tif missing(col1) then col1 = \"ZZ_Check_cutout_strng_4_VN_&wo2c_file_counter\";\n\t\t\t\t\t\t\tvarname_first_29char = substr(upcase(col1), 1, &wof2l_max_var_name_length_target);\n\t\t\t\t\t\trun;\n\t\t\t\n\t\t\t\t\t%end;\n\t\t\t\t\tdata work.varnames_transposed_&wo2c_file_counter._exp;\n\t\t\t\t\t\tset work.varnames_transposed_&wo2c_file_counter._exp;\n\t\t\t\t\t\tdrop\n\t\t\t\t\t\t\tcol1\n\t\t\t\t\t\t;\n\t\t\t\t\trun;\n\t\t\t\t%end;\n \n \n\t\t\t\tproc sort\n\t\t\t\t\tdata = work.varnames_transposed_&wo2c_file_counter._exp;\n\t\t\t\t\tby\toriginal_varname;\n\t\t\t\tquit;\n\t\t\t%end; /* end if exist */ %else\n\t\t\t%do;\n\t\t\t\tdata work.varnames_transposed_&wo2c_file_counter._exp;\n\t\t\t\t\tlength\n\t\t\t\t\t\tvarname_first_29char $32.\n\t\t\t\t\t\tnew_varname $32.\n\t\t\t\t\t\tcurrent_varname $32.\n\t\t\t\t\t\toriginal_varname $256.\n\t\t\t\t\t\tfilename_1st_occurence $256.\n\t\t\t\t\t\tformat_value $32.\n\t\t\t\t\t\tinformat_value $32.\n\t\t\t\t\t\toriginal_order 8\n\t\t\t\t\t\t;\n\t\t\t\t\tif 0;\n\t\t\t\trun;\n\t\t\t%end;\n\t\t%end; %else\n\t\t%do;\n\t/*******\n\tcreate empty dataset so the whole process can run through smoothly.\n\t*******/\n\t\t\tdata work.varnames_transposed_&wo2c_file_counter._exp;\n\t\t\t\tlength\n\t\t\t\t\tvarname_first_29char $32.\n\t\t\t\t\tnew_varname $32.\n\t\t\t\t\tcurrent_varname $32.\n\t\t\t\t\toriginal_varname $256.\n\t\t\t\t\tfilename_1st_occurence $256.\n\t\t\t\t\tformat_value $32.\n\t\t\t\t\tinformat_value $32.\n\t\t\t\t\toriginal_order 8\n\t\t\t\t\t;\n\t\t\t\tif 0;\n\t\t\trun;\n\t\t\t\n\t\t%end;\n\t%end;\n \n\t/**********\n\tnow, processing the metadata, we are bringing all the files together from the previous loop into one file\n\t**********/\n\t\t\n \n\tdata work.varnames_all_in_one;\n\t\tset\n\t%do wo2c_file_counter = 1 %to &wp2c_file_count;\n\t\twork.varnames_transposed_&wo2c_file_counter._exp\n\t%end;\n\t;\n\trun;\n\t/**********\n\tdeduping the variable names by the ORIGINAL variable name to prepare for the variable name creation\n\t\tthat adheres to the SAS variable names rules.\n\t**********/\n \n\tproc sort\n\t\tdata = work.varnames_all_in_one\n\t\tout = varnames_all_in_one_deduped ;\n\t\tby original_varname format_value;\n\tquit;\n \n\tdata varnames_all_in_one_deduped;\n\t\tset varnames_all_in_one_deduped;\n\t\tby original_varname ;\n\t\tif first.original_varname;\n\trun;\n \n\t/*************************\n\tcheck if table exists in CAS , but it not loaded yet\n\t**************************/\n\t%let wof2l_log_target_environment = ;\n\t%let wof2l_caslib_temp = %trim(%left(%scan(&wof2l_variable_dict_dataset, 1, '.')));\n\tproc sql noprint;\n\t\tselect distinct(engine)\n\t\tinto :wof2l_log_target_environment\n\t\tfrom dictionary.libnames\n\t\twhere upcase(libname) = \"%upcase(&wof2l_caslib_temp)\"\n\t\t;\n\tquit;\n \n \n\t%if %sysfunc(exist(&wof2l_variable_dict_dataset)) = 0 and\n\t\t&wof2l_log_target_environment eq CAS %then\n\t%do;\n\t\t%let wof2l_castable_temp = %trim(%left(%scan(&wof2l_variable_dict_dataset, 2, '.')));\n\t\tproc cas;\n\t\t\ttable.caslibinfo\n\t\t \t\tresult=sss/caslib=\"&wof2l_caslib_temp\"  ;\n\t\t\tdescribe sss;\n\t\t\tprint sss;\n\t\t\tsaveresult sss\n\t\t\t\tdataout=work._temp_path_data;\n\t\trun;\n\t\t%let wof2l_temp_lib_path = ;\t\n\t\tproc sql;\n\t\t\tselect path\n\t\t\tinto:wof2l_temp_lib_path\n\t\t\tfrom work._temp_path_data;\n\t\tquit;\n \n\t\t%if %sysfunc(fileexist(%trim(%left(&wof2l_temp_lib_path))&wof2l_castable_temp..sashdat)) %then\n\t\t%do;\n\t\t\tproc casutil\n\t\t\t\tincaslib=\"&wof2l_caslib_temp\" outcaslib = \"&wof2l_caslib_temp\";\n\t\t\t\tload casdata=\"&wof2l_castable_temp..sashdat\" casout=\"&wof2l_castable_temp\" promote;\n\t\t\tquit;\n\t\t%end;\n\t%end;\n \n \n\t%if %sysfunc(exist(&wof2l_variable_dict_dataset)) %then\n\t%do;\n\t\tdata work.original_var_overview_ds;\n\t\t\tset &wof2l_variable_dict_dataset;\n\t\trun;\n\t\tproc sort\n\t\t\tdata = work.original_var_overview_ds;\n\t\t\tby original_varname;\n\t\tquit;\n\t\tdata work.overview_new_var_upload_list;\n\t\t\tmerge\n\t\t\t\twork.varnames_all_in_one_deduped (in = update)\n\t\t\t\twork.original_var_overview_ds (in = original)\n\t\t\t\t;\n\t\t\tby \toriginal_varname;\n\t\trun;\n\t\tdata work.varnames_all_in_one_deduped;\n\t\t\tset overview_new_var_upload_list;\n\t\trun;\n\t%end;\n\t\t\n \n\t/**********\n\tnow preparing the sort order so we can find out if we have duplicates when we\n\t\tshorten the variable name to 29 characters\n\t**********/\n \n\tproc sort\n\t\tdata = work.varnames_all_in_one_deduped;\n\t\tby \tvarname_first_29char\n\t\t\tdescending new_varname;\n\tquit;\n \n\t/**********\n\tthis datastep deals with duplicates and if there are, we are appending a counter to\n\t\tthe newly created variable name to make them unique.\n\t\twe also replace characters in the newly variable name that we don't like for SAS variable names.\n\t\tThen we are writing out the dataset so it is available for reference later on.\n\t**********/\n\t\t\n\tdata &wof2l_variable_dict_dataset;\n\t\tretain\n\t\t\toriginal_varname\n\t\t\tnew_varname\n\t\t\tfilename_1st_occurence\n\t\t\tvarname_first_29char\n\t\t\tformat_value\n\t\t\tinformat_value\n\t\t\t;\n\t\tlength new_varname $32.;\n\t\tset work.varnames_all_in_one_deduped;\n\t\tby varname_first_29char;\n\t\tkeep new_varname\n\t\t\toriginal_varname\n\t\t\tvarname_first_29char\n\t\t\tfilename_1st_occurence\n\t\t\tformat_value\n\t\t\tinformat_value\n\t\t\t;\n\t\tretain counter 0;\n\t\tif first.varname_first_29char then\n\t\t\tcounter = 0;\n\t\tcounter = counter + 1;\n\t\tif (first.varname_first_29char ne last.varname_first_29char) or\n\t\t\t(not first.varname_first_29char and not last.varname_first_29char) then\n\t\tdo;\n\t\t\tif missing(new_varname) then\n\t\t\tdo;\n\t\t\t\tnew_varname = trim(left(varname_first_29char)) || \"_\" || strip(put(counter, z2.));\n\t\t\t\t%if &wof2l_chck_4_spcl_char_in_vars = 1 %then\n\t\t\t\t%do;\n\t\t\t\t\tnew_varname = tranwrd(strip(new_varname), ' ', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '@', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, ':', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '/', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '\\', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '|', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, ';', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '$', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '>', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '<', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '^', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '~', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '*', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '(', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '[', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, ']', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '{', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '}', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, ')', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '!', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '+', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '=', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '?', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '.', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '-', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(trim(left(new_varname)), ' ', \"_\");\n\t\t\t\t%end;\n\t\t\tend;\n\t\tend; else\n\t\t\tif missing(new_varname) then\n\t\t\tdo;\n\t\t\t\tnew_varname = varname_first_29char;\n\t\t\t\t%if &wof2l_chck_4_spcl_char_in_vars = 1 %then\n\t\t\t\t%do;\n\t\t\t\t\tnew_varname = tranwrd(trim(left(new_varname)), ' ', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '@', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, ':', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '/', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '\\', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '|', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, ';', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '$', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '>', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '<', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '^', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '~', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '*', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '(', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '[', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, ']', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '{', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '}', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, ')', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '!', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '+', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '=', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '?', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '.', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(new_varname, '-', \"_\");\n\t\t\t\t\tnew_varname = tranwrd(trim(left(new_varname)), ' ', \"_\");\n\t\t\t\t%end;\n\t\t\tend;\n\t\t\tnew_varname = tranwrd(new_varname, '&', \"_\");\n\t\t\tnew_varname = tranwrd(new_varname, '#', \"_\");\n\t\t\tnew_varname = tranwrd(new_varname, ',', \"_\");\n\t\t\tnew_varname = tranwrd(new_varname, '%', \"_\");\n\t\t\tnew_varname = tranwrd(new_varname, '\"', \"_\");\n\t\t\tnew_varname = tranwrd(new_varname, \"'\", \"_\");\n\trun;\n \n\t/***\n\tsort into work dataset, just incase if variable dictionary libnamae is a CAS lib.\n\t***/\t\n\tdata work._temp_variable_dict_ds_sorted;\n\t\tset &wof2l_variable_dict_dataset;\n\trun;\n\tproc sort\n\t\tdata=work._temp_variable_dict_ds_sorted;\n\t\tby original_varname;\n\tquit;\n\tdata &wof2l_variable_dict_dataset;\n\t\tset work._temp_variable_dict_ds_sorted;\n\trun;\n \n\t/**********\n\tafter we determined the new variable names, we now have to read in the actual files from CSV into SAS.\n\t\tWhen doing that, we are now using the new variable names, and we put the original variable names\n\t\tinto the label.\n\t**********/\n \n\t%do wo2c_file_counter = 1 %to &wp2c_file_count;\n\t/**********\n\tlooping again through all the provided files, this time to read in the actual data.\n\t**********/\n \n\t\t%let wo2c_full_file_name = %scan(&wof2l_full_fname_path_2_load_seq, &wo2c_file_counter, '#');\n\t\t%let wo2c_file_extension = %scan(&wof2l_extension_2_load_seq, &wo2c_file_counter, '#');\n\t\t%let wof2l_sheet_name = %scan(&wof2l_sheet_name_seq, &wo2c_file_counter, '#');\n\t\t%let wof2l_final_table_name = %scan(&wof2l_target_table_name_seq, &wo2c_file_counter, '#');\n \n\t\t%let wof2l_filepath_for_sas_content = %scan(&wof2l_path_for_sas_content_seq, &wo2c_file_counter, '#');\n\t\t%let wof2l_file_delimiter_guided = %scan(&wof2l_file_delimiter_seq, &wo2c_file_counter, '#');\n\t\t%let wof2l_header_flag_guided = %scan(&wof2l_file_header_flag_seq, &wo2c_file_counter, '#');\n \n \n \n\t\t%let wof2l_table_to_process_check = .;\n \n\t\tproc sql;\n\t\t\tselect load_date\n\t\t\tinto :wof2l_table_to_process_check\n\t\t\tfrom work._DIAP_working_upload_log_ds\n\t\t\twhere\n\t\t\t\tupcase(file_path_full_name) = \"%upcase(&wo2c_full_file_name)\" and\t\t\n\t\t\t\tupcase(adjusted_table_name) = \"%upcase(&wof2l_final_table_name)\"\t\t\n\t\t\t;\n\t\tquit;\n \n\t\t%put GENERAL INFORMATION: File # &wo2c_file_counter &wo2c_full_file_name with sheet &wof2l_sheet_name ;\n\t\t%put GENERAL INFORMATION: wof2l_table_to_process_check &wof2l_table_to_process_check for final tablename &wof2l_final_table_name ;\n \n\t\t%if &wof2l_table_to_process_check = . %then\n\t\t%do;\n \n \n\t\t\tdata work.varnames_transposed_&wo2c_file_counter._exp;\n\t\t\t\tmerge \twork.varnames_transposed_&wo2c_file_counter._exp (in = infile)\n\t\t\t\t\t\twork._temp_variable_dict_ds_sorted (drop = format_value informat_value);\n\t\t\t\tby\toriginal_varname;\n\t\t\t\tif infile;\n\t\t\t\toriginal_varname = tranwrd(original_varname, '&', \"_\");\n\t\t\t\toriginal_varname = tranwrd(original_varname, '#', \"_\");\n\t\t\t\toriginal_varname = tranwrd(original_varname, ',', \"_\");\n\t\t\t\toriginal_varname = tranwrd(original_varname, '%', \"_\");\n\t\t\t\toriginal_varname = tranwrd(original_varname, '\"', \"_\");\n\t\t\t\toriginal_varname = tranwrd(original_varname, \"'\", \"_\");\n\t\t\trun;\n\t\t\tdata work.varnames_transposed_&wo2c_file_counter._exp;\n\t\t\t\tset work.varnames_transposed_&wo2c_file_counter._exp;\n\t\t\t\tif missing(new_varname) then\n\t\t\t\tdo;\n\t\t\t\t\tnew_varname = compress(\"CHECK_SOURCEFILE_4_DUP_VARNAME\"||_n_);\n\t\t\t\t\tcall symput(\"wof2l_check_source_fl_flag_&wo2c_file_counter\", 1);\n\t\t\t\tend;\n\t\t\trun;\n\t\t\t%let new_variable_name_seq = ;\n\t\t\t%let original_varname_seq = ;\n\t\t\t%let current_variable_name_seq = ;\n\t\t\t%let format_value_seq = ;\n\t\t\t%let informat_value_seq = ;\n \n\t\t\t%local\n\t\t\t\tnew_variable_name_seq\n\t\t\t\toriginal_varname_seq\n\t\t\t \tcurrent_variable_name_seq\n\t\t\t \tformat_value_seq\n\t\t\t \tinformat_value_seq\n\t\t\t\t;\t\n\t/**********\n\tso above we are merging back in the newly created variable name for the current file\n\t\t\tand writing those out into macro variables below for easier processing later and looping...\n\t**********/\n \n\t/***\n\tsort it first so that missing informat values come last.\n\t**/\n\t\t\tproc sort\n\t\t\t\tdata = varnames_transposed_&wo2c_file_counter._exp;\n\t\t\t\tby original_order;\n\t\t\tquit;\n \n \n\t\t\t\t%do wof2l_var_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t%let new_var_name_seq_&wo2c_file_counter._&wof2l_var_counter = ;\n\t\t\t\t\t%let curr_var_name_seq_&wo2c_file_counter._&wof2l_var_counter = ;\n\t\t\t\t\t%let orig_varname_seq_&wo2c_file_counter._&wof2l_var_counter = ;\n\t\t\t\t\t%let format_value_seq_&wo2c_file_counter._&wof2l_var_counter = ;\n\t\t\t\t\t%let informat_value_seq_&wo2c_file_counter._&wof2l_var_counter = ;\n\t\t\t\t%end;\n\t\t\t\tdata _null_;\n\t\t\t\t\tset varnames_transposed_&wo2c_file_counter._exp;\n\t\t\t\t\tsuffix = put(_n_, 6.);\n\t\t\t\t\tcall symput(cats(\"new_var_name_seq_&wo2c_file_counter._\", suffix), new_varname);\n\t\t\t\t\tcall symput(cats(\"curr_var_name_seq_&wo2c_file_counter._\", suffix), current_varname);\n\t\t\t\t\tcall symput(cats(\"orig_varname_seq_&wo2c_file_counter._\", suffix), original_varname);\n\t\t\t\t\tcall symput(cats(\"format_value_seq_&wo2c_file_counter._\", suffix), format_value);\n\t\t\t\t\tcall symput(cats(\"informat_value_seq_&wo2c_file_counter._\", suffix), informat_value);\n\t\t\t\trun;\n\t\t\t\t%do wof2l_var_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t%let new_var_name_seq_&wo2c_file_counter._&wof2l_var_counter = \"%trim(%left(&&new_var_name_seq_&wo2c_file_counter._&wof2l_var_counter))\"n;\n\t\t\t\t\t%let curr_var_name_seq_&wo2c_file_counter._&wof2l_var_counter = %trim(%left(&&curr_var_name_seq_&wo2c_file_counter._&wof2l_var_counter));\n\t\t\t\t\t%let orig_varname_seq_&wo2c_file_counter._&wof2l_var_counter = %trim(%left(&&orig_varname_seq_&wo2c_file_counter._&wof2l_var_counter));\n\t\t\t\t\t%let format_value_seq_&wo2c_file_counter._&wof2l_var_counter = %trim(%left(&&format_value_seq_&wo2c_file_counter._&wof2l_var_counter));\n\t\t\t\t\t%let informat_value_seq_&wo2c_file_counter._&wof2l_var_counter = %trim(%left(&&informat_value_seq_&wo2c_file_counter._&wof2l_var_counter));\n\t\t\t\t%end;\n \n \n \n\t\t\t%if &wof2l_debug_mode %then\n\t\t\t%do;\n\t\t\t\t\t%do wof2l_var_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t%put INFORMATION: new_var_name_seq_&wo2c_file_counter._&wof2l_var_counter = &&new_var_name_seq_&wo2c_file_counter._&wof2l_var_counter;\n\t\t\t\t\t\t%put INFORMATION: curr_var_name_seq_&wo2c_file_counter._&wof2l_var_counter = &&curr_var_name_seq_&wo2c_file_counter._&wof2l_var_counter;\n\t\t\t\t\t\t%put INFORMATION: orig_varname_seq_&wo2c_file_counter._&wof2l_var_counter = &&orig_varname_seq_&wo2c_file_counter._&wof2l_var_counter;\n\t\t\t\t\t\t%put INFORMATION: format_value_seq_&wo2c_file_counter._&wof2l_var_counter = &&format_value_seq_&wo2c_file_counter._&wof2l_var_counter;\n\t\t\t\t\t\t%put INFORMATION: informat_value_seq_&wo2c_file_counter._&wof2l_var_counter = &&informat_value_seq_&wo2c_file_counter._&wof2l_var_counter;\n\t\t\t\t\t%end;\n\t\t\t%end;\n\t/**********\n\tnow reading in the complete dataset and setting all the variable characteristics as determined in above\n\t\t\tsteps.\n\t**********/\n \n \n\t/****\n\tCheck for variable counter to be different from zero ,so that a valid table is created\n\t*****/\n \n\t\t\t%if &&wof2l_max_varnumber_&wo2c_file_counter gt 0 %then\n\t\t\t%do;\n\t/****\n\thave to check for fixed delimited file first, since they might have a CSV or TXT extension.\n\t****/\n\t\t\t%let wof2l_check_source_file_flag = &&wof2l_check_source_fl_flag_&wo2c_file_counter;\n \n\t\t\t%if &wof2l_check_source_file_flag = 1 and\n\t\t\t\t\"&wof2l_prefix_4_suspicious_src_fl\" ne \"\" and\n\t\t\t\t\"&wof2l_fnl_ds_name_4_all_extfiles\" eq \"\" %then\n\t\t\t%do;\n\t\t\t\t%let wof2l_length_prefix_fn_str = %length(&wof2l_prefix_4_suspicious_src_fl);\n\t\t\t\t%if &wof2l_max_lgth_of_suspicious_str < &wof2l_length_prefix_fn_str %then\n\t\t\t\t%do;\n\t\t\t\t\t%let &wof2l_length_prefix_fn_str = &wof2l_max_lgth_of_suspicious_str;\n\t\t\t\t\t%let wof2l_prefix_4_suspicious_src_fl = %substr(&wof2l_prefix_4_suspicious_src_fl, 1, &wof2l_length_prefix_fn_str);\n\t\t\t\t%end;\n\t\t\t\t%let wof2l_final_table_name = &wof2l_prefix_4_suspicious_src_fl%trim(%left(%substr(&wof2l_final_table_name, %eval(&wof2l_length_prefix_fn_str + 1))));\n\t\t\t%end;\n \n\t\t\t%if \"&wof2l_fixed_file_definition_ds\" ne \"\" %then\n\t\t\t%do;\n \n\t\t\t\t\t%if &wof2l_debug_mode %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\t%put INFORMATION: Loading FIXED/Width delimited file #&wo2c_file_counter. &wo2c_full_file_name;\n\t\t\t\t\t\t%put INFORMATION: Target libname is: &wof2l_cas_target_libname;\n\t\t\t\t\t\t%put INFORMATION: Target Table name is: &wof2l_final_table_name;\n\t\t\t\t\t%end;\t\n\t\t\t\t\t\n\t\t\t\t\t%if &wof2l_upload_activation = 1 %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\t\n\t\t\t\t\t\t%if \"&wof2l_fnl_ds_name_4_all_extfiles\" ne \"\" and\n\t\t\t\t\t\t\t%sysfunc(exist(&wof2l_cas_target_libname..&wof2l_final_table_name)) %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tdata work.&wof2l_fnl_ds_name_4_all_extfiles;\n\t\t\t\t\t\t\t\tset &wof2l_cas_target_libname..&wof2l_final_table_name;\n\t\t\t\t\t\t\trun;\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t%if &wof2l_target_environment eq CAS %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tproc casutil;\n\t\t\t\t\t\t\t\tdroptable casdata = \"&wof2l_final_table_name\" incaslib = \"&wof2l_cas_target_libname\" quiet;\n\t\t\t\t\t\t\t\tdroptable casdata = \"&wof2l_final_table_name\" incaslib = \"&wof2l_cas_target_libname\" quiet;\n\t\t\t\t\t\t\tquit;\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\tdata &wof2l_cas_target_libname..&wof2l_final_table_name;\n\t\t\t\t\t\t\tset\n\t\t\t\t\t\t\t%if \"&wof2l_fnl_ds_name_4_all_extfiles\" ne \"\" and\n\t\t\t\t\t\t\t\t%sysfunc(exist(work.&wof2l_fnl_ds_name_4_all_extfiles)) %then\n\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\twork.&wof2l_fnl_ds_name_4_all_extfiles\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\twork.get_table_info_&wo2c_file_counter\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t&&new_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter = &&curr_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t\tdrop &&curr_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\tformat\n\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t&&new_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter &&format_value_seq_&wo2c_file_counter._&wof2c_variable_counter\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\tinformat\n\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t%if \"%trim(%left(&&informat_value_seq_&wo2c_file_counter._&wof2c_variable_counter))\" = \"\" %then\n\t\t\t\t\t\t\t\t\t%let informat_value_seq_&wo2c_file_counter._&wof2c_variable_counter = &&format_value_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t\t&&new_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter &&informat_value_seq_&wo2c_file_counter._&wof2c_variable_counter\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\tlabel\n\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t&&new_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter = \"&&orig_varname_seq_&wo2c_file_counter._&wof2c_variable_counter\"\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\n\t\t\t\n\t\t\t\t\t\trun;\t\t\t\n\t\t\t\t\t\tdata work._DIAP_working_upload_log_ds;\n\t\t\t\t\t\t\tset work._DIAP_working_upload_log_ds;\n\t\t\t\t\t\t\tif file_path_full_name = \"&wo2c_full_file_name\" then\t\n\t\t\t\t\t\t\tdo;\n\t\t\t\t\t\t\t\t%if &wof2l_check_source_file_flag = 1 and\n\t\t\t\t\t\t\t\t\t\"&wof2l_prefix_4_suspicious_src_fl\" ne \"\" and\n\t\t\t\t\t\t\t\t\t\"&wof2l_fnl_ds_name_4_all_extfiles\" eq \"\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tadjusted_table_name = \"&wof2l_final_table_name\";\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\tcheck_source_file_flag = &wof2l_check_source_file_flag;\n\t\t\t\t\t\t\t\tload_date = today();\n\t\t\t\t\t\t\t\tload_time = time();\n\t\t\t\t\t\t\t\tlibrary = \"%upcase(&wof2l_cas_target_libname)\";\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\trun;\n\t\t\t\t\t\t%if &wof2l_target_environment eq CAS %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tproc casutil;\n\t\t\t\t\t\t\t\tpromote casdata=\"&wof2l_final_table_name\" incaslib=\"&wof2l_cas_target_libname\"\n\t\t\t\t\t\t\t\t\t\toutcaslib=\"&wof2l_cas_target_libname\" casout=\"&wof2l_final_table_name\";\n\t\t\t\t\t\t\t\t%if &wof2l_make_imported_data_prsstnt = 1 %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tsave casdata=\"&wof2l_final_table_name\" incaslib=\"&wof2l_cas_target_libname\"\n\t\t\t\t\t\t\t\t\t\t\toutcaslib=\"&wof2l_cas_target_libname\" casout=\"&wof2l_final_table_name\" replace;\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\tquit;\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t%let wof2l_ds_2_profile_seq = &wof2l_ds_2_profile_seq.# &wof2l_cas_target_libname..&wof2l_final_table_name;\n\t\t\t\t\t%end; %else %put INFORMATION ALERT: Upload is set to be NOT active!!!;\n \n\t\t\t%end;\n\t\t\t%else\n\t\t\t%do;\t\n \n\t\t\t\t%let wof2l_final_ds_name = &wof2l_cas_target_libname..&wof2l_final_table_name;\n\t\t\t\t%if &wof2l_drop_missing_vars ne 0 %then\n\t\t\t\t%do;\n\t\t\t\t\t%let wof2l_output_dataset_name = work.&wof2l_final_table_name;\n\t\t\t\t%end; %else\t\n\t\t\t\t%do;\n\t\t\t\t\t%let wof2l_output_dataset_name = &wof2l_final_ds_name;\n\t\t\t\t%end;\n \n \n\t\t\t\t%if &wo2c_file_extension eq CSV or\t\n\t\t\t\t\t&wo2c_file_extension eq TXT or\n\t\t\t\t\t((\"&wof2l_file_delimiter_guided\" ne \"\" and %upcase(\"&wof2l_file_delimiter_guided\") ne \"_DIAP_NA_\") and\n\t\t\t\t\t&wof2l_diap_guided_automation = 1) %then\n\t\t\t\t%do;\n\t\t\n\t\t\t\t\t%if &wof2l_debug_mode %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\t%put INFORMATION: Loading file #&wo2c_file_counter. &wo2c_full_file_name;\n\t\t\t\t\t\t%put INFORMATION: Target libname is: &wof2l_cas_target_libname;\n\t\t\t\t\t\t%put INFORMATION: Target Table name is: &wof2l_final_table_name;\n\t\t\t\t\t%end;\n\t\t\t\t\t%if &wof2l_upload_activation = 1 %then\n\t\t\t\t\t%do;\n \n\t\t\t\t\t\t%if \"&wof2l_fnl_ds_name_4_all_extfiles\" ne \"\" and\n\t\t\t\t\t\t\t%sysfunc(exist(&wof2l_output_dataset_name)) %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tdata work.&wof2l_fnl_ds_name_4_all_extfiles;\n\t\t\t\t\t\t\t\tset &wof2l_output_dataset_name;\n\t\t\t\t\t\t\trun;\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\n \n\t\t\t\t\t\t%if &wof2l_target_environment eq CAS %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tproc casutil;\n\t\t\t\t\t\t\t\tdroptable casdata = \"&wof2l_final_table_name\" incaslib = \"&wof2l_cas_target_libname\" quiet;\n\t\t\t\t\t\t\t\tdroptable casdata = \"&wof2l_final_table_name\" incaslib = \"&wof2l_cas_target_libname\" quiet;\n\t\t\t\t\t\t\tquit;\n\t\t\t\t\t\t%end;\n\t\t\n/*\t\t\t\t\t\t%let wof2l_input_file_&wo2c_file_counter = \"&wo2c_full_file_name\";*/\n\t\t\t\t\t\t%let wof2l_input_file_&wo2c_file_counter = inf&wo2c_file_counter;\n\t\t\t\t\t\t%if &wof2l_chck_txt_fl_4_spcl_chrct = 1 %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tfilename cf&wo2c_file_counter temp;\n\t\t\t\t\t\t\t%let wof2l_count_of_chrct_2_chk = %wordcnt(&wof2l_spcl_chrctr_sq2chck_in_hex, '#');\n\t\t\t\t\t\t\t%let wof2l_hex_chrct_2_chck = %trim(%left(%scan(&wof2l_spcl_chrctr_sq2chck_in_hex, 1, '#')));\n\t\t\t\t\t\t\t/* MAGIC preprocessing step */\n\t\t\t\t\t\t\tdata _null_;\n\t\t\t\t\t\t\t\tinfile &&wof2l_input_file_&wo2c_file_counter recfm=n;\n\t\t\t\t\t\t\t\tfile cf&wo2c_file_counter recfm=n;\n\t\t\t\t\t\t\t\tinput a $char1.;\n\t\t\t\t\t\t\t\tretain open 0;\n\t\t\t\t\t\t\t\tif a='\"' then\n\t\t\t\t\t\t\t\t\topen = not open;\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\ta=\"&wof2l_hex_chrct_2_chck\"x\n\t\t\t\t\t\t\t\t\t%do wof2l_counter_of_chrct_2_chk = 2 %to &wof2l_count_of_chrct_2_chk;\n\t\t\t\t\t\t\t\t\t\t\t%let wof2l_hex_chrct_2_chck = %trim(%left(%scan(&wof2l_spcl_chrctr_sq2chck_in_hex, &wof2l_counter_of_chrct_2_chk, '#')));\n\t\t\t\t\t\t\t\t\t\tor a=\"&wof2l_hex_chrct_2_chck\"x\n\t\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\tand open then\n\t\t\t\t\t\t\t\t\tput \"%trim(%left(&wof2l_spcl_chrct_chck_rplcmnt_hx))\"x @;\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tput a $char1. @;\n\t\t\t\t\t\t\trun;\n\t\t\t\t\t\t\t%let wof2l_input_file_&wo2c_file_counter = cf&wo2c_file_counter;\n\t\t\t\t\t\t\n\t\t\t\t\t\t%end;\n\t\t\n\t\t\t\t\t\t%if &wof2l_csv_big_data_mode = 0 %then\n\t\t\t\t\t\t%do;\n \n\t\t\n\t\t\t\t\t\t\tdata\n\t\t\t\t\t\t\t\t%if \"&wof2l_fnl_ds_name_4_all_extfiles\" ne \"\" and\n\t\t\t\t\t\t\t\t\t%sysfunc(exist(work.&wof2l_fnl_ds_name_4_all_extfiles)) %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\twork._wof2l_output_dataset_name\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\t&wof2l_output_dataset_name\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t%let _EFIERR_ = 0;\n\t\t\t\t\t\t\t\tinfile &&wof2l_input_file_&wo2c_file_counter\n \n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"TAB\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = '09'x\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"BLANK\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = ' '\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"COMMA\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = ','\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"SEMICOLON\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = ';'\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%if %upcase(\"&&wof2l_delimiter_file_no_&wo2c_file_counter\") eq \"PIPE\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = '|'\n\t\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tdelimiter = \"&&wof2l_delimiter_file_no_&wo2c_file_counter\"\n\t\t\t\t\t\t\t\t%end;\n \n\t\t\t\t\t\t\t\tMISSOVER DSD\n\t\t\t\t\t\t\t\tlrecl=&wof2l_lrec_length\n\t\t\t\t\t\t\t\t%if &&wof2l_has_header_file_no_&wo2c_file_counter %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tfirstobs = 2;\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\t%else\t\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tfirstobs = 1;\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\tlength\n\t\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t\t%if \"&&wof2l_length_seq_&wo2c_file_counter._&wof2c_variable_counter\" eq \"\" %then\n\t\t\t\t\t\t\t\t\t\t%let wof2l_length_seq_&wo2c_file_counter._&wof2c_variable_counter = 3;\n\t\t\t\t\t\t\t\t\tvar_&wo2c_file_counter._&wof2c_variable_counter\n\t\t\t\t\t\t\t\t\t%if \"%upcase(&&wof2l_type_seq_&wo2c_file_counter._&wof2c_variable_counter)\" = \"CHAR\" %then\n\t\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\t\t$\n\t\t\t\t\t\t\t\t\t%end; &&wof2l_length_seq_&wo2c_file_counter._&wof2c_variable_counter\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t\t%if \"&&wof2l_format_seq_&wo2c_file_counter._&wof2c_variable_counter\" eq \"\" %then\n\t\t\t\t\t\t\t\t\t\t%let wof2l_format_seq_&wo2c_file_counter._&wof2c_variable_counter = best12.;\n\t\t\t\t\t\t\t\t\tformat var_&wo2c_file_counter._&wof2c_variable_counter &&wof2l_format_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t\t%if \"&&wof2l_informat_seq_&wo2c_file_counter._&wof2c_variable_counter\" eq \"\" %then\n\t\t\t\t\t\t\t\t\t\t%let wof2l_informat_seq_&wo2c_file_counter._&wof2c_variable_counter = best32.;\n\t\t\t\t\t\t\t\t\tinformat var_&wo2c_file_counter._&wof2c_variable_counter &&wof2l_informat_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\tlabel\n\t\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t\t&&new_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter = \"&&orig_varname_seq_&wo2c_file_counter._&wof2c_variable_counter\"\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\tinput\n\t\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t\tvar_&wo2c_file_counter._&wof2c_variable_counter \t\t\n\t\t\t\t\t\t\t\t\t%if \"%upcase(&&wof2l_type_seq_&wo2c_file_counter._&wof2c_variable_counter)\" = \"CHAR\" %then\n\t\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\t\t$\n\t\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t\t&&new_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter = &&curr_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t\t\tdrop &&curr_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\tformat\n\t\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t\t&&new_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter &&format_value_seq_&wo2c_file_counter._&wof2c_variable_counter\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\tinformat\n\t\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t\t%if \"%trim(%left(&&informat_value_seq_&wo2c_file_counter._&wof2c_variable_counter))\" = \"\" %then\n\t\t\t\t\t\t\t\t\t\t%let informat_value_seq_&wo2c_file_counter._&wof2c_variable_counter = &&format_value_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t\t\t&&new_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter &&informat_value_seq_&wo2c_file_counter._&wof2c_variable_counter\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\trun;\n\t\t\t\t\t\t\t%if \"&wof2l_fnl_ds_name_4_all_extfiles\" ne \"\" and\n\t\t\t\t\t\t\t\t%sysfunc(exist(work.&wof2l_fnl_ds_name_4_all_extfiles)) %then\n\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\tdata &wof2l_output_dataset_name;\n\t\t\t\t\t\t\t\t\tset work.&wof2l_fnl_ds_name_4_all_extfiles\n\t\t\t\t\t\t\t\t\t\twork._wof2l_output_dataset_name;\n\t\t\t\t\t\t\t\trun;\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t%if &wof2l_csv_big_data_mode = 1 %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tdata &wof2l_output_dataset_name;\n\t\t\t\t\t\t\t\tset\n\t\t\t\t\t\t\t\t%if \"&wof2l_fnl_ds_name_4_all_extfiles\" ne \"\" and\n\t\t\t\t\t\t\t\t\t%sysfunc(exist(work.&wof2l_fnl_ds_name_4_all_extfiles)) %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\twork.&wof2l_fnl_ds_name_4_all_extfiles\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\t\twork.get_table_info_&wo2c_file_counter\n\t\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t\t&&new_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter = &&curr_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t\t\tdrop &&curr_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\tlabel\n\t\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t\t&&new_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter = \"&&orig_varname_seq_&wo2c_file_counter._&wof2c_variable_counter\"\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\tformat\n\t\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t\t&&new_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter &&format_value_seq_&wo2c_file_counter._&wof2c_variable_counter\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\tinformat\n\t\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t\t%if \"%trim(%left(&&informat_value_seq_&wo2c_file_counter._&wof2c_variable_counter))\" = \"\" %then\n\t\t\t\t\t\t\t\t\t\t%let informat_value_seq_&wo2c_file_counter._&wof2c_variable_counter = &&format_value_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t\t\t&&new_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter &&informat_value_seq_&wo2c_file_counter._&wof2c_variable_counter\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\trun;\t\t\t\n \n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t%if &wof2l_debug_mode %then\n\t\t\t\t\t\t\t\t\t%put INFORMATION PROGRESS: Updating Loaddate of &wo2c_full_file_name;\n \n\t\t\t\t\t\t%if &wof2l_drop_missing_vars ne 0 %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t%DIAP_handling_missings_vars(\n\t\t\t\t\t\t\t\tdhm_missing_handling_option = &wof2l_drop_missing_vars,\n\t\t\t\t\t\t\t\tdhm_dataset_2_check = &wof2l_output_dataset_name,\n\t\t\t\t\t\t\t\tdhm_dataset_2_check_output = &wof2l_final_ds_name,\n\t\t\t\t\t\t\t\tdhm_dataset_2_write_out_results = _DIAP_missing_analysis_&wo2c_file_counter,\n\t\t\t\t\t\t\t\tdhm_stg_2_chk_var_b4_drop = &wof2l_chk_strng_in_var_4_missing\n\t\t\t\t\t\t\t\t);\t\t\t\n \n\t\t\t\t\t\t%end;\n\t\t\t\t\t\tdata work._DIAP_working_upload_log_ds;\n\t\t\t\t\t\t\tset work._DIAP_working_upload_log_ds;\n\t\t\t\t\t\t\tif file_path_full_name = \"&wo2c_full_file_name\" then\t\n\t\t\t\t\t\t\tdo;\n\t\t\t\t\t\t\t\t%if &wof2l_check_source_file_flag = 1 and\n\t\t\t\t\t\t\t\t\t\"&wof2l_prefix_4_suspicious_src_fl\" ne \"\" and\n\t\t\t\t\t\t\t\t\t\"&wof2l_fnl_ds_name_4_all_extfiles\" eq \"\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tadjusted_table_name = \"&wof2l_final_table_name\";\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\tcheck_source_file_flag = &wof2l_check_source_file_flag;\n\t\t\t\t\t\t\t\tload_date = today();\n\t\t\t\t\t\t\t\tload_time = time();\n\t\t\t\t\t\t\t\tlibrary = \"%upcase(&wof2l_cas_target_libname)\";\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\trun;\n\t\t\t\n\t\t\t\t\t\t%if &wof2l_target_environment eq CAS %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tproc casutil;\n\t\t\t\t\t\t\t\tpromote casdata=\"&wof2l_final_table_name\" incaslib=\"&wof2l_cas_target_libname\"\n\t\t\t\t\t\t\t\t\t\toutcaslib=\"&wof2l_cas_target_libname\" casout=\"&wof2l_final_table_name\";\n\t\t\t\t\t\t\t\t%if &wof2l_make_imported_data_prsstnt = 1 %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tsave casdata=\"&wof2l_final_table_name\" incaslib=\"&wof2l_cas_target_libname\"\n\t\t\t\t\t\t\t\t\t\t\toutcaslib=\"&wof2l_cas_target_libname\" casout=\"&wof2l_final_table_name\" replace;\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\tquit;\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t%let wof2l_ds_2_profile_seq = &wof2l_ds_2_profile_seq.# &wof2l_cas_target_libname..&wof2l_final_table_name;\t\t\t\n\t\t\t\t\t%end; %else %put INFORMATION ALERT: Upload is set to be NOT active!!!;\n\t\t\t\t%end; %else\t\n\t\t\t\t%if &wo2c_file_extension eq XLSX  or\n\t\t\t\t\t(&wo2c_file_extension eq XLS and &wof2l_diap_guided_automation = 1) %then\n\t\t\t\t%do;\n\t\t\t\t\t%if &wof2l_debug_mode %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\t%put INFORMATION: Loading EXCEL file #&wo2c_file_counter. &wo2c_full_file_name;\n\t\t\t\t\t\t%put INFORMATION: SHEET  &wof2l_sheet_name;\n\t\t\t\t\t\t%put INFORMATION: Target libname is: &wof2l_cas_target_libname;\n\t\t\t\t\t\t%put INFORMATION: Target Table name is: &wof2l_final_table_name;\n\t\t\t\t\t%end;\n\t\t\t\n\t\t\t\t\t%if &wof2l_upload_activation = 1 %then\n\t\t\t\t\t%do;\n \n \n\t\t\t\t\t\t%if \"&wof2l_fnl_ds_name_4_all_extfiles\" ne \"\" and\n\t\t\t\t\t\t\t%sysfunc(exist(&wof2l_output_dataset_name)) %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tdata work.&wof2l_fnl_ds_name_4_all_extfiles;\n\t\t\t\t\t\t\t\tset &wof2l_output_dataset_name;\n\t\t\t\t\t\t\trun;\n\t\t\t\t\t\t%end;\n \n\t\t\t\t\t\t%if &wof2l_target_environment eq CAS %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tproc casutil;\n\t\t\t\t\t\t\t\tdroptable casdata = \"&wof2l_final_table_name\" incaslib = \"&wof2l_cas_target_libname\" quiet;\n\t\t\t\t\t\t\t\tdroptable casdata = \"&wof2l_final_table_name\" incaslib = \"&wof2l_cas_target_libname\" quiet;\n\t\t\t\t\t\t\tquit;\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\tdata &wof2l_output_dataset_name;\n\t\t\t\t\t\t\tset\n\t\t\t\t\t\t\t%if \"&wof2l_fnl_ds_name_4_all_extfiles\" ne \"\" and\n\t\t\t\t\t\t\t\t%sysfunc(exist(work.&wof2l_fnl_ds_name_4_all_extfiles)) %then\n\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\twork.&wof2l_fnl_ds_name_4_all_extfiles\n\t\t\t\t\t\t\t%end;\n\t\t\n\t\t\t\t\t\t\t\twork.get_table_info_&wo2c_file_counter;\n\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t&&new_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter = &&curr_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t\tdrop &&curr_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\tlabel\n\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t&&new_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter = \"&&orig_varname_seq_&wo2c_file_counter._&wof2c_variable_counter\"\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\tformat\n\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t&&new_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter &&format_value_seq_&wo2c_file_counter._&wof2c_variable_counter\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\tinformat\n\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t%if \"%trim(%left(&&informat_value_seq_&wo2c_file_counter._&wof2c_variable_counter))\" = \"\" %then\n\t\t\t\t\t\t\t\t\t%let informat_value_seq_&wo2c_file_counter._&wof2c_variable_counter = &&format_value_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t\t&&new_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter &&informat_value_seq_&wo2c_file_counter._&wof2c_variable_counter\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t%if &wof2l_skip_mssng_vrnm_in_xls = 1 %then\n\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\tZZ_MISSING_VARNAME_2_AVOID_WNG = 0;\n\t\t\t\t\t\t\t\tdrop ZZ_MISSING_VARNAME_:;\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\trun;\t\t\t\n\t\t\t\t\t\t%if &wof2l_drop_missing_vars ne 0 %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t%DIAP_handling_missings_vars(\n\t\t\t\t\t\t\t\tdhm_missing_handling_option = &wof2l_drop_missing_vars,\n\t\t\t\t\t\t\t\tdhm_dataset_2_check = &wof2l_output_dataset_name,\n\t\t\t\t\t\t\t\tdhm_dataset_2_check_output = &wof2l_final_ds_name,\n\t\t\t\t\t\t\t\tdhm_dataset_2_write_out_results = _DIAP_missing_analysis_&wo2c_file_counter,\n\t\t\t\t\t\t\t\tdhm_stg_2_chk_var_b4_drop = &wof2l_chk_strng_in_var_4_missing\n\t\t\t\t\t\t\t\t);\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\tdata work._DIAP_working_upload_log_ds;\n\t\t\t\t\t\t\tset work._DIAP_working_upload_log_ds;\n\t\t\t\t\t\t\tif file_path_full_name = \"&wo2c_full_file_name\" and\n\t\t\t\t\t\t\t\toriginal_sheetname = \"&wof2l_sheet_name\" then\t\n\t\t\t\t\t\t\tdo;\n\t\t\t\t\t\t\t\t%if &wof2l_check_source_file_flag = 1 and\n\t\t\t\t\t\t\t\t\t\"&wof2l_prefix_4_suspicious_src_fl\" ne \"\" and\n\t\t\t\t\t\t\t\t\t\"&wof2l_fnl_ds_name_4_all_extfiles\" eq \"\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tadjusted_table_name = \"&wof2l_final_table_name\";\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\tcheck_source_file_flag = &wof2l_check_source_file_flag;\n\t\t\t\t\t\t\t\tload_date = today();\n\t\t\t\t\t\t\t\tload_time = time();\n\t\t\t\t\t\t\t\tlibrary = \"%upcase(&wof2l_cas_target_libname)\";\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\trun;\n\t\t\n\t\t\t\t\t\t%if &wof2l_target_environment eq CAS %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tproc casutil;\n\t\t\t\t\t\t\t\tpromote casdata=\"&wof2l_final_table_name\" incaslib=\"&wof2l_cas_target_libname\"\n\t\t\t\t\t\t\t\t\t\toutcaslib=\"&wof2l_cas_target_libname\" casout=\"&wof2l_final_table_name\";\n\t\t\t\t\t\t\t\t%if &wof2l_make_imported_data_prsstnt = 1 %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tsave casdata=\"&wof2l_final_table_name\" incaslib=\"&wof2l_cas_target_libname\"\n\t\t\t\t\t\t\t\t\t\t\toutcaslib=\"&wof2l_cas_target_libname\" casout=\"&wof2l_final_table_name\" replace;\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\tquit;\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t%let wof2l_ds_2_profile_seq = &wof2l_ds_2_profile_seq.# &wof2l_cas_target_libname..&wof2l_final_table_name;\n\t\t\t\t\t%end; %else %put INFORMATION ALERT: Upload is set to be NOT active!!!;\n\t\t\t\t%end; %else\t\n\t\t\t\t%if &wo2c_file_extension eq JMP or\n\t\t\t\t\t&wo2c_file_extension eq SHP or\t\t\n\t\t\t\t\t&wo2c_file_extension eq JSON or\t\t\n\t\t\t\t\t&wo2c_file_extension eq XML %then\n\t\t\t\t%do;\n\t\t\t\t\t%if &wof2l_debug_mode %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\t%put INFORMATION: Loading JUMP/SHP file #&wo2c_file_counter. &wo2c_full_file_name;\n\t\t\t\t\t\t%put INFORMATION: Target libname is: &wof2l_cas_target_libname;\n\t\t\t\t\t\t%put INFORMATION: Target Table name is: &wof2l_final_table_name;\n\t\t\t\t\t%end;\t\n\t\t\t\t\t\n\t\t\t\t\t%if &wof2l_upload_activation = 1 %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\tproc datasets lib= work;\n\t\t\t\t\t\t\tdelete _DIAP_xml_temp_storage;\n\t\t\t\t\t\tquit;\n\t\t\t\t\t\t%if (&wo2c_file_extension eq XML and\n\t\t\t\t\t\t%sysfunc(exist(&wof2l_output_dataset_name))) or\n\t\t\t\t\t\t(\"&wof2l_fnl_ds_name_4_all_extfiles\" ne \"\" and\n\t\t\t\t\t\t\t%sysfunc(exist(&wof2l_output_dataset_name)) ) %then\n\t\t\t\t\t\t%do;\t\t\t\t\t\n\t\t\t\t\t\t\tdata work._DIAP_xml_temp_storage;\n\t\t\t\t\t\t\t\tset &wof2l_output_dataset_name;\n\t\t\t\t\t\t\trun;\n\t\t\t\t\t\t%end;\n \n \n \n\t\t\t\t\t\t%if &wof2l_target_environment eq CAS %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tproc casutil;\n\t\t\t\t\t\t\t\tdroptable casdata = \"&wof2l_final_table_name\" incaslib = \"&wof2l_cas_target_libname\" quiet;\n\t\t\t\t\t\t\t\tdroptable casdata = \"&wof2l_final_table_name\" incaslib = \"&wof2l_cas_target_libname\" quiet;\n\t\t\t\t\t\t\tquit;\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\tdata\n\t\t\t\t\t\t\t%if (&wo2c_file_extension eq XML and\n\t\t\t\t\t\t\t\t%sysfunc(exist(work._DIAP_xml_temp_storage))) or\n\t\t\t\t\t\t\t\t(\"&wof2l_fnl_ds_name_4_all_extfiles\" ne \"\" and\n\t\t\t\t\t\t\t\t%sysfunc(exist(work._DIAP_xml_temp_storage)) ) %then\n\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\twork._DIAP_XML_Temp_storage_new;\n\t\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t&wof2l_output_dataset_name;\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\tset work.get_table_info_&wo2c_file_counter\n \n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t&&new_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter = &&curr_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t\tdrop &&curr_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\tlabel\n\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t&&new_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter = \"&&orig_varname_seq_&wo2c_file_counter._&wof2c_variable_counter\"\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\tformat\n\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t&&new_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter &&format_value_seq_&wo2c_file_counter._&wof2c_variable_counter\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\tinformat\n\t\t\t\t\t\t\t%do wof2c_variable_counter = 1 %to &&wof2l_max_varnumber_&wo2c_file_counter;\n\t\t\t\t\t\t\t\t%if \"%trim(%left(&&informat_value_seq_&wo2c_file_counter._&wof2c_variable_counter))\" = \"\" %then\n\t\t\t\t\t\t\t\t\t%let informat_value_seq_&wo2c_file_counter._&wof2c_variable_counter = &&format_value_seq_&wo2c_file_counter._&wof2c_variable_counter;\n\t\t\t\t\t\t\t\t&&new_var_name_seq_&wo2c_file_counter._&wof2c_variable_counter &&informat_value_seq_&wo2c_file_counter._&wof2c_variable_counter\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t;\n\t\t\t\n\t\t\t\t\t\trun;\t\t\t\n \n\t\t\t\t\t\t%if (&wo2c_file_extension eq XML and\n\t\t\t\t\t\t\t%sysfunc(exist(work._DIAP_xml_temp_storage))) or\n\t\t\t\t\t\t\t(\"&wof2l_fnl_ds_name_4_all_extfiles\" ne \"\" and\n\t\t\t\t\t\t\t%sysfunc(exist(work._DIAP_xml_temp_storage)) )%then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tdata &wof2l_output_dataset_name;\n\t\t\t\t\t\t\t\tset work._DIAP_xml_temp_storage\n\t\t\t\t\t\t\t\t\twork._DIAP_XML_Temp_storage_new;\n\t\t\t\t\t\t\trun;\n\t\t\t\t\t\t\tproc datasets lib = work;\n\t\t\t\t\t\t\t\tdelete _DIAP_xml_temp_storage\n\t\t\t\t\t\t\t\t\t\t_DIAP_XML_Temp_storage_new;\n\t\t\t\t\t\t\tquit;\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t%if &wof2l_drop_missing_vars ne 0 %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t%DIAP_handling_missings_vars(\n\t\t\t\t\t\t\t\tdhm_missing_handling_option = &wof2l_drop_missing_vars,\n\t\t\t\t\t\t\t\tdhm_dataset_2_check = &wof2l_output_dataset_name,\n\t\t\t\t\t\t\t\tdhm_dataset_2_check_output = &wof2l_final_ds_name,\n\t\t\t\t\t\t\t\tdhm_dataset_2_write_out_results = _DIAP_missing_analysis_&wo2c_file_counter,\n\t\t\t\t\t\t\t\tdhm_stg_2_chk_var_b4_drop = &wof2l_chk_strng_in_var_4_missing\n\t\t\t\t\t\t\t\t);\t\t\t\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\tdata work._DIAP_working_upload_log_ds;\n\t\t\t\t\t\t\tset work._DIAP_working_upload_log_ds;\n\t\t\t\t\t\t\tif file_path_full_name = \"&wo2c_full_file_name\"\n\t\t\t\t\t\t\t%if &wo2c_file_extension eq JSON or\n\t\t\t\t\t\t\t\t&wo2c_file_extension eq XML %then\n\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\tand\n\t\t\t\t\t\t\t\toriginal_sheetname = \"&wof2l_sheet_name\"\n\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\tthen\t\n\t\t\t\t\t\t\tdo;\n\t\t\t\t\t\t\t\t%if &wof2l_check_source_file_flag = 1 and\n\t\t\t\t\t\t\t\t\t\"&wof2l_prefix_4_suspicious_src_fl\" ne \"\" and\n\t\t\t\t\t\t\t\t\t\"&wof2l_fnl_ds_name_4_all_extfiles\" eq \"\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tadjusted_table_name = \"&wof2l_final_table_name\";\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\tcheck_source_file_flag = &wof2l_check_source_file_flag;\n\t\t\t\t\t\t\t\tload_date = today();\n\t\t\t\t\t\t\t\tload_time = time();\n\t\t\t\t\t\t\t\tlibrary = \"%upcase(&wof2l_cas_target_libname)\";\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\trun;\n\t\t\t\t\t\t%if &wof2l_target_environment eq CAS %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tproc casutil;\n\t\t\t\t\t\t\t\tpromote casdata=\"&wof2l_final_table_name\" incaslib=\"&wof2l_cas_target_libname\"\n\t\t\t\t\t\t\t\t\t\toutcaslib=\"&wof2l_cas_target_libname\" casout=\"&wof2l_final_table_name\";\n\t\t\t\t\t\t\t\t%if &wof2l_make_imported_data_prsstnt = 1 %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tsave casdata=\"&wof2l_final_table_name\" incaslib=\"&wof2l_cas_target_libname\"\n\t\t\t\t\t\t\t\t\t\t\toutcaslib=\"&wof2l_cas_target_libname\" casout=\"&wof2l_final_table_name\" replace;\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\tquit;\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t%let wof2l_ds_2_profile_seq = &wof2l_ds_2_profile_seq.# &wof2l_cas_target_libname..&wof2l_final_table_name;\n\t\t\t\t\t%end; %else %put INFORMATION ALERT: Upload is set to be NOT active!!!;\n\t\t\t\t%end; %else\n\t\t\t\t%if &wo2c_file_extension eq NEF %then\n\t\t\t\t%do;\n\t\t\t\t\t%if &wof2l_debug_mode %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\t%put INFORMATION: Copying NEF file #&wo2c_file_counter. &wo2c_full_file_name;\n\t\t\t\t\t\t%put INFORMATION: Target libname is: &wof2l_cas_target_libname;\n\t\t\t\t\t\t%put INFORMATION: Target Table name is: &wof2l_final_table_name;\n\t\t\t\t\t%end;\n\t\t\t\t\t%if &wof2l_upload_activation = 1 %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\t%let wof2l_libname_path = ;\n\t\t\t\t\t\t%if &wof2l_target_environment eq CAS %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tproc cas;\n\t\t\t\t\t\t\t\ttable.caslibinfo result=sss/caslib=\"&wof2l_cas_target_libname\"  ;\n\t\t\t\t\t\t\t\tdescribe sss;\n\t\t\t\t\t\t\t\tprint sss;\n\t\t\t\t\t\t\t\tsaveresult sss  dataout=work.xdata;\n\t\t\t\t\t\t\trun;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tproc sql;\n\t\t\t\t\t\t\t    select path into:wof2l_libname_path\n\t\t\t\t\t\t\t    from work.xdata;\n\t\t\t\t\t\t\tquit;\n\t\t\t\t\t\t%end; %else\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t%let wof2l_libname_path = %trim(%left(%sysfunc(pathname(&wof2l_cas_target_libname))))&wof2l_delimiter.;\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\tdata work._DIAP_working_upload_log_ds;\n\t\t\t\t\t\t\tset work._DIAP_working_upload_log_ds;\n\t\t\t\t\t\t\tif file_path_full_name = \"&wo2c_full_file_name\" then\t\n\t\t\t\t\t\t\tdo;\n\t\t\t\t\t\t\t\t%if &wof2l_check_source_file_flag = 1 and\n\t\t\t\t\t\t\t\t\t\"&wof2l_prefix_4_suspicious_src_fl\" ne \"\" and\n\t\t\t\t\t\t\t\t\t\"&wof2l_fnl_ds_name_4_all_extfiles\" eq \"\" %then\n\t\t\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t\t\tadjusted_table_name = \"&wof2l_final_table_name\";\n\t\t\t\t\t\t\t\t%end;\n\t\t\t\t\t\t\t\tcheck_source_file_flag = &wof2l_check_source_file_flag;\n\t\t\t\t\t\t\t\tload_date = today();\n\t\t\t\t\t\t\t\tload_time = time();\n\t\t\t\t\t\t\t\tlibrary = \"%upcase(&wof2l_cas_target_libname)\";\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\trun;\n\t\t\t\t\t\t%if &wof2l_debug_mode %then\n\t\t\t\t\t\t\t%put INFORMATION GENERAL: This file is copied into this path: wof2l_libname_path = &wof2l_libname_path;\n\t\t\t\t\t\tx \"scp &wo2c_full_file_name &wof2l_libname_path.&wof2l_final_table_name..NEF\";\n\t\t\n\t\t\t\t\t%end; %else %put INFORMATION ALERT: Upload is set to be NOT active!!!;\n\t\t\t\t%end; %else\n\t\t\t\t%put INFORMATION ALERT: Extension &wo2c_file_extension is unknown!;\n\t\t\t%end; /* end of fixed width file ELSE*/\n \n\t\t\t%end; /*end of check for varnumber gt 0 */ %else\n\t\t\t%do;\n\t\t\t\t%put INFORMATION: File #&wo2c_file_counter. &wo2c_full_file_name not uploaded no variable in source file!;\t\t\n\t\t\t%end;\n \n\t\t%end; %else\t\n\t\t%do;\n\t\t\t%put INFORMATION: File #&wo2c_file_counter. &wo2c_full_file_name not uploaded since no new version available!!;\n\t\t%end;\n \n\tfilename inf&wo2c_file_counter clear;\n\t%end; /* end file counter */\n \n\t%if &wof2l_target_environment eq CAS %then\n\t%do;\n\t\tdata wof2l_upload_log_ds;\n\t\t\tset work._DIAP_working_upload_log_ds;\n\t\t\tif missing(library) then delete;\n\t\trun;\n\t\t%let wof2l_final_table_name = %scan(&wof2l_upload_log_ds, 2, '.');\n\t\t%let wof2l_cas_target_libname = %scan(&wof2l_upload_log_ds, 1, '.');\n\t\tproc casutil;\n\t\t\tdroptable casdata = \"&wof2l_final_table_name\" incaslib = \"&wof2l_cas_target_libname\" quiet;\n\t\t\tdroptable casdata = \"&wof2l_final_table_name\" incaslib = \"&wof2l_cas_target_libname\" quiet;\n\t\tquit;\n\t\tdata &wof2l_cas_target_libname..&wof2l_final_table_name;\n\t\t\tset wof2l_upload_log_ds;\n\t\trun;\n\t\tproc casutil;\n\t\t\tpromote casdata=\"&wof2l_final_table_name\" incaslib=\"&wof2l_cas_target_libname\"\n\t\t\t\t\toutcaslib=\"&wof2l_cas_target_libname\" casout=\"&wof2l_final_table_name\" ;\n\t\t\tsave casdata=\"&wof2l_final_table_name\" incaslib=\"&wof2l_cas_target_libname\"\n\t\t\t\t\toutcaslib=\"&wof2l_cas_target_libname\" casout=\"&wof2l_final_table_name\" replace;\n\t\tquit;\n \n\t\tdata wof2l_variable_dict_dataset;\n\t\t\tset &wof2l_variable_dict_dataset;\n\t\trun;\n\t\t%let wof2l_final_table_name = %scan(&wof2l_variable_dict_dataset, 2, '.');\n\t\t%let wof2l_cas_target_libname = %scan(&wof2l_variable_dict_dataset, 1, '.');\n\t\tproc casutil;\n\t\t\tdroptable casdata = \"&wof2l_final_table_name\" incaslib = \"&wof2l_cas_target_libname\" quiet;\n\t\t\tdroptable casdata = \"&wof2l_final_table_name\" incaslib = \"&wof2l_cas_target_libname\" quiet;\n\t\tquit;\n\t\tdata &wof2l_cas_target_libname..&wof2l_final_table_name;\n\t\t\tset wof2l_variable_dict_dataset;\n\t\trun;\n\t\tproc casutil;\n\t\t\tpromote casdata=\"&wof2l_final_table_name\" incaslib=\"&wof2l_cas_target_libname\"\n\t\t\t\t\toutcaslib=\"&wof2l_cas_target_libname\" casout=\"&wof2l_final_table_name\" ;\n\t\t\tsave casdata=\"&wof2l_final_table_name\" incaslib=\"&wof2l_cas_target_libname\"\n\t\t\t\t\toutcaslib=\"&wof2l_cas_target_libname\" casout=\"&wof2l_final_table_name\" replace;\n\t\tquit;\n\t%put &=wof2l_ds_2_profile_seq;\n\t\t%if \"%upcase(&wof2l_do_profiling)\" = \"DICT_ONLY\" or\t\n\t\t\t\"%upcase(&wof2l_do_profiling)\" = \"PROFILE\" %then\n\t\t%do;\n\t\t\t%automated_profiling_4_DIAP(\n\t\t\t\tap4d_table_2_prep_4_prof_seq = &wof2l_ds_2_profile_seq,\n\t\t\t\tap4d_dict_source_file_path = &wof2l_profile_dict_location,\n\t\t\t\tap4d_prof_execution_option = &wof2l_do_profiling,\n\t\t\t\tap4d_libname_4_dictionaries = %scan(&wof2l_upload_log_ds, 1, '.'),\n\t\t\t\tap4d_viyaversion = &wof2l_viyaversion\n\t\t\t\t);\n\t\t%end;\n \n\t%end; /* if CAS */ %else\n\t%do;\n\t\tdata &wof2l_upload_log_ds;\n\t\t\tset work._DIAP_working_upload_log_ds;\n\t\t\tif missing(library) then delete;\n\t\trun;\n \n\t%end; /* file loop */\n\t%end; /*   zero files check */\n%end; /* check for doing only profiling */\n%mend;\n \n/** FOR TESTING ***\noption mprint source notes;\n%let full_filename_path_seq = ;\nproc sql noprint;\n\tselect\n\t\tfull_file_name\n\tinto\n\t\t:full_filename_path_seq separated by \" #\"\n\tfrom\n\t\t&overview_ds;\nquit;\n%put &=full_filename_path_seq;\n \n%write_out_files_2_libname(\n\t&wo2c_full_file_name_seq,\n\t&target_libname,\n\t&overview_ds\n\t);\n \n \n*********************/\n/******************************************************************************\n \n%wordcnt\n________\n \n \nCounts the words in a list\n \n______________________________________________________________________________\n \n \nUSAGE:                         %wordcnt(list,delim)\n \n______________________________________________________________________________\n \nDESCRIPTION:\n \nFinds the number of words/tokens in a string.  The user specifies a\ndelimiter e.g. # to identify what separates the words.  The macro should be\ncalled in the following way, e.g. %let x=%wordcnt(item1#item2 item2a#item3, '#').  After running\nthe macro x will be assigned the value of wordcnt.\n______________________________________________________________________________\n \n \nINPUT PARAMETERS AND KEYWORDS:\n \nlist            the name of the string.\ndelim           the delimiter e.g. '#'.\n______________________________________________________________________________\n \n \nCALLS: none.\n______________________________________________________________________________\n \nNOTES: (Initials, date, summary)\n \nStephan Weigandt    20200406  First officially Released Version\n______________________________________________________________________________\n \n*******************************************************************************/\n%macro wordcnt(\nlist,\ndelim\n)\n;\n%local\nword\nwc_count;\n%let wc_count = 0;\n%if %quote(&list) ne %then\n%do;\n%let word = %scan(%quote(&list), 1, &delim);\n%let word = %quote(&word);\n%do %while (&word ne);\n%let wc_count = %eval(&wc_count + 1);\n%let word = %scan(%quote(&list), &wc_count+1, &delim);\n%let word = %quote(&word);\n%end;\n%end;\n&wc_count\n%mend wordcnt;\n/******************************************************************************\n \n%log_dataset_4_upload_maintenance\n________\n \n \nuploads a list of files that are listed in a \"#\"-separated sequence (without quotes).\nSpecifically this macro maintains the upload log dataset and preparess the upload log dataset\nso it can be used by \"write_out_files_2_libname.sas\" to read in the files that need\nto be read in.\n \n______________________________________________________________________________\n \n \nUSAGE:                         see testing section on the bottom of this code\n \n______________________________________________________________________________\n \nDESCRIPTION:\n \nThis macro uploads all files that are listed in a #-separated macro sequence into CAS.\nIt takes care of the following formats:\n- CSV\n- JMP\n- XLSX.\n______________________________________________________________________________\n \n \nINPUT PARAMETERS AND KEYWORDS:\n \n\tld4um_upload_log_ds_name:\n\t\t\tname and place of the dataset that keeps track of all the uploaded files.\n\tld4um_upload_new_seq_of_files:\n\t\t\tlist of files separated by # that need to be uploaded to SAS/CAS.\n\tld4um_directory_path_seq:\n\t\t\tlist of directories of files that need to be uploaded separated by #\n\tld4um_substitute_string_seq:\n\t\t\tif the filename or variable names need to be truncated, one way to get there\n\t\t\tis to omit certain characters im the target table name/variable name.\n\tld4um_fn_in_fxd_wdth_def_fl_seq:\n\t\t\tif the macro is called based on \"special definition\" file, this will\n\t\t\treference which table name was provided in that dictionary\n\tld4um_max_name_length:\n\t\t\tthe total filename has to be less than 32, this process adds at least 2 characters\n\t\t\tto the target table name in case when the truncated table name from 2 or more\n\t\t\tsource files end up to be the same name.\n\t\t\tSo this number indicates how many characters are used in case the table name\n\t\t\thas to be truncated. it is recommneded to use a number less or equal than 30.\n\tld4um_debug_mode:\n\t\t\t1: writes out additional information to the log.\n\t\t\t0 (default): no additional information is written out to the log.\n\tld4um_check_modify_date:\n\t\t\t1 (default): process checks for the modified date of the file to be uploaded and compares\n\t\t\t\t\t\tto the load date of that file in case the same file was uploaded in the past.\n\t\t\t0: modified date is ignored and all files are uploaded no matter what.\n\tld4um_stringseq_2_cutout_from_fn\n\t\t\ta string sequence separated by # can be provided, which will be cut out of the filename\n \n \n______________________________________________________________________________\n \nNOTES: (Initials, date, summary)\n \nStephan Weigandt    20200406  First officially Released Version\n______________________________________________________________________________\n \n*******************************************************************************/\n \n%macro log_dataset_4_upload_maintenance(\n\tld4um_upload_log_ds_name,\n\tld4um_upload_new_seq_of_files,\n\tld4um_directory_path_seq = ,\n\tld4um_substitute_string_seq = ,\n\tld4um_fn_in_fxd_wdth_def_fl_seq = ,\n\tld4um_max_name_length = 29,\n\tld4um_debug_mode = 0,\n\tld4um_check_modify_date = 1,\n\tld4um_stringseq_2_cutout_from_fn = ,\n\tld4um_force_upload_of_all_files = 0,\n\tld4um_fnl_tblname_from_sheetonly = 1,\n\tld4um_create_unique_target_tblnm = 0,\n\tld4um_delimiter = /,\n\tld4um_fnl_ds_name_4_all_extfiles = ,\n\tld4um_diap_guided_automation = 0,\n\tld4um_gddauto_upd_fls_del_seq = ,\n\tld4um_gddauto_upd_fls_sht_seq = ,\n\tld4um_gddauto_upd_fls_cntt_flg = ,\n\tld4um_gddauto_upd_fls_tgt_seq = ,\n\tld4um_gddauto_upd_fls_hdr_seq =\n \n\t);\n\t\t\t\n \n%local\t\n\tld4um_file_count\n\tld4um_file_counter\n\tld4um_full_file_name\n\tld4um_file_extension\n\tld4um_filename\n\tld4um_full_file_name_length\n\tld4um_table_name\n\tld4um_excel_table_seq\n\tld4um_xlsx_table_count\n\tld4um_xlsx_table_counter\n\tld4um_first_char\n\tld4um_original_table_name\n\tld4um_final_table_name\n\tld4um_sheet_name\n\tld4um_file_name_length\n\tld4um_full_table_name\n\tld4um_original_sheet_name\n\tld4um_sheet_name_length\n\tld4um_onefile\n\tld4um_string_seq_cut_count\n\tld4um_string_seq_cut_counter\n\tld4um_gddauto_upd_fls_del\n\tld4um_gddauto_upd_fls_sht\n\tld4um_gddauto_upd_fls_ct_flag\n\tld4um_gddauto_upd_fls_tgt\n\tld4um_gddauto_upd_fls_hdr_flg\n \n\t;\n \n \n%let ld4um_gddauto_upd_fls_del = ;\n \n%let ld4um_half_of_max_name_length = %eval(&ld4um_max_name_length / 2);\n%let ld4um_file_count = %wordcnt(&ld4um_upload_new_seq_of_files, '#');\n%let ld4um_string_seq_cut_count = 0;\n%let ld4um_string_seq_cut_count = %wordcnt(&ld4um_stringseq_2_cutout_from_fn, \"#\");\n \nproc datasets lib = work;\n\tdelete _file_list_complete_info_:;\nquit;\n \n%do ld4um_file_counter = 1 %to &ld4um_file_count;\n/*********\nFirst check the length of the filename and such, since that will become the table name.\nExcel will be treated separately, since one XLS file can contain multiple sheets.\n*********/\n\t%let ld4um_full_file_name = %scan(&ld4um_upload_new_seq_of_files, &ld4um_file_counter, '#');\n\t%let ld4um_file_extension = %upcase(%trim(%left(%scan(&ld4um_full_file_name, -1))));\n \n\t%if \"&ld4um_gddauto_upd_fls_cntt_flg\" ne \"\" %then\n\t\t%let ld4um_gddauto_upd_fls_ct_flag = %scan(&ld4um_gddauto_upd_fls_cntt_flg, &ld4um_file_counter, '#');\n \n\t%if \"&ld4um_gddauto_upd_fls_ct_flag\" eq \"\" %then\n\t\t%let ld4um_gddauto_upd_fls_ct_flag = 0;\n \n\t%if &ld4um_diap_guided_automation = 1 %then\n\t%do;\n\t\t%if \"&ld4um_gddauto_upd_fls_del_seq\" ne \"\" %then\n\t\t%do;\n\t\t\t%let ld4um_gddauto_upd_fls_del = %scan(&ld4um_gddauto_upd_fls_del_seq, &ld4um_file_counter, '#');\n\t\t%end; %else\n\t\t%do;\n\t\t\t%let ld4um_gddauto_upd_fls_del = ;\n\t\t%end;\n \n\t\t%if \"&ld4um_gddauto_upd_fls_hdr_seq\" ne \"\" %then\n\t\t%do;\n\t\t\t%let ld4um_gddauto_upd_fls_hdr_flg = %scan(&ld4um_gddauto_upd_fls_hdr_seq, &ld4um_file_counter, '#');\n\t\t%end; %else\n\t\t%do;\n\t\t\t%let ld4um_gddauto_upd_fls_hdr_flg = ;\n\t\t%end;\n \n\t\t%let ld4um_gddauto_upd_fls_sht = %scan(&ld4um_gddauto_upd_fls_sht_seq, &ld4um_file_counter, '#');\n\t\t%if %upcase(\"&ld4um_gddauto_upd_fls_sht\") eq \"_DIAP_NA_\" %then\n\t\t\t%let ld4um_gddauto_upd_fls_sht = ;\n\t\t%if \"&ld4um_gddauto_upd_fls_tgt_seq\" ne \"\" %then\n\t\t%do;\n\t\t\t%let ld4um_gddauto_upd_fls_tgt = %scan(&ld4um_gddauto_upd_fls_tgt_seq, &ld4um_file_counter, '#');\n\t\t\t%if %upcase(\"&ld4um_gddauto_upd_fls_tgt\") eq \"_DIAP_NA_\" %then\n\t\t\t\t%let ld4um_gddauto_upd_fls_tgt = ;\n\t\t%end; %else\n\t\t%do;\n\t\t\t%let ld4um_gddauto_upd_fls_tgt = ;\n\t\t%end;\n\t%end;\n \n \n\t%if \"&ld4um_fn_in_fxd_wdth_def_fl_seq\" ne \"\" %then\t\n\t%do;\n\t\t%let ld4um_fn_in_fxd_wdth_def_fl = %scan(&ld4um_fn_in_fxd_wdth_def_fl_seq, &ld4um_file_counter, '#');\n\t\t%if &ld4um_debug_mode %then\n\t\t%do;\n\t\t\t%put INFORMATION: General: Working on  &=ld4um_fn_in_fxd_wdth_def_fl;\n\t\t\t%put INFORMATION: General: Working on  &=ld4um_full_file_name;\n\t\t%end;\n\t%end;\n\t%let ld4um_filename = %scan(&ld4um_full_file_name, -1, \"&ld4um_delimiter\");\n\t%let ld4um_original_table_name = %scan(&ld4um_filename, 1, '.');\n\t%if \"&ld4um_directory_path_seq\" ne \"\" %then\n\t%do;\n\t\t%let ld4um_directory_path = %scan(&ld4um_directory_path_seq, &ld4um_file_counter, '#');\n\t%end; %else\n\t%do;\n\t\t%let ld4um_full_file_name_length = %length(&ld4um_full_file_name);\n\t\t%let ld4um_file_name_length = %length(&ld4um_filename);\n\t\t%let ld4um_directory_path = %substr(&ld4um_full_file_name, 1, %eval(&ld4um_full_file_name_length - &ld4um_file_name_length));\n\t%end;\n\t%let ld4um_onefile = _DIAP_DT;\n \n\t%if &ld4um_gddauto_upd_fls_ct_flag = 0 %then\n\t%do;\n\t\tfilename _DIAP_DT \"&ld4um_full_file_name\";\n\t%end; %else\n\t%do;\n\t\tfilename _DIAP_DT filesrvc folderpath= \"&ld4um_directory_path\" filename=\"&ld4um_filename\";\n\t%end;\n \n\t%if &ld4um_debug_mode %then\n\t%do;\n\t\t%put INFORMATION: General: Working on  &=ld4um_filename;\n\t\t%put INFORMATION: General: Working on  &=ld4um_directory_path;\n\t%end;\n\t%let ld4um_file_modified_date = ;\n\t%if &ld4um_check_modify_date = 1\n/*\t\tand*/\n/*\t\t&ld4um_gddauto_upd_fls_ct_flag = 0 */\n\t\t%then\n\t%do;\n\t    %let ld4um_fid=%sysfunc(fopen(&ld4um_onefile));\n\t\n\t\t%let ld4um_Modify_Datetime = %qsysfunc(finfo(&ld4um_fid,Last Modified));\n\t\t%let ld4um_file_modified_date = %substr(&ld4um_Modify_Datetime, 1, 9);\n\t\t%let ld4um_file_modified_time = %substr(&ld4um_Modify_Datetime, 11, 8);\n\t   \t%let ld4um_fid=%sysfunc(fclose(&ld4um_fid));\n\t%end;\n\t%if \"&ld4um_file_modified_date\" eq \"\" %then\n\t%do;\n\t\t%let ld4um_file_modified_date = 10Jan2199;\n\t\t%let ld4um_file_modified_time = 00:00:01;\n\t%end;\n \n\t%if &ld4um_string_seq_cut_count ne 0 %then\n\t%do;\n\t\t%do ld4um_string_seq_cut_counter = 1 %to &ld4um_string_seq_cut_count;\n\t\t\t%let ld4um_string_2_cut = %scan(&ld4um_stringseq_2_cutout_from_fn, &ld4um_string_seq_cut_counter, \"#\");\t\t\t\n \n\t\t\t%if &ld4um_debug_mode %then\n\t\t\t%do;\n\t\t\t\t%put INFORMATION: General: Omitting character string from File: &ld4um_original_table_name;\n\t\t\t%end;\n \n\t\t\tdata _null_;\n\t\t\t\tld4um_original_table_name = \"&ld4um_original_table_name\";\n\t\t\t\tld4um_string_2_cut = \"&ld4um_string_2_cut\";\n\t\t\t\tlength_chk = length(ld4um_string_2_cut);\n\t\t\t\tlength_org = length(ld4um_original_table_name);\n\t\t\t\tposition = 0;\n\t\t\t\tposition = index(upcase(ld4um_original_table_name), upcase(ld4um_string_2_cut));\n\t\t\t\tif position ne 0 then\n\t\t\t\tdo;\n\t\t\t\t\tif position = 1 and length_chk ne length_org then\n\t\t\t\t\t\tld4um_original_table_name = trim(left(substr(ld4um_original_table_name, position + length_chk)));\n\t\t\t\t\telse if position = 1 and length_chk eq length_org then\n\t\t\t\t\t\tld4um_original_table_name = \"\";\n\t\t\t\t\telse\n\t\t\t\t\t\tld4um_original_table_name = trim(left(trim(left(substr(ld4um_original_table_name, 1, position - 1)))||trim(left(substr(ld4um_original_table_name, position + length_chk)))));\n\t\t\t\tend;\n\t\t\t\tif missing(ld4um_original_table_name) then ld4um_original_table_name = \"ZZ_Check_out_cut_out_string_4_FN_&ld4um_file_counter\";\n\t\t\t\tcall symput(\"ld4um_original_table_name\", ld4um_original_table_name);\n\t\t\trun;\n\t\t\t%let ld4um_original_table_name = %trim(%left(&ld4um_original_table_name));\n \n\t\t\t%if &ld4um_debug_mode %then\n\t\t\t%do;\n\t\t\t\t%put INFORMATION: General: To New Filename: &ld4um_original_table_name;\n\t\t\t%end;\n \n\t\t%end;\n\t%end;\n \n\t%if \"&ld4um_gddauto_upd_fls_tgt\" ne \"\" %then\n\t\t%let ld4um_original_table_name = &ld4um_gddauto_upd_fls_tgt;\n \n\t%let ld4um_first_char = %substr(&ld4um_original_table_name, 1, 1);\n\t%if &ld4um_debug_mode %then\n\t%do;\n\t\t%put INFORMATION: General: Working on  &=ld4um_first_char;\n\t\t%put INFORMATION: General: Working on  &=ld4um_file_modified_date;\n\t%end;\n\tdata _null_;\n\t\tif compress(\"&ld4um_first_char\",\"1234567890(-@*+{[}])\") = \"\" then\t\n\t\t\tcall symput(\"ld4um_first_char\", 1);\n\trun;\n\t%if &ld4um_first_char = 1 %then\n\t\t%let ld4um_table_name = T&ld4um_original_table_name;\n\t%else\t\n\t\t%let ld4um_table_name = &ld4um_original_table_name;\n\t\t%if &ld4um_debug_mode %then\n\t%do;\n\t\t%put INFORMATION: General: Working on  &=ld4um_table_name;\n\t%end;\t\n\t/*********\n\tbefore checking table name length, reduce characters that need to be dropped\n\tmandatorily.\n\t*********/\n\t%let ld4um_table_name = %upcase(%sysfunc(compress(%superQ(ld4um_table_name),%(%))));\n\t%if %length(&ld4um_table_name) gt &ld4um_max_name_length %then\n\t%do;\n\t\t%let ld4um_table_name = %sysfunc(compress(%superQ(ld4um_table_name),&ld4um_substitute_string_seq.));\n\t\t%if %length(&ld4um_table_name) gt &ld4um_max_name_length %then\n\t\t\t%let ld4um_table_name = %substr(&ld4um_table_name, 1, &ld4um_max_name_length);\n\t%end;\n\t%let ld4um_original_sheet_name = ;\n\t%let ld4um_xlsx_table_counter = 1;\n/*********\nFor Excel this is an attempt to come up with some intelligent way to determine the opimal\nlength of file name and sheet name(s) per Excel file for the target table name.\n*********/\n\t%if ((&ld4um_file_extension eq XLSX or\n\t\t&ld4um_file_extension eq JSON or\n\t\t&ld4um_file_extension eq XML) or\n\t\t(&ld4um_file_extension eq XLS and &ld4um_diap_guided_automation = 1) ) and\n\t\t(\"&ld4um_fn_in_fxd_wdth_def_fl_seq\" eq \"\") %then\n\t%do;\n\t\t%if &ld4um_file_extension eq XML and\n\t\t\t&ld4um_diap_guided_automation ne 1 %then\n\t\t%do;\n\t\t\tfilename  tempxlsx \"&ld4um_full_file_name.\";\n\t\t\tfilename  tpxmlmap \"%substr(&ld4um_full_file_name, 1, %eval(%length(&ld4um_full_file_name) - 3))map\";\n\t\t\tlibname tempxlsx xmlv2 automap=replace xmlmap=tpxmlmap;\n\t\t\n\t\t\tlibname tempxlsx xmlv2 xmlmap=tpxmlmap access=READONLY;\n \n\t\t%end; %else\n\t\t%if &ld4um_diap_guided_automation ne 1 %then\n\t\t%do;\n\t\t\tlibname tempxlsx &ld4um_file_extension \"&ld4um_full_file_name.\";\n\t\t%end;\n\t\t%let ld4um_excel_table_seq = ;\n\t\t%if &ld4um_fnl_tblname_from_sheetonly = 1 %then\n\t\t%do;\n\t\t\t%let ld4um_table_name = ;\n\t\t%end;\n\t\t%let ld4um_org_excel_table_name = &ld4um_table_name;\n\t\t%if &ld4um_diap_guided_automation ne 1 %then\n\t\t%do;\n\t\t\tproc sql noprint;\n\t\t\t\tselect\n\t\t\t\t\tmemname\n\t\t\t\tinto\n\t\t\t\t\t:ld4um_excel_table_seq separated by \"#\"\n\t\t\t\tfrom\n\t\t\t\t\tdictionary.tables\n\t\t\t\twhere\n\t\t\t\t\tupcase(libname) = \"TEMPXLSX\";\n\t\t\tquit;\n\t\t%end; %else\n\t\t%do;\n\t\t\t%let ld4um_excel_table_seq = &ld4um_gddauto_upd_fls_sht;\n\t\t%end;\n\t\t%let ld4um_xlsx_table_count = %wordcnt(&ld4um_excel_table_seq, '#');\n\t\t%let ld4um_table_name_length = %length(&ld4um_table_name);\n\t\t%if &ld4um_debug_mode %then\n\t\t\t%put INFORMATION: General: Working on  &ld4um_org_excel_table_name;\n\t\t%do ld4um_xlsx_table_counter = 1 %to &ld4um_xlsx_table_count;\n\t\t\t%let ld4um_table_name = &ld4um_org_excel_table_name;\n\t\t\t%let ld4um_original_sheet_name = %scan(&ld4um_excel_table_seq, &ld4um_xlsx_table_counter, \"#\");\n\t\t\t%let ld4um_sheet_name = %sysfunc(tranwrd(%quote(&ld4um_original_sheet_name),-,_));\n\t\t\t%let ld4um_sheet_name = %sysfunc(compress(%superQ(ld4um_sheet_name),%(%)));\n\t\t\t/**\n\t\t\t\tcheck if name is final table name is provided through guided automation,\n\t\t\t\tthen sheet name is not needed.\n\t\t\t**/\n\t\t\t%if \"&ld4um_gddauto_upd_fls_tgt\" ne \"\" %then\n\t\t\t\t%let ld4um_sheet_name = ;\n\t\t\t%let ld4um_sheet_name_length = %length(&ld4um_sheet_name);\n\t\t\t%let ld4um_complete_length = %eval(&ld4um_sheet_name_length + &ld4um_table_name_length);\n\t\t\t%if &ld4um_debug_mode %then\n\t\t\t%do;\n\t\t\t\t%put INFORMATION: General: Working on  &=ld4um_sheet_name;\n\t\t\t\t%put INFORMATION: General: Working on  &=ld4um_complete_length;\n\t\t\t%end;\n\t\t\t%if &ld4um_complete_length gt &ld4um_max_name_length %then\n\t\t\t%do;\n\t\t\t\t%let ld4um_sheet_name = %sysfunc(compress(%superQ(ld4um_sheet_name),&ld4um_substitute_string_seq.));;\n\t\t\t\t%let ld4um_sheet_name_length = %length(&ld4um_sheet_name);\n\t\t\t\t%if &ld4um_sheet_name_length gt &ld4um_max_name_length %then\n\t\t\t\t%do;\n\t\t\t\t\t%let ld4um_sheet_name = %substr(&ld4um_sheet_name, 1, &ld4um_max_name_length);\n\t\t\t\t\t%let ld4um_sheet_name_length = &ld4um_max_name_length;\n\t\t\t\t%end;\n\t\t\t\t%let ld4um_complete_length = %eval(&ld4um_sheet_name_length + &ld4um_table_name_length);\n\t\t\t\t%if &ld4um_complete_length gt &ld4um_max_name_length %then\n\t\t\t\t%do;\n\t\t\t\t\t%let ld4um_table_name = %sysfunc(compress(%superQ(ld4um_table_name),&ld4um_substitute_string_seq.));\n\t\t\t\t%end;\n\t\t\t\t\n\t\t\t%end;\n\t\t\t%let ld4um_table_name_length = %length(&ld4um_table_name);\n\t\t\t%let ld4um_sheet_name_length = %length(&ld4um_sheet_name);\n\t\t\t%let ld4um_complete_length = %eval(&ld4um_sheet_name_length + &ld4um_table_name_length);\t\t\n\t\t\t%if %length(&ld4um_sheet_name) gt &ld4um_half_of_max_name_length and\n\t\t\t\t%length(&ld4um_table_name) gt &ld4um_half_of_max_name_length %then\n\t\t\t%do;\n\t\t\t\t\t%let ld4um_table_name = %substr(&ld4um_table_name, 1, &ld4um_half_of_max_name_length);\n\t\t\t\t\t%let ld4um_sheet_name = %substr(&ld4um_sheet_name, 1, &ld4um_half_of_max_name_length);\n\t\t\t\t\t\n\t\t\t%end; %else\n\t\t\t%if &ld4um_complete_length gt &ld4um_max_name_length %then\n\t\t\t%do;\n\t\t\t\t%if &ld4um_table_name_length gt &ld4um_sheet_name_length %then\n\t\t\t\t%do;\n\t\t\t\t\t%let ld4um_allowed_length = %eval(&ld4um_max_name_length - &ld4um_sheet_name_length);\n\t\t\t\t\t%let ld4um_table_name = %substr(&ld4um_table_name, 1, &ld4um_allowed_length);\n\t\t\t\t%end; %else\t\n\t\t\t\t%do;\n\t\t\t\t\t%let ld4um_allowed_length = %eval(&ld4um_max_name_length - &ld4um_table_name_length);\n\t\t\t\t\t%let ld4um_sheet_name = %substr(&ld4um_sheet_name, 1, &ld4um_allowed_length);\n\t\t\t\t%end;\n\t\t\t%end;\n\t\t\t%let ld4um_table_name = %sysfunc(tranwrd(%quote(&ld4um_table_name&ld4um_sheet_name),%str( ),_));\n\t\t\t%let ld4um_final_table_name = %sysfunc(tranwrd(%quote(&ld4um_table_name),%str( ),_));\n\t\t\t%let ld4um_final_table_name = %upcase(%sysfunc(tranwrd(%quote(&ld4um_final_table_name),-,_)));\n/*********\nWrite out information to a temporary file for later consumption in case for Excel.\n*********/\n/** **/\n\t\t\t%if &ld4um_debug_mode %then\n\t\t\t%do;\n\t\t\t\t%put INFORMATION PROGRESS: File &ld4um_full_file_name;\n\t\t\t\t%put INFORMATION PROGRESS: Sheet &ld4um_original_sheet_name;\n\t\t\t\t%put INFORMATION PROGRESS: Mofify Date &ld4um_file_modified_date;\n\t\t\t\t%put INFORMATION PROGRESS: Modify Time &ld4um_file_modified_time;\n\t\t\t\t%put INFORMATION PROGRESS: Final Table Name &ld4um_final_table_name;\n\t\t\t%end;\n \n \n\t\t\tdata work._file_list_complete_info_&ld4um_file_counter._&ld4um_xlsx_table_counter;\n\t\t\t\tlength\n\t\t\t\t\tfile_path_full_name $512\n\t\t\t\t\toriginal_filename $128\n\t\t\t\t\toriginal_sheetname $128\n\t\t\t\t\tadjusted_table_name $64\n\t\t\t\t\tadjusted_table_name_org $64\n\t\t\t\t\textension $12\n\t\t\t\t\tlibrary $8\n\t\t\t\t\tfile_delimiter $32\n\t\t\t\t\t%if \"&ld4um_directory_path_seq\" ne \"\" %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\tdirectory_path  $512\n\t\t\t\t\t%end;\t\t\t\t\t\n\t\t\t\t\t;\n\t\t\t\tformat\n\t\t\t\t\tfile_modified_date date10.\n\t\t\t\t\tfile_modified_time time8.\n\t\t\t\t\t;\n\t\t\t\tfile_path_full_name = \"&ld4um_full_file_name\";\n\t\t\t\toriginal_filename = \"&ld4um_filename\";\n\t \t\t\toriginal_sheetname = \"&ld4um_original_sheet_name\";\n\t  \t\t\tadjusted_table_name_org = \"%trim(%left(&ld4um_final_table_name))\";\n\t\t\t\tadjusted_table_name = \"\";\n\t\t\t\tfile_delimiter = \"&ld4um_gddauto_upd_fls_del\";\n\t\t\t\textension = \"&ld4um_file_extension\";\n\t\t\t\tlibrary = \"\";\n\t\t\t\tfile_modified_date = input(\"&ld4um_file_modified_date\", date9.);\n\t\t\t\tfile_modified_time = input(\"&ld4um_file_modified_time\", time8.);\n\t\t\t\tcheck_source_file_flag = 0;\n\t\t\t\tfilepath_is_for_sas_content = &ld4um_gddauto_upd_fls_ct_flag;\n\t\t\t\t%if &ld4um_gddauto_upd_fls_hdr_flg = 0 %then\n\t\t\t\t%do;\n\t\t\t\t\tvariable_name_is_in_header = 0;\n\t\t\t\t%end; %else\n\t\t\t\t%do;\n\t\t\t\t\tvariable_name_is_in_header = 1;\n\t\t\t\t%end;\n\t\t\t\t%if \"&ld4um_directory_path_seq\" ne \"\" %then\n\t\t\t\t%do;\n\t\t\t\t\tdirectory_path = \"&ld4um_directory_path\";\n\t\t\t\t%end;\n\t\t\trun;\n\t\t%end;\n\t%end; %else\n\t%do;\n\t\t%if &ld4um_file_extension ne DBF and\n\t\t\t&ld4um_file_extension ne PRJ and\n\t\t\t&ld4um_file_extension ne SHX %then\n\t\t%do;\n/*********\nWrite out information to a temporary file for later consumption in case for all other cases.\n*********/\n\t\t\t%let ld4um_final_table_name = %sysfunc(tranwrd(%quote(&ld4um_table_name),%str( ),_));\n\t\t\t%let ld4um_final_table_name = %sysfunc(tranwrd(%quote(&ld4um_final_table_name),-,_));\n\t\t\t\n\t/**\n\t\t\t%put INFORMATION PROGRESS: File &ld4um_full_file_name;\n\t\t\t%put INFORMATION PROGRESS: Mofify Date &ld4um_file_modified_date;\n\t\t\t%put INFORMATION PROGRESS: Modify Time &ld4um_file_modified_time;\n\t\n\t**/\n\t\t\tdata work._file_list_complete_info_&ld4um_file_counter._&ld4um_xlsx_table_counter;\n\t\t\t\t\tlength\n\t\t\t\t\t\tfile_path_full_name $512\n\t\t\t\t\t\toriginal_filename $128\n\t\t\t\t\t\toriginal_sheetname $128\n\t\t\t\t\t\tadjusted_table_name $64\n\t\t\t\t\t\tadjusted_table_name_org $64\n\t\t\t\t\t\textension $12\n\t\t\t\t\t\tlibrary $8\n\t\t\t\t\t\tfile_delimiter $32\n\t\t\t\t\t\t%if \"&ld4um_directory_path_seq\" ne \"\" %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tdirectory_path  $512\n\t\t\t\t\t\t%end;\t\t\t\t\t\n\t\t\t\t\t\t%if \"&ld4um_fn_in_fxd_wdth_def_fl_seq\" ne \"\" %then\t\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tfilename_asin_fxd_wdth_def_fl $128\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t;\n\t\t\t\t\tformat\n\t\t\t\t\t\tfile_modified_date date9.\n\t\t\t\t\t\tfile_modified_time time8.\n\t\t\t\t\t\t;\n\t\t\t\t\tfile_path_full_name = \"&ld4um_full_file_name\";\n\t\t\t\t\toriginal_filename = \"&ld4um_filename\";\n\t\t \t\t\toriginal_sheetname = \"&ld4um_original_sheet_name\";\n\t\t  \t\t\tadjusted_table_name_org = \"%trim(%left(&ld4um_final_table_name))\";\n\t\t\t\t\tadjusted_table_name = \"\";\n\t\t\t\t\tlibrary = \"\";\n\t\t\t\t\tfile_delimiter = \"&ld4um_gddauto_upd_fls_del\";\n\t\t\t\t\textension = \"&ld4um_file_extension\";\n\t\t\t\t\tfile_modified_date = input(\"&ld4um_file_modified_date\", date9.);\n\t\t\t\t\tfile_modified_time = input(\"&ld4um_file_modified_time\", time8.);\n\t\t\t\t\tcheck_source_file_flag = 0;\n\t\t\t\t\tfilepath_is_for_sas_content = &ld4um_gddauto_upd_fls_ct_flag;\n\t\t\t\t\t%if &ld4um_gddauto_upd_fls_hdr_flg = 0 %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\tvariable_name_is_in_header = 0;\n\t\t\t\t\t%end; %else\n\t\t\t\t\t%do;\n\t\t\t\t\t\tvariable_name_is_in_header = 1;\n\t\t\t\t\t%end;\n\t\t\t\t\t%if \"&ld4um_directory_path_seq\" ne \"\" %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\tdirectory_path = \"&ld4um_directory_path\";\n\t\t\t\t\t%end;\n\t\t\t\t\t%if \"&ld4um_fn_in_fxd_wdth_def_fl_seq\" ne \"\" %then\t\n\t\t\t\t\t%do;\n\t\t\t\t\t\tfilename_asin_fxd_wdth_def_fl = \"&ld4um_fn_in_fxd_wdth_def_fl\";\n\t\t\t\t\t%end;\n\t\t\t\trun;\n\t\t%end;\n\t%end;\n \n \n%end;\n/*********\nPut all the information together into one file and check if there is an original overview\nfile available.\n*********/\n%let ld4um_temp_table_seq_2_check = ;\n \nproc sql noprint;\n\tselect memname\n\tinto :ld4um_temp_table_seq_2_check separated by \" \"\n\tfrom dictionary.tables\n\twhere\n\t\tupcase(libname) = \"WORK\" and\t\n\t\tupcase(memname) contains \"_FILE_LIST_COMPLETE_INFO_\";\nquit;\n \n%if &ld4um_temp_table_seq_2_check eq %then\n%do;\n\tdata &ld4um_temp_table_seq_2_check;\n\t\tlength\n\t\t\tfile_path_full_name $512\n\t\t\toriginal_filename $128\n\t\t\toriginal_sheetname $128\n\t\t\tadjusted_table_name $64\n\t\t\tadjusted_table_name_org $64\n\t\t\textension $12\n\t\t\tlibrary $8\n\t\t\tfile_delimiter $32\n\t\t\t%if \"&ld4um_directory_path_seq\" ne \"\" %then\n\t\t\t%do;\n\t\t\t\tdirectory_path  $512\n\t\t\t%end;\t\t\t\t\t\n\t\t\t%if \"&ld4um_fn_in_fxd_wdth_def_fl_seq\" ne \"\" %then\t\n\t\t\t%do;\n\t\t\t\tfilename_asin_fxd_wdth_def_fl $128\n\t\t\t%end;\n\t\t\t;\n\t\tcheck_source_file_flag = 0;\n\t\tfilepath_is_for_sas_content = 0;\n\t\tif 0;\n\trun;\t\t\t\n%end;\n \n \n/*************************\ncheck if table exists in CAS , but it not loaded yet\n**************************/\n%let ld4um_target_environment = ;\n%let ld4um_caslib_temp = %trim(%left(%scan(&ld4um_upload_log_ds_name, 1, '.')));\nproc sql noprint;\n\tselect distinct(engine)\n\tinto :ld4um_target_environment\n\tfrom dictionary.libnames\n\twhere upcase(libname) = \"%upcase(&ld4um_caslib_temp)\"\n\t;\nquit;\n \n%if %sysfunc(exist(&ld4um_upload_log_ds_name)) = 0 and\n\t&ld4um_target_environment eq CAS %then\n%do;\n\t%let ld4um_castable_temp = %trim(%left(%scan(&ld4um_upload_log_ds_name, 2, '.')));\n\tproc cas;\n\t\ttable.caslibinfo\n\t \t\tresult=sss/caslib=\"&ld4um_caslib_temp\"  ;\n\t\tdescribe sss;\n\t\tprint sss;\n\t\tsaveresult sss\n\t\t\tdataout=work._temp_path_data;\n\trun;\n\t%let ld4um_temp_lib_path = ;\t\n\tproc sql;\n\t\tselect path\n\t\tinto:ld4um_temp_lib_path\n\t\tfrom work._temp_path_data;\n\tquit;\n \n\t%if %sysfunc(fileexist(%trim(%left(&ld4um_temp_lib_path))&ld4um_castable_temp..sashdat)) %then\n\t%do;\n\t\tproc casutil\n\t\t\tincaslib=\"&ld4um_caslib_temp\" outcaslib = \"&ld4um_caslib_temp\";\n\t\t\tload casdata=\"&ld4um_castable_temp..sashdat\" casout=\"&ld4um_castable_temp\" promote;\n\t\tquit;\n\t%end;\n%end;\n \n \n \n%if %sysfunc(exist(&ld4um_upload_log_ds_name)) %then\n%do;\n\tdata work.ld4um_combined_log_ds;\n\t\tset &ld4um_temp_table_seq_2_check\n\t\t;\n\trun;\n\tproc sort\n\t\tdata = work.ld4um_combined_log_ds;\n\t\tby\n\t\t\tfile_path_full_name\n\t\t\t;\n\tquit;\n\t\n\tdata work.original_overview_ds;\n\t\tset &ld4um_upload_log_ds_name;\n\t\tif missing(check_source_file_flag) then check_source_file_flag = 0;\n\trun;\n\tproc sort\n\t\tdata = work.original_overview_ds;\n\t\tby\n\t\t\tfile_path_full_name\n\t\t\t;\n\tquit;\n\tdata work.overview_new_upload_list;\n\t\tmerge\n\t\t\twork.ld4um_combined_log_ds (in = update)\n\t\t\twork.original_overview_ds (in = original);\n\t\tby \t\n\t\t\tfile_path_full_name;\n\t\tformat\n\t\t\ttemp_mod_date best12.\n\t\t\ttemp_load_date best12.;\n\t\ttemp_mod_date = .;\n\t\ttemp_load_date = .;\n\t\tif not update and original then\n\t\t\toutput; else\n\t\tif update and original then\n\t\tdo;\n\t\t\ttemp_mod_date = file_modified_date;\n\t\t\ttemp_load_date = load_date;\n\t\t\t%if &ld4um_force_upload_of_all_files = 0 %then\n\t\t\t%do;\n\t\t\t\tif temp_mod_date < temp_load_date or\n\t\t\t\t   (file_modified_date = load_date and\t\t\n\t\t\t\t   file_modified_time < load_time) then\n\t\t\t\tdo;\n\t\t\t\t\tput \"PROCESSSING INFORMATION: Following file is not uploaded again since the last upload date is more recent then the file date:\" ;\n\t\t\t\t\tput \"PROCESSSING INFORMATION: \" file_path_full_name;\n\t\t\t\t\toutput;\t\t\t\t\n\t\t\t\tend; else\n\t\t\t\tdo;\n\t\t\t%end;\n\t\t\t\t\tload_date = .;\n\t\t\t\t\tload_time = .;\n\t\t\t\t\toutput;\t\n\t\t\t%if &ld4um_force_upload_of_all_files = 0 %then\n\t\t\t%do;\n\t\t\t\tend;\n\t\t\t%end;\n\t\tend; else\n\t\tif update and not original then\t\n\t\tdo;\n\t\t\toutput;\n\t\tend;\n\t\tdrop\n\t\t\ttemp_mod_date\n\t\t\ttemp_load_date\n\t\t\tfile_modified_date\n\t\t\tfile_modified_time;\n\trun;\n\tdata work.zz_ld4um_upload_log_ds_name;\n\t\tset overview_new_upload_list;\n\trun;\n%end; %else\n%do;\n\tdata work.zz_ld4um_upload_log_ds_name;\n\t\tset &ld4um_temp_table_seq_2_check\n\t\t;\n\t\tformat\n\t\t\tload_time time8.\n\t\t\tload_date date9.\n\t\t;\n\t\tload_date = .;\n\t\tload_time = .;\n\t\tdrop\n\t\t\tfile_modified_date\n\t\t\tfile_modified_time;\n\trun;\n\t\t\t\n%end;\n\t\nproc sort data = work.zz_ld4um_upload_log_ds_name;\n\tby\n\t\tadjusted_table_name_org\n\t\tdescending load_date;\nquit;\n \n/**********\nthis datastep deals with duplicates and if there are, we are appending a counter to\n\tthe newly created table name to make them unique.\n**********/\n%let ld4um_z_prefix = %eval(31 - &ld4um_max_name_length);\ndata &ld4um_upload_log_ds_name;\n\tset work.zz_ld4um_upload_log_ds_name;\n\tby\n\t\tadjusted_table_name_org;\n\tretain counter 0;\n\tdrop counter;\n\tif first.adjusted_table_name_org then\n\t\tcounter = 0;\n\tcounter = counter + 1;\n\t%if &ld4um_create_unique_target_tblnm = 1 %then\n\t%do;\n\t\tif (first.adjusted_table_name_org ne last.adjusted_table_name_org) or\n\t\t\t(not first.adjusted_table_name_org and not last.adjusted_table_name_org) then\n\t\tdo;\n\t\t\tif missing(adjusted_table_name) then\n\t\t\tdo;\n\t\t\t\t%if \"&ld4um_fnl_ds_name_4_all_extfiles\" eq \"\" %then\n\t\t\t\t%do;\n\t\t\t\t\tadjusted_table_name = trim(left(adjusted_table_name_org)) || \"_\" || put(counter, z&ld4um_z_prefix..);\n\t\t\t\t%end; %else\n\t\t\t\t%do;\n\t\t\t\t\tadjusted_table_name = \"&ld4um_fnl_ds_name_4_all_extfiles\";\n\t\t\t\t%end;\n\t\t\tend;\n\t\tend; else\n\t%end;\n\t\t%if \"&ld4um_fnl_ds_name_4_all_extfiles\" eq \"\" %then\n\t\t%do;\n\t\t\tadjusted_table_name = trim(left(adjusted_table_name_org));\n\t\t%end; %else\n\t\t%do;\n\t\t\tadjusted_table_name = \"&ld4um_fnl_ds_name_4_all_extfiles\";\n\t\t%end;\n \nrun;\n \n \n \n%mend log_dataset_4_upload_maintenance;\n/** FOR TESTING ***\noption mprint source notes;\noption mprint source notes;\n* %include \"C:\\Users\\<<MYUSERID>>\\OneDrive - SAS\\Documents\\Data Management\\Code Examples\\Viya\\DIAP\\Git_Section\\diap\\macros\\wordcnt.sas\";\n%include \"/mnt/downloads/production_code/macros/wordcnt.sas\";\n \n%let upload_new_seq_of_files=/mnt/downloads/ZZ_Testing/top_folder/excel_2/excel_test.xlsx#\n/Public/DIAP/TestFiles/excelfile.xlsx# /mnt/downloads/ZZ_Testing/top_folder/excel_2/_DIAP_guided_execution.csv#\n/Public/DIAP/TestFiles/testdir1/TestData_w_blank_del.csv# /Public/DIAP/TestFiles/testdir2/TestData.csv;\n%let directory_path_seq=/mnt/downloads/ZZ_Testing/top_folder/excel_2/# /Public/DIAP/TestFiles/#\n/mnt/downloads/ZZ_Testing/top_folder/excel_2/# /Public/DIAP/TestFiles/testdir1/# /Public/DIAP/TestFiles/testdir2/;\n%let WOF2L_FNL_DS_NAME_4_ALL_EXTFILES=;\n%let WOF2L_DIAP_GUIDED_AUTOMATION=1;\n%let WOF2L_GDDAUTO_UPD_FLS_DEL_SEQ=# # #blank #;\n%let WOF2L_GDDAUTO_UPD_FLS_SHT_SEQ=Sheet1 #ByPlant # # #;\n%let WOF2L_GDDAUTO_UPD_FLS_CNTT_FLG=0 #1 #0 #1 #1;\n%let WOF2L_GDDAUTO_UPD_FLS_TGT_SEQ=#ByPlantData # #TestBlankCSVFile #;\n%let WOF2L_GDDAUTO_UPD_FLS_HDR_SEQ=1 #1 #1 #1 #1;\n \n \n%let upload_log_ds_name = work._upload_log_work2;\n \n%let substitute_string_seq = aeiouAEOIU;\n%log_dataset_4_upload_maintenance(\n\t&upload_log_ds_name,\n\t&upload_new_seq_of_files,\n\tld4um_directory_path_seq = &directory_path_seq,\n\tld4um_substitute_string_seq = &substitute_string_seq,\n\tld4um_max_name_length = 29,\n\tld4um_debug_mode = 1,\n\tld4um_check_modify_date = 1,\n\tld4um_stringseq_2_cutout_from_fn = ,\n\tld4um_force_upload_of_all_files = 0,\n\tld4um_fnl_tblname_from_sheetonly = 1,\n\tld4um_create_unique_target_tblnm = 0,\n\tld4um_delimiter = /,\n\tld4um_fnl_ds_name_4_all_extfiles = ,\n\tld4um_diap_guided_automation = 1,\n\tld4um_gddauto_upd_fls_del_seq = &WOF2L_GDDAUTO_UPD_FLS_DEL_SEQ,\n\tld4um_gddauto_upd_fls_sht_seq = &WOF2L_GDDAUTO_UPD_FLS_SHT_SEQ,\n\tld4um_gddauto_upd_fls_cntt_flg = &WOF2L_GDDAUTO_UPD_FLS_CNTT_FLG,\n\tld4um_gddauto_upd_fls_tgt_seq = &WOF2L_GDDAUTO_UPD_FLS_TGT_SEQ,\n\tld4um_gddauto_upd_fls_hdr_seq = &WOF2L_GDDAUTO_UPD_FLS_HDR_SEQ\n\t);\n \n \n*********************/\n \n \n/******************************************************************************\n \n%automated_profiling_4_DIAP\n________\n \n \n \n______________________________________________________________________________\n \n \nUSAGE:                         see testing section on the bottom of this code\n \n______________________________________________________________________________\n \nDESCRIPTION:\n \nThis macro is used within DIAP to integrate the AUTOPROFILING app developed\nby Joao Olivera in SAS Portugal. It bridges the information coming from DIAP to the\nAutorprofiling application.\n______________________________________________________________________________\n \n \nINPUT PARAMETERS AND KEYWORDS:\n \n\tap4d_table_2_prep_4_prof_seq: sequence of tables loaded to CAS separated by #\n\tap4d_dict_source_file_name: this parameter is not used at the moment\n\tap4d_dict_source_file_path: this parameter is not used at the moment\n\tap4d_prof_execution_option:\n\t\t2 options\n\t\t\tDICT_ONLY:  only fills in the default dictionary entries needed for the\n\t\t\t\t\t\tAUTOPROFILING app. The actual profiling needs to be triggered\n\t\t\t\t\t\tseparatedly.\n\t\t\tPROFILE:\tThis option fills in the default dictionary entries AND also\n\t\t\t\t\t\ttriggers the execution of creating the actual profiles.\n\tad4d_fcmp_execution:\n\t\t2 options\n\t\t\t1: used proc FCMP to execute commands\n\t\t\t0: uses traditional macro processing to execute commands\n______________________________________________________________________________\n \nNOTES: (Initials, date, summary)\n \nStephan Weigandt    20200707  First officially Released Version\n______________________________________________________________________________\n \n*******************************************************************************/\n \n%macro automated_profiling_4_DIAP(\n\tap4d_table_2_prep_4_prof_seq = ,\n\tap4d_dict_source_file_name = ,\n\tap4d_dict_source_file_path = ,\n\tap4d_prof_execution_option = DICT_ONLY,\n\tad4d_fcmp_execution = 1,\n\tap4d_libname_4_dictionaries = ,\n\tap4d_viyaversion = 35\n\t);\n \n\t%let ViyaVersion = &ap4d_viyaversion;\t\t/* constant used on the macro routine called | 34 = Viya 3.4 | 35 = Viya 3.5 */\n\t%let DataMartLib = &ap4d_libname_4_dictionaries;\t/* constant used on the macro routine called | Data Mart Location */\n\t\n \n \n\t\n\t/* Including the Auto Profiling code that creates / populates the Data Mart*/\n \n\t%local\n\t\tap4d_table_count\n\t\tap4d_table_counter\n\t\tap4d_full_table_name\n\t\tap4d_col_seq\n\t\tap4d_ds_name\n\t\tap4d_ds_libname\n\t\tap4d_col_counter\n\t\tap4d_col_count\n\t\tap4d_col_name\n\t\tap4d_col_name_seq\n\t\tap4d_col_type_seq\n\t;\n\t%let ap4d_table_count = %wordcnt(&ap4d_table_2_prep_4_prof_seq, \"#\");\n \n \n\t%do ap4d_table_counter = 1 %to &ap4d_table_count;\n\t\t%let ap4d_full_table_name = %scan(&ap4d_table_2_prep_4_prof_seq, &ap4d_table_counter, \"#\");\n\t\t%let ap4d_ds_libname = %scan(&ap4d_full_table_name, 1, \".\");\n\t\t%let ap4d_ds_name = %scan(&ap4d_full_table_name, 2, \".\");\n\t\t%let ap4d_col_name_seq = ;\n\t\t%let ap4d_col_type_seq = ;\n\t\t%if \"%upcase(&ap4d_prof_execution_option)\" = \"DICT_ONLY\" or\n\t\t\t\"%upcase(&ap4d_prof_execution_option)\" = \"PROFILE\" %then\n\t\t%do;\n \n\t\t\t%let ap4d_final_table_name = &ap4d_ds_name;\n\t\t\t%let ap4d_cas_target_libname = DM_DtMrt;\n\t\t\t%let ap4d_max_varnumber_&ap4d_table_counter = ;\n\t\t\tproc sql noprint;\n\t\t\t\tselect\n\t\t\t\t\tnobs into :ap4d_max_varnumber_&ap4d_table_counter\n\t\t\t\tfrom dictionary.tables\n\t\t\t\twhere\n\t\t\t\t\tupcase(libname) = \"%upcase(&ap4d_ds_libname)\" and\n\t\t\t\t \tupcase(memname) = \"%upcase(&ap4d_ds_name)\";\n\t\t\tquit;\n \n \n \n\t\t\t%do ap4d_var_counter = 1 %to &&ap4d_max_varnumber_&ap4d_table_counter;\n\t\t\t\t%local\n\t\t\t\t\tap4d_varname_seq_&ap4d_table_counter._&ap4d_var_counter\n\t\t\t\t\tap4d_type_seq_&ap4d_table_counter._&ap4d_var_counter\n\t\t\t\t\t;\n\t\t\t\t%let ap4d_varname_seq_&ap4d_table_counter._&ap4d_var_counter = ;\n\t\t\t\t%let ap4d_type_seq_&ap4d_table_counter._&ap4d_var_counter = ;\n\t\t\t%end;\n \n\t\t\tproc sql noprint;\n\t\t\t\tcreate table columns_4_prfl_&ap4d_table_counter as\n\t\t\t\tselect\n\t\t\t\t\tname,\n\t\t\t\t\ttype\n\t\t\t\tfrom\n\t\t\t\t\tdictionary.columns\n\t\t\t\twhere\n\t\t\t\t\tupcase(libname) = \"%upcase(&ap4d_ds_libname)\" and\n\t\t\t\t\tupcase(memname) = \"%upcase(&ap4d_ds_name)\"\n\t\t\t\t;\n\t\t\tquit;\n \n \n \n\t\t\tdata _null_;\n\t\t\t\tset columns_4_prfl_&ap4d_table_counter;\n\t\t\t\tsuffix = put(_n_, 6.);\n\t\t\t\tcall symput(cats(\"ap4d_varname_seq_&ap4d_table_counter._\", suffix), name);\n\t\t\t\tcall symput(cats(\"ap4d_type_seq_&ap4d_table_counter._\", suffix), type);\n\t\t\trun;\n\t\t\t%do ap4d_var_counter = 1 %to &&ap4d_max_varnumber_&ap4d_table_counter;\n\t\t\t\t%let ap4d_varname_seq_&ap4d_table_counter._&ap4d_var_counter = %trim(%left(&&ap4d_varname_seq_&ap4d_table_counter._&ap4d_var_counter));\n\t\t\t\t%let ap4d_type_seq_&ap4d_table_counter._&ap4d_var_counter = %trim(%left(&&ap4d_type_seq_&ap4d_table_counter._&ap4d_var_counter));\n\t\t\t%end;\n\t\t\t%let ap4d_varname_seq_count = &&ap4d_max_varnumber_&ap4d_table_counter;\n\t\t\t\t%do ap4d_var_counter = 1 %to &&ap4d_max_varnumber_&ap4d_table_counter;\n\t\t\t\t\t%put INFORMATION: ap4d_varname_seq_&ap4d_table_counter._&ap4d_var_counter = &&ap4d_varname_seq_&ap4d_table_counter._&ap4d_var_counter;\n\t\t\t\t\t%put INFORMATION: ap4d_type_seq_&ap4d_table_counter._&ap4d_var_counter = &&ap4d_type_seq_&ap4d_table_counter._&ap4d_var_counter;\n\t\t\t\t%end;\n \n \n\t\t\tproc casutil;\n\t\t\t\tdroptable casdata = \"&ap4d_final_table_name\" incaslib = \"&ap4d_cas_target_libname\" quiet;\n\t\t\t\tdroptable casdata = \"&ap4d_final_table_name\" incaslib = \"&ap4d_cas_target_libname\" quiet;\n\t\t\tquit;\n \n \n\t\t\tdata &ap4d_cas_target_libname..&ap4d_ds_name;\n\t\t\t\tlength\n\t\t\t\t\t_Definition_Version\t\t4\n\t\t\t\t\t_Definition_date\t\t\t8\n\t\t\t\t\t_rawdta_lib_name\t\t\t$40\t\n\t\t\t\t\t_rawdta_table_name \t\t$40\n\t\t\t\t\t_column_2profile \t\t$1\n\t\t\t\t\t_column_mr_group\t\t\t$128\n\t\t\t\t\t_column_name\t\t\t\t$40\n\t\t\t\t\t_column_name_matchcode\t$64\n\t\t\t\t\t_column_label\t\t\t$64\n\t\t\t\t\t_column_meaning \t\t\t$256\n\t\t\t\t\t_column_func_meaning\t\t$64\n\t\t\t\t\t_column_iscritical \t\t$1\n\t\t\t\t\t_column_type\t\t\t\t$32\n\t\t\t\t\t_column_datatype \t\t$32\n\t\t\t\t\t_column_data_fmt\t\t\t$64\n\t\t\t\t\t_column_decimals\t\t\t8\n\t\t\t\t\t_column_pattern\t\t\t$2048\n\t\t\t\t\t_column_minmax\t\t\t$64\n\t\t\t\t\t_DQ_Resolution_Actions \t$2048\n\t\t\t\t\t_DQ_locale\t\t\t\t$10\n\t\t\t\t\t_DQ_match_level_names\t3.0\n\t\t\t\t\t_DQ_match_level_addrs\t3.0\n\t\t\t\t\t_Func_Validation\t\t\t$128\n\t\t\t\t\t_Func_ValDesc\t\t\t$2048\n\t\t\t\t\t_SID_model_name\t\t\t$128\n\t\t\t\t\t_SID_model_table\t\t\t$40\n\t\t\t\t\t_SID_model_caslib\t\t$40\n\t\t\t\t\t_SID_model_params\t\t$2048\n\t\t\t\t\t_max_sample_size\t\t\t8\n\t\t\t\t;\n\t\n\t\t\t\t%do ap4d_var_counter = 1 %to &&ap4d_max_varnumber_&ap4d_table_counter;\n\t\t\t\t\t_column_2profile = \"Y\";\n\t\t\t\t\t_column_name = \"&&ap4d_varname_seq_&ap4d_table_counter._&ap4d_var_counter\";\n\t\t\t\t\t_column_label = \"&&ap4d_varname_seq_&ap4d_table_counter._&ap4d_var_counter\";\n\t\t\t\t\t_column_iscritical = \"Y\";\n\t\t\t\t\t_column_type =\n\t\t\t\t\t%if \"%upcase(&&ap4d_type_seq_&ap4d_table_counter._&ap4d_var_counter)\" = \"CHAR\" %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\t\"CHAR\"\n\t\t\t\t\t%end; %else\t\t\n\t\t\t\t\t%do;\n\t\t\t\t\t\t\"DOUBLE\"\n\t\t\t\t\t%end;\n\t\t\t\t\t;\n\t\t\t\t\t_column_datatype = _column_type;\n\t\t\t\t\t_max_sample_size = 250;\n\t\t\t\t\t_rawdta_lib_name = \"&ap4d_ds_libname\";\n\t\t\t\t\t_rawdta_table_name = \"&ap4d_ds_name\";\n\t\t\t\t\toutput;\n\t\t\t\t%end;\n\t\t\trun;\n \n\t\t\tproc casutil;\n\t\t\t\tpromote casdata=\"&ap4d_final_table_name\" incaslib=\"&ap4d_cas_target_libname\"\n\t\t\t\t\t\toutcaslib=\"&ap4d_cas_target_libname\" casout=\"&ap4d_final_table_name\" ;\n\t\t\tquit;\n \n \n\t\t\t%let ViyaVersion = 35;\n\t\t\t%let DataMartLib = DM_DtMrt;\n\t\t\t%let inSrcFile = &ap4d_ds_name..csv;\n\t\t\t%let inSrcFileType = CSV;\n\t\t\t%let inSrcTable = &ap4d_ds_name.;\n\t\t\t%let do_update_defs = YES;\n\t\t\t%if &ap4d_table_counter = &ap4d_table_count %then\n\t\t\t%do;\n\t\t\t\t%let save_to_disk = YES;\n\t\t\t%end; %else\n\t\t\t%do;\n\t\t\t\t%let save_to_disk = NO;\n\t\t\t%end;\n\t\t\t%let prfTableSuffix=_PRF;\t \t\t\t\t\t\t\t/* Suffix to be used on the profile results table */\n\t\t\t%if &ad4d_fcmp_execution = 1 %then\n\t\t\t%do;\n \n\t\t\t\tdata _null_;\n\t\t\t\t\tretain \t_inViyaVer _dmCasLib\n\t\t\t\t\t\t\t_inSrcFile _inSrcFileType _inSrcTable\n\t\t\t\t\t\t\t_do_update_defs _save_to_disk\n\t\t\t\t\t;\n\t\t\t\t\tlength \t_inViyaVer \t\t$4\n\t\t\t\t\t\t\t_dmCasLib\t\t$40\n\t\t\t\t\t\t\t_inSrcFile \t\t$40\n\t\t\t\t\t\t\t_inSrcFileType\t$10\n\t\t\t\t\t\t\t_inSrcTable \t$40\n\t\t\t\t\t\t\t_do_update_defs\t$3\n\t\t\t\t\t\t\t_save_to_disk \t$3\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t_val\t$80\n\t\t\t\t\t\t\tlen\t\t8\n\t\t\t\t\t\t\tmaxlen\t8\n\t\t\t\t\t;\n\t\t\t\t\t/* Looping throughout the JSON set */\n\t\t\t\t\t\n\t\t\t\t\t\t/* Initiation of variables and stuff */\n\t\t\t\t\t\t\t_dmCasLib = \"&DataMartLib\";\n\t\t\t\t\t\t\t_inViyaVer= &ViyaVersion;\n\t\t\t\n\t\t\t\t\t\t/* Making sure that the params content has no spaces / blanks and special characters\n\t\t\t\t\t\talthough this should be already handled on the javascript gathering param values*/\n\t\t\t\t\t\t_inSrcFile = \"&ap4d_cas_target_libname..SASDS\";\n\t\t\t\t\t\t_inSrcFileType = \"&inSrcFileType\";\n\t\t\t\t\t\t_inSrcTable = \"&ap4d_final_table_name\";\n\t\t\t\t\t\t_do_update_defs = \"&do_update_defs\";\n\t\t\t\t\t\t_save_to_disk = \"&save_to_disk\";\n\t\t\t\t\t\t\n\t\t\t\t\t\tput \"======================| Run_Loading_Dictionary with |======================\";\n\t\t\t\t\t\n\t\t\t\t\t\tput _inViyaVer=\t \t\n\t\t\t\t\t\t\t_dmCasLib=\t\t \t\n\t\t\t\t\t\t\t_inSrcFile= \t\t\t\n\t\t\t\t\t\t\t_inSrcFileType=\t\t\n\t\t\t\t\t\t\t_inSrcTable= \t\n\t\t\t\t\t\t\t_do_update_defs=\t\n\t\t\t\t\t\t\t_save_to_disk=;\n\t\t\t\t\t\tput \"=========================| Calling the Program |==========================\";\n\t\t\t\t\t\tif (_inViyaVer > 0) then do;\n\t\t\t\t\t\t\tcall TblDict_Load_Dictionary(_inViyaVer,\t\t_dmCasLib,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t _inSrcFile, \t\t_inSrcTable,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t _do_update_defs, \t_save_to_disk\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\tend;\n\t\t\t\n\t\t\t\trun;\n\t\t\t%end; %else\n\t\t\t%do;\n\t\t\t\t%put &=DataMartLib;\n\t\t\t\t%load_DTA_prf_rawdta_tabledict(\n\t\t\t\t\t\t\t\t\tinViyaVer\t  = &ViyaVersion,\n\t\t\t\t\t\t\t\t\tdmCasLib\t  = &DataMartLib,\n\t\t\t\t\t\t\t\t\tinSrcFile\t  = &ap4d_cas_target_libname..SASDS,\n\t\t\t\t\t\t\t\t\tinSrcTable\t  = &ap4d_final_table_name,\n\t\t\t\t\t\t\t\t\tdo_update_defs= &do_update_defs,\n\t\t\t\t\t\t\t\t\tsave_to_disk  = &save_to_disk\n\t\t\t\t\t\t\t\t  );\n \n \n\t\t\t%end;\n \n\t\t\tproc casutil;\n\t\t\t\tdroptable casdata = \"&ap4d_final_table_name\" incaslib = \"&ap4d_cas_target_libname\" quiet;\n\t\t\tquit;\n \n\t\t%end; /** end if **/\n\t%end;\n\t%do ap4d_table_counter = 1 %to &ap4d_table_count;\n\t\t%let ap4d_full_table_name = %scan(&ap4d_table_2_prep_4_prof_seq, &ap4d_table_counter, \"#\");\n\t\t%let ap4d_ds_libname = %scan(&ap4d_full_table_name, 1, \".\");\n\t\t%let ap4d_ds_name = %scan(&ap4d_full_table_name, 2, \".\");\n \n\t\t%if \"%upcase(&ap4d_prof_execution_option)\" = \"PROFILE\" %then\n\t\t%do;\n\t\t\t%let ViyaVersion = 35;\n\t\t\t%let DataMartLib = DM_DtMrt;\n\t\t\t%let inSrcFile = &ap4d_ds_name..csv;\n\t\t\t%let inSrcFileType = CSV;\n\t\t\t%let prfTableSuffix=_PRF;\t\t\t\n\t\t\t%let inSrcTable = &ap4d_ds_name.;\n\t\t\t%let do_update_defs = YES;\n\t\t\t%if &ap4d_table_counter = &ap4d_table_count %then\n\t\t\t%do;\n\t\t\t\t%let save_to_disk = YES;\n\t\t\t%end; %else\n\t\t\t%do;\n\t\t\t\t%let save_to_disk = NO;\n\t\t\t%end;\n \n\t\t\t%if &ad4d_fcmp_execution = 1 %then\n\t\t\t%do;\n\t\t\t\tdata _null_;\n\t\t\t\t\tretain \t_in_rawdta_lib _in_rawdta_table _in_prf_table_desc\n\t\t\t\t\t\t\t_dm_cas_lib _in_prf_table _do_append_master _save_to_disk\n\t\t\t\t\t;\n\t\t\t\t\tlength \t_in_rawdta_lib \t\t$40\n\t\t\t\t\t\t\t_in_rawdta_table \t$40\n\t\t\t\t\t\t\t_in_prf_table\t\t$40\n\t\t\t\t\t\t\t_dm_cas_lib\t\t\t$40\n\t\t\t\t\t\t\t_in_prf_table_desc \t$255\n\t\t\t\t\t\t\t_do_append_master \t$3\n\t\t\t\t\t\t\t_save_to_disk \t\t$3\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t_val\t$256\n\t\t\t\t\t\t\tlen\t\t8\n\t\t\t\t\t\t\tmaxlen\t8\n\t\t\t\t\t;\n\t\t\t\t\t\t\t_dm_cas_lib = \"&DataMartLib\";\n\t\t\t\t\t\t\t_inViyaVer= &ViyaVersion;\n\t\t\t\n\t\t\t\t\t\t/* Making sure that the params content has no spaces / blanks and special characters\n\t\t\t\t\t\talthough this should be already handled on the javascript gathering param values*/\n\t\t\t\t\t\t_in_rawdta_lib = \"&ap4d_ds_libname\";\n\t\t\t\t\t\t_in_rawdta_table = strip(\"&ap4d_ds_name\");\n\t\t\t\t\t\t_in_prf_table_desc = \"Automated Profile prepared by DIAP\";\n\t\t\t\t\t\t_do_append_master = \"&do_update_defs\";\n\t\t\t\t\t\t_save_to_disk = \"&save_to_disk\";\n\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\tput \"======================| Run_Auto_Profiling |======================\";\n\t\t\t\t\t\t/* Generating the Profiling Table Name =\n\t\t\t\t\t\t\traw data table name plus the Suffix defined by 'prfTableSuffix' */\n\t\t\t\t\t\t_val = compress(upcase(_in_rawdta_table));\n\t\t\t\t\t\tlen = length(_val);\n\t\t\t\t\t\tmaxlen = 32 - length(\"_PRF\");\n\t\t\t\t\t\tif len gt maxlen then  _in_prf_table = strip(substrn(_val, 1, maxlen) || \"_PRF\");\n\t\t\t\t\t\telse\t\t\t\t   _in_prf_table = strip(substrn(_val, 1, len) || \"_PRF\");\n\t\t\t\t\t\t\n\t\t\t\t\t\tput _in_rawdta_lib=\n\t\t\t\t\t\t\t_in_rawdta_table=\n\t\t\t\t\t\t\t_in_prf_table=\n\t\t\t\t\t\t\t_in_prf_table_desc=\n\t\t\t\t\t\t\t_dm_cas_lib=\t\n\t\t\t\t\t\t\t_do_append_master=\n\t\t\t\t\t\t\t_save_to_disk=;\n\t\t\t\t\t\tput \"======================| Calling the Program |=======================\";\n\t\t\t\t\t\tcall DQ_AutoProfile_Run(\n\t\t\t\t\t\t\t\t_in_rawdta_lib,\n\t\t\t\t\t\t\t\t_in_rawdta_table,\n\t\t\t\t\t\t\t\t_in_prf_table,\n\t\t\t\t\t\t\t\t_in_prf_table_desc,\n\t\t\t\t\t\t\t\t_dm_cas_lib,\n\t\t\t\t\t\t\t\t_do_append_master,\n\t\t\t\t\t\t\t\t_save_to_disk\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\n\t\t\t\trun;\n\t\t\t%end; %else\n\t\t\t%do;\n\t\t\t\t%let ap4d_ds_name = %trim(%left(%upcase(&ap4d_ds_name));\n\t\t\t\t%let ap4d_length_ds_name = %length(&ap4d_ds_name);\n\t\t\t\t%let ap4d_legnth_prefix = %length(&prfTableSuffix);\n\t\t\t\t%let ad4d_max_length_ds_name = %eval(32 - &ap4d_legnth_prefix);\n\t\t\t\t%if &ap4d_length_ds_name gt &ad4d_max_length_ds_name %then\t\n\t\t\t\t%do;\n\t\t\t\t\t%let in_prf_table = %trim(%left(%substr(&ap4d_ds_name, 1, &ad4d_max_length_ds_name)))&prfTableSuffix;\n\t\t\t\t%end; %else\t\n\t\t\t\t%do;\n\t\t\t\t\t%let in_prf_table = %trim(%left(%substr(&ap4d_ds_name, 1, &ap4d_length_ds_name)))&prfTableSuffix;\n\t\t\t\t%End;\n \n\t\t\t\t%let in_prf_tabl = %trim(%left((&in_prf_tabl)));\n\t\t\t\t\n\t\t\t\t%do_profile_results2(\n\t\t\t\t\t\t\tin_rawdta_lib \t   = &ap4d_ds_libname,\n\t\t\t\t\t\t\tin_rawdta_table   = &ap4d_ds_name,\n\t\t\t\t\t\t\tin_prf_table \t   = &in_prf_table,\n\t\t\t\t\t\t\tin_prf_table_desc = Automated Profile prepared by DIAP,\n\t\t\t\t\t\t\tdm_cas_lib \t   = &DataMartLib,\n\t\t\t\t\t\t\tdo_append_master  = &do_update_defs,\n\t\t\t\t\t\t\tsave_to_disk \t   = &save_to_disk\n\t\t\t\t\t\t\t);\n\t\t\t%end;\n\t\t%end;\n\t%end; /** \tend of ap4d_table_counter  **/\n%mend;\n \n/** FOR TESTING ***\noption mprint source notes;\n%include \"/mnt/downloads/production_code/macros/wordcnt.sas\";\n\tOPTIONS cashost=\"&_CASHOST_\" casport=&_CASPORT_;\n\tcas;\n\tcaslib _all_ assign;\nlibname test \"/mnt/downloads/blast_covid/data/100_Loading\";\n%let table_2_prep_4_prof_seq = test._variable_dictionary_bl_load#test.first_blast#test.first_blast_expanded1#test._upload_log_bl_load;\n%let dict_source_file_name = ;\n%let profile_option = PROFILE;\n%let dict_source_file_path = /Public/DM_Assets/SAS_DQ_AUTOPROFILE/Imports;\n%automated_profiling_4_DIAP(\n\tap4d_table_2_prep_4_prof_seq = &table_2_prep_4_prof_seq,\n\tap4d_dict_source_file_name = &dict_source_file_name,\n\tap4d_dict_source_file_path = &dict_source_file_path,\n\tap4d_prof_execution_option = &profile_option\n\t);\n \n*********************/\n/******************************************************************************\n \n%wrapper_import_files_into_viya\n________\n \n \nthis is the core wrapper of DIAP.\nIt takes in all the parameters and prepares and starts the process\n- to find the files in the directories\n- process the files found in the directories\n- manages the metadata of those files and cleans up the metadata\n- triggers the profiling execution .\n \n______________________________________________________________________________\n \n \nUSAGE:        see testing section on the bottom of this code\n \n______________________________________________________________________________\n \nDESCRIPTION:\n \nDIAP can handle a whole variety of external files to be uploaded into SAS/CAS.\n \n______________________________________________________________________________\n \n \nINPUT PARAMETERS AND KEYWORDS:\n \n\twifiv_inRootDir:\n\t\tdefault: /mnt/downloads/ZZ_Testing/top_folder/\n\t\tThis is the path to the top level directory that DIAP should use to start looking for\n\t\tfiles that should be uploaded.\n\twifiv_inExtension:\n\t\tdefault: *\n\t\tprovide which extensions to look for. Choose * (default) to look for any extensions.\n\twifiv_inTargetLib:\n\t\tdefault: work\n\t\tprovide a SAS or CAS libname where the files that are found in the directory should be uploaded to.\n\t\tThe system can handle SAS or CAS libnames.\n\twifiv_inUpldLogDS:\n\t\tThis parameter is not used at this point.\n\twifiv_inSbstStrgSeq:\n\t\tdefault: aeiouAEIOU\n\t\tThis sequence of characters determine which characters will be omitted if the target file name or variable name\n\t\tneeds to be truncated.\n\twifiv_meta_centralized:\n\t\tdefault: 1\n\t\t1: if set to 1, then all the information will be centrally stored in the library as specified in wifiv_libname_meta_centralized\n\t\t\tlibname. The overview of the uploaded tables are stored under\n\t\t\t\t_Upload_log ,\n\t\t\tand the overview of the variables created is stored in this table:\n\t\t\t\t_Variable_Dictionary\n\t\t0: if set to 0, then the metainformation about the upload process is stored within the chosen target library\n\t\t\tas specified in wifiv_inTargetLib.\n\t\t\tThe overview of the uploaded tables are stored under\n\t\t\t\t_Upload_log_&wifiv_inTargetLib,\n\t\t\tand the overview of the variables created is stored in this table:\n\t\t\t\t_Variable_Dictionary_&wifiv_inTargetLib\n\twifiv_libname_meta_centralized:\n\t\tdefault: DM_DtMrt\n\t\tthis parameter determines the library name where the metainformation about this process is stored in case a\n\t\tcentralized location is desired.\n\twifiv_max_table_name_length:\n\t\tdefault: 27\n\t\tdetermines the maximum table length allowed after truncation of the name. It is recommended to have a value less than\n\t\t30 for sure, since the underscore plus a counter is added in case the truncated name is the name for multiple source files.\n\twifiv_debug_mode:\n\t\tdefault: 0\n\t\t1: writes out additional detail information about the process to the log window.\n\t\t0: no additional information is written out.\n\twifiv_shp_enrich_with_zip:\n\t\tdefault: 0\n\t\t0: Shape files are read in as is.\n\t\t1: additional zip information is merged into the SHAPE files assuming that they contain lattitude and longitude\n\t\t\tinformation. It also needs a specific lookup table for the process to be available.\n\twifiv_do_profiling:\n\t\tdefault: NO\n\t\tNO: no additional processing is done for profiling purposes. This is also automatically chosen if the underlying\n\t\t\tparameters are not set that are needed for the processing of profiling.\n\t\tDICT_ONLY:  only fills in the default dictionary entries needed for the\n\t\t\tAUTOPROFILING app. The actual profiling needs to be triggered separatedly.\n\t\tPROFILE:\tThis option fills in the default dictionary entries AND also\n\t\t\ttriggers the execution of creating the actual profiles.\t\n\t\tThe last 2 options require the \"Autoprofiling\" application to be included with DIAP. For details check\n\t\tthe installation instructions.\n\twifiv_profiling_dict_location:\n\t\tThis parameter is NOT used at this point.\n\twifiv_profiling_code_location:\n\t\tThis parameter is NOT used at this point.\n \n______________________________________________________________________________\n \nNOTES: (Initials, date, summary)\n \nStephan Weigandt    20200406  First officially Released Version\n______________________________________________________________________________\n \n*******************************************************************************/\n%macro wrapper_import_files_into_viya(\n\twifiv_inRootDir \t   = /mnt/downloads/ZZ_Testing/top_folder/,\n\twifiv_inExtension   = *,\n\twifiv_inTargetLib \t   = work,\n\twifiv_inUpldLogDS = _NONE_,\n\twifiv_inSbstStrgSeq \t   = aeiouAEIOU,\n\twifiv_meta_centralized = 1,\n\twifiv_libname_meta_centralized = DM_DtMrt,\n\twifiv_max_table_name_length = 27,\n\twifiv_debug_mode = 0,\n\twifiv_shp_enrich_with_zip = 0,\n\twifiv_do_profiling = NO,\n\twifiv_profiling_dict_location = ,\n\twifiv_profiling_code_location = ,\n\twifiv_path_2_python_shape_script = ,\n\twifiv_csv_big_data_mode = 0,\n\twifiv_write_log_into_file = 1,\n\twifiv_provide_default_log_path = ,\n\twifiv_drop_missing_vars = 0,\n\twifiv_stringseq_2_cutout_from_fn = ,\n\twifiv_stringseq_2_cutout_from_vn = ,\n\twifiv_prefix_4_suspicious_src_fl = CHK,\n\twifiv_max_lgth_of_suspicious_str = 4,\n\twifiv_check_csv_4_num = 0,\n\twifiv_macro_varname_cashost = controller.viya.sas,\n\twifiv_macro_varname_casport = 5570,\n\twifiv_viyaversion = 35,\n\twifiv_install_mode_in_SASContent = 0,\n\twifiv_chck_txt_fl_4_spcl_chrct = 0,\n\twifiv_spcl_chrctr_sq2chck_in_hex = 0A#0D,\n\twifiv_spcl_chrct_chck_rplcmnt_hx = 00,\n\twifiv_make_imported_data_prsstnt = 1,\n\twifiv_force_upload_of_all_files = 0,\n\twifiv_traverse_directories = 1,\n\twifiv_skip_files_start_with_seq = ,\n\twifiv_skip_files_end_with_seq = ,\n\twifiv_fnl_tblname_from_sheetonly = 0,\n\twifiv_create_unique_target_tblnm = 1,\n\twifiv_delimiter = /,\n\twifiv_chck_4_spcl_char_in_vars = 1,\n\twifiv_fnl_ds_name_4_all_extfiles = ,\n\twifiv_diap_guided_auto_fl_loc =\n);\n \n%put INFORMATION GENERAL: &=wifiv_inExtension;\n%put INFORMATION GENERAL: &=wifiv_inTargetLib;\n%put INFORMATION GENERAL: &=wifiv_inUpldLogDS;\n \n%local\n\twifiv_temp_file\n\twifiv_temp_path_length\n\twifiv_temp_file_length\n\twifiv_temp_path_only\n\twifiv_diap_gdd_auto_fl_loc_src\n\twifiv_diap_gdd_auto_fl_loc_only\n\twifiv_temp_count\n\twifiv_diap_guided_automation\n\twifiv_gddauto_upd_fls_del_seq\n\twifiv_gddauto_upd_fls_dir_seq\n\twifiv_gddauto_upd_fls_sht_seq\n\twifiv_gddauto_upd_fls_cntt_flg\n\twifiv_gddauto_upd_fls_tgt_seq\n\t;\n \n%let fixed_width_file_definition_name = _DIAP_Special_File_Definition.csv;\n \n%let wifiv_diap_gdd_auto_fl_loc_src = ;\n%let wifiv_diap_gdd_auto_fl_loc_only = ;\n%if \"&wifiv_diap_guided_auto_fl_loc\" = \"\" %then\n%do;\n\t%let wifiv_diap_guided_automation = 0;\n\t%let wifiv_gddauto_upd_fls_del_seq = ;\n\t%let wifiv_gddauto_upd_fls_dir_seq = ;\n\t%let wifiv_gddauto_upd_fls_sht_seq = ;\n\t%let wifiv_gddauto_upd_fls_hdr_seq = ;\n\t%let wifiv_gddauto_upd_fls_cntt_flg = ;\n\t%let wifiv_gddauto_upd_fls_tgt_seq = ;\n \n\t%let length = %length(&root_directory);\n\t%let last_char = %substr(&root_directory,&length, 1);\n \n\t%if \"&last_char\" ne \"&wifiv_delimiter.\" %then\n\t\t%let root_directory = &root_directory.&wifiv_delimiter.;\n\t\n \n%end; %else\n%do;\n \n\t%let wifiv_diap_gdd_auto_fl_loc_src = %scan(&wifiv_diap_guided_auto_fl_loc, 1, \":\");\n\t%let wifiv_gdd_src_length = %length(&wifiv_diap_gdd_auto_fl_loc_src);\n\t%let wifiv_gdd_loc_length = %length(&wifiv_diap_guided_auto_fl_loc);\n\t%if &wifiv_debug_mode = 1 %then\n\t\t%put &=wifiv_diap_guided_auto_fl_loc;\n\t%if &wifiv_debug_mode = 1 %then\n\t\t%put &=wifiv_gdd_src_length;\n\t%if &wifiv_debug_mode = 1 %then\n\t\t%put &=wifiv_diap_gdd_auto_fl_loc_src;\n\t%if &wifiv_debug_mode = 1 %then\n\t\t%put &=wifiv_gdd_loc_length;\n \n\t%let wifiv_diap_gdd_auto_fl_loc_only = %substr(&wifiv_diap_guided_auto_fl_loc, %eval(&wifiv_gdd_src_length + 2));\n \n\t%let do_processing = 1;\n\t%if %upcase(\"&wifiv_diap_gdd_auto_fl_loc_src\") eq \"SASSERVER\" %then\n\t%do;\n\t\tfilename _DIAP_GA \"&wifiv_diap_gdd_auto_fl_loc_only\";\t\n\t%end; %else\n\t%do;\n\t\t%let wifiv_temp_file = %scan(&wifiv_diap_gdd_auto_fl_loc_only, -1, \"&wifiv_delimiter\");\n\t\t%let wifiv_temp_path_length = %length(&wifiv_diap_gdd_auto_fl_loc_only);\n\t\t%let wifiv_temp_file_length = %length(&wifiv_temp_file);\n\t\t%let wifiv_temp_path_only = %substr(&wifiv_diap_gdd_auto_fl_loc_only, 1, %eval(&wifiv_temp_path_length - &wifiv_temp_file_length));\n\t\t\n\t\tfilename _DIAP_GA \t\n\t\t\t\tfilesrvc \t\n\t\t\t\tfolderpath \t= \"&wifiv_temp_path_only\"\n\t\t\t\tfilename\t= \"&wifiv_temp_file\";\n\t%end;\n\t%let wifiv_diap_guided_automation = 1;\n\t%let wifiv_gddauto_upd_fls_del_seq = ;\n\t%let wifiv_gddauto_upd_fls_dir_seq = ;\n\t%let wifiv_gddauto_upd_fls_sht_seq = ;\n\t%let wifiv_gddauto_upd_fls_cntt_flg = ;\n\t%let wifiv_gddauto_upd_fls_hdr_seq = ;\n\t%let wifiv_gddauto_upd_fls_tgt_seq = ;\n\t%let wifiv_ga_full_filename_path_seq = ;\n\t%let wifiv_fllist_contains_fixed_def = 0;\n \n\tproc import\n\t\tdatafile = _DIAP_GA\n\t\tout = work._DIAP_guided_execution_order\n\t\tdbms=dlm replace;\n\t\tdelimiter = \",\" ;\n\t\tdatarow = 2;\n\t\tguessingrows = 200;\n\t \tgetnames=yes;\n\tquit;\n \n\t%let wifiv_temp_count = 0;\n\t%let wifiv_temp_target_count = 0;\n\t%let wifiv_temp_header_flag_count = 0;\n \n\tproc sql;\n\t\tselect\n\t\t\tcount(name)\n\t\tinto :wifiv_temp_count\n\t\tfrom dictionary.columns\n\t\twhere upcase(libname) = \"WORK\" and\n\t\tupcase(memname) = \"_DIAP_GUIDED_EXECUTION_ORDER\" and\n\t\tupcase(name) = \"DELIMITER_FOR_TEXT_FILES\";\n\tquit;\n\tproc sql;\n\t\tselect\n\t\t\tcount(name)\n\t\tinto :wifiv_temp_target_count\n\t\tfrom dictionary.columns\n\t\twhere upcase(libname) = \"WORK\" and\n\t\tupcase(memname) = \"_DIAP_GUIDED_EXECUTION_ORDER\" and\n\t\tupcase(name) = \"TARGET_TABLE_NAME\";\n\tquit;\n\tproc sql;\n\t\tselect\n\t\t\tcount(name)\n\t\tinto :wifiv_temp_header_flag_count\n\t\tfrom dictionary.columns\n\t\twhere upcase(libname) = \"WORK\" and\n\t\tupcase(memname) = \"_DIAP_GUIDED_EXECUTION_ORDER\" and\n\t\tupcase(name) = \"COLUMN_NAMES_IN_FIRST_ROW\";\n\tquit;\n\tproc sql;\n\t\tselect\n\t\t\tcount(full_file_name)\n\t\tinto\n\t\t\t:wifiv_fllist_contains_fixed_def\n\t\tfrom work._DIAP_guided_execution_order\n\t\twhere upcase(full_file_name) contains %upcase(\"&fixed_width_file_definition_name\");\n\tquit;\n \n\tdata work._DIAP_guided_execution_order;\n\t\tlength target_table_name $64.\n\t\t\t\tdelimiter_for_text_files $64.\n\t\t\t\tsheet_xml_json_tablename $64.;\n\t\tset work._DIAP_guided_execution_order (rename=(delimiter_for_text_files = del_ftf_old\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttarget_table_name = ttn_old\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsheet_xml_json_tablename = sheet_xjt_old));\n\t\tfile_name = scan(full_file_name, -1, \"&wifiv_delimiter\");\n\t\tdrop\n\t\t\tfile_name_length\n\t\t\tfull_name_length\n\t\t\tdel_ftf_old\n\t\t\tttn_old\n\t\t\tsheet_xjt_old\n\t\t\t;\n\t\tif missing(ttn_old) then\n\t\t\ttarget_table_name = \"_DIAP_NA_\";\n\t\telse\n\t\t\ttarget_table_name = ttn_old;\n\t\tif missing(del_ftf_old) then\n\t\t\tdelimiter_for_text_files = \"_DIAP_NA_\";\n\t\telse\n\t\t\tdelimiter_for_text_files = del_ftf_old;\n\t\tif missing(sheet_xjt_old) then\n\t\t\tsheet_xml_json_tablename = \"_DIAP_NA_\";\n\t\telse\n\t\t\tsheet_xml_json_tablename = sheet_xjt_old;\n\t\t%if &wifiv_temp_header_flag_count ne 0 %then\n\t\t%do;\n\t\t\tif missing(column_names_in_first_row) then\n\t\t\t\tcolumn_names_in_first_row = 1;\n\t\t%end;\n\t\tif missing(is_in_SAS_Content_flag) then\n\t\t\tis_in_SAS_Content_flag = 0;\n\t\tfile_name_length = length(file_name);\n\t\tfull_name_length = length(full_file_name);\n\t\tdirectory_path = substr(full_file_name, 1, full_name_length - file_name_length);\n\trun;\n\t\n \n \n%end;\n \n%let wifiv_root_dir_src = %upcase(%scan(&wifiv_inRootDir, 1, \":\"));\n%let wifiv_root_is_sas_content = 0;\n%if %upcase(\"&wifiv_root_dir_src\") eq \"SASCONTENT\" %then\n%do;\n\t%let root_directory = %scan(&wifiv_inRootDir, 2, \":\");\n\t%let wifiv_root_is_sas_content = 1;\n%end; %else\n%do;\n\t%if %upcase(\"&wifiv_root_dir_src\") eq \"SASSERVER\" %then\n\t%do;\n\t\t%let root_directory = %scan(&wifiv_inRootDir, 2, \":\");\n\t%end; %else\n\t%do;\n\t\t%let root_directory = &wifiv_inRootDir;\n\t%end;\n%end;\n%let extension = &wifiv_inExtension;\n%let target_libname = &wifiv_inTargetLib;\n \n/****\nmax_table_name_length:\nthis determines the maximum allowed table name length.\nE.g. in the case of uploading XLSX files to SAS94, the final table name\nis built by concatenating Excel-filename and Sheetname.\nSo this can easily lead to a datasetname that is too long.\nAlso take into consideration that the concatenated name for multiple tables could\npotentially the same in the abbreviated form.\nThe system checks for that and adds a counter to the table name.\nSo leave at least 2 characters for a counter.\n****/\n%let max_table_name_length = &wifiv_max_table_name_length;\n/****\nsubstitute_string_seq:\nIf the target table name is too long, this string determines which\ncharacters are taken out from the targeet name to shorten the name further,\nbefore the truncation process kicks in.\nE.g. when substitute_string_seq = aeAEoO\nthen a table name of\n\"ThisIsAVeryLongTableNameThatIsTooLong\" and a\nmax_table_name_length = 29\nwould be first changed to the following:\n\"ThisIsVryLngTblNmThtIsTLng\" which would be short enough\n****/\n%let substitute_string_seq = &wifiv_inSbstStrgSeq.;\n \n%let meta_centralized = &wifiv_meta_centralized;\n%let libname_meta_centralized = &wifiv_libname_meta_centralized;\n \n%let debug_mode = &wifiv_debug_mode;\n%let shp_enrich_with_zip = &wifiv_shp_enrich_with_zip;\n/**************\nPlease change all parameters above this section as needed.\nSee the meaning of the keywords in the headersection.\nDon't change anything below this section!!\n***************/\n \n \n%let wifiv_clean_up_worklib_inbetween = 1;\n \n%if &meta_centralized = 1 %then\n%do;\n\t%let upload_log_ds = &libname_meta_centralized.._UPLOAD_LOG;\n\t%let variable_dict_ds = &libname_meta_centralized.._VARIABLE_DICTIONARY;\n%end; %else\n%do;\n\t%let upload_log_ds = &target_libname.._UPLOAD_LOG_%upcase(&target_libname.);\n\t%let variable_dict_ds = &target_libname.._VARIABLE_DICTIONARY_%upcase(&target_libname.);\n%end;\n \n%let wifiv_target_environment = ;\n \nproc sql noprint;\n\tselect distinct(engine)\n\tinto :wifiv_target_environment\n\tfrom dictionary.libnames\n\twhere upcase(libname) = \"%upcase(&wifiv_inTargetLib)\"\n\t;\nquit;\n \n \n%if \"%upcase(&wifiv_target_environment)\" eq \"CAS\" %then\n%do;\n\t%if \"&wifiv_macro_varname_cashost\" ne  \"\" %then\n\t%do;\n\t\toptions cashost=\"&wifiv_macro_varname_cashost\" casport=&wifiv_macro_varname_casport;\n\t%end;\n/*\tcas DIAP_PRC;*/\n\tcaslib _all_ assign;\n%end;\t\n/***\nCheck that last characters is either / or \\\n***/\t\n \n \n%if \"&wifiv_provide_default_log_path\" eq \"\" %then\n\t%let wifiv_write_log_into_file = 0;\n \n \n%if &wifiv_write_log_into_file = 1 %then\n%do;\n\t%let wifiv_timestamp = ;\n\tdata _null_;\n\t\ttodaysdate = today();\n\t\tyear = year(todaysdate);\n\t\tmonth = put(month(todaysdate), z2.);\n\t\tday = put(day(todaysdate), z2.);\n\t\tnowtime = time();\n\t\thour = put(hour(nowtime), z2.);\n\t\tminute = put(minute(nowtime), z2.);\n\t\tput minute;\n\t\ttimestamp = trim(left(year))||trim(left(month))||trim(left(day))||\"_\"||trim(left(hour))||trim(left(minute));\n\t\tcall symput('wifiv_timestamp', timestamp);\n\trun;\n\t%let wifiv_timestamp = %trim(%left(&wifiv_timestamp));\n\t\n\t%if \"&wifiv_provide_default_log_path\" eq \"\" %then\n\t\t%let wifiv_provide_default_log_path = %trim(%left(&root_directory));\n \n\t%if &wifiv_install_mode_in_SASContent = 0 %then\n\t%do;\n\t\tproc printto\n\t\t\tlog=\"&wifiv_provide_default_log_path.&target_libname._&wifiv_timestamp._DIAP_upload_run.log\";\n\t\tquit;\n\t%end; %else\n\t%if &wifiv_install_mode_in_SASContent = 1 %then\n\t%do;\n\t\tfilename logfile\n\t\t\tfilesrvc\n\t\t\tfolderpath = \"&wifiv_provide_default_log_path\"\n\t\t\tfilename = \"&target_libname._&wifiv_timestamp._DIAP_upload_run.log\";\n \n\t\tproc printto\n\t\t\tlog=logfile new;\n\t\tquit;\n\t%end;\n\t\n%end;\n/***\noverview_ds:\n\t\tprovide the location of the SAS dataset, that contains the list\n\t\tof all found files in the directory.\n***/\n\t%let overview_ds = work._file_overview;\n\t%let batchsize = 100;\t\n\t\n\tproc datasets lib=%scan(&overview_ds, 1, '.');\n\t\tdelete %scan(&overview_ds, 2, '.');\n\tquit;\n\t\n/***\nIn case CUSTOM is selected make sure that to check for the files, all the extensions are checked for\n****/\n\t%let extension_pass_through = &extension;\n\t%if \"%upcase(&extension)\" eq \"CUSTOM\" %then\t\n\t\t%let extension_pass_through = *;\n \n\t%if &wifiv_diap_guided_automation = 1 %then\n\t%do;\n \n\t\tdata &overview_ds;\n\t\t\tset work._DIAP_guided_execution_order;\n\t\trun;\n \n\t%end; %else\n\t%do;\n\t\t%list_all_files(\n\t\t\t&root_directory,\n\t\t\t&extension_pass_through,\n\t\t\t&overview_ds,\n\t\t\tlaf_debug_mode = &debug_mode,\n\t\t\tlaf_traverse_directories = &wifiv_traverse_directories,\n\t\t\tlaf_directory_separator = &wifiv_delimiter.,\n\t\t\tlaf_is_sas_content_directory = &wifiv_root_is_sas_content\t\t\t\n\t\t\t);\n\t%end;\n\t%if \"%upcase(&wifiv_do_profiling)\" = \"DICT_ONLY\" or\n\t\t\"%upcase(&wifiv_do_profiling)\" = \"PROFILE\" or\n\t\t\"%upcase(&wifiv_do_profiling)\" = \"PROFILE_ONLY_NO_UPLOAD\" %then\n\t%do;\n\t\t%if \"&wifiv_profiling_dict_location\" eq \"\" %then\n\t\t%do;\n\t\t\t%let wifiv_do_profiling = NO;\n\t\t%end; %else\n\t\t%do;\n\t\t\tfilename PrfRslts \t/* limited to 8 characters */\n\t\t\t\t\tfilesrvc \t/* SAS Viya Service to load the code stored within Viya */\n\t\t\t\t\tfolderpath \t= \"&prfl_cd_lctn_in_content_area\"\n\t\t\t\t\tfilename\t= 'DQ_AutoDataProfiling_Exec_4.sas';\n\t\t\t%include PrfRslts;\n\t\t\tfilename _TblDict \t/* limited to 8 characters */\n\t\t\t\t\tfilesrvc \t/* SAS Viya Service to load the code stored within Viya */\n\t\t\t\t\tfolderpath \t= \"&prfl_cd_lctn_in_content_area\"\n\t\t\t\t\tfilename\t= 'DQ_AutoDataProfiling_TableDict_4.sas';\n\t\t\t%include _TblDict;\n\t\t%end;\n\t%end;\n\t\n \n \n\t%if %sysfunc(exist(&overview_ds)) ne 0 %then\n\t%do;\n \n/****\nprepare for fixed-width file import\n****/\n\t\t%let diap_fixed_width_file_def_seq = ;\n\t\t%let fixed_file_ds_name_4_processing = ;\n \n\t\t%local\n\t\t\twifiv_skip_files_start_count\n\t\t\twifiv_skip_files_end_count\n\t\t\t;\n \n\t\tproc sql;\n\t\t\tselect\n\t\t\t\tfull_file_name\n\t\t\tinto\n\t\t\t\t:diap_fixed_width_file_def_seq separated by ' #'\n\t\t\tfrom\t\n\t\t\t\t&overview_ds\n\t\t\twhere\n\t\t\t\tupcase(file_name) = \"%upcase(&fixed_width_file_definition_name)\"\n\t\t\t;\n\t\tquit;\n\t\t%let fixed_file_width_def_count = %wordcnt(&diap_fixed_width_file_def_seq, '#');\n\t\t%put &=fixed_file_width_def_count;\n \n \n\t\t%if \"&wifiv_skip_files_start_with_seq\" ne \"\" or\n\t\t\t\"&wifiv_skip_files_end_with_seq\" ne \"\" %then\n\t\t%do;\n\t\t\t%let wifiv_skip_files_start_count = %wordcnt(&wifiv_skip_files_start_with_seq, \"#\");\n\t\t\t%let wifiv_skip_files_end_count = %wordcnt(&wifiv_skip_files_end_with_seq, \"#\");\n \n \n \n\t\t\tdata &overview_ds.;\n\t\t\t\tset &overview_ds;\n\t\t\t\tlength_name = length(file_name);\n\t\t\t\tdrop length_name;\n\t\t\t\t%do wifiv_skip_counter = 1 %to &wifiv_skip_files_start_count;\n\t\t\t\t\t%let wifiv_skip_files_start_with = %scan(&wifiv_skip_files_start_with_seq, &wifiv_skip_counter, \"#\");\n\t\t\t\t\t%let wifiv_skip_files_start_length = %length(&wifiv_skip_files_start_with);\n\t\t\t\t\tif length_name >= &wifiv_skip_files_start_length then\n\t\t\t\t\tdo;\n\t\t\t\t\t\tif upcase(substr(file_name, 1, &wifiv_skip_files_start_length)) = %upcase(\"&wifiv_skip_files_start_with\") then delete;\t\t\t\n\t\t\t\t\tend;\n\t\t\t\t%end;\n\t\t\t\t%do wifiv_skip_counter = 1 %to &wifiv_skip_files_end_count;\n\t\t\t\t\t%let wifiv_skip_files_end_with = %scan(&wifiv_skip_files_end_with_seq, &wifiv_skip_counter, \"#\");\n\t\t\t\t\t%let wifiv_skip_files_end_length = %length(&wifiv_skip_files_end_with);\n\t\t\t\t\tif length_name >= &wifiv_skip_files_end_length then\n\t\t\t\t\tdo;\n\t\t\t\t\t\tif upcase(substr(file_name, length_name - &wifiv_skip_files_end_length + 1, &wifiv_skip_files_end_length)) = %upcase(\"&wifiv_skip_files_end_with\") then delete;\t\t\t\n\t\t\t\t\tend;\n\t\t\t\t%end;\n\t\t\trun;\t\t\t\n\t\t%end;\n\t\t\n\t\t%if &fixed_file_width_def_count ne 0 %then\n\t\t%do;\n\t\t\t%do fixed_file_width_def_counter = 1 %to &fixed_file_width_def_count;\n\t\t\t\t%let diap_fixed_width_file_def = %scan(&diap_fixed_width_file_def_seq, &fixed_file_width_def_counter, '#');\n\t\t\t\tproc import\n\t\t\t\t\tdatafile=\"&diap_fixed_width_file_def\"\n\t\t\t\t\tout=work._fixed_file_definition_&fixed_file_width_def_counter\n\t\t\t\t\tdbms=dlm replace;\n\t\t\t\t\tdelimiter = \",\" ;\n\t\t\t\t\tdatarow = 2;\n\t\t\t\t\tguessingrows = 200;\n\t\t\t\t \tgetnames=yes;\n\t\t\t\tquit;\n\t\t\t%end;\n\t\t\t%let fixed_file_ds_name_4_processing = work._fixed_file_definition_all_comb;\n\t\t\tdata &fixed_file_ds_name_4_processing;\n\t\t\t\tset\n\t\t\t\t%do fixed_file_width_def_counter = 1 %to &fixed_file_width_def_count;\n\t\t\t\t\twork._fixed_file_definition_&fixed_file_width_def_counter\n\t\t\t\t%end;\n\t\t\t\t;\n\t\t\trun;\n \n\t\t\tproc sort\n\t\t\t\tdata = &fixed_file_ds_name_4_processing nodupkey;\n\t\t\t\tby\n\t\t\t\t\tfilename\n\t\t\t\t\tdirectory\n\t\t\t\t\tvariable_name\n\t\t\t\t\t;\n\t\t\tquit;\n\t\t\t\n\t\t\tdata work._fixed_file_definition_red;\n\t\t\t\tset &fixed_file_ds_name_4_processing;\n\t\t\t\tby filename directory;\n\t\t\t\tif first.directory;\n\t\t\trun;\n\t\t\t%let ind_fn_4_fixed_width_seq = ;\n\t\t\t%let is_full_fn_indicator_seq = ;\n\t\t\t%let ind_dir_4_fixed_width_seq = ;\n\t\t\t\n\t\t\tproc sql;\n\t\t\t\tselect\n\t\t\t\t\tfilename,\n\t\t\t\t\tdirectory\n\t\t\t\tinto\n\t\t\t\t\t:ind_fn_4_fixed_width_seq separated by ' #',\n\t\t\t\t\t:ind_dir_4_fixed_width_seq separated by ' #'\n\t\t\t\tfrom\t\n\t\t\t\t\twork._fixed_file_definition_red\n\t\t\t\t;\n\t\t\tquit;\n\t\t\t%let fixed_filename_count = %wordcnt(&ind_fn_4_fixed_width_seq, '#');\n/****\nnow check for how many fixed file are occuring\n*****/\n\t\t\t%if &wifiv_debug_mode = 1 %then\n\t\t\t%do;\n\t\t\t\tdata &overview_ds._fxd_backup;\n\t\t\t\t\tset &overview_ds;\n\t\t\t\trun;\n\t\t\t%end;\n\t\t\tdata &overview_ds._fixed_width\n\t\t\t\t&overview_ds (drop = filename_as_in_fixed_width_def);\n\t\t\t\tlength\n\t\t\t\t\tfilename_as_in_fixed_width_def $100.;\n\t\t\t\tset &overview_ds;\n\t\t\t\tdrop switch;\n\t\t\t\tswitch = 0;\n\t\t\t\t%do fixed_filename_counter = 1 %to &fixed_filename_count;\n\t\t\t\t\t%let filename = %scan(&ind_fn_4_fixed_width_seq, &fixed_filename_counter, '#' );\n\t\t\t\t\t%let fixed_file_dir = %scan(&ind_dir_4_fixed_width_seq, &fixed_filename_counter, '#' );\n\t\t\t\t\t%let filename_length = %length(%trim(%left(&filename)));\n\t\t\t\t\tif substr(upcase(file_name), 1, &filename_length) = \"%trim(%left(%upcase(&filename)))\" and\n\t\t\t\t\t\ttrim(left(upcase(directory_path))) = \"%trim(%left(%upcase(&fixed_file_dir)))\" then\n\t\t\t\t\tdo;\n\t\t\t\t\t\tfilename_as_in_fixed_width_def = \"%trim(%left(&filename))\";\n\t\t\t\t\t\tswitch = 1;\n\t\t\t\t\tend;\n\t\t\t\t%end;\n\t\t\t\tif switch then\n\t\t\t\t\toutput &overview_ds._fixed_width;\n\t\t\t\telse\n\t\t\t\t\toutput &overview_ds;\n\t\t\trun;\n \n \n \n\t\t\t\n\t\t\tproc sort\n\t\t\t\tdata = &fixed_file_ds_name_4_processing nodupkey;\n\t\t\t\tby\n\t\t\t\t\tfilename\n\t\t\t\t\tdirectory\n\t\t\t\t\tvariable_start_position\n\t\t\t\t\tvariable_name\n\t\t\t\t\t;\n\t\t\tquit;\n \n \n\t\t\tdata work._loop_overview_ds_fwf;\n\t\t\t\tset &overview_ds._fixed_width;\n\t\t\t\tunique_id = _n_;\n\t\t\trun;\n\t\n\t\t\t%let number_of_rows_fwf = 0;\n\t\t\tproc sql noprint;\n\t\t\t\tselect\n\t\t\t\t\tnobs\n\t\t\t\tinto\t\n\t\t\t\t\t:number_of_rows_fwf\n\t\t\t\tfrom\t\n\t\t\t\t\tdictionary.tables\n\t\t\t\twhere\n\t\t\t\t\tlibname = \"WORK\" and\n\t\t\t\t\tmemname = \"_LOOP_OVERVIEW_DS_FWF\";\n\t\t\tquit;\n\t\n\t\t\t%if &number_of_rows_fwf ne 0 %then\n\t\t\t%do;\n \n\t\t\t\t%let mod_fwf = %sysfunc(mod(&number_of_rows_fwf,&batchsize));\n\t\t\t\t%let loop_size_fwf = %eval(&number_of_rows_fwf / &batchsize);\n\t\t\t\t\n\t\t\t\t%do batch_counter_fwf = 0 %to &loop_size_fwf;\n\t\t\t\t\t%let full_filename_path_seq_fwf = ;\n\t\t\t\t\t%let directory_path_seq_fwf = ;\n\t\t\t\t\t%let fn_as_in_fixed_width_def_seq = ;\n\t\t\t\t\tproc sql noprint;\n\t\t\t\t\t\tselect\n\t\t\t\t\t\t\tfull_file_name,\n\t\t\t\t\t\t\tdirectory_path,\n\t\t\t\t\t\t\tfilename_as_in_fixed_width_def\n\t\t\t\t\t\tinto\n\t\t\t\t\t\t\t:full_filename_path_seq_fwf separated by \"# \",\n\t\t\t\t\t\t\t:directory_path_seq_fwf separated by \"# \",\n\t\t\t\t\t\t\t:fn_as_in_fixed_width_def_seq separated by \"# \"\n\t\t\t\t\t\tfrom\n\t\t\t\t\t\t\twork._loop_overview_ds_fwf\n\t\t\t\t\t\twhere\n\t\t\t\t\t\t\tunique_id gt %eval(&batch_counter_fwf*&batchsize) and\t\t\n\t\t\t\t\t\t\tunique_id le %eval(%eval(&batch_counter_fwf +1)*&batchsize);\n\t\t\t\t\tquit;\n \n\t\t\t\t\t%if &wifiv_clean_up_worklib_inbetween = 1 %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\tproc datasets lib = work nolist;\n\t\t\t\t\t\t\tdelete\n\t\t\t\t\t\t\t\tvarnames_:\n\t\t\t\t\t\t\t\tget_table_info_:\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\tquit;\n\t\t\t\t\t%end;\n\t\t\n\t\t\t\t\t%put INFORMATION GENERAL: This is batch # &batch_counter_fwf &=full_filename_path_seq_fwf;\n\t\t\t\t\t%put INFORMATION GENERAL: This is batch # &batch_counter_fwf &=directory_path_seq_fwf;\n\t\t\t\t\t%write_out_files_2_libname(\n\t\t\t\t\t\t&full_filename_path_seq_fwf,\n\t\t\t\t\t\t&target_libname,\n\t\t\t\t\t\t&fn_as_in_fixed_width_def_seq,\n\t\t\t\t\t\twof2l_directory_path_seq = &directory_path_seq_fwf,\n\t\t\t\t\t\twof2l_upload_log_ds = &upload_log_ds,\n\t\t\t\t\t\twof2l_shp_enrich_with_zip = &shp_enrich_with_zip,\n\t\t\t\t\t\twof2l_variable_dict_dataset = &variable_dict_ds,\n\t\t\t\t\t\twof2l_debug_mode = &debug_mode,\n\t\t\t\t\t\twof2l_max_name_length = &max_table_name_length,\n\t\t\t\t\t\twof2l_substitute_string_seq = &substitute_string_seq,\n\t\t\t\t\t\twof2l_fixed_file_definition_ds = &fixed_file_ds_name_4_processing ,\n\t\t\t\t\t\twof2l_do_profiling = &wifiv_do_profiling,\n\t\t\t\t\t\twof2l_profile_dict_location = &wifiv_profiling_dict_location,\n\t\t\t\t\t\twof2l_path_2_python_shape_script = &wifiv_path_2_python_shape_script,\n\t\t\t\t\t\twof2l_drop_missing_vars = &wifiv_drop_missing_vars,\n\t\t\t\t\t\twof2l_stringseq_2_cutout_from_fn = &wifiv_stringseq_2_cutout_from_fn,\n\t\t\t\t\t\twof2l_stringseq_2_cutout_from_vn = &wifiv_stringseq_2_cutout_from_vn,\n\t\t\t\t\t\twof2l_prefix_4_suspicious_src_fl = &wifiv_prefix_4_suspicious_src_fl,\n\t\t\t\t\t\twof2l_max_lgth_of_suspicious_str = &wifiv_max_lgth_of_suspicious_str,\n\t\t\t\t\t\twof2l_check_csv_4_num = &wifiv_check_csv_4_num,\n\t\t\t\t\t\twof2l_viyaversion = &wifiv_viyaversion,\n\t\t\t\t\t\twof2l_chck_txt_fl_4_spcl_chrct = &wifiv_chck_txt_fl_4_spcl_chrct,\n\t\t\t\t\t\twof2l_spcl_chrctr_sq2chck_in_hex = &wifiv_spcl_chrctr_sq2chck_in_hex,\n\t\t\t\t\t\twof2l_spcl_chrct_chck_rplcmnt_hx = &wifiv_spcl_chrct_chck_rplcmnt_hx,\n\t\t\t\t\t\twof2l_make_imported_data_prsstnt = &wifiv_make_imported_data_prsstnt,\n\t\t\t\t\t\twof2l_force_upload_of_all_files = &wifiv_force_upload_of_all_files,\n\t\t\t\t\t\twof2l_skip_files_start_with_seq = &wifiv_skip_files_start_with_seq ,\n\t\t\t\t\t\twof2l_skip_files_end_with_seq = &wifiv_skip_files_end_with_seq,\n\t\t\t\t\t\twof2l_fnl_tblname_from_sheetonly = &wifiv_fnl_tblname_from_sheetonly,\n\t\t\t\t\t\twof2l_create_unique_target_tblnm = &wifiv_create_unique_target_tblnm,\n\t\t\t\t\t\twof2l_delimiter = &wifiv_delimiter,\n\t\t\t\t\t\twof2l_chck_4_spcl_char_in_vars = &wifiv_chck_4_spcl_char_in_vars,\n\t\t\t\t\t\twof2l_fnl_ds_name_4_all_extfiles = &wifiv_fnl_ds_name_4_all_extfiles,\n\t\t\t\t\t\twof2l_diap_guided_automation = &wifiv_diap_guided_automation,\n\t\t\t\t\t\twof2l_gddauto_upd_fls_del_seq = &wifiv_gddauto_upd_fls_del_seq,\n\t\t\t\t\t\twof2l_gddauto_upd_fls_sht_seq = &wifiv_gddauto_upd_fls_sht_seq,\n\t\t\t\t\t\twof2l_gddauto_upd_fls_cntt_flg = &wifiv_gddauto_upd_fls_cntt_flg,\n\t\t\t\t\t\twof2l_gddauto_upd_fls_hdr_seq = &wifiv_gddauto_upd_fls_hdr_seq,\n\t\t\t\t\t\twof2l_gddauto_upd_fls_tgt_seq = &wifiv_gddauto_upd_fls_tgt_seq\n\t\t\t\t\t\t\n\t\t\t\t\t\t);\n\t\t\t\t%end;\n\t\t\t%end;\n\t\t\t%else\n\t\t\t\t%put INFORMATION ALERT: Did NOT find any matching definitions in the Special File Definition;\n\t\t\t\t%let fixed_file_ds_name_4_processing = ;\n\t\t\t\n \n\t\t%end; /* end of Fixed width check/processing */\n \n \n \n\t\tdata work._loop_overview_ds;\n\t\t\tset &overview_ds;\n\t\t\tunique_id = _n_;\n\t\trun;\n \n\t\t%let number_of_rows = 0;\n\t\tproc sql noprint;\n\t\t\tselect\n\t\t\t\tnobs\n\t\t\tinto\t\n\t\t\t\t:number_of_rows\n\t\t\tfrom\t\n\t\t\t\tdictionary.tables\n\t\t\twhere\n\t\t\t\tlibname = \"WORK\" and\n\t\t\t\tmemname = \"_LOOP_OVERVIEW_DS\";\n\t\tquit;\n \n\t\t%let mod = %sysfunc(mod(&number_of_rows,&batchsize));\n\t\t%let loop_size = %eval(&number_of_rows / &batchsize);\n\t\t%do batch_counter = 0 %to &loop_size;\n\t\t\t%let full_filename_path_seq = ;\n\t\t\t%let directory_path_seq = ;\n\t\t\tproc sql noprint;\n\t\t\t\tselect\n\t\t\t\t\tfull_file_name,\n\t\t\t\t\tis_in_SAS_Content_flag,\n\t\t\t\t\t%if &wifiv_diap_guided_automation = 1 %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\tsheet_xml_json_tablename,\n\t\t\t\t\t\t%if &wifiv_temp_count ne 0 %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tdelimiter_for_text_files,\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t%if &wifiv_temp_header_flag_count ne 0 %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\tcolumn_names_in_first_row,\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t%if &wifiv_temp_target_count ne 0 %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\ttarget_table_name,\n\t\t\t\t\t\t%end;\n\t\t\t\t\t%end;\n\t\t\t\t\tdirectory_path\n\t\t\t\tinto\n\t\t\t\t\t:full_filename_path_seq separated by \"# \",\n\t\t\t\t\t:wifiv_gddauto_upd_fls_cntt_flg separated by \" #\" ,\n\t\t\t\t\t%if &wifiv_diap_guided_automation = 1 %then\n\t\t\t\t\t%do;\n\t\t\t\t\t\t:wifiv_gddauto_upd_fls_sht_seq separated by \" #\" ,\n\t\t\t\t\t\t%if &wifiv_temp_count ne 0 %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t:wifiv_gddauto_upd_fls_del_seq separated by \" #\",\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t%if &wifiv_temp_header_flag_count ne 0 %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t:wifiv_gddauto_upd_fls_hdr_seq separated by \" #\",\n\t\t\t\t\t\t%end;\n\t\t\t\t\t\t%if &wifiv_temp_target_count ne 0 %then\n\t\t\t\t\t\t%do;\n\t\t\t\t\t\t\t:wifiv_gddauto_upd_fls_tgt_seq separated by \" #\",\n\t\t\t\t\t\t%end;\n\t\t\t\t\t%end;\n\t\t\t\t\t:directory_path_seq separated by \"# \"\n\t\t\t\tfrom\n\t\t\t\t\twork._loop_overview_ds\n\t\t\t\twhere\n\t\t\t\t\tunique_id gt %eval(&batch_counter*&batchsize) and\t\t\n\t\t\t\t\tunique_id le %eval(%eval(&batch_counter +1)*&batchsize);\n\t\t\tquit;\n \n\t\t\t%put INFORMATION GENERAL: This is batch # &batch_Counter &=full_filename_path_seq;\n\t\t\t%put INFORMATION GENERAL: This is batch # &batch_Counter &=directory_path_seq;\n\t\t\t%if &wifiv_clean_up_worklib_inbetween = 1 %then\n\t\t\t%do;\n\t\t\t\tproc datasets lib = work nolist;\n\t\t\t\t\tdelete\n\t\t\t\t\t\tvarnames_:\n\t\t\t\t\t\tget_table_info_:\n\t\t\t\t\t\t;\n\t\t\t\tquit;\n\t\t\t%end;\n\t\t\t%write_out_files_2_libname(\n\t\t\t\t&full_filename_path_seq,\n\t\t\t\t&target_libname,\n\t\t\t\t,\n\t\t\t\twof2l_directory_path_seq = &directory_path_seq,\n\t\t\t\twof2l_upload_log_ds = &upload_log_ds,\n\t\t\t\twof2l_debug_mode = &debug_mode,\n\t\t\t\twof2l_shp_enrich_with_zip = &shp_enrich_with_zip,\n\t\t\t\twof2l_variable_dict_dataset = &variable_dict_ds,\n\t\t\t\twof2l_max_name_length = &max_table_name_length,\n\t\t\t\twof2l_substitute_string_seq = &substitute_string_seq,\n\t\t\t\twof2l_do_profiling = &wifiv_do_profiling,\n\t\t\t\twof2l_profile_dict_location = &wifiv_profiling_dict_location,\n\t\t\t\twof2l_path_2_python_shape_script = &wifiv_path_2_python_shape_script,\n\t\t\t\twof2l_csv_big_data_mode = &wifiv_csv_big_data_mode,\n\t\t\t\twof2l_drop_missing_vars = &wifiv_drop_missing_vars,\n\t\t\t\twof2l_stringseq_2_cutout_from_fn = &wifiv_stringseq_2_cutout_from_fn,\n\t\t\t\twof2l_stringseq_2_cutout_from_vn = &wifiv_stringseq_2_cutout_from_vn,\n\t\t\t\twof2l_prefix_4_suspicious_src_fl = &wifiv_prefix_4_suspicious_src_fl,\n\t\t\t\twof2l_max_lgth_of_suspicious_str = &wifiv_max_lgth_of_suspicious_str,\n\t\t\t\twof2l_check_csv_4_num = &wifiv_check_csv_4_num,\n\t\t\t\twof2l_viyaversion = &wifiv_viyaversion,\n\t\t\t\twof2l_chck_txt_fl_4_spcl_chrct = &wifiv_chck_txt_fl_4_spcl_chrct,\n\t\t\t\twof2l_spcl_chrctr_sq2chck_in_hex = &wifiv_spcl_chrctr_sq2chck_in_hex,\n\t\t\t\twof2l_spcl_chrct_chck_rplcmnt_hx = &wifiv_spcl_chrct_chck_rplcmnt_hx,\n\t\t\t\twof2l_make_imported_data_prsstnt = &wifiv_make_imported_data_prsstnt,\n\t\t\t\twof2l_force_upload_of_all_files = &wifiv_force_upload_of_all_files,\n\t\t\t\twof2l_skip_files_start_with_seq = &wifiv_skip_files_start_with_seq ,\n\t\t\t\twof2l_skip_files_end_with_seq = &wifiv_skip_files_end_with_seq,\n\t\t\t\twof2l_fnl_tblname_from_sheetonly = &wifiv_fnl_tblname_from_sheetonly,\n\t\t\t\twof2l_create_unique_target_tblnm = &wifiv_create_unique_target_tblnm,\n\t\t\t\twof2l_delimiter = &wifiv_delimiter,\n\t\t\t\twof2l_chck_4_spcl_char_in_vars = &wifiv_chck_4_spcl_char_in_vars,\n\t\t\t\twof2l_fnl_ds_name_4_all_extfiles = &wifiv_fnl_ds_name_4_all_extfiles,\n\t\t\t\twof2l_diap_guided_automation = &wifiv_diap_guided_automation,\n\t\t\t\twof2l_gddauto_upd_fls_del_seq = &wifiv_gddauto_upd_fls_del_seq,\n\t\t\t\twof2l_gddauto_upd_fls_sht_seq = &wifiv_gddauto_upd_fls_sht_seq,\n\t\t\t\twof2l_gddauto_upd_fls_cntt_flg = &wifiv_gddauto_upd_fls_cntt_flg,\n\t\t\t\twof2l_gddauto_upd_fls_hdr_seq = &wifiv_gddauto_upd_fls_hdr_seq,\n\t\t\t\twof2l_gddauto_upd_fls_tgt_seq = &wifiv_gddauto_upd_fls_tgt_seq\n\t\t\t\t);\n\t\t%end;\n\t%end; %else\n\t%do;\n\t\t%put INFORMATION ALERT: Directory does NOT exist!;\n\t%end;\n\t%if &wifiv_write_log_into_file = 1 %then\n\t%do;\n\t\tproc printto;\n\t\tquit;\n\t%end;\n/*\t%if \"%upcase(&wifiv_target_environment)\" eq \"CAS1\" %then*/\n/*\t%do;*/\n/*\t\tcas DIAP_PRC disconnect ;*/\n/*\t\tcas DIAP_PRC terminate ;*/\n/*\t%end;*/\n%mend wrapper_import_files_into_viya;\n \n/** FOR TESTING ***\noption mprint source notes;\n%include \"/mnt/downloads/production_code/wrapper/development_wrapper/00_all_code_pieces_import_files_into_viya_4_execution.sas\";\n\tOPTIONS cashost=\"&_CASHOST_\" casport=&_CASPORT_;\n\tcas;\n\tcaslib _all_ assign;\n \n%let root_directory = /mnt/downloads/ZZ_Testing/top_folder/;\n%let extension = *;\n%let target_libname = work;\n%let substitute_string_seq = aeiouAEIOU;\n%let meta_centralized = 0;\n%let libname_meta_centralized = work;\n%let max_table_name_length = 27;\n%let shp_enrich_with_zip = 0;\n%let debug_mode = 1;\n%let profiling_execution_option = NO;\n%let prfl_dict_lctn_in_content_area = ;\n%let prfl_cd_lctn_in_content_area = ;\n \n\t%wrapper_import_files_into_viya(\n\t\twifiv_inRootDir \t   = &root_directory,\n\t\twifiv_inExtension   = &extension,\n\t\twifiv_inTargetLib \t   = &target_libname,\n\t\twifiv_inUpldLogDS = _NONE_,\n\t\twifiv_inSbstStrgSeq \t   = &substitute_string_seq,\n\t\twifiv_meta_centralized = &meta_centralized,\n\t\twifiv_libname_meta_centralized = &libname_meta_centralized,\n\t\twifiv_max_table_name_length = &max_table_name_length,\n\t\twifiv_debug_mode = &debug_mode,\n\t\twifiv_shp_enrich_with_zip = &shp_enrich_with_zip,\n\t\twifiv_do_profiling = &profiling_execution_option,\n\t\twifiv_profiling_dict_location = &prfl_dict_lctn_in_content_area,\n\t\twifiv_profiling_code_location = &prfl_cd_lctn_in_content_area\n\t\t);\n \n \n*********************/\n/******************************************************************************\n \n%DIAP_handling_missings_vars\n________\n \n \ndeletes completely missing variables from datasets\n \n______________________________________________________________________________\n \n \nUSAGE:                         see testing section on the bottom of this code\n \n______________________________________________________________________________\n \nDESCRIPTION:\n \nThis macro checks all the variables of a provided dataset for completely missing\n\tvariables. There are 2 modes for dropping of those variables, either all of them, or\nonly the ones that contains a certain string in their variable name.\n______________________________________________________________________________\n \n \nINPUT PARAMETERS AND KEYWORDS:\n \n\tdhm_missing_handling_option:\n\t\t1: drop any variable that contains only missing values\n\t\t2: drop only those variables that contain a certain string\n\t\tas provided in parameter dhm_stg_2_chk_var_b4_drop\n\tdhm_dataset_2_check\n\t\tprovide the dataset name that needs to be checked for missing variables\t\t\t\t\n\tdhm_dataset_2_write_out_results\n\t\tprovide dataset name where the results of the missing variables is stored\n\tdhm_stg_2_chk_var_b4_drop\n\t\tchecks the variable name for this string sequence before dropping\n\t\tdefault: ZZ_MISSING_VARNAME_\t\n______________________________________________________________________________\n \nNOTES: (Initials, date, summary)\n \nStephan Weigandt    20200909  First officially Released Version\n______________________________________________________________________________\n \n*******************************************************************************/\n%macro DIAP_handling_missings_vars(\n\tdhm_missing_handling_option = 1,\n\tdhm_dataset_2_check = ,\n\tdhm_dataset_2_check_output = ,\n\tdhm_dataset_2_write_out_results = ,\n\tdhm_stg_2_chk_var_b4_drop = ZZ_MISSING_VARNAME_\n\t);\n \n\t%local\n\t\tdhm_drop_seq\n\t\tdhm_count_num\n\t\tdhm_count_char\n\t\t;\n\t%let dhm_drop_seq = ;\n\t%let dhm_count_num = 0;\n\t%let dhm_count_char = 0;\n\tproc sql noprint;\n\t\tselect\n\t\t\tcount(type)\n\t\tinto\n\t\t\t:dhm_count_num\n\t\tfrom\n\t\t\tdictionary.columns\n\t\twhere\n\t\t\tupcase(libname) = \"%upcase(%trim(%left(%scan(&dhm_dataset_2_check, 1, '.'))))\" and\n\t\t\tupcase(memname) = \"%upcase(%trim(%left(%scan(&dhm_dataset_2_check, 2, '.'))))\" and\n\t\t\tupcase(type) = \"NUM\"\n\t\t;\n\t\tselect\n\t\t\tcount(type)\n\t\tinto\n\t\t\t:dhm_count_char\n\t\tfrom\n\t\t\tdictionary.columns\n\t\twhere\n\t\t\tupcase(libname) = \"%upcase(%trim(%left(%scan(&dhm_dataset_2_check, 1, '.'))))\" and\n\t\t\tupcase(memname) = \"%upcase(%trim(%left(%scan(&dhm_dataset_2_check, 2, '.'))))\" and\n\t\t\tupcase(type) = \"CHAR\"\n\t\t;\n\tquit;\n\t%let dhm_count_char = %trim(%left(&dhm_count_char));\n\t%let dhm_count_num = %trim(%left(&dhm_count_num));\n \n\tproc iml;\n\t\tuse &dhm_dataset_2_check;\n\t\t%if &dhm_count_num > 0 %then\n\t\t%do;\n\t\t\tread all var _NUM_ into x[colname=nNames];\n\t\t\tn = countn(x,\"col\");\n\t\t\tnmiss = countmiss(x,\"col\");\n\t\t%end;\t\n\t\t%if &dhm_count_char > 0 %then\n\t\t%do;\n\t\t\tread all var _CHAR_ into x[colname=cNames];\n\t\t\tc = countn(x,\"col\");\n\t\t\tcmiss = countmiss(x,\"col\");\n\t\t%end;\t\n\t\tclose &dhm_dataset_2_check;\n\t\t%if &dhm_count_num > 0  and\n\t\t\t&dhm_count_char > 0 %then\n\t\t%do;\n\t\t\t/* combine results for num and char into a single table */\n\t\t\tNames = cNames || nNames;\n\t\t\trNames = {\"Missing\", \"Not_Missing\"};\n\t\t\tcnt = (cmiss // c) || (nmiss // n);\n\t\t\tprint cnt[r=rNames c=Names label=\"\"];\n\t\n\t\t\tcreate &dhm_dataset_2_write_out_results\n\t\t\t\tfrom cnt[r=rNames c=Names];\n\t\t\t\tappend from cnt[r=rNames];\n\t\t\tclose;\n\t\t%end;\n\t\t%if &dhm_count_num = 0  and\n\t\t\t&dhm_count_char > 0 %then\n\t\t%do;\n\t\t\t/* combine results for num and char into a single table */\n\t\t\tNames = cNames ;\n\t\t\trNames = {\"Missing\", \"Not_Missing\"};\n\t\t\tcnt = (cmiss // c) ;\n\t\t\tprint cnt[r=rNames c=Names label=\"\"];\n\t\n\t\t\tcreate &dhm_dataset_2_write_out_results\n\t\t\t\tfrom cnt[r=rNames c=Names];\n\t\t\t\tappend from cnt[r=rNames];\n\t\t\tclose;\n\t\t%end;\n\t\t%if &dhm_count_num > 0  and\n\t\t\t&dhm_count_char = 0 %then\n\t\t%do;\n\t\t\t/* combine results for num and char into a single table */\n\t\t\tNames = nNames;\n\t\t\trNames = {\"Missing\", \"Not_Missing\"};\n\t\t\tcnt = (nmiss // n);\n\t\t\tprint cnt[r=rNames c=Names label=\"\"];\n\t\n\t\t\tcreate &dhm_dataset_2_write_out_results\n\t\t\t\tfrom cnt[r=rNames c=Names];\n\t\t\t\tappend from cnt[r=rNames];\n\t\t\tclose;\n\t\t%end;\n\tquit;\n\tproc transpose\n\t\tdata = &dhm_dataset_2_write_out_results\n\t\tout = &dhm_dataset_2_write_out_results._t;\n\t\tid  rnames;\n\tquit;\n \n\t%if &dhm_missing_handling_option = 1 %then\n\t%do;\n/****\ndelete all occuring missing vars\n****/\n\t\tproc sql;\n\t\t\tselect\n\t\t\t\t_NAME_\n\t\t\tinto\n\t\t\t\t:dhm_drop_seq separated by \" \"\n\t\t\tfrom\n\t\t\t\t&dhm_dataset_2_write_out_results._t\n\t\t\twhere\n\t\t\t\tMissing > 1 and\n\t\t\t\tNot_Missing = 0\n\t\t\t;\n\t\tquit;\n \n\t%end;\n\t%if &dhm_missing_handling_option = 2 %then\n\t%do;\n/****\ndelete occuring missing vars that originally also have a missing variable name\n****/\n\t\tproc sql;\n\t\t\tselect\n\t\t\t\t_NAME_\n\t\t\tinto\n\t\t\t\t:dhm_drop_seq separated by \" \"\n\t\t\tfrom\n\t\t\t\t&dhm_dataset_2_write_out_results._t\n\t\t\twhere\n\t\t\t\tMissing > 1 and\n\t\t\t\tNot_Missing = 0 and\n\t\t\t\tupcase(_NAME_) contains (\"%upcase(&dhm_stg_2_chk_var_b4_drop)\")\n\t\t\t;\n\t\tquit;\n \n\t%end;\n\t%let dhm_missing_var_count = 0;\n\t%let dhm_missing_var_count = %wordcnt(&dhm_drop_seq, ' ');\n\tdata &dhm_dataset_2_check_output;\n\t\tset &dhm_dataset_2_check;\n\t\t%if &dhm_missing_var_count ne 0 %then\n\t\t%do;\n\t\t\tdrop &dhm_drop_seq;\n\t\t%end;\n\trun;\n \n%mend;\n \n/** FOR TESTING ***\noption mprint source notes;\n%include \"/mnt/downloads/production_code/macros/wordcnt.sas\";\ndata one;\ninput ZZ_MISSING_VARNAME_ $ b $ cothervar $ d e;\ncards;\n. . . 1 3\n. b . 2 4\n. a . . 5\n. . . 3 5\n. a . . 6\n. a . . 7\n. a . 2 8\n;\nrun;\n \n%let ebla_cas_target_libname = ZZ_Tstng;\n%let missing_handling_option = 1;\n%let dataset_2_check = work.one;\n%let dataset_2_check_output = work.two;\n%let dataset_2_write_out_results =  work._missing_var_results_;\n%let stg_2_chk_var_b4_drop = ZZ_MISSING_VARNAME_;\n \n \n%DIAP_handling_missings_vars(\n\tdhm_missing_handling_option = &missing_handling_option,\n\tdhm_dataset_2_check = &dataset_2_check,\n\tdhm_dataset_2_check_output = &dataset_2_check_output,\n\tdhm_dataset_2_write_out_results = &dataset_2_write_out_results,\n\tdhm_stg_2_chk_var_b4_drop = &stg_2_chk_var_b4_drop\n\t);\n \n \n*********************/\n \n%macro execute_all();\n%put \t&=chck_4_spcl_char_in_vars_ui\t;\n%put  \t&=check_csv_4_num_ui\t;\n%put \t&=check_txt_file_4_special_chrctui\t;\n%put \t&=csv_big_data_mode_ui\t;\n%put \t&=debug_mode_ui\t;\n%put \t&=diap_create_unique_target_tblnm2\t;\n%put \t&=diap_fnl_tblname_from_sheetonly2\t;\n%put \t&=diap_traverse_directories_ui\t;\n%put \t&=drop_missing_vars_ui\t;\n%put \t&=extension_ui\t;\n%put \t&=fnl_ds_name_4_all_extfiles_ui\t;\n%put \t&=force_upload_of_all_files_ui\t;\n%put \t&=libname_meta_centralized_ui\t;\n%put \t&=make_imported_data_persistent_ui\t;\n%put \t&=max_lgth_of_suspicious_str_ui\t;\n%put \t&=max_table_length_ui\t;\n%put \t&=meta_centralized_ui\t;\n%put \t&=prefix_4_suspicious_src_fl_ui\t;\n%put \t&=root_directory_ui\t;\n%put    &=log_file_path_ui;\n%put &=root_directory_overwrite_ui;\n%put \t&=skip_files_ending_with_seq_ui\t;\n%put \t&=skip_files_starting_with_seq_ui\t;\n%put \t&=spcl_chrctr_check_rplcmnt_inhex2\t;\n%put \t&=special_chrctr_seq_2_chck_inhex2\t;\n%put \t&=stringseq_2_cutout_from_fn_ui\t;\n%put \t&=stringseq_2_cutout_from_vn_ui\t;\n%put \t&=substitute_string_seq_ui\t;\n%put \t&=target_libname_ui\t;\n%put \t&=write_log_into_file_ui\t;\n%let root_directory = &root_directory_ui;\n/*%let root_directory = %scan(&root_directory_ui, 2, \":\")/;*/\n/*%let root_directory_source = %scan(&root_directory_ui, 1, \":\");*/\n/*%let do_processing = 1;*/\n/*%if \"%upcase(&root_directory_source)\" ne \"SASSERVER\" and*/\n/*\t\"&root_directory_overwrite_ui\" = \"\" and*/\n/*\t&DIAP_mode_selection_ui = 1 %then*/\n/*%do;*/\n/*\t%let do_processing = 0;*/\n/*\t%put FATAL ABORT: Please select a directory under SASSERVER!!!;*/\n/*\t%put FATAL ABORT: SAS Content folders are NOT allowed!!;*/\n/*%end;*/\n \n%put &=root_directory;\n \n%let \tchck_4_spcl_char_in_vars\t=\t&chck_4_spcl_char_in_vars_ui\t;\n%let \tcheck_csv_4_num\t=\t&check_csv_4_num_ui\t;\n%let \tcheck_txt_file_4_special_chrct\t=\t&check_txt_file_4_special_chrctui\t;\n%let \tcsv_big_data_mode\t=\t&csv_big_data_mode_ui\t;\n%let \tdebug_mode\t=\t&debug_mode_ui\t;\n%let \tdiap_create_unique_target_tblnm\t=\t&diap_create_unique_target_tblnm2\t;\n%let \tdiap_fnl_tblname_from_sheetonly\t=\t&diap_fnl_tblname_from_sheetonly2\t;\n%let \tdiap_traverse_directories\t=\t&diap_traverse_directories_ui\t;\n%let \tdrop_missing_vars\t=\t&drop_missing_vars_ui\t;\n%let \textension\t=\t&extension_ui\t;\n%let \tfnl_ds_name_4_all_extfiles\t=\t&fnl_ds_name_4_all_extfiles_ui\t;\n%let \tforce_upload_of_all_files\t=\t&force_upload_of_all_files_ui\t;\n%let \tlibname_meta_centralized\t=\t&libname_meta_centralized_ui\t;\n%let \tmake_imported_data_persistent\t=\t&make_imported_data_persistent_ui\t;\n%let \tmax_lgth_of_suspicious_str\t=\t&max_lgth_of_suspicious_str_ui\t;\n%let \tmax_table_length\t=\t&max_table_length_ui\t;\n%let \tmeta_centralized\t=\t&meta_centralized_ui\t;\n%let \tprefix_4_suspicious_src_fl\t=\t&prefix_4_suspicious_src_fl_ui\t;\n \n%if \"&root_directory_overwrite_ui\" ne \"\" %then\n%do;\n\t%let root_directory_source_ow = %upcase(%scan(&root_directory_overwrite_ui, 1, \":\"));\n\t%if \"&root_directory_source_ow\"\tne \"SASSERVER\" and\n\t\t\"&root_directory_source_ow\"\tne \"SASCONTENT\" %then\n\t%do;\n\t\t%let root_directory = SASSERVER:&root_directory_overwrite_ui;\n\t%end; %else\n\t%do;\n\t\t%let root_directory = &root_directory_overwrite_ui;\n\t%end;\n%end;\n%let \tskip_files_ending_with_seq\t=\t&skip_files_ending_with_seq_ui\t;\n%let \tskip_files_starting_with_seq\t=\t&skip_files_starting_with_seq_ui\t;\n%let \tspcl_chrctr_check_rplcmnt_in_hex\t=\t&spcl_chrctr_check_rplcmnt_inhex2\t;\n%let \tspecial_chrctr_seq_2_chck_in_hex\t=\t&special_chrctr_seq_2_chck_inhex2\t;\n%let \tstringseq_2_cutout_from_fn\t=\t&stringseq_2_cutout_from_fn_ui\t;\n%let \tstringseq_2_cutout_from_vn\t=\t&stringseq_2_cutout_from_vn_ui\t;\n%let \tsubstitute_string_seq\t=\t&substitute_string_seq_ui\t;\n%let \ttarget_libname\t=\t&target_libname_ui\t;\n%let \twrite_log_into_file\t=\t&write_log_into_file_ui\t;\n \n%let DIAP_viyaversion = 4;\n \n%let provide_default_log_path = ;\n%let log_file_directory_source_ui = ;\n%if \"&log_file_path_ui\" ne \"\" %then\n%do;\n\t%let provide_default_log_path = %scan(&log_file_path_ui, 2, \":\")/;\n\t%let log_file_directory_source_ui = %scan(&log_file_path_ui, 1, \":\");\n%end;\n%if \"%upcase(&log_file_directory_source_ui)\" eq \"SASSERVER\" %then\n%do;\n\t%let install_mode_in_SAS_Content = 0;\n%end; %else\n%do;\n\t%let install_mode_in_SAS_Content = 1;\n%end;\n%if &DIAP_mode_selection_ui = 1 %then\n%do;\n\t%let diap_guided_automation_fl_loc = ;\n%end; %else\n%do;\n\t%let diap_guided_automation_fl_loc = &diap_guided_auto_fl_loc_ui;\n%end;\n \n \n \n \n%if &fcmp_run_indicator = 1 and\n\t&do_processing = 1 %then\n%do;\n\t%_jobexec_dict_loading; run; quit;\n%end; %else\n%if &do_processing = 1 %then\n%do;\n \n\t%put INFORMATION: &=profiling_execution_option ;\n\t%wrapper_import_files_into_viya(\n\t\twifiv_inRootDir \t   = &root_directory,\n\t\twifiv_inExtension   = &extension,\n\t\twifiv_inTargetLib \t   = &target_libname,\n\t\twifiv_inUpldLogDS = _NONE_,\n\t\twifiv_inSbstStrgSeq \t   = &substitute_string_seq,\n\t\twifiv_meta_centralized = &meta_centralized,\n\t\twifiv_libname_meta_centralized = &libname_meta_centralized,\n\t\twifiv_max_table_name_length = &max_table_name_length,\n\t\twifiv_debug_mode = &debug_mode,\n\t\twifiv_shp_enrich_with_zip = &shp_enrich_with_zip,\n\t\twifiv_do_profiling = &profiling_execution_option,\n\t\twifiv_profiling_dict_location = &prfl_dict_lctn_in_content_area,\n\t\twifiv_profiling_code_location = &prfl_cd_lctn_in_content_area,\n\t\twifiv_path_2_python_shape_script = &path_2_python_shape_script,\n\t\twifiv_csv_big_data_mode = &csv_big_data_mode,\n\t\twifiv_write_log_into_file = &write_log_into_file,\n\t\twifiv_provide_default_log_path = &provide_default_log_path,\n\t\twifiv_drop_missing_vars = &drop_missing_vars,\n\t\twifiv_stringseq_2_cutout_from_fn = &stringseq_2_cutout_from_fn,\n\t\twifiv_stringseq_2_cutout_from_vn = &stringseq_2_cutout_from_vn,\n\t\twifiv_prefix_4_suspicious_src_fl = &prefix_4_suspicious_src_fl,\n\t\twifiv_max_lgth_of_suspicious_str = &max_lgth_of_suspicious_str,\n\t\twifiv_check_csv_4_num = &check_csv_4_num,\n\t\twifiv_macro_varname_cashost = &_CASHOST_,\n\t\twifiv_macro_varname_casport = &_CASPORT_,\n\t\twifiv_viyaversion = &DIAP_viyaversion,\n\t\twifiv_install_mode_in_SASContent = &install_mode_in_SAS_Content,\n\t\twifiv_chck_txt_fl_4_spcl_chrct = &check_txt_file_4_special_chrct,\n\t\twifiv_spcl_chrctr_sq2chck_in_hex = &special_chrctr_seq_2_chck_in_hex,\n\t\twifiv_spcl_chrct_chck_rplcmnt_hx = &spcl_chrctr_check_rplcmnt_in_hex,\n\t\twifiv_make_imported_data_prsstnt = &make_imported_data_persistent,\n\t\twifiv_force_upload_of_all_files = &force_upload_of_all_files,\n\t\twifiv_traverse_directories = &diap_traverse_directories,\n\t\twifiv_skip_files_start_with_seq = &skip_files_starting_with_seq,\n\t\twifiv_skip_files_end_with_seq = &skip_files_ending_with_seq,\n\t\twifiv_fnl_tblname_from_sheetonly = &diap_fnl_tblname_from_sheetonly,\n\t\twifiv_create_unique_target_tblnm = &diap_create_unique_target_tblnm,\n\t\twifiv_delimiter = &diap_delimiter.,\n\t\twifiv_chck_4_spcl_char_in_vars = &chck_4_spcl_char_in_vars,\n\t\twifiv_fnl_ds_name_4_all_extfiles = &fnl_ds_name_4_all_extfiles,\n\t\twifiv_diap_guided_auto_fl_loc = &diap_guided_automation_fl_loc\n\t\t);\n%end;\n \n%mend;\n%if &DIAP_mode_selection_ui = 4 %then\n%do;\n\tfilename temp_fix temp;\n\t\tdata _null_;\n\t\t\tfile temp_fix delimiter = \",\";\n\t\t\tinfile datalines delimiter = \",\" truncover;\n\t\t\tlength\n\t\t\t  directory $256.\n\t\t\t  filename $128.\n\t\t\t  include_fn_in_table_output 8\n\t\t\t  file_type $3.\n\t\t\t  variable_name $32.\n\t\t\t  variable_label $256.\n\t\t\t  variable_type $4.\n\t\t\t  variable_length 8\n\t\t\t  variable_format $32.\n\t\t\t  variable_informat $32.\n\t\t\t  variable_start_position 8\n\t\t\t  variable_end_position 8;\n\t\n\t\t\tinput\n\t\t\t  directory $\n\t\t\t  filename $\n\t\t\t  include_fn_in_table_output\n\t\t\t  file_type $\n\t\t\t  variable_name $\n\t\t\t  variable_label $\n\t\t\t  variable_type $\n\t\t\t  variable_length\n\t\t\t  variable_start_position\n\t\t\t  variable_end_position;\n\t \t\tvariable_format = \"\";\n\t\t\tvariable_informat = \"\";\n\t\t\tif _n_ = 1 then\n\t\t\tdo;\n\t\t\tput\n\t\t\t  \"directory,\"\n\t\t\t  \"filename,\"\n\t\t\t  \"include_fn_in_table_output,\"\n\t\t\t  \"file_type,\"\n\t\t\t  \"variable_name,\"\n\t\t\t  \"variable_label,\"\n\t\t\t  \"variable_type,\"\n\t\t\t  \"variable_length,\"\n\t\t\t  \"variable_start_position,\"\n\t\t\t  \"variable_end_position,\"\n\t\t\t  \"variable_format,\"\n\t\t\t  \"variable_informat\"\n\t\t\t\t;\n\t\t\t\t\n\t\t\tend;\n\t\t\tput\n\t\t\t  directory $\n\t\t\t  filename $\n\t\t\t  include_fn_in_table_output\n\t\t\t  file_type $\n\t\t\t  variable_name $\n\t\t\t  variable_label $\n\t\t\t  variable_type $\n\t\t\t  variable_length\n\t\t\t  variable_start_position\n\t\t\t  variable_end_position\n\t\t\tvariable_format\n\t\t\tvariable_informat\t;\n\t\n\t\t\t  datalines;\n\t/mnt/downloads/climate/,climdiv,1,fix,state_code,state_code,char,3,1,3\n\t/mnt/downloads/climate/,climdiv,1,fix,division_number,division_number,num,8,4,4\n\t/mnt/downloads/climate/,climdiv,1,fix,element_code,element_code,char,1,5,6\n\t/mnt/downloads/climate/,climdiv,1,fix,year,year,num,8,7,10\n\t/mnt/downloads/ZZ_Testing/top_folder/xml/,first_blast.xml,1,xml,hit_num,hit_num,num,8,1,1\n\t/mnt/downloads/ZZ_Testing/top_folder/xml/,first_blast.xml,1,xml,hit_id,hit_id,char,32,2,2\n\t/mnt/downloads/ZZ_Testing/top_folder/xml/,first_blast.xml,1,xml,hit_def,hit_def,char,512,3,3\n\t/mnt/downloads/ZZ_Testing/top_folder/xml/,first_blast.xml,1,xml,hit_accession,hit_accession,num,8,4,4\n\t/mnt/downloads/ZZ_Testing/top_folder/xml/,first_blast.xml,1,xml,hit_len,hit_len,num,8,5,5\n\t/mnt/downloads/ZZ_Testing/top_folder/xml/,first_blast.xml,1,xml,hsp_midline,hsp_midline,char,32000,6,6\n\t\t\t;\n\t\trun;\n%end;\n%if &DIAP_mode_selection_ui = 3 %then\n%do;\n\tfilename temp_gdd temp;\n\t\tdata _null_;\n\t\t\tfile temp_gdd delimiter = \",\";\n\t\t\tinfile datalines delimiter = \",\" truncover;\n\t\t\tlength\n\t\t\t\tfull_file_name $256.\n\t\t\t\tsheet_xml_json_tablename $128.\n\t\t\t\tis_in_SAS_Content_flag $32.\n\t\t\t\tcolumn_names_in_first_row $32.\n\t\t\t\tdelimiter_for_text_files $32.\n\t\t\t\ttarget_table_name $32.\n\t\t\t\t;\n\t\n\t\t\tinput\n\t\t\t\tfull_file_name $\n\t\t\t\tsheet_xml_json_tablename $\n\t\t\t\tis_in_SAS_Content_flag\n\t\t\t\tcolumn_names_in_first_row\n\t\t\t\tdelimiter_for_text_files $\n\t\t\t\ttarget_table_name $\n\t\t\t\t;\n\t\n\t\t\tif _n_ = 1 then\n\t\t\tdo;\n\t\t\tput\n\t\t\t\t\"full_file_name,\"\n\t\t\t\t\"sheet_xml_json_tablename,\"\n\t\t\t\t\"is_in_SAS_Content_flag,\"\n\t\t\t\t\"column_names_in_first_row,\"\n\t\t\t\t\"delimiter_for_text_files,\"\n\t\t\t\t\"target_table_name\"\n\t\t\t\t;\n \n\t\t\tend;\n\t\t\tput\n\t\t\t\tfull_file_name $\n\t\t\t\tsheet_xml_json_tablename $\n\t\t\t\tis_in_SAS_Content_flag\n\t\t\t\tcolumn_names_in_first_row\n\t\t\t\tdelimiter_for_text_files $\n\t\t\t\ttarget_table_name $\n\t\t\t\t;\t\n\t\t\tdatalines;\n/mnt/dir/where/excel/files/test_excel.xlsx,name_of_sheet_2_read_in,0,1, ,excel_sheet2\n/public/dir/where/csv/files/test_detect_delimiter_automatically.csv, ,1,1, ,auto_detect_delimiter\n/public/dir/where/csv/files/test_comma_delimited.csv, ,1,1,comma,\n/public/dir/where/csv/files/test_tab_delimited.csv, ,1,1,tab,tab_del_from_sasContent\n/public/dir/where/csv/files/test_blank_space_delimited.csv, ,1,1,blank,\n/public/dir/where/csv/files/test_semicolon_delimited.csv, ,1,1,semicolon,semi_del_table\n/public/dir/where/csv/files/test_pipe_delimited.csv, ,1,1,pipe,\n/mnt/dir/where/more/excel/files/test_target_table_name_auto_created.xlsx,another_name_of_sheet_2_read_in,0,1, ,\n\t\t\t;\n\t\trun;\n%end;\n \n \n%macro check_4_admin_tasks();\n/*%let root_directory = ;*/\n/*%let root_directory_source = ;*/\n/*%if &DIAP_mode_selection_ui = 1 %then*/\n/*%do;*/\n/*\t%let root_directory = %scan(&root_directory_ui, 2, \":\")/;*/\n/*\t%let root_directory_source = %scan(&root_directory_ui, 1, \":\");*/\n/*%end;*/\n%let do_processing = 1;\n/*%if \"%upcase(&root_directory_source)\" ne \"SASSERVER\" and*/\n/*\t\"&root_directory_overwrite_ui\" = \"\" and*/\n/*\t&DIAP_mode_selection_ui = 1 %then*/\n/*%do;*/\n/*\t%let do_processing = 0;*/\n/*\t%put FATAL ABORT: Please select a directory under SASSERVER!!!;*/\n/*\t%put FATAL ABORT: SAS Content folders are NOT allowed!!;*/\n/*%end;*/\n/*%if \"&root_directory_overwrite_ui\" ne \"\" %then*/\n/*%do;*/\n/*\t%let root_directory = &root_directory_overwrite_ui;*/\n/*\t%let root_directory_source = SASSERVER;*/\n/*%end;*/\n \n%let controlfile_target_location = %scan(&controlfile_target_location_ui, 2, \":\")/;\n%let control_trgt_location_source = %scan(&controlfile_target_location_ui, 1, \":\");\n \n \n%put &=controlfile_target_location;\n%put &=do_processing;\n \n \n%if (&DIAP_mode_selection_ui = 3 or &DIAP_mode_selection_ui = 4) and\n\t&do_processing = 1 %then\n%do;\n\t%if &DIAP_mode_selection_ui = 4 %then\n\t%do;\n\t\t%if %upcase(\"&control_trgt_location_source\") eq \"SASSERVER\" %then\n\t\t%do;\n\t\t\tfilename out \"&controlfile_target_location._DIAP_Special_File_Definition.csv\";\n\t\t%end; %else\n\t\t%do;\n\t\t\tfilename out \t\n\t\t\t\t\tfilesrvc \t\n\t\t\t\t\tfolderpath \t= \"&controlfile_target_location\"\n\t\t\t\t\tfilename\t= \"_DIAP_Special_File_Definition.csv\";\n\t\t%end;\n\t\t%put &=controlfile_target_location;\n\t\tdata _null_;\n\t\t\tfile out delimiter = \",\";\n\t\t\tinfile temp_fix delimiter = \",\" truncover;\n\t\t\tlength\n\t\t\t  directory $256.\n\t\t\t  filename $128.\n\t\t\t  include_fn_in_table_output $32.\n\t\t\t  file_type $32.\n\t\t\t  variable_name $32.\n\t\t\t  variable_label $256.\n\t\t\t  variable_type $32.\n\t\t\t  variable_length $32.\n\t\t\t  variable_format $32.\n\t\t\t  variable_informat $32.\n\t\t\t  variable_start_position $32.\n\t\t\t  variable_end_position $32.;\n\t\n\t\t\tinput\n\t\t\t  directory $\n\t\t\t  filename $\n\t\t\t  include_fn_in_table_output $\n\t\t\t  file_type $\n\t\t\t  variable_name $\n\t\t\t  variable_label $\n\t\t\t  variable_type $\n\t\t\t  variable_length $\n\t\t\t  variable_start_position $\n\t\t\t  variable_end_position $\n\t\t\t  variable_format $\n\t\t\t  variable_informat $\n\t\t\t  ;\n\t\n\t\t\tput\n\t\t\t  directory $\n\t\t\t  filename $\n\t\t\t  include_fn_in_table_output $\n\t\t\t  file_type $\n\t\t\t  variable_name $\n\t\t\t  variable_label $\n\t\t\t  variable_type $\n\t\t\t  variable_length $\n\t\t\t  variable_start_position $\n\t\t\t  variable_end_position $\n\t\t\t  variable_format $\n\t\t\t  variable_informat $\n\t\t\t  ;\n\t\trun;\n\t%end;\n \n \n\t%if &DIAP_mode_selection_ui = 3 %then\n\t%do;\n\t\t%if %upcase(\"&control_trgt_location_source\") eq \"SASSERVER\" %then\n\t\t%do;\n\t\t\tfilename out \"&controlfile_target_location._DIAP_guided_execution.csv\";\n\t\t%end; %else\n\t\t%do;\n\t\t\tfilename out \t\n\t\t\t\t\tfilesrvc \t\n\t\t\t\t\tfolderpath \t= \"&controlfile_target_location\"\n\t\t\t\t\tfilename\t= \"_DIAP_guided_execution.csv\";\n\t\t%end;\n\t\tdata _null_;\n\t\t\tfile out delimiter = \",\";\n\t\t\tinfile temp_gdd delimiter = \",\" truncover;\n\t\t\tlength\n\t\t\t\tfull_file_name $256.\n\t\t\t\tsheet_xml_json_tablename $128.\n\t\t\t\tis_in_SAS_Content_flag $32.\n\t\t\t\tcolumn_names_in_first_row $32.\n\t\t\t\tdelimiter_for_text_files $32.\n\t\t\t\ttarget_table_name $32.\n\t\t\t\t;\n\t\n\t\t\tinput\n\t\t\t\tfull_file_name $\n\t\t\t\tsheet_xml_json_tablename $\n\t\t\t\tis_in_SAS_Content_flag $\n\t\t\t\tcolumn_names_in_first_row $\n\t\t\t\tdelimiter_for_text_files $\n\t\t\t\ttarget_table_name $\n\t\t\t\t;\n\t\n\t\t\tput\n\t\t\t\tfull_file_name $\n\t\t\t\tsheet_xml_json_tablename $\n\t\t\t\tis_in_SAS_Content_flag $\n\t\t\t\tcolumn_names_in_first_row $\n\t\t\t\tdelimiter_for_text_files $\n\t\t\t\ttarget_table_name $\n\t\t\t\t;\t\n\t\trun;\n\t%end;\n%end; %else\n%do;\n\t%execute_all();\n%end;\n \ndata _null_;\n\tset _diap_option_setting_storage;\n\tcall execute(\"option \"||original_setting||\";\");\nrun;\n \noption validvarname = &_DIAP_option_validvarname_org;\n%mend check_4_admin_tasks;\n%check_4_admin_tasks();\n"}}