{"creationTimeStamp":"2023-08-31T07:54:16.782Z","modifiedTimeStamp":"2024-01-15T13:56:04.327Z","createdBy":"gerdaw","modifiedBy":"gerdaw","name":"Catalog - Run Agent.step","displayName":"Catalog - Run Agent.step","localDisplayName":"Catalog - Run Agent.step","description":"Trigger a SAS Information Catalog agent to run.","localDescription":"Trigger a SAS Information Catalog agent to run.","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/3017b145-c4c8-4520-aa98-1c14e72bff76","uri":"/dataFlows/steps/3017b145-c4c8-4520-aa98-1c14e72bff76","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/3017b145-c4c8-4520-aa98-1c14e72bff76","uri":"/dataFlows/steps/3017b145-c4c8-4520-aa98-1c14e72bff76","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/3017b145-c4c8-4520-aa98-1c14e72bff76","uri":"/dataFlows/steps/3017b145-c4c8-4520-aa98-1c14e72bff76","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/3017b145-c4c8-4520-aa98-1c14e72bff76","uri":"/dataFlows/steps/3017b145-c4c8-4520-aa98-1c14e72bff76"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/3017b145-c4c8-4520-aa98-1c14e72bff76","uri":"/dataFlows/steps/3017b145-c4c8-4520-aa98-1c14e72bff76","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/3017b145-c4c8-4520-aa98-1c14e72bff76","uri":"/dataFlows/steps/3017b145-c4c8-4520-aa98-1c14e72bff76","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[],"outputPorts":[]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"pageDefinition\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Definition\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text1\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Trigger a SAS Information Catalog agent to run. This will analyze the connected data source and collect information on changes.\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"botID\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Enter the agent ID:\",\n\t\t\t\t\t\"placeholder\": \"SAS Information Catalog agent ID\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text2\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"The run time of an agent can variy depending on how the agent is configured and how many of the tables that the agent indexes have changed since the last agent run. If you do not want to wait for the agent run to finish, uncheck the box below - this will make the agent run asynchronous, otherwise this step waits syncrhonously for the agent to finish its run.\\n\\nYou can only display run results if you wait for the agent to finish.\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"isSync\",\n\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\"label\": \"Wait for the agent run to finish (synchronous)\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"displayResults\",\n\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\"label\": \"Display agent run results\",\n\t\t\t\t\t\"visible\": \"$isSync\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"pageAbout\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"textAbout\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Catalog - Run Agent step\\n==================\\n\\nThe \\\" Catalog - Run Agent\\\" custom steps triggers a SAS Information Catalog agent to run via the /catalog/bots/{agentId}/state. If you run this step in synchronous mode then the step will query the current agent run state every 30 seconds\\n\\nThis can used in combination with the Catalog - List Agents step to get the ID of an agent.\\n\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionPrereqs\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Pre-requisites\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textPrereqs\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"You need to part of the SAS Administrator group or a Custom Group that can maintain the Information Catalog agents, see this documentation page for more details: https://go.documentation.sas.com/doc/en/infocatcdc/default/infocatag/n1xniiffqq05c9n1n31o997vvdwu.htm?requestorId=1c9d26e9-68e7-4041-bb09-d33447b2d3ca#n0kvrjp9o1ntfen1hqeaec4cwidz\\n\\nTested on Viya version Stable 2023.12\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionDocumentation\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Documentation\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textDocumentation\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"* Agent REST-API documentation can be found here (https://developer.sas.com/apis/rest/DataManagement/#update-an-agent-39-s-run-state)\\n* Maintaining agents via a custom group (https://go.documentation.sas.com/doc/en/infocatcdc/default/infocatag/n1xniiffqq05c9n1n31o997vvdwu.htm?requestorId=1c9d26e9-68e7-4041-bb09-d33447b2d3ca#n0kvrjp9o1ntfen1hqeaec4cwidz)\\n* General information about agents (https://go.documentation.sas.com/doc/en/infocatcdc/default/infocatag/n19g2478yryor8n1hub3q3sxw7st.htm?requestorId=1c9d26e9-68e7-4041-bb09-d33447b2d3ca)\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionChangelog\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Changelog\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textChangelog\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"* Version: 1.0 (15JAN2024)\\n      - Initial version\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"botID\": \"\",\n\t\t\"isSync\": true,\n\t\t\"displayResults\": true\n\t}\n}","templates":{"SAS":"%let _ra_viyaHost = %sysfunc(getoption(SERVICESBASEURL));\n\n* Trigger Agent run;\nproc http\n\tmethod='put'\n\turl=\"&_ra_viyaHost./catalog/bots/&botID./state?value=running\"\n\toauth_bearer = sas_services;\n\theaders 'Accept' = 'text/plain';\nquit;\n\n* Macro to check the status of the agent run;\n* Calls itself as long as the status is running;\n%macro _ra_check_status();\n\tfilename _ra_stt temp;\n\tproc http\n\t\tmethod='get'\n\t\turl=\"&_ra_viyaHost./catalog/bots/&botID./state\"\n\t\toauth_bearer = sas_services\n\t\tout=_ra_stt;\n\t\theaders 'Accept' = 'text/plain';\n\tquit;\n\t\n\tdata _null_;\n\t\tlength status $128.;\n\t\tinfile _ra_stt;\n\t\tinput status $;\n\t\n\t\tif status = 'running' then do;\n\t\t\tput 'NOTE: Waiting for agent run to finish.';\n\t\t\t* Wait for 30 seconds before making another call;\n\t\t\tcall sleep(30, 1);\n\t\t\tcall execute('%_ra_check_status()');\n\t\tend;\n\t\telse do;\n\t\t\tput 'NOTE: Agent run is finished.';\n\t\tend;\n\trun;\n%mend _ra_check_status;\n\n%if &isSync. %then %do;\n\t%_ra_check_status();\n%end;\n\n%if &isSync. and &displayResults. %then %do;\n\tfilename _ra_hst temp;\n\tproc http\n\t\tmethod='get'\n\t\turl=\"&_ra_viyaHost./catalog/bots/&botID./history?limit=1\"\n\t\toauth_bearer = sas_services\n\t\tout=_ra_hst;\n\t\theaders 'Accept' = 'application/json';\n\tquit;\n\n\tlibname _ra_hst json;\n\n\tdata _null_;\n\t\tset _ra_hst.items_links(obs=1);\n\t\tcall symputx('_ra_catalog_uri', substr(uri, 22, find(uri, '%') + 23));\n\trun;\n\n\ttitle \"<a href='&_ra_viyaHost./SASInformationCatalog/?q=&_ra_catalog_uri.' target='_blank' rel='noopener noreferrer'>View Information on the Agent Run (right click > open in a new tab)</a>\";\n\tproc print data=_ra_hst.items(drop=ordinal_root ordinal_items version) noobs;\n\tquit;\n\ttitle;\n\n\tlibname _ra_hst clear;\n\t%symdel _ra_catalog_uri;\n%end;\n\n* Clean up;\n%symdel _ra_viyaHost;\n%sysmacdelete _ra_check_status;\nfilename _ra_stt clear;"}}