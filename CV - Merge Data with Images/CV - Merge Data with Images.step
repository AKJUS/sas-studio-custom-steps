{"creationTimeStamp":"2024-04-12T20:05:17.546Z","modifiedTimeStamp":"2024-07-11T21:49:28.491Z","createdBy":"roblan","modifiedBy":"roblan","name":"CV - Merge Data with Images.step","displayName":"CV - Merge Data with Images.step","localDisplayName":"CV - Merge Data with Images.step","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/690fcab1-50f6-4f05-bfb7-77561f0b815a","uri":"/dataFlows/steps/690fcab1-50f6-4f05-bfb7-77561f0b815a","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/690fcab1-50f6-4f05-bfb7-77561f0b815a","uri":"/dataFlows/steps/690fcab1-50f6-4f05-bfb7-77561f0b815a","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/690fcab1-50f6-4f05-bfb7-77561f0b815a","uri":"/dataFlows/steps/690fcab1-50f6-4f05-bfb7-77561f0b815a","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/690fcab1-50f6-4f05-bfb7-77561f0b815a","uri":"/dataFlows/steps/690fcab1-50f6-4f05-bfb7-77561f0b815a"},{"method":"POST","rel":"copy","href":"/dataFlows/steps/690fcab1-50f6-4f05-bfb7-77561f0b815a/copy","uri":"/dataFlows/steps/690fcab1-50f6-4f05-bfb7-77561f0b815a/copy","responseType":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/690fcab1-50f6-4f05-bfb7-77561f0b815a","uri":"/dataFlows/steps/690fcab1-50f6-4f05-bfb7-77561f0b815a","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/690fcab1-50f6-4f05-bfb7-77561f0b815a","uri":"/dataFlows/steps/690fcab1-50f6-4f05-bfb7-77561f0b815a","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[{"name":"_Annotationtbl_","displayName":"_Annotationtbl_","localDisplayName":"_Annotationtbl_","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table"},{"name":"_inImgtbl_","displayName":"_inImgtbl_","localDisplayName":"_inImgtbl_","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table"}],"outputPorts":[{"name":"insert_outtabname","displayName":"insert_outtabname","localDisplayName":"insert_outtabname","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table","supportsView":false,"requiresStructure":false}]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"DataPage\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Data\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text2\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Join type:\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_jointypeoption_\",\n\t\t\t\t\t\"type\": \"dropdown\",\n\t\t\t\t\t\"label\": \"\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"APPEND\",\n\t\t\t\t\t\t\t\"label\": \"Append\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"FULL\",\n\t\t\t\t\t\t\t\"label\": \"Full\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"INNER\",\n\t\t\t\t\t\t\t\"label\": \"Inner\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"LEFT\",\n\t\t\t\t\t\t\t\"label\": \"Left\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"RIGHT\",\n\t\t\t\t\t\t\t\"label\": \"RIGHT\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text1\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Name of variable to use for the join (merge): \",\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$_jointypeoption_\",\n\t\t\t\t\t\t\"!=\",\n\t\t\t\t\t\t\"APPEND\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_insert_varjoin\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$_jointypeoption_\",\n\t\t\t\t\t\t\"!=\",\n\t\t\t\t\t\t\"APPEND\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_Annotationtbl_\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Annotation table:\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"insert_outtabname\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Output table label 1\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_inImgtbl_\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Image table:\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"page1\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"about_text\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Computer Vision (CV) - Merge Data with Images\\n=================================\\n\\nThis custom step allows users to merge or append data together that contains images. Common uses are:\\n1)\\tMerging images with labels\\n2)\\tAppending dataset together to create larger image processing datasets.\\nThis custom step uses the dljoin action whoâ€™s documentation may be found here: https://go.documentation.sas.com/doc/en/sasstudiocdc/default/pgmsascdc/casdlpg/cas-deeplearn-dljoin.htm\\n\\nJoin type (Required): Specifies one of the following types of table joins:\\nAPPEND\\nFULL\\nINNER\\nLEFT\\nRIGHT\\n\\nName of variable to use for the join (merge): specify the name of the variable that will be used to join tables when merging.  The ID variable name must match both tables and must not contain duplicate values in a table. \\n\\n\\nCreated / contact : \\n\\n- Robert Blanchard (robert.blanchard@sas.com)\\n\\n\\nVersion : 1.0.   (11JUL2024)\\n\\n\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"_jointypeoption_\": {\n\t\t\t\"value\": \"INNER\",\n\t\t\t\"label\": \"Inner\"\n\t\t},\n\t\t\"_insert_varjoin\": \"\",\n\t\t\"_Annotationtbl_\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"insert_outtabname\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"_inImgtbl_\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t}\n\t}\n}","templates":{"SAS":"\ndata _null_;\n\ncall symput(\"outCaslib\",scan(%cmpres(\"&insert_outtabname.\"),1,\".\",\"MO\"));\ncall symput(\"outCASTbl\",scan(%cmpres(\"&insert_outtabname.\"),2,\".\",\"MO\"));\ncall symput(\"annoCaslib\",scan(%cmpres(\"&_annotationtbl_.\"),1,\".\",\"MO\"));\ncall symput(\"annoCASTbl\",scan(%cmpres(\"&_annotationtbl_.\"),2,\".\",\"MO\"));\ncall symput(\"imgCaslib\",scan(%cmpres(\"&_inImgtbl_.\"),1,\".\",\"MO\"));\ncall symput(\"imgCASTbl\",scan(%cmpres(\"&_inImgtbl_.\"),2,\".\",\"MO\"));\n\nrun;\n\n\n/*-----------------------------------------------------------------------------------------*\n   Macro to check if a given libref belongs to a SAS or CAS engine.\n*------------------------------------------------------------------------------------------*/\n\n%macro check_for_caslib(sas_libname);\n /* Get a list of available caslibs               */\n/* - Create a table with the caslib names        */\n/* - Create a macro variable witha list of names */\nproc sql noprint;\ncreate table work.list_of_caslibs as\n\tselect libname \n\t\tinto :list_of_caslibs separated by ','\n\tfrom dictionary.libnames\n\twhere upcase(sysname)=\"CASLIB\"\n\torder by libname;\nquit;\n \n/* Check the specified caslib in the list of available caslib */\nproc sql noprint;\n\tselect *\n\tfrom work.list_of_caslibs\n\twhere libname = upcase(\"&sas_libname\");\nquit;\n \n/* Use the SQLOBS macro variable. If 1, then the caslib was found */\n%if &sqlobs=1 %then %do;\n\t%put NOTE: ***************************************************;\n\t%put NOTE: The %upcase(&sas_libname) library is a valid Caslib;\n\t%put NOTE: ***************************************************;\n%end;\n%else %do;\n\t%put ERROR: *********************************************************;\n\t%put ERROR: The %upcase(&sas_libname) library is not a valid Caslib.;\n\t%put ERROR: Please specific a library that uses the CAS engine.;\n\t%put ERROR: List of available caslibs: &list_of_caslibs.;\n\t%put ERROR: **********************************************************;\n data _null_;\n\tabort 42;\n run;\n\t/* Terminate execution */\n\t%return;\n%end;\n \n%mend;\n \n \n%check_for_caslib(&outCaslib);\n%check_for_caslib(&imgCaslib);\n\n \n\nproc cas;\n_verify_jointype=\"&_jointypeoption_\"; /* yes no */\nif _verify_jointype = \"APPEND\" then do;\n   deepLearn.dlJoin /                                 \n      annotatedTable={name=\"&annoCASTbl\", caslib=\"&annoCaslib\"}\n      casOut={name=\"&outCASTbl\", replace=1, caslib=\"&outCaslib\"}\n\t\tjoinType=\"&_jointypeoption_\"\n      table={name=\"&imgCASTbl\", caslib=\"&imgCaslib\"};\nend;\n\n\nif _verify_jointype ne \"APPEND\" then do;\n   deepLearn.dlJoin /                                 \n      annotatedTable={name=\"&annoCASTbl\", caslib=\"&annoCaslib\"}\n      casOut={name=\"&outCASTbl\", replace=1, caslib=\"&outCaslib\"}\n      id=\"&_insert_varjoin\"\n\t\tjoinType=\"&_jointypeoption_\"\n      table={name=\"&imgCASTbl\", caslib=\"&imgCaslib\"};\nend;\nquit;\n\n\n\n%SYMDEL \n\toutCaslib\n\toutCASTbl\n\tannoCaslib\n\tannoCASTbl\n\timgCaslib\n\timgCASTbl\n\t;\n\n%SYSMACDELETE \n\tcheck_for_caslib\n\t;\n"}}