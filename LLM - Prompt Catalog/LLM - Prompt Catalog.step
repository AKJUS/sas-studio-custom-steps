{"creationTimeStamp":"2024-01-30T03:52:05.786Z","modifiedTimeStamp":"2024-02-02T08:21:48.287Z","createdBy":"XinRu.Lee@sas.com","modifiedBy":"XinRu.Lee@sas.com","name":"LLM - Prompt Catalog.step","displayName":"LLM - Prompt Catalog.step","localDisplayName":"LLM - Prompt Catalog.step","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/e27d42c2-9fdd-4c1b-a814-504adcb5e7a2","uri":"/dataFlows/steps/e27d42c2-9fdd-4c1b-a814-504adcb5e7a2","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/e27d42c2-9fdd-4c1b-a814-504adcb5e7a2","uri":"/dataFlows/steps/e27d42c2-9fdd-4c1b-a814-504adcb5e7a2","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/e27d42c2-9fdd-4c1b-a814-504adcb5e7a2","uri":"/dataFlows/steps/e27d42c2-9fdd-4c1b-a814-504adcb5e7a2","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/e27d42c2-9fdd-4c1b-a814-504adcb5e7a2","uri":"/dataFlows/steps/e27d42c2-9fdd-4c1b-a814-504adcb5e7a2"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/e27d42c2-9fdd-4c1b-a814-504adcb5e7a2","uri":"/dataFlows/steps/e27d42c2-9fdd-4c1b-a814-504adcb5e7a2","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/e27d42c2-9fdd-4c1b-a814-504adcb5e7a2","uri":"/dataFlows/steps/e27d42c2-9fdd-4c1b-a814-504adcb5e7a2","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[{"name":"querytable","displayName":"querytable","localDisplayName":"querytable","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table"},{"name":"prompttable","displayName":"prompttable","localDisplayName":"prompttable","minEntries":0,"maxEntries":1,"defaultEntries":0,"type":"table"}],"outputPorts":[{"name":"responsetable","displayName":"responsetable","localDisplayName":"responsetable","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table","supportsView":false,"requiresStructure":false}]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"pageQuery\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Query\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"queryInputChoice\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Specify source of your query input\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"table\",\n\t\t\t\t\t\t\t\"label\": \"Use a table\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"enter\",\n\t\t\t\t\t\t\t\"label\": \"Enter manually\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"querytable\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Select the table containing the queries:\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$queryInputChoice\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"table\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"queryColumn\",\n\t\t\t\t\t\"type\": \"columnselector\",\n\t\t\t\t\t\"label\": \"Select the column containing the query:\",\n\t\t\t\t\t\"order\": false,\n\t\t\t\t\t\"columntype\": \"c\",\n\t\t\t\t\t\"max\": 1,\n\t\t\t\t\t\"min\": 1,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$queryInputChoice\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"table\"\n\t\t\t\t\t],\n\t\t\t\t\t\"table\": \"querytable\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"queryText\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Enter query text:\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$queryInputChoice\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"enter\"\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"pagePrompt\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Prompt\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"promptInputChoice\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Specify source of your prompt input:\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"catalog\",\n\t\t\t\t\t\t\t\"label\": \"Prompt catalog\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"custom\",\n\t\t\t\t\t\t\t\"label\": \"Custom prompt\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"prompttable\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Select the prompt table:\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"enabled\": [\n\t\t\t\t\t\t\"$promptInputChoice\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"catalog\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"columnselector2\",\n\t\t\t\t\t\"type\": \"columnselector\",\n\t\t\t\t\t\"label\": \"Select the prompt column:\",\n\t\t\t\t\t\"order\": false,\n\t\t\t\t\t\"columntype\": \"c\",\n\t\t\t\t\t\"max\": 1,\n\t\t\t\t\t\"min\": 1,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$promptInputChoice\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"catalog\"\n\t\t\t\t\t],\n\t\t\t\t\t\"table\": \"prompttable\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text1\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Suggested prompt has been selected automatically based on an evaluation framework.\",\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$promptInputChoice\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"catalog\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"SuggestedPromptCheckbox\",\n\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\"label\": \"Use suggested prompt from prompt catalog\",\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$promptInputChoice\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"catalog\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"suggested_prompt_col\",\n\t\t\t\t\t\"type\": \"columnselector\",\n\t\t\t\t\t\"label\": \"Select suggested prompt column:\",\n\t\t\t\t\t\"order\": false,\n\t\t\t\t\t\"columntype\": \"c\",\n\t\t\t\t\t\"max\": 1,\n\t\t\t\t\t\"min\": 1,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\"$promptInputChoice\",\n\t\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\t\"catalog\"\n\t\t\t\t\t\t],\n\t\t\t\t\t\t\"&\",\n\t\t\t\t\t\t\"$SuggestedPromptCheckbox\"\n\t\t\t\t\t],\n\t\t\t\t\t\"table\": \"prompttable\",\n\t\t\t\t\t\"readonly\": false\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"suggested_prompt_val\",\n\t\t\t\t\t\"type\": \"dropdown\",\n\t\t\t\t\t\"label\": \"Suggested prompt column = 'True':\",\n\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\"ref\": \"suggested_prompt_col\"\n\t\t\t\t\t},\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"placeholder\": \"True\",\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\"$promptInputChoice\",\n\t\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\t\"catalog\"\n\t\t\t\t\t\t],\n\t\t\t\t\t\t\"&\",\n\t\t\t\t\t\t\"$SuggestedPromptCheckbox\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"SuggestedPrompt\",\n\t\t\t\t\t\"type\": \"list\",\n\t\t\t\t\t\"label\": \"Review suggested prompt (for viewing only):\",\n\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\"ref\": \"columnselector2\"\n\t\t\t\t\t},\n\t\t\t\t\t\"max\": null,\n\t\t\t\t\t\"min\": null,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\"$promptInputChoice\",\n\t\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\t\"catalog\"\n\t\t\t\t\t\t],\n\t\t\t\t\t\t\"&\",\n\t\t\t\t\t\t\"$SuggestedPromptCheckbox\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"overwritePromptText\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Select the options below to pick another prompt. This will overwrite the suggested prompt.\",\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\"$promptInputChoice\",\n\t\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\t\"catalog\"\n\t\t\t\t\t\t],\n\t\t\t\t\t\t\"&\",\n\t\t\t\t\t\t\"!$SuggestedPromptCheckbox\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"promptIDColumn\",\n\t\t\t\t\t\"type\": \"columnselector\",\n\t\t\t\t\t\"label\": \"Select the prompt ID column:\",\n\t\t\t\t\t\"order\": false,\n\t\t\t\t\t\"columntype\": \"n\",\n\t\t\t\t\t\"max\": 1,\n\t\t\t\t\t\"min\": 1,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\"$promptInputChoice\",\n\t\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\t\"catalog\"\n\t\t\t\t\t\t],\n\t\t\t\t\t\t\"&\",\n\t\t\t\t\t\t\"!$SuggestedPromptCheckbox\"\n\t\t\t\t\t],\n\t\t\t\t\t\"table\": \"prompttable\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"promptDropdown\",\n\t\t\t\t\t\"type\": \"dropdown\",\n\t\t\t\t\t\"label\": \"Select the prompt for your model:\",\n\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\"ref\": \"promptIDColumn\"\n\t\t\t\t\t},\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\"$promptInputChoice\",\n\t\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\t\"catalog\"\n\t\t\t\t\t\t],\n\t\t\t\t\t\t\"&\",\n\t\t\t\t\t\t\"!$SuggestedPromptCheckbox\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"promptlist\",\n\t\t\t\t\t\"type\": \"list\",\n\t\t\t\t\t\"label\": \"Review prompt list (for viewing only):\",\n\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\"ref\": \"columnselector2\"\n\t\t\t\t\t},\n\t\t\t\t\t\"max\": null,\n\t\t\t\t\t\"min\": null,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\"$promptInputChoice\",\n\t\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\t\"catalog\"\n\t\t\t\t\t\t],\n\t\t\t\t\t\t\"&\",\n\t\t\t\t\t\t\"!$SuggestedPromptCheckbox\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"customPrompt\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Insert custom prompt here:\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$promptInputChoice\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"custom\"\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"pageLLM\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Large Language Model\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"intro\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"This custom step works with offline and online large language model APIs that support the OpenAI format.\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"llmTypeChoice\",\n\t\t\t\t\t\"type\": \"dropdown\",\n\t\t\t\t\t\"label\": \"Specify offline or online large language model\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"openai\",\n\t\t\t\t\t\t\t\"label\": \"OpenAI\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"offline\",\n\t\t\t\t\t\t\t\"label\": \"Offline model\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"APIURL\",\n\t\t\t\t\t\"type\": \"textarea\",\n\t\t\t\t\t\"label\": \"REST endpoint for large language model:\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"Token\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Token for OpenAI API:\",\n\t\t\t\t\t\"placeholder\": \"Token or macro variable storing the token\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$llmTypeChoice\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"openai\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"llmDropdown\",\n\t\t\t\t\t\"type\": \"dropdown\",\n\t\t\t\t\t\"label\": \"Enter an available openai models. Refer to official Open AI documentation for updated list:\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"gpt-3.5-turbo\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$llmTypeChoice\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"openai\"\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"pageOutput\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Save & Promote Tables\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"responsetable\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Response table:\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"save_prompts\",\n\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\"label\": \"Save prompt history and prompt catalog tables (anemoi lib)\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"promote_history\",\n\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\"label\": \"Promote prompt history table (public caslib)\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"promote_catalog\",\n\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\"label\": \"Promote prompt catalog table (public caslib)\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"pageAbout\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"textAbout\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"LLM - Prompt Catalog\\n==========\\n\\nThis custom step allows users to:\\n1. Submit single or multiple queries to a large language model;\\n2. Test prompts (prompt engineering) and view results in the output table node;\\n3. Save prompt to the prompt history and prompt catalog tables;\\n4. Promote prompt history and prompt catalog tables.\\n\\nThe following large language models are supported: \\n  * Offline Models (e.g. Llama-2-7b)\\n  * Online Models (e.g. OpenAI API)\\n\\nOutput table options can be specified to WORK.RESPONSE.\\n\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionPrereqs\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Pre-requisites\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textPrereqs\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"Pre-requisites:  Tested on Viya version Stable 2023.12\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionDocumentation\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Documentation\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textDocumentation\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"To understand more on Prompt Engineering, please refer to https://www.promptingguide.ai\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionChangelog\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Changelog\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textChangelog\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"* Version: 1.0 (02FEB2024)\\n      - Initial version\\n\\nContact: Xin Ru Lee (XinRu.Lee@sas.com)\\n\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"queryInputChoice\": {\n\t\t\t\"value\": \"table\",\n\t\t\t\"label\": \"Use a table\"\n\t\t},\n\t\t\"querytable\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"queryColumn\": [],\n\t\t\"queryText\": \"\",\n\t\t\"promptInputChoice\": {\n\t\t\t\"value\": \"catalog\",\n\t\t\t\"label\": \"Prompt catalog\"\n\t\t},\n\t\t\"prompttable\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"columnselector2\": [],\n\t\t\"SuggestedPromptCheckbox\": true,\n\t\t\"suggested_prompt_col\": [],\n\t\t\"suggested_prompt_val\": {\n\t\t\t\"value\": \"True\"\n\t\t},\n\t\t\"SuggestedPrompt\": [],\n\t\t\"promptIDColumn\": [],\n\t\t\"promptDropdown\": null,\n\t\t\"promptlist\": [],\n\t\t\"customPrompt\": \"\",\n\t\t\"llmTypeChoice\": {\n\t\t\t\"value\": \"offline\",\n\t\t\t\"label\": \"Offline model\"\n\t\t},\n\t\t\"APIURL\": \"http(s)://<>\",\n\t\t\"Token\": \"\",\n\t\t\"llmDropdown\": {\n\t\t\t\"value\": \"gpt-3.5-turbo\"\n\t\t},\n\t\t\"responsetable\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"save_prompts\": false,\n\t\t\"promote_history\": false,\n\t\t\"promote_catalog\": false\n\t},\n\t\"promptHierarchies\": [\n\t\t{\n\t\t\t\"name\": \"PromptHierarchy1\",\n\t\t\t\"levels\": [\n\t\t\t\t\"promptDropdown\",\n\t\t\t\t\"promptlist\"\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"name\": \"PromptHierarchy2\",\n\t\t\t\"levels\": [\n\t\t\t\t\"suggested_prompt_val\",\n\t\t\t\t\"SuggestedPrompt\"\n\t\t\t]\n\t\t}\n\t]\n}","templates":{"SAS":"cas;\ncaslib _all_ assign;\nlibname anemoi \"/shared-data1/anemoi\";\n\n/* **************************************** */\n/*             INPUT QUERY TABLE            */\n/* **************************************** */\n%macro createFinalTable1();\n\tproc sql;\n\t    create table work.joined_table as\n\t\t    select *, catx(' ',\"Given this:\",txt,prompt) as content length=32767\n\t            from &querytable.(keep=&queryColumn.)\n\t                full join &prompttable.(keep=&columnselector2.)\n                        on 1 = 1;\n\tquit;\n\t\n\tdata &responsetable.;\n\t     length txt $32767.;\n\t     length prompt $32767.;\n\t     length response $32767.;\n\t\t call execute('%loopOverDatasets('|| size ||')');\n\t\t stop;\n  \t\t set work.joined_table nobs=size;\n\trun;\n%mend createFinalTable1;\n\n%macro createFinalTable2();\n\t%if &SuggestedPromptCheckbox. = 1 %then %do;\n        data work.prompt001 (keep=&columnselector2.); \n            set &prompttable.;\n            if &suggested_prompt_col. = 'True' then output;\n        run;\n\t%end;\n\n\t%if &SuggestedPromptCheckbox. = 0 %then %do;\n        data work.prompt001 (keep=&columnselector2.); \n            set &prompttable.;\n            if &promptIDColumn. = &promptDropdown. then output;\n        run;\n\t%end;\n\n\tproc sql;\n\t    create table work.joined_table as\n\t\t    select *, catx(' ', 'Given this:', txt, prompt) as content length=32767\n\t            from &querytable.(keep=&queryColumn.)\n\t                full join prompt001\n                        on 1 = 1;\n\tquit;\n\t\n\tdata &responsetable.;\n\t    length txt $32767.;\n\t    length prompt $32767.;\n\t    length response $32767.;\n\t\tcall execute('%loopOverDatasets('|| size ||')');\n\t\tstop;\n  \t\tset work.joined_table nobs=size;\n\trun;\n%mend createFinalTable2;\n\n\n* Specify source of your query input = 'Enter Manually';\n* (e.g. &queryInputChoice. = 'enter');\n%macro createQueryTable(name, keepCol);\n\tproc sql noprint;\n\t\tcreate table &name. (&keepCol. char(32767));\n\t\t\tinsert into &name.\n\t\t\t    set &keepCol. = %nrstr(\"&queryText.\");\n\tquit;\n%mend createQueryTable;\n\n/* **************************************** */\n/*             INPUT PROMPT TABLE           */\n/* **************************************** */\n* Specify source of your prompt input = 'Custom Prompt';\n* (3.g. &promptInputChoice. = 'custom');\n%macro createPromptTable(name,keepCol);\n\tproc sql noprint;\n\t\tcreate table &name (&keepCol. char(32767));\n\t\t\tinsert into &name.\n\t\t\t    set &keepCol. = %nrstr(\"&customPrompt.\");\n\tquit;\n%mend createPromptTable;\n\n/* **************************************** */\n/*        SELECT LARGE LANGUAGE MODEL       */\n/* **************************************** */\n%macro loopOverDatasets(datasetCount);\n    %local iter;\n\n    * initiate loop;\n    %do iter=1 %to &datasetCount;\n        * get libref and dataset name for dataset you will work on during this iteration;\n        data work.msgs_json;\n            set work..joined_table (firstobs=&iter. obs=&iter. keep=content);\n            role = 'assistant';\n        run;\n\n        * Prepare the json files for in and out;\n        filename json_in temp;\n        filename json_out temp;\n\n        * Input the texts for json_in;\n        proc json out=json_in pretty;\n            write values \"model\" \"%trim(&llmDropdown.)\"; \n            write values \"messages\";\n            write open array;\n            export work.msgs_json / nosastags;\n            write close;  \n            write values \"temperature\" 0.1;\n            write values \"max_tokens\" 1000;\n        run;   \n \n        * Send the json_in to LLM by API;\n        proc http\n\t        url=\"%trim(%nrstr(&APIURL))\"\n\t        method='Post'\n\t        in=json_in\n\t        out=json_out;\n\t        headers\n\t            'Authorization' = \"%trim(%nrstr(&Token.))\"\n\t            'Content-Type' = 'application/json';\n        run;\n\n        * Print the response from gtp;\n        libname jlib json fileref=json_out;\n\n        proc print data=jlib.choices_message(keep=content);\n        run;\n\n        data row_response;\n\t        merge joined_table(firstobs=&iter. obs=&iter. drop=content) jlib.choices_message(keep=content rename=(content=response));\n\t    run;\n\n\t    proc append base=&responsetable. data=work.row_response force;\n\t    run;\n    %end;\n\t\n\t* Cleanup;\n\tproc delete data=work.txt001 work.joined_table work.row_response work.msgs_json;\n    run;\n%mend loopOverDatasets;\n\n* Call LLM API;\ndata _null_;\n\t* Create Query Table if needed;\n\tif strip(\"&queryInputChoice.\") = 'enter' then do;\n\t\tcall execute('%createQueryTable(txt001, txt)');\n\t\tcall symput('querytable', 'txt001');\t\n\t\tcall symput('queryColumn', 'txt');\n\tend;\n\n\t* Create Prompt Table if needed;\n\tif strip(\"&promptInputChoice.\") = 'custom' then do;\n\t\tcall execute('%createPromptTable(prompt001, prompt)');\t\n\t\tcall symput('prompttable', 'prompt001');\n\t\tcall symput('columnselector2', 'prompt');\n\tend; \nrun;\n\ndata _null_;\n\t* Select Prompt from Prompt Catalog;\n\tif strip(\"&promptInputChoice.\") = 'catalog' then do;\n\t    call execute('%createFinalTable2()');\n\t\tcall symput('prompttable', 'prompt001');\n\t\tcall symput('columnselector2', 'prompt');\n\tend; \n\telse do; \n\t\tcall execute('%createFinalTable1()');\n\tend;\nrun;\n\n/* **************************************** */\n/*     ADD TO PROMPT HISTORY & CATALOG      */\n/* **************************************** */\n\n%let new_run = response;\n%let prompt_history = prompthistory;\n%let prompt_catalog = promptcatalog;\n\n* Append to Prompt History table;\nproc sql;\n\tcreate table work.promptappend AS\n\t    select * from anemoi.&prompt_history.\n\t        union ALL\n\t    select txt, prompt, response from &new_run.;\nquit;\n\n* Add unique ID to the new prompt;\ndata &prompt_history.(drop=ID_max);\n\tset promptappend;\n\tretain ID_max;\n\tID_max = max(ID_max, ID);\n\tif ID = . then ID = ID_max + 1;\nrun;\n\n* Find the latest prompt and ID;\nproc sql noprint;\n    select max(ID) into :maxID from &prompt_history.;\n    select prompt into :promptValue from work.prompt001;\nquit;\n\n* Copy latest public.promptcatalog table into temporary work.promptcatalog;\ndata &prompt_catalog.;\n\tset public.&prompt_catalog;\nrun;\n\n* Insert the new row into work.promptcatalog;\nproc sql;\n\tinsert into &prompt_catalog. (prompt, ID, suggested_prompt)\n\t    values (\"&promptValue.\", &maxID., 'False');\nquit;\n\n* Remove duplicates from Prompt Catalog;\nproc sort data=&prompt_catalog. out=&prompt_catalog. (keep=prompt ID suggested_prompt) nodupkey;\n\tby prompt;\nrun;\n\n* Order by ID number;\nproc sort data=&prompt_catalog. out=&prompt_catalog.;\n\tby ID;\nrun;\n\n/* **************************************** */\n/*   SAVE & PROMOTE PROMPT HISTORY/CATALOG  */\n/* **************************************** */\n%let outlib = anemoi;\n\n%if &save_prompts.=1 %then %do;\n\tdata &outlib..&prompt_history.; \n\t\tset &prompt_history.;\n\t\tby ID;\n\trun;\n\n\tdata &outlib..&prompt_catalog.; \n\t\tset &prompt_catalog.;\n\t\tby ID;\n\trun;\n%end;\n\n%let VAlib = public;\n\n%if &promote_history.=1 %then %do;\n\t\n\t* drop table;\n\tproc casutil;\n\t\tdroptable casdata=\"&prompt_history.\" incaslib=\"&VAlib.\" quiet;\n\tquit;\n\t\n\tdata &VAlib..&prompt_history.; \n\t\tset &prompt_history.;\n\trun;\n\t\n\t* promote table;\n\tproc casutil;\n\t   promote casdata=\"&prompt_history\" casout=\"&prompt_history\" incaslib=\"&VAlib\" outcaslib=\"&VAlib\";\n\tquit;\n%end;\n\n\n%if &promote_catalog=1 %then %do;\n\t* drop table;\n\tproc casutil;\n\t\tdroptable casdata=\"&prompt_catalog.\" incaslib=\"&VAlib.\" quiet;\n\tquit;\n\t\n\tdata &VAlib..&prompt_catalog.; \n\t\tset &prompt_catalog.;\n\trun;\n\n\t* promote table;\n\tproc casutil;\n\t   promote casdata=\"&prompt_catalog.\" casout=\"&prompt_catalog.\" incaslib=\"&VAlib.\" outcaslib=\"&VAlib.\";\n\tquit;\n%end;"}}