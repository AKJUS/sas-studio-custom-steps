{"creationTimeStamp":"2022-10-14T14:32:50.672Z","modifiedTimeStamp":"2022-10-21T17:26:14.813Z","createdBy":"Stephan.Weigandt@sas.com","modifiedBy":"Stephan.Weigandt@sas.com","name":"Create Listing Of Directory CLOD.step","displayName":"Create Listing Of Directory CLOD.step","localDisplayName":"Create Listing Of Directory CLOD.step","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/356f9e7c-4cc6-4499-8ce0-cbb6b3ba1d72","uri":"/dataFlows/steps/356f9e7c-4cc6-4499-8ce0-cbb6b3ba1d72","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/356f9e7c-4cc6-4499-8ce0-cbb6b3ba1d72","uri":"/dataFlows/steps/356f9e7c-4cc6-4499-8ce0-cbb6b3ba1d72","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/356f9e7c-4cc6-4499-8ce0-cbb6b3ba1d72","uri":"/dataFlows/steps/356f9e7c-4cc6-4499-8ce0-cbb6b3ba1d72","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/356f9e7c-4cc6-4499-8ce0-cbb6b3ba1d72","uri":"/dataFlows/steps/356f9e7c-4cc6-4499-8ce0-cbb6b3ba1d72"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/356f9e7c-4cc6-4499-8ce0-cbb6b3ba1d72","uri":"/dataFlows/steps/356f9e7c-4cc6-4499-8ce0-cbb6b3ba1d72","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/356f9e7c-4cc6-4499-8ce0-cbb6b3ba1d72","uri":"/dataFlows/steps/356f9e7c-4cc6-4499-8ce0-cbb6b3ba1d72","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[],"outputPorts":[{"name":"outputtable_ui","displayName":"outputtable_ui","localDisplayName":"outputtable_ui","minEntries":1,"maxEntries":1,"type":"table","requiresStructure":false}]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"Essentials\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Essentials\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"root_directory_ui\",\n\t\t\t\t\t\"type\": \"path\",\n\t\t\t\t\t\"label\": \"Provide Root Directory (can be from within SAS Server or SAS Content)\",\n\t\t\t\t\t\"pathtype\": \"folder\",\n\t\t\t\t\t\"placeholder\": \"Select Root Directory\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"Extension_ui\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Extension\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"outputtable_ui\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Choose Output Table\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"work.directory_overview\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"General\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"General\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"clod_traverse_directories_ui\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Traverse Subdirectories?\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"1\",\n\t\t\t\t\t\t\t\"label\": \"Yes\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"0\",\n\t\t\t\t\t\t\t\"label\": \"No\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"include_directories_ui\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Include Directories in Output?\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"1\",\n\t\t\t\t\t\t\t\"label\": \"Yes\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"0\",\n\t\t\t\t\t\t\t\"label\": \"No\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"cas_save_on_disk_ui\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Should promoted table be saved on disk?\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"1\",\n\t\t\t\t\t\t\t\"label\": \"Yes\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"0\",\n\t\t\t\t\t\t\t\"label\": \"No\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$cas_promote_ui\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"1\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"cas_promote_ui\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"If a CAS library is selected, should table be promoted?\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"1\",\n\t\t\t\t\t\t\t\"label\": \"Yes\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"0\",\n\t\t\t\t\t\t\t\"label\": \"No\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"Admin\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Admin\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"debug_mode_ui\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Debug Mode?\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"1\",\n\t\t\t\t\t\t\t\"label\": \"Yes\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"0\",\n\t\t\t\t\t\t\t\"label\": \"No\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"write_log_into_file_ui\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Write Log into File? (\\\"Yes\\\" will open input field below for path selection)\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"1\",\n\t\t\t\t\t\t\t\"label\": \"Yes\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"0\",\n\t\t\t\t\t\t\t\"label\": \"No\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"log_file_path_ui\",\n\t\t\t\t\t\"type\": \"path\",\n\t\t\t\t\t\"label\": \"Path for logfile creation\",\n\t\t\t\t\t\"pathtype\": \"folder\",\n\t\t\t\t\t\"placeholder\": \"Select directory in SAS Server or SAS Content\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$write_log_into_file_ui\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"1\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"options_seq_ui\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Provide options to be applied for this run (only single options allowed like mprint, nosource, notes, etc).\",\n\t\t\t\t\t\"placeholder\": \"mprint notes source\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"About\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text1\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"CLOD: Create Listing Of Directory:\\nVersion: 3.1\\n\\nCLOD lists all files and directories that can be found under a provided (root-) directory.\\n\\nIf you have any questions, suggestions, ideas or any unexpected behavior, please contact:\\nstephan.weigandt@sas.com.\\n\\nHere is an overview of the available parameters:\\n\\n#### Provide Root Directory (can be from within SAS Server or SAS Content) - ROOT_DIRECTORY_UI\\n\\nProvide the top level directory that CLOD should use to start looking for files and subfolders. CLOD will then traverse through the whole directory structure and find all the files and folders below this top level directory. \\n\\nIf the root directory is in the SAS Server area, this has to start out with: sasserver: (e.g. example value for root_directory: sasserver:/mnt/desired/path/for/files_to_be_readin/from/SASServer/).\\n\\nIf the root directory is in the SAS Content area, this has to start out with: sascontent: (e.g. example value for root_directory: sascontent:/Public/desired_path_for/files/in/SASContent/).\\n\\n#### Extension - EXTENSION_UI\\n\\nDefault value: *\\n\\nif * is provided, all files are captured in the output. \\nOtherwise, any text string can provided, which will be used as a filter for the ending of the files. So only files will be captured that fall into this filter. \\n\\n#### Target Libname (CAS or 94, needs to exist) - TARGET_LIBNAME_UI\\n\\nThis can be any existing library accessible to SAS Studio. \\nIf it is a CASLIB, the table will NOT be promoted or saved to disk. \\nIf that is desired, this would need to happen outside the custom step. \\n\\n#### Name of Output Dataset? - OUTPUT_DATASET_NAME_UI\\n\\nProvide the output table name. \\n\\n#### Traverse Subdirectories? - CLOD_TRAVERSE_DIRECTORIES_UI\\n\\nSuggested default value: Yes (1)\\n\\nIf Yes is selected, CLOD will traverse all directories that can be found under directory provided in \\\"Root Directory\\\" parameter.\\nIf No is selected, CLOD will only look for files in selected directory. \\n\\n#### Include Directories in Output? - INCLUDE_DIRECTORIES_UI\\n\\nSuggested default value: No (0)\\n\\nIf No is selected, the output dataset doesn't contain the actual directory names, but only the files that could be found. \\nIf Yes is selected, the actual directory names are also captured, and an additional column is added to the output table (OBJECT_TYPE), which is either set to \\\"file\\\" or \\\"folder\\\".\\n\\n#### If a CAS library is selected, should table be promoted? - CAS_PROMOTE_UI\\n\\nSuggested default value: No (0)\\nThis selection is only applied if selected target library is a CAS library. \\nIf No is selected, the table is not promoted and stays only active for the local session.\\nIf Yes is selected, CLOD will promote the table. \\n\\n#### Should promoted table be saved on disk? - CAS_SAVE_ON_DISK_UI\\n\\nSuggested default value: No (0)\\nThis selection is only applied if selected target library is a CAS library and output table is promoted. \\nIf No is selected, the table is not saved on disk.\\nIf Yes is selected, CLOD will save table on disk and make it persistent. \\n\\n#### Debug Mode? - DEBUG_MODE_UI\\n\\nSuggested default value: No (0)\\n\\nIf set to 1, CLOD writes out more information out to the log, that might be helpful for further investigations.\\n\\nIf set to 0, CLOD just writes out the default SAS log output, depending on the settings of the options mprint, source and notes.\\n\\n#### Path for logfile creation - LOG_FILE_PATH_UI\\n\\nsuggested default value: empty/missing.\\n\\nThis parameter is only relevant when the parameter \\\"WRITE_LOG_INTO_FILE_UI\\\" is set to 1. \\n\\nProvide a default path for all runs: as soon as a path is provided, this path is being used for ALL runs.\\n\\nIf the log directory is in the SAS Server area, this has to start out with: sasserver: (e.g. example value for provide_default_log_path: sasserver:/mnt/desired/path/for/log_files_to_be_saved/on/SASServer/).\\n\\nIf the log directory is in the SAS Content area, this has to start out with: sascontent: (e.g. example value for provide_default_log_path: sascontent:/Public/desired_path_for/logfiles/in/SASContent/).\\n\\n#### Write Log into File? - WRITE_LOG_INTO_FILE_UI\\n\\nSuggested default value: No (0)\\n\\nIf set to 0, log is written into default SAS log location.\\n\\nIf set to 1, log is written to location as provided under the parameter \\\"LOG_FILE_PATH_UI\\\".\\n\\n#### Provide options to be applied for this run (only single options allowed like mprint, nosource, etc). - OPTIONS_SEQ_UI\\n\\nIf provided those options will be applied to the execution of the code. \\n\\n\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"root_directory_ui\": \"\",\n\t\t\"Extension_ui\": \"*\",\n\t\t\"outputtable_ui\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"clod_traverse_directories_ui\": {\n\t\t\t\"value\": \"1\",\n\t\t\t\"label\": \"Yes\"\n\t\t},\n\t\t\"include_directories_ui\": {\n\t\t\t\"value\": \"0\",\n\t\t\t\"label\": \"No\"\n\t\t},\n\t\t\"cas_save_on_disk_ui\": {\n\t\t\t\"value\": \"0\",\n\t\t\t\"label\": \"No\"\n\t\t},\n\t\t\"cas_promote_ui\": {\n\t\t\t\"value\": \"0\",\n\t\t\t\"label\": \"No\"\n\t\t},\n\t\t\"debug_mode_ui\": {\n\t\t\t\"value\": \"0\",\n\t\t\t\"label\": \"No\"\n\t\t},\n\t\t\"write_log_into_file_ui\": {\n\t\t\t\"value\": \"0\",\n\t\t\t\"label\": \"No\"\n\t\t},\n\t\t\"log_file_path_ui\": \"\",\n\t\t\"options_seq_ui\": \"\"\n\t},\n\t\"promptHierarchies\": []\n}","templates":{"SAS":"/******************************************************************************\n%adjust_option_setings_controlled\n________\nHelps to maintain option changes in a program flow.\n______________________________________________________________________________\n \nUSAGE:                         %adjust_option_setings_controlled(aosc_option_seq = ,\naosc_temp_option_storage_ds = ,\naosc_running_mode = ,\naosc_validvarname_setting =\n)\n______________________________________________________________________________\n \nDESCRIPTION:\n \nWhen option changes occur (only single word options allowed), then this macro\nhelps to maintain the original option setting, so at the end, the system can\nrevert back to the original settings.\n______________________________________________________________________________\n \nINPUT PARAMETERS AND KEYWORDS:\n \naosc_option_seq                    This can be a blank separated list of single word\nSAS options (e.g. like: source, notes, etc...).\nIf empty nothing happens in CHANGE mode.\naosc_temp_option_storage_ds     provide the full dataset name (e.g. work._aosc_setting_storage)\nwhere the original option values (of the ones that are\nprovided in AOSC_OPTION_SEQ) are stored.\naosc_running_mode                2 modes available:\nCHANGE: takes settings from AOSC_OPTION_SEQ and applies\nthose\nRESET: if AOSC_TEMP_OPTION_STORAGE_DS exists, this mode\nwill set options back according to content of\nthis dataset.\naosc_validvarname_setting         if not blank, validvarname will be set to the value\nas provided with this parameter\n_________________________________________________________________________\n \nCALLS: none.\n______________________________________________________________________________\n \nNOTES: (Initials, date, summary)\n \nStephan Weigandt    20220922  First officially Released Version\n______________________________________________________________________________\n \n*******************************************************************************/\n \n%macro adjust_option_setings_controlled(\naosc_option_seq = ,\naosc_temp_option_storage_ds = work._aosc_temp_option_storage_ds,\naosc_running_mode = ,\naosc_validvarname_setting =\n);\n \n \n%if %upcase(\"&aosc_running_mode\") = \"CHANGE\" %then\n%do;\ndata &aosc_temp_option_storage_ds;\nlength\nnew_setting $24.\noriginal_setting $24.\nnew_single_setting_seq $256.\n;\nnew_setting = \"\";\noriginal_setting = \"\";\nnew_single_setting_seq = \"\";\nnumberofsettings = 0;\nadditional_option_setting = 0;\nif 0;\nrun;\n \n%if \"&aosc_option_seq\" ne \"\" or\n\"&aosc_validvarname_setting\" ne \"\" %then\n%do;\ndata &aosc_temp_option_storage_ds;\nlength\nnew_setting $24.\noriginal_setting $24.\nnew_single_setting_seq $256.\n;\nnew_single_setting_seq = strip(\"&aosc_option_seq\");\n%if \"&aosc_validvarname_setting\" ne \"\" %then\n%do;\noriginal_setting = getoption(\"validvarname\");\nadditional_option_setting = 1;\nnew_setting = \"&aosc_validvarname_setting\";\noutput;\ncall execute(\"option validvarname = \"||new_Setting||\";\");\n%end;\n%if \"&aosc_option_seq\" ne \"\" %then\n%do;\nnumberofsettings = count(new_single_setting_seq, \" \") + 1;\nadditional_option_setting = 0;\ndo i = 1 to numberofsettings;\nnew_setting = \"\";\nnew_setting = scan(new_single_setting_seq, i, \" \");\nif not missing(new_setting) then\ndo;\noriginal_setting = getoption(new_setting);\noutput;\ncall execute(\"option \"||new_Setting||\";\");\nend;\nend;\n%end;\nrun;\n%end;\n%end;\n \n%if %upcase(\"&aosc_running_mode\") = \"RESET\" %then\n%do;\n%if %sysfunc(exist(&aosc_temp_option_storage_ds)) %then\n%do;\ndata _null_;\nset &aosc_temp_option_storage_ds;\nif additional_option_setting = 1 then\ndo;\ncall execute(\"option validvarname = \"||original_setting||\";\");\nend; else\ndo;\ncall execute(\"option \"||original_setting||\";\");\nend;\nrun;\n%end;\n%end;\n%mend adjust_option_setings_controlled;\n \n/** FOR TESTING ***\noption nomprint nosource notes ;\n%let option_seq = mprint notes source;\n%let running_mode = CHANGE;\n%let validvarname_setting = any;\n \n%put PRECHANGE;\n%put VALIDVARNAME: %sysfunc(getoption(validvarname));\n%put SOURCE: %sysfunc(getoption(source));\n%put NOTES: %sysfunc(getoption(notes));\n%put MPRINT: %sysfunc(getoption(mprint));\n \n%adjust_option_setings_controlled(\naosc_option_seq = &option_seq,\naosc_running_mode = &running_mode,\naosc_validvarname_setting = &validvarname_setting\n);\n \n%put POSTCHANGE;\n%put VALIDVARNAME: %sysfunc(getoption(validvarname));\n%put SOURCE: %sysfunc(getoption(source));\n%put NOTES: %sysfunc(getoption(notes));\n%put MPRINT: %sysfunc(getoption(mprint));\n \n \n%let running_mode = RESET;\n \n%adjust_option_setings_controlled(\naosc_running_mode = &running_mode\n);\n \n%put POSTRESET;\n%put VALIDVARNAME: %sysfunc(getoption(validvarname));\n%put SOURCE: %sysfunc(getoption(source));\n%put NOTES: %sysfunc(getoption(notes));\n%put MPRINT: %sysfunc(getoption(mprint));\n \n \n \n*********************/\n \n/**\nstore current SAS options settings, so they can be reset\nat the end of processing\n**/\n \n \n%adjust_option_setings_controlled(\naosc_option_seq = &options_seq_ui,\naosc_running_mode = CHANGE,\naosc_validvarname_setting = any\n);\n \n%let clod_delimiter = ;\n%macro set_os_dependent_values(\nsodv_delimiter = clod_delimiter\n);\n%if %upcase(&SYSSCP) = WIN %then\n%do;\n%let &sodv_delimiter = \\;\n%end; %else\n%do;\n%let &sodv_delimiter = /;\n%end;\n%mend set_os_dependent_values;\n%set_os_dependent_values(\nsodv_delimiter = clod_delimiter\n);\n \n/******************************************************************************\n \n%list_all_files\n________\n \n \ncreates a list of files, based on the provided extensions, that are available\nwithin a root directory. It automatically also checks all subdirectories.\n \n______________________________________________________________________________\n \n \nUSAGE:                         see testing section on the bottom of this code\n \n______________________________________________________________________________\n \nDESCRIPTION:\n \nThis macro creates a SAS dataset that lists all files that can be found within a\nroot directory and all subdirectories under the provided root directory.\nThis can be applied to all available files (by choosing \"*\" as extension),\nor for specific extensions.\n______________________________________________________________________________\n \n \nINPUT PARAMETERS AND KEYWORDS:\n \nlaf_root_dir                provide the top level directory from\nwhere to search for files.\nlaf_extenstion_to_check     can be the wildcard \"*\" or\nany extension, e.g. \"CSV\", \"XLM\" etc\n(provide without quotes)\nlaf_output_ds_file_overview       provide SAS datasets providing\nLIBNAME and SAS Dataset name\n______________________________________________________________________________\n \nNOTES: (Initials, date, summary)\n \nStephan Weigandt    20200406  First officially Released Version\nStephan Weigandt    20220610  expanded functionality to also cover\nSAS Content objects\n______________________________________________________________________________\n \n*******************************************************************************/\n \n%macro list_all_files(\nlaf_root_dir,\nlaf_extenstion_to_check,\nlaf_output_ds_file_overview,\nlaf_debug_mode = 0,\nlaf_directory_separator = /,\nlaf_traverse_directories = 1,\nlaf_is_sas_content_directory = 0,\nlaf_iteration_number = 0_0,\nlaf_include_directories = 0\n);\n%local\nfilrf\nrc\ndid\nmemcnt\nname\nlal_append_flag\nlal_length\ntot_obs\ntable_append_seq\nlaf_full_file_name\ni\nlaf_debug_text_\n;\n \n%let laf_debug_text_skipping = INFORMATION: Skipping due to extension:;\n%let laf_debug_text_scanning = INFORMATION: Scanning next directory:;\n%let lal_length = %length(&laf_root_dir);\n%if \"%substr(%trim(%left(&laf_root_dir)), &lal_length, 1)\" ne\n\"%trim(%left(&laf_directory_separator))\" %then\n%do;\n%let laf_root_dir = %trim(%left(&laf_root_dir))&laf_directory_separator;\n%end;\n%if &laf_iteration_number = 0_0 %then\n%do;\nproc datasets lib= work;\ndelete _LAF_spcl_list_files_:;\nquit;\n%end;\n%let laf_do_processing = 1;\n%if &laf_is_sas_content_directory = 0 %then\n%do;\nfilename f&laf_iteration_number \"&laf_root_dir\";\n%end; %else\n%do;\n%let laf_rc = 1;\ndata _null_;\nlength fref $ 8 folderPath $ 1024;\nfolderPath = \"&laf_root_dir\";\nfref=\"__isdir\";\nrcf = filename(fref, ,\n\"filesrvc\",\ncats('folderpath=',quote(strip(folderPath)))\n);\nput rcf;\ncall symput (\"laf_rc\", strip(rcf));\nrun;\n \n%if &laf_rc = 0 %then\n%do;\nfilename f&laf_iteration_number filesrvc folderpath=\"&laf_root_dir\";\n%end; %else\n%do;\n%let laf_do_processing = 0;\n%end;\n%end;\n%let laf_next_iteration = %eval(%scan(&laf_iteration_number, 1, '_') + 1);\n%let lal_append_flag = 0;\n%if %sysfunc(exist(work._LAF_spcl_list_files_&laf_iteration_number)) %then\n%do;\ndata work._LAF_spcl_list_files_&laf_iteration_number._inter;\nset work._LAF_spcl_list_files_&laf_iteration_number\n%if %sysfunc(exist(\nwork._LAF_spcl_list_files_&laf_iteration_number._inter\n)) %then\n%do;\nwork._LAF_spcl_list_files_&laf_iteration_number._inter\n%end;\n;\nrun;\n%let lal_append_flag = 1;\n%end;\ndata work._LAF_spcl_list_files_&laf_iteration_number ;\nkeep\ndirectory_path\nfull_file_name\nfile_name\nis_in_SAS_Content_flag\n%if &laf_include_directories = 1 %then\n%do;\nobject_type\n%end;\n;\nlength\ndirectory_path $768\nfile_name $256\nfull_file_name $1024\n%if &laf_include_directories = 1 %then\n%do;\nobject_type $12\n%end;\n;\nis_in_SAS_Content_flag = &laf_is_sas_content_directory;\ndirectory_path = symget(\"laf_root_dir\");\n%if &laf_do_processing = 1 %then\n%do;\ndid = dopen(\"f&laf_iteration_number\");\nmcount = dnum(did);\n/**\ncheck if directory exists or the correct area is chosen.\nif not set to 0 to prevent error message\n**/\nif missing(mcount) then\nmcount = 0;\ndo i=1 to mcount;\nfile_name = dread(did, i);\nfid = mopen(did, file_name);\nfileext = find(file_name,'.');\nextension = scan(file_name, -1, '.');\n/* fid=0 means directory in most cases */\nfull_file_name = STRIP(directory_path)||STRIP(file_name);\nif fid > 0 or fileext then\ndo;\nif \"&laf_extenstion_to_check\" = \"*\" or\nupcase(extension) = %upcase(\"&laf_extenstion_to_check\") then\ndo;\n%if &laf_debug_mode %then\n%do;\nput \"INFORMATION: Found following file:\" full_file_name;\n%end;\n%if &laf_include_directories = 1 %then\n%do;\nobject_type = \"file\";\n%end;\noutput;\nend;\n%if &laf_debug_mode %then\n%do;\nelse\ndo;\nput \"&laf_debug_text_skipping\" full_file_name;\nend;\n%end;\nend;\n%if &laf_traverse_directories = 1 %then\n%do;\nelse\ndo;\n%if &laf_debug_mode %then\n%do;\nput \"&laf_debug_text_scanning\" full_file_name;\n%end;\n%if &laf_include_directories = 1 %then\n%do;\nobject_type = \"folder\";\noutput;\n%end;\narg1 = cats('%nrstr(%list_all_files(',\nfull_file_name,\n\", &laf_extenstion_to_check,\"\n);\narg2 = cats(\"&laf_output_ds_file_overview,\nlaf_debug_mode = &laf_debug_mode,\"\n);\narg3 = cats(\"laf_directory_separator =\n&laf_directory_separator,\nlaf_traverse_directories =\n&laf_traverse_directories,\"\n);\narg3b = cats(\"laf_include_directories =\n&laf_include_directories, \"\n);\narg4 = cats(\"laf_is_sas_content_directory =\n&laf_is_sas_content_directory,\nlaf_iteration_number =\n&laf_next_iteration._\",i,\"))\"\n);\ncall execute(strip(arg1)||\nstrip(arg2)||\nstrip(arg3)||\nstrip(arg3b)||\nstrip(arg4)\n);\nend;\n%end;\nend;\nrc = dclose(did);\n%end;\n%else\n%do;\nfull_file_name = STRIP(substr(directory_path,\n1,\nlength(directory_path)-1)\n);\n%if &laf_include_directories = 1 %then\n%do;\nobject_type = \"file\";\n%end;\n \noutput;\n%end;\nrun;\n \n \n%let tot_obs = 0;\nproc sql noprint;\nselect nobs into :tot_obs\nfrom dictionary.tables\nwhere upcase(libname)='WORK' and\nupcase(memname)=\"_LAF_SPCL_LIST_FILES_&laf_iteration_number\";\nquit;\n%put total records = &tot_obs.;\n%if &tot_obs = 0 %then\n%do;\nproc datasets lib= work;\ndelete _LAF_SPCL_LIST_FILES_&laf_iteration_number;\nquit;\n%if lal_append_flag = 1 %then\n%do;\ndata work._LAF_spcl_list_files_&laf_iteration_number.;\nset work._LAF_spcl_list_files_&laf_iteration_number._inter;\nrun;\nproc datasets lib= work;\ndelete _LAF_spcl_list_files_&laf_iteration_number._inter;\nquit;\n%end;\n%end; %else\n%do;\n%if lal_append_flag = 1 %then\n%do;\ndata work._LAF_spcl_list_files_&laf_iteration_number.;\nset work._LAF_spcl_list_files_&laf_iteration_number.\nwork._LAF_spcl_list_files_&laf_iteration_number._inter;\nrun;\nproc datasets lib= work;\ndelete _LAF_spcl_list_files_&laf_iteration_number._inter;\nquit;\n%end;\n%end;\n \n%if &laf_iteration_number = 0_0 %then\n%do;\n%let table_append_seq = ;\nproc sql noprint;\nselect memname into :table_append_seq separated by \" \"\nfrom dictionary.tables\nwhere upcase(libname)='WORK' and\nupcase(memname)contains\"_LAF_SPCL_LIST_FILES_\";\nquit;\n%if \"&table_append_seq\" ne \"\" %then\n%do;\ndata work._laf_file_overview_sort;\nset &table_append_seq;\nrun;\nproc sort data =work._laf_file_overview_sort;\nby full_file_name\n%if &laf_include_directories = 1 %then\n%do;\ndescending object_type\n%end;\n;\nquit;\n \ndata &laf_output_ds_file_overview;\nset work._laf_file_overview_sort;\nby full_file_name;\n%if &laf_include_directories = 1 %then\n%do;\nif first.full_file_name ne last.full_file_name  then\ndo;\nobject_type = \"file\";\nend;\n%end;\nif first.full_file_name;\nrun;\n%end;\n \n \n%end;\n \n%if &laf_do_processing = 1 %then\n%do;\nfilename f&laf_iteration_number clear;\n%end;\n%mend list_all_files;\n/** FOR TESTING ***\n \n \noption mprint source notes;\n%let root_directory = /Users/<<MYUSERID>>/My Folder/SAS Videos;\n%let is_content_dir = 0;\n%let delimiter = /;\n%let delimiter = \\;\n%let include_directories = 1;\n%let extension = *;\n%let overview_ds = work.file_overview;\n%let traverse_directories = 1;\n%list_all_files(\n&root_directory,\n&extension,\n&overview_ds,\nlaf_traverse_directories = &traverse_directories,\nlaf_debug_mode = 1,\nlaf_directory_separator = /,\nlaf_is_sas_content_directory = &is_content_dir,\nlaf_include_directories = &include_directories\n);\n \n*********************/\n/******************************************************************************\n%wordcnt\n________\nCounts the words in a list\n______________________________________________________________________________\n \nUSAGE:                         %wordcnt(list,delim)\n______________________________________________________________________________\n \nDESCRIPTION:\n \nFinds the number of words/tokens in a string.  The user specifies a\ndelimiter e.g. # to identify what separates the words.  The macro should be\ncalled in the following way:\ne.g. %let x=%wordcnt(item1#item2 item2a#item3, '#').\nAfter running the macro x will be assigned the value of wordcnt.\n______________________________________________________________________________\n \nINPUT PARAMETERS AND KEYWORDS:\n \nlist            the name of the string.\ndelim           the delimiter e.g. '#'.\n_________________________________________________________________________\n \nCALLS: none.\n______________________________________________________________________________\n \nNOTES: (Initials, date, summary)\n \nStephan Weigandt    20200406  First officially Released Version\n______________________________________________________________________________\n \n*******************************************************************************/\n%macro wordcnt(\nlist,\ndelim\n)\n;\n%local\nword\nwc_count;\n%let wc_count = 0;\n%if %quote(&list) ne %then\n%do;\n%let word = %scan(%quote(&list), 1, &delim);\n%let word = %quote(&word);\n%do %while (&word ne);\n%let wc_count = %eval(&wc_count + 1);\n%let word = %scan(%quote(&list), &wc_count+1, &delim);\n%let word = %quote(&word);\n%end;\n%end;\n&wc_count\n%mend wordcnt;\n/** FOR TESTING ***\noption mprint source notes ;\n%let item_seq = a b c#d$f g #h#i$j;\n%let separator = '$' ;\n%let separator = '#' ;\n%let separator = ' ' ;\n%let number_of_items = %wordcnt(&item_seq, &separator);\n%put &=number_of_items;\n \n*********************/\n%macro execute_all();\n \n%let write_log_to_file = &write_log_into_file_ui;\n%if &write_log_to_file eq 1 %then\n%do;\n%let provide_default_log_path = %scan(&log_file_path_ui, 2, \":\")/;\n%let log_file_directory_source_ui = %scan(&log_file_path_ui, 1, \":\");\n \n%if \"%upcase(&log_file_directory_source_ui)\" eq \"SASSERVER\" %then\n%do;\n%let log_file_in_SAS_Content = 0;\n%end; %else\n%do;\n%let log_file_in_SAS_Content = 1;\n%end;\n \n/**\ndetermine and set todays date\n**/\ndata _null_;\ntodaysdate = today();\nyear = year(todaysdate);\nmonth = put(month(todaysdate), z2.);\nday = put(day(todaysdate), z2.);\nnowtime = time();\nhour = put(hour(nowtime), z2.);\nminute = put(minute(nowtime), z2.);\nput minute;\ntimestamp = trim(left(year))||\ntrim(left(month))||\ntrim(left(day))||\n\"_\"||\ntrim(left(hour))||\ntrim(left(minute));\ncall symput('timestamp', timestamp);\nrun;\n%let timestamp = %trim(%left(&timestamp));\n%if &debug_mode_ui = 1 %then\n%do;\n%put INFORMATION: Logfile location: &provide_default_log_path;\n%put INFORMATION: Logfile name : clod_run_&timestamp..log;\n%end;\n \n \n%if &log_file_in_SAS_Content = 1 %then\n%do;\nfilename logfl\nfilesrvc\nfolderpath = \"&provide_default_log_path\"\nfilename = \"clod_run_&timestamp..log\";\nfilename printfl\nfilesrvc\nfolderpath = \"&provide_default_log_path\"\nfilename = \"clod_run_&timestamp..out\";\n%end; %else\n%do;\nfilename logfl \"&provide_default_log_path.clod_run_&timestamp..log\";\nfilename printfl \"&provide_default_log_path.clod_run_&timestamp..out\";\n%end;\nproc printto\nlog=logfl new\nprint=printfl new;\nquit;\n%end;\n \n \n \n%put     &=debug_mode_ui    ;\n%put     &=clod_traverse_directories_ui    ;\n%put     &=extension_ui    ;\n%put     &=root_directory_ui    ;\n%put    &=log_file_path_ui;\n%let target_libname_ui = &outputtable_ui_lib;\n%let output_dataset_name_ui = &outputtable_ui_name;\n%put     &=target_libname_ui    ;\n%put     &=write_log_into_file_ui    ;\n%put    &=output_dataset_name_ui;\n%put    &=options_seq_ui;\n%let root_directory = %scan(&root_directory_ui, 2, \":\");\n%let root_dir_src = %upcase(%scan(&root_directory_ui, 1, \":\"));\n%let is_content_dir = 0;\n%if %upcase(\"&root_dir_src\") eq \"SASCONTENT\" %then\n%do;\n%let is_content_dir = 1;\n%end;\n%put &=root_directory;\n \n%let     target_libname    =    &target_libname_ui    ;\n%let     write_log_into_file    =    &write_log_into_file_ui    ;\n \n \n%let provide_default_log_path = ;\n%let log_file_directory_source_ui = ;\n%if \"&log_file_path_ui\" ne \"\" %then\n%do;\n%let provide_default_log_path = %scan(&log_file_path_ui, 2, \":\")/;\n%let log_file_directory_source_ui = %scan(&log_file_path_ui, 1, \":\");\n%end;\n%if \"%upcase(&log_file_directory_source_ui)\" eq \"SASSERVER\" %then\n%do;\n%let install_mode_in_SAS_Content = 0;\n%end; %else\n%do;\n%let install_mode_in_SAS_Content = 1;\n%end;\n%let target_environment = ;\nproc sql noprint;\nselect distinct(engine)\ninto :target_environment\nfrom dictionary.libnames\nwhere upcase(libname) = \"%upcase(&target_libname_ui)\"\n;\nquit;\n \n%if %upcase(&target_environment) = CAS %then\n%do;\n%if &cas_promote_ui = 1 %then\n%do;\nproc casutil     incaslib=\"&target_libname_ui\"\noutcaslib=\"&target_libname_ui\";\ndroptable casdata = \"&output_dataset_name_ui\" quiet;\ndroptable casdata = \"&output_dataset_name_ui\" quiet;\nquit;\n%end;\n%end;\n \n \n%let include_directories = 1;\n%let overview_ds = &target_libname_ui..&output_dataset_name_ui;\n%let traverse_directories = 1;\n%list_all_files(\n&root_directory,\n&extension_ui,\n&overview_ds,\nlaf_traverse_directories = &clod_traverse_directories_ui,\nlaf_debug_mode = &debug_mode_ui,\nlaf_directory_separator = &clod_delimiter,\nlaf_is_sas_content_directory = &is_content_dir,\nlaf_include_directories = &include_directories_ui\n);\n \n%if %upcase(&target_environment) = CAS %then\n%do;\n%if &cas_promote_ui = 1 %then\n%do;\nproc casutil     incaslib=\"&target_libname_ui\"\noutcaslib=\"&target_libname_ui\";\npromote casdata = \"&output_dataset_name_ui\"\ncasout=\"&output_dataset_name_ui\";\n%if &cas_save_on_disk_ui = 1 %then\n%do;\nsave     casdata= \"&output_dataset_name_ui\"\ncasout=\"&output_dataset_name_ui\" replace;\n%end;\nquit;\n \n%end;\n \n%end;\n \n%if &write_log_to_file = 1 %then\n%do;\nproc printto ;\nquit;\n%end;\n \n%mend execute_all;\n \n%execute_all();\n \n/**\nRestore original SAS options settings\n**/\n \n%adjust_option_setings_controlled(\naosc_running_mode = RESET\n);\n \n%if &debug_mode_ui ne 1 %then\n%do;\nproc datasets lib=work;\ndelete\n_clod:\n_LAF_:\n_aosc:\n;\nquit;\n%end;\n \n"}}