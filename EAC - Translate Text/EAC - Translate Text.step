{"creationTimeStamp":"2025-01-03T10:32:51.189Z","modifiedTimeStamp":"2025-01-03T10:38:30.972Z","createdBy":"gerdaw","modifiedBy":"gerdaw","name":"EAC - Translate Text.step","displayName":"EAC - Translate Text.step","localDisplayName":"EAC - Translate Text.step","description":"Translate text using the API from DeepL, it supports both the free and paid subscription plans. Please note that usage of this step requires an API token from DeepL.","localDescription":"Translate text using the API from DeepL, it supports both the free and paid subscription plans. Please note that usage of this step requires an API token from DeepL.","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/55e69139-3601-4908-ab7c-546f39b2b98c","uri":"/dataFlows/steps/55e69139-3601-4908-ab7c-546f39b2b98c","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/55e69139-3601-4908-ab7c-546f39b2b98c","uri":"/dataFlows/steps/55e69139-3601-4908-ab7c-546f39b2b98c","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/55e69139-3601-4908-ab7c-546f39b2b98c","uri":"/dataFlows/steps/55e69139-3601-4908-ab7c-546f39b2b98c","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/55e69139-3601-4908-ab7c-546f39b2b98c","uri":"/dataFlows/steps/55e69139-3601-4908-ab7c-546f39b2b98c"},{"method":"POST","rel":"copy","href":"/dataFlows/steps/55e69139-3601-4908-ab7c-546f39b2b98c/copy","uri":"/dataFlows/steps/55e69139-3601-4908-ab7c-546f39b2b98c/copy","responseType":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/55e69139-3601-4908-ab7c-546f39b2b98c","uri":"/dataFlows/steps/55e69139-3601-4908-ab7c-546f39b2b98c","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/55e69139-3601-4908-ab7c-546f39b2b98c","uri":"/dataFlows/steps/55e69139-3601-4908-ab7c-546f39b2b98c","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[{"name":"inputTable","displayName":"inputTable","localDisplayName":"inputTable","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table"}],"outputPorts":[{"name":"outTable","displayName":"outTable","localDisplayName":"outTable","description":"Adding the translated text as an additional column to the output table.","localDescription":"Adding the translated text as an additional column to the output table.","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table","columnDelta":{"updateColumnArguments":["transColName"],"automaticMapping":[{"inputPort":"inputTable","inputPortName":"inputTable"}]},"supportsView":false,"requiresStructure":false}]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"pageDefinition\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Definition\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text1\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"To translate the text it is seend to DeepL via HTTPS. Please ensure that you are allowed to use this service.\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"inputTable\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Table that contains the text that needs translating\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"outTable\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Table that will contain the translated text\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"authToken\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Enter your DeepL API token:\",\n\t\t\t\t\t\"placeholder\": \"Token or macro variable storing the token\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"subscriptionType\",\n\t\t\t\t\t\"type\": \"dropdown\",\n\t\t\t\t\t\"label\": \"Select your DeepL subscription type:\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"api-free\",\n\t\t\t\t\t\t\t\"label\": \"DeepL API Free\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"api\",\n\t\t\t\t\t\t\t\"label\": \"DeepL API Pro\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text5\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"The DeepL API requires language codes to be provided as ISO 639-1 codes, e.g. DE is German.\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"langSel\",\n\t\t\t\t\t\"type\": \"columnselector\",\n\t\t\t\t\t\"label\": \"Select the column containing source language:\",\n\t\t\t\t\t\"order\": false,\n\t\t\t\t\t\"columntype\": \"c\",\n\t\t\t\t\t\"max\": 1,\n\t\t\t\t\t\"min\": 1,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"table\": \"inputTable\",\n\t\t\t\t\t\"include\": null\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"textToTranslate\",\n\t\t\t\t\t\"type\": \"columnselector\",\n\t\t\t\t\t\"label\": \"Select column containing text needing translation:\",\n\t\t\t\t\t\"order\": false,\n\t\t\t\t\t\"columntype\": \"c\",\n\t\t\t\t\t\"max\": 1,\n\t\t\t\t\t\"min\": 1,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"table\": \"inputTable\",\n\t\t\t\t\t\"include\": null\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"transColName\",\n\t\t\t\t\t\"type\": \"newcolumn\",\n\t\t\t\t\t\"label\": \"Translated column name:\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"hideproperties\": false,\n\t\t\t\t\t\"readonly\": false\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"targetLang\",\n\t\t\t\t\t\"type\": \"dropdown\",\n\t\t\t\t\t\"label\": \"Select the language to translate text into:\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"DE\",\n\t\t\t\t\t\t\t\"label\": \"German\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"EN\",\n\t\t\t\t\t\t\t\"label\": \"English\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"FR\",\n\t\t\t\t\t\t\t\"label\": \"French\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"IT\",\n\t\t\t\t\t\t\t\"label\": \"Italian\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"pageAbout\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"textAbout\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"EAC - Translate Text step\\n==========\\n\\nThe \\\"EAC - Translate Text\\\" translates texts using the DeepL API. \\n\\nThe usage of this step requires an account with DeepL, to generate an API token.\\n\\nTo get the DeepL API token go to https://www.deepl.com/account/summary, select the Account tab and then under the section Authentication Key for DeepL API copy your key.\\n\\nPlease check the terms and conditions of DeepL on their website https://www.deepl.com, before using this step.\\n\\nError Handling, there is two common HTTP Status Codes that you might encounter:\\nHTTP 429: too many requests. Your application should be configured to resend the request after some delay, rather than constantly resending the request - this usually solved by switching to a higher subscription plan.\\n\\nHTTP 456: quota exceeded. The translation limit of your account has been reached - this can be solved by switching your subscription plan.\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionPrereqs\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Pre-requisites\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textPrereqs\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"Pre-requisites:  Tested on Viya version Stable 2023.04 and a DeepL API token\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionDocumentation\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Documentation\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textDocumentation\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"* Check the DeepL website for terms and conditions at https://www.deepl.com\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionChangelog\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Changelog\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textChangelog\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"* Version 1.1 (03JAN2025)\\n     - Added EAC category name prefix\\n     - Updated the About page to the current template\\n\\n* Version: 1.0 (10MAY2023)\\n      - Initial version\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"inputTable\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"outTable\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"authToken\": \"\",\n\t\t\"subscriptionType\": {\n\t\t\t\"value\": \"api-free\",\n\t\t\t\"label\": \"DeepL API Free\"\n\t\t},\n\t\t\"langSel\": [],\n\t\t\"textToTranslate\": [],\n\t\t\"transColName\": {\n\t\t\t\"value\": \"_tt_text\",\n\t\t\t\"label\": \"The text that was translated by DeepL\"\n\t\t},\n\t\t\"targetLang\": {\n\t\t\t\"value\": \"DE\",\n\t\t\t\"label\": \"German\"\n\t\t}\n\t},\n\t\"columnExclusions\": [\n\t\t[\n\t\t\t\"textToTranslate\",\n\t\t\t\"langSel\"\n\t\t]\n\t]\n}","templates":{"SAS":"* Call the DeepL API - takes in a ID to get the text that needs translating;\n%macro _tt_translate(_tt_temp_ID);\n\tdata _null_;\n\t\tset work._tt_tmp_out(keep=_tt_ID &textToTranslate_1_name_base. &langSel_1_name_base. where=(_tt_ID=&_tt_temp_ID.));\n\n\t\t_tt_encoded = strip(&textToTranslate_1_name_base.);\n\t\tcall symputx('_tt_toTranslate', _tt_encoded);\n\t\tcall symputx('_tt_source_lang', &langSel_1_name_base.);\n\trun;\n\n\tfilename deepL temp;\n\tproc http\n\t\turl = \"https://&subscriptionType..deepl.com/v2/translate\"\n\t\tct = 'application/x-www-form-urlencoded'\n\t\tin = form(\"target_lang\" = \"&targetLang.\"\n\t\t\t\t\"source_lang\" = \"&_tt_source_lang.\"\n\t\t\t\t\"text\" = \"&_tt_toTranslate.\")\n\t    out = deepL;\n\t    headers\n\t        'Accept' = 'application/json'\n\t\t\t'Authorization' = \"DeepL-Auth-Key %unquote(&authToken.)\";\n\trun;\n\tlibname deepL json;\n\n\tdata _null_;\n\t\tif &SYS_PROCHTTP_STATUS_CODE. ge 400 then do;\n\t\t\tstr = \"ERROR: DeepL responded with &SYS_PROCHTTP_STATUS_CODE. for the Text &_tt_toTranslate.\";\n    \t\tputlog str;\n  \t\tend;\n\trun;\n\n\tdata work._tt_tmp_translated;\n\t\tlength _tt_ID 8. &transColName_name_base. $32000.;\n\t\tlabel _tt_ID = 'Temporary ID variable for joining the data back to the results table'\n\t\t\t&transColName_name_base. = 'Contains the translated text';\n\t\tset deepL.translations(keep=text rename=(text=&transColName_name_base.));\n\n\t\t_tt_ID = &_tt_temp_ID.;\n\trun;\n\n\tlibname deepL clear;\n\tfilename deepL clear;\n\n\tproc append base=work._tt_translated data=work._tt_tmp_translated;\n\trun;\n%mend _tt_translate;\n\n* TEMP base table that will be dropped at the end;\ndata work._tt_translated;\n\tlength _tt_ID 8. &transColName_name_base. $32000.;\n\tlabel _tt_ID = 'Temporary ID variable for joining the data back to the results table'\n\t\t&transColName_name_base. = 'Contains the translated text';\nrun;\n\n* Call the macro and add the TEMP ID;\ndata work._tt_tmp_out(drop=arg);\n\tlength _tt_ID 8.;\n\tset &inputTable.;\n\t\n\t_tt_ID = _n_;\n\targ = '%nrstr(%_tt_translate('!! _tt_ID !!'));';\n\tcall execute(arg);\nrun;\n\n* Join the translated text with the original table;\nproc sql;\n\tcreate table work._tt_tmp_out_2 as\n\t\tselect a.*, b.&transColName_name_base.\n\t\t\tfrom work._tt_tmp_out as a\n\t\t\t\tleft join work._tt_translated as b\n\t\t\t\t\ton a._tt_ID = b._tt_ID;\nrun;\n\n* Write output for step user;\ndata &outTable.;\n\tset work._tt_tmp_out_2(drop=_tt_ID);\nrun;\n\n* Clean up;\n%sysmacdelete _tt_translate;\nproc datasets library=work nolist;\n\tdelete _tt_translated _tt_tmp_translated _tt_tmp_out _tt_tmp_out_2;\nrun;"}}