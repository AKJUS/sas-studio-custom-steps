{"type":"code","name":"GEO - Apply Shape Reduce.step","displayName":"GEO - Apply Shape Reduce.step","description":"","templates":{"SAS":"/*-----------------------------------------------------------------------------------------*\n   This macro creates a global macro variable called _usr_nameCaslib\n   that contains the caslib name (aka. caslib-reference-name) associated with the libname \n   and assumes that the libname is using the CAS engine.\n\n   As sysvalue has a length of 1024 chars, we use the trimmed option in proc sql\n   to remove leading and trailing blanks in the caslib name.\n   From macro provided by Wilbram Hazejager\n*------------------------------------------------------------------------------------------*/\n\n%macro _usr_getNameCaslib(_usr_LibrefUsingCasEngine); \n\n   %global _usr_nameCaslib;\n   %let _usr_nameCaslib=;\n\n   proc sql noprint;\n      select sysvalue into :_usr_nameCaslib trimmed from dictionary.libnames\n      where libname = upcase(\"&_usr_LibrefUsingCasEngine.\") and upcase(sysname)=\"CASLIB\";\n   quit;\n\n%mend _usr_getNameCaslib;\n\ndata _reduced_shape_;\n\tset &inputtable1;\n\twhere DENSITY <= &densitylevel;\nrun;\n\ncas reduce_shape;\ncaslib _all_ assign;\noptions MSGLEVEL=I;\noption casdatalimit=all mprint symbolgen;\n\n%macro Promotion();\n\n%if \"&promotion\" = \"Yes\" %then\n\t%do;\t\t\n\n\t\t/*-----------------------------------------------------------------------------------------*\n\t\t   Check Output table libref to ensure it points to a valid caslib.\n\t\t*------------------------------------------------------------------------------------------*/\n\t\t\n\t\t %_usr_getNameCaslib(&outputtable1_lib.);\n\t\t %let inputCaslib=&_usr_nameCaslib.;\n\t\t %put NOTE: &inputCaslib. is the caslib for the output table.;\n\t\t %let _usr_nameCaslib=;\n\t\t\n\t\t %if \"&inputCaslib.\" = \"\" %then %do;\n\t\t    %put ERROR: The output Library should refer to a valid CAS output. ;\n\t\t    %let _nctf_error_flag=1;\n\t\t %end;\n\t\t\n\t\tproc casutil outcaslib=\"&outputtable1_lib\" ;\n\t\t\tdroptable casdata=\"&outputtable1_name\" QUIET; \n\t\t \tload data=_reduced_shape_ casout=\"&outputtable1_name\" promote ;\n\t\t\tsave  incaslib=\"&outputtable1_lib\" casdata=\"&outputtable1_name\" replace;\n\t\tquit;\n\n%end;\n\n%mend Promotion;\n\n%Promotion();\n\n%macro Clean();\n\n\tproc delete data=work._reduced_shape_; run;\n\t\n\t%if %symexist(densitylevel) %then %do;  \t\n\t\t%symdel densitylevel; \n\t%end;\n\n\t%if %symexist(promotion) %then %do;  \t\n\t\t%symdel promotion; \n\t%end;\n\n%mend Clean;\n\n%Clean();\n\n"},"properties":{},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"ShapeReduce\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Parameters\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"inputtable1\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Input table label 1:\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"WHATSDENSITY\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Density\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"text4\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"If the custom step Import Shape have been selected \\\"Yes\\\" for the reduction analysis, here is possible to decide how many points to include in the final table selecting the value of the density in the drop down list.\\n\\nThe number of points for each value of density has been printed in the output of the Import Shape custom step.\\n\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"DENSITY\",\n\t\t\t\t\t\t\t\"type\": \"columnselector\",\n\t\t\t\t\t\t\t\"label\": \"Density column:\",\n\t\t\t\t\t\t\t\"order\": false,\n\t\t\t\t\t\t\t\"columntype\": \"a\",\n\t\t\t\t\t\t\t\"max\": 1,\n\t\t\t\t\t\t\t\"min\": null,\n\t\t\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\t\t\"table\": \"inputtable1\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"densitylevel\",\n\t\t\t\t\t\t\t\"type\": \"dropdown\",\n\t\t\t\t\t\t\t\"label\": \"Select the level of density to retain in the table:\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"ref\": \"DENSITY\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"outputtable1\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Output table label 1:\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"section1\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Promoting\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"text5\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"Using this option is possible to promote the resulting table to a CASLIB.\\n\\nIMPORTANT: always select a valid CASLIB as output if you want to promote the output table\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"promotion\",\n\t\t\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\t\t\"label\": \"Do you want to to promote the output table?\",\n\t\t\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\"value\": \"Yes\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\"value\": \"No\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"page2\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text1\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Apply Shape Reduce\\n===============\\n\\nThis custom step allows the reduction of a shape file, using the result of PROC GREDUCE used in the Import Shape Custom Step.\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionPrereqs\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"PRE-REQUISITES\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textPrereqs\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"To run this custom step is required to run first the Import Shape custom step and select the \\\"Yes\\\" in the option Proc Greduce Analysis.\\nThe input port has to be connected to the output table of the Import Shape custom step.\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"USERINTERFACE\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"USER INTERFACE\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"text3\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"The user has to select the level of density to retain in the table:\\n\\nIf 0 is selected the output table will have only rows with DENSITY = 0\\nIf 3 is selected the output table will have all the rows with DENSITY <= 3\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionDocumentation\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Documentation\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textDocumentation\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"PROC GREDUCE\\n\\nhttps://go.documentation.sas.com/doc/en/pgmmvacdc/9.4/grmapref/n0grevqu4asrarn1lmo5eblj0sxz.htm\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"ChangeLog\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Change Log\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"text2\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"- Version 1.0 (21DEC2023) \\n    - Initial version\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"inputtable1\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"DENSITY\": [\n\t\t\t{\n\t\t\t\t\"value\": \"DENSITY\"\n\t\t\t}\n\t\t],\n\t\t\"densitylevel\": null,\n\t\t\"outputtable1\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"promotion\": {\n\t\t\t\"value\": \"Yes\"\n\t\t}\n\t}\n}","flowMetadata":{"inputPorts":[{"name":"inputtable1","displayName":"inputtable1","description":"","minEntries":1,"maxEntries":1,"type":"table"}],"outputPorts":[{"name":"outputtable1","displayName":"outputtable1","description":"","minEntries":1,"maxEntries":1,"columnDelta":null,"type":"table"}]}}