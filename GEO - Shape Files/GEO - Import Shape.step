{"type":"code","name":"GEO - Import Shape.step","displayName":"GEO - Import Shape.step","description":"","templates":{"SAS":"cas import_shape;\ncaslib _all_ assign;\noptions MSGLEVEL=I;\noption casdatalimit=all mprint symbolgen;\n%let SHAPE = %scan(\"&fileorfolderselector1\", 3, \":\", \"MO\");\n\n/*-----------------------------------------------------------------------------------------*\n   This macro creates a global macro variable called _usr_nameCaslib\n   that contains the caslib name (aka. caslib-reference-name) associated with the libname \n   and assumes that the libname is using the CAS engine.\n\n   As sysvalue has a length of 1024 chars, we use the trimmed option in proc sql\n   to remove leading and trailing blanks in the caslib name.\n   From macro provided by Wilbram Hazejager\n*------------------------------------------------------------------------------------------*/\n\n%macro _usr_getNameCaslib(_usr_LibrefUsingCasEngine); \n\n   %global _usr_nameCaslib;\n   %let _usr_nameCaslib=;\n\n   proc sql noprint;\n      select sysvalue into :_usr_nameCaslib trimmed from dictionary.libnames\n      where libname = upcase(\"&_usr_LibrefUsingCasEngine.\") and upcase(sysname)=\"CASLIB\";\n   quit;\n\n%mend _usr_getNameCaslib;\n\n%macro reduce();\n\n\t%if \"&usedshapeINFO\" = \"Yes\" %then \n      %do;\n\n\t\tdata _import_shape_;\n\t\tset &inputtable1;\n\t\t__seq__ = _n_;\n\t\trun;\n\n\t\tods html ;\n\t\ttitle j=center color=Black \"Example of map using \"\n\t\tunderlin=1 \"&IDcolumn\" \n\t\tunderlin=0 \" as ID variable\";\n\n\t\tproc gmap map=_import_shape_ data=_import_shape_ all;\n\t\t   id &IDcolumn;\n\t\t   choro &IDcolumn / discrete;\n\t\trun;\n\n\t\tods html close;\n\n\t\t%if \"&promotion\" = \"Yes\" %then\n\t      %do;\t\t\n\n\t\t\t/*-----------------------------------------------------------------------------------------*\n\t\t\t   Check Output table libref to ensure it points to a valid caslib.\n\t\t\t*------------------------------------------------------------------------------------------*/\n\n\t\t     %_usr_getNameCaslib(&outputtable1_lib.);\n\t\t     %let inputCaslib=&_usr_nameCaslib.;\n\t\t     %put NOTE: &inputCaslib. is the caslib for the output table.;\n\t\t     %let _usr_nameCaslib=;\n\t\t\n\t\t     %if \"&inputCaslib.\" = \"\" %then %do;\n\t\t        %put ERROR: The output Library should refer to a valid CAS output. ;\n\t\t        %let _nctf_error_flag=1;\n\t\t     %end;\n\t\t\t\n\t\t\tproc casutil outcaslib=\"&outputtable1_lib\" ;\n\t\t\t\tdroptable casdata=\"&outputtable1_name\" QUIET; \n\t\t\t \tload data=_import_shape_ casout=\"&outputtable1_name\" promote ;\n\t\t\t\tsave  incaslib=\"&outputtable1_lib\" casdata=\"&outputtable1_name\" replace;\n\t\t\tquit;\n\n\t\t%end;\n\t\t\n\t\t%if \"&reduceanalysis\" = \"Yes\" %then\n\t      %do;\n\t\t\t\n\t\t\tproc  greduce data=_import_shape_ out=&outputtable1;\n\t\t\t\tid &IDcolumn;\n\t\t\trun;\n\t\n\t\t\tproc sql noprint;\n\t\t\t\tcreate table Info as\n\t\t\t\tselect\tt1.Density,\n\t\t\t\t\tcount(Density) as N_Points\n\t\t\t\tfrom &outputtable1 t1\n\t\t\t\tgroup by Density;\n\t\t\tquit;\n\t\n\t\t\tdata Info (keep= density N_Points_Cumulative);\n\t\t\t    set info;\n\t\t\t    by DENSITY;\n\t\t\t\tretain cum_N_Points;\n\t\t\t    cum_N_Points+N_Points;\n\t\t\t\trename cum_N_Points = N_Points_Cumulative;\n\t\t\trun;\n\n\t\t\tods html ;\n\t\t\ttitle j=center color=Black \"Number of points for each density\";\n\t\n\t\t\tproc print data=Info;\n\t\t\trun;\n\n\t\t\tods html close;\n\n\t\t%end;\n\n   %end;\n   %else %if \"&usedshapeINFO\" = \"No\" %then\n      %do;\n\n\t\tproc mapimport datafile=\"&SHAPE\" out=_import_shape_;\n\t\t\tid &IDNAME;\n\t\trun;\n\n\t\tdata _import_shape_;\n\t\t\tset _import_shape;\n\t\t\t__seq__ = _n_;\n\t\trun;\n\n\t\tods html ;\n\t\ttitle j=center color=Black \"Example of map using \"\n\t\tunderlin=1 \"&IDNAME\" \n\t\tunderlin=0 \" as ID variable\";\n\n\t\tproc gmap map=_import_shape_ data=_import_shape_ all;\n\t\t   id &IDNAME;\n\t\t   choro &IDNAME / discrete;\n\t\trun;\n\n\t\tods html close;\n\n\t\t%if \"&promotion\" = \"Yes\" %then\n\t      %do;\t\t\n\n\t\t\t/*-----------------------------------------------------------------------------------------*\n\t\t\t   Check Output table libref to ensure it points to a valid caslib.\n\t\t\t*------------------------------------------------------------------------------------------*/\n\n\t\t     %_usr_getNameCaslib(&outputtable1_lib.);\n\t\t     %let inputCaslib=&_usr_nameCaslib.;\n\t\t     %put NOTE: &inputCaslib. is the caslib for the output table.;\n\t\t     %let _usr_nameCaslib=;\n\t\t\n\t\t     %if \"&inputCaslib.\" = \"\" %then %do;\n\t\t        %put ERROR: The output Library should refer to a valid CAS output. ;\n\t\t        %let _nctf_error_flag=1;\n\t\t     %end;\n\t\t\t\n\t\t\tproc casutil outcaslib=\"&outputtable1_lib\" ;\n\t\t\t\tdroptable casdata=\"&outputtable1_name\" QUIET; \n\t\t\t \tload data=_import_shape_ casout=\"&outputtable1_name\" promote ;\n\t\t\t\tsave  incaslib=\"&outputtable1_lib\" casdata=\"&outputtable1_name\" replace;\n\t\t\tquit;\n\n\t\t%end;\n\t\t\n\t\t%if \"&reduceanalysis\" = \"Yes\" %then\n\t      %do;\n\t\t\t\n\t\t\tproc  greduce data=_import_shape_ out=&outputtable1;\n\t\t\t\tid &IDNAME;\n\t\t\trun;\n\t\n\t\t\tproc sql noprint;\n\t\t\t\tcreate table Info as\n\t\t\t\tselect\tt1.Density,\n\t\t\t\t\tcount(Density) as N_Points\n\t\t\t\tfrom &outputtable1 t1\n\t\t\t\tgroup by Density;\n\t\t\tquit;\n\t\n\t\t\tdata Info (keep= density N_Points_Cumulative);\n\t\t\t    set info;\n\t\t\t    by DENSITY;\n\t\t\t\tretain cum_N_Points;\n\t\t\t    cum_N_Points+N_Points;\n\t\t\t\trename cum_N_Points = N_Points_Cumulative;\n\t\t\trun;\n\n\t\t\tods html ;\n\t\t\ttitle j=center color=Black \"Number of points for each density\";\n\t\n\t\t\tproc print data=Info;\n\t\t\trun;\n\n\t\t\tods html close;\n\t\n\t\t%end;\n\n\t%end;\n\n%mend reduce;\n\n%reduce();\n\n\n\n%macro Clean();\n\n\tproc delete data=work.Info; run;\n\tproc delete data=work._import_shape_; run;\n\t\n\t%if %symexist(SHAPE) %then %do;  \t\n\t\t%symdel SHAPE; \n\t%end;\n\n\t%if %symexist(promotion) %then %do;  \t\n\t\t%symdel promotion; \n\t%end;\n\n%mend Clean;\n\n%Clean();"},"properties":{},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"ShapeImport\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Parameters\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"usedshapeINFO\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Has the List Shape Info Custom Step been used?\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"Yes\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"No\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"fileorfolderselector1\",\n\t\t\t\t\t\"type\": \"path\",\n\t\t\t\t\t\"label\": \"Select the shape file import:\",\n\t\t\t\t\t\"pathtype\": \"file\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$usedshapeINFO\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"No\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"inputtable1\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Label for the input table\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"readonly\": false\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"IDcolumn\",\n\t\t\t\t\t\"type\": \"columnselector\",\n\t\t\t\t\t\"label\": \"Select the ID column:\",\n\t\t\t\t\t\"order\": false,\n\t\t\t\t\t\"columntype\": \"a\",\n\t\t\t\t\t\"max\": 1,\n\t\t\t\t\t\"min\": null,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$usedshapeINFO\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"Yes\"\n\t\t\t\t\t],\n\t\t\t\t\t\"readonly\": false,\n\t\t\t\t\t\"table\": \"inputtable1\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"IDNAME\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Name of the ID column:\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$usedshapeINFO\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"No\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"outputtable1\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Label for the output table\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"reduceanalysis\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Do you want to analyze the shape to reduce its dimension?\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"Yes\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"No\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"section1\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Promoting\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"text5\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"Using this option is possible to promote the resulting table to a CASLIB.\\n\\nIMPORTANT: always select a valid CASLIB as output if you want to promote the output table.\\n\\nNOTE: if has been chosen to analyse the table for reduction, it is advisable to promote the table after performing the reduction.\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"promotion\",\n\t\t\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\t\t\"label\": \"Do you want to to promote the output table?\",\n\t\t\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\"value\": \"Yes\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\"value\": \"No\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"About\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text1\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Import Shape\\n==========\\n\\nThis custom step imports and analyzes a shape file (.shp).\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"USERINTERFACE\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"USER INTERFACE\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"text3\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"If the custom step List Shape Info has been used select \\\"Yes\\\" to speed up the import process. The input port has to be connected to the output table of the List Shape Info custom step.\\n\\nSelect the shape file import: select the file to import.\\n\\nSelect the ID column: if the custom step \\\"List Shape Info\\\" has been used, this selector allow to choose the ID column from a list of variables.\\n\\nLabel for the output table: select the name of the output table of the process.\\n\\nReduce Analysis: choose YES to analyze the table with the PROC GREDUCE, will be printed a table with the information about the densities of the shape file. Choosing NO it will be possile to promote the resulting table to a CASLIB.\\n\\nOutput Port: Output table of the process.\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"NOTES\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"PLEASE NOTE\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"text4\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"To use this custom step is mandatory to download on the server not only the *.shp file, but also all the other shapefile metadata files namely : *.dbf, *.prj, *.shx\\n\\nThis custom step require SAS/GRAPH.\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionDocumentation\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Documentation\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textDocumentation\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"PROC MAPIMPORT\\n\\nhttps://go.documentation.sas.com/doc/en/pgmmvacdc/9.4/grmapref/p0qsj9oazola04n10usle21dvk67.htm\\n\\nPROC GMAP\\n\\nhttps://go.documentation.sas.com/doc/en/pgmmvacdc/9.4/grmapref/n01e0bon6tv6ncn1a7dlrr5fh5tr.htm\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"ChangeLog\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Change Log\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"text2\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"- Version 1.0 (21DEC2023) \\n    - Initial version\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"usedshapeINFO\": {\n\t\t\t\"value\": \"Yes\"\n\t\t},\n\t\t\"fileorfolderselector1\": \"\",\n\t\t\"inputtable1\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"IDcolumn\": [],\n\t\t\"IDNAME\": \"\",\n\t\t\"outputtable1\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"reduceanalysis\": {\n\t\t\t\"value\": \"Yes\"\n\t\t},\n\t\t\"promotion\": {\n\t\t\t\"value\": \"Yes\"\n\t\t}\n\t}\n}","flowMetadata":{"inputPorts":[{"name":"inputtable1","displayName":"inputtable1","description":"","minEntries":0,"maxEntries":1,"type":"table"}],"outputPorts":[{"name":"outputtable1","displayName":"outputtable1","description":"","minEntries":1,"maxEntries":1,"columnDelta":null,"type":"table"}]}}