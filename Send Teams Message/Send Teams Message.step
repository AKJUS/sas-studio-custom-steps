{"creationTimeStamp":"2022-11-27T14:22:29.079Z","modifiedTimeStamp":"2022-12-12T16:56:29.577Z","createdBy":"viyademo01","modifiedBy":"viyademo01","name":"Send Teams Message.step","displayName":"Send Teams Message.step","localDisplayName":"Send Teams Message.step","description":"Send a message to a Microsoft Teams channel. Created by Tamara Fischer & David Weik","localDescription":"Send a message to a Microsoft Teams channel. Created by Tamara Fischer & David Weik","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/090fb6b5-9ca5-4de9-9f91-61bbc372c588","uri":"/dataFlows/steps/090fb6b5-9ca5-4de9-9f91-61bbc372c588","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/090fb6b5-9ca5-4de9-9f91-61bbc372c588","uri":"/dataFlows/steps/090fb6b5-9ca5-4de9-9f91-61bbc372c588","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/090fb6b5-9ca5-4de9-9f91-61bbc372c588","uri":"/dataFlows/steps/090fb6b5-9ca5-4de9-9f91-61bbc372c588","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/090fb6b5-9ca5-4de9-9f91-61bbc372c588","uri":"/dataFlows/steps/090fb6b5-9ca5-4de9-9f91-61bbc372c588"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/090fb6b5-9ca5-4de9-9f91-61bbc372c588","uri":"/dataFlows/steps/090fb6b5-9ca5-4de9-9f91-61bbc372c588","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/090fb6b5-9ca5-4de9-9f91-61bbc372c588","uri":"/dataFlows/steps/090fb6b5-9ca5-4de9-9f91-61bbc372c588","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[{"name":"inputtable1","displayName":"inputtable1","localDisplayName":"inputtable1","minEntries":0,"maxEntries":1,"type":"table"}],"outputPorts":[]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"inPage\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Message Definition\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"linkInFlow\",\n\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\"label\": \"Connect to a table (only serves to visually connect the step to a table)\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text3\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Visually link this step to a table by right clicking it, Add input port and connecting the table.\\n\\nThis only serves as a visual connection, no actual information is exchanged.\",\n\t\t\t\t\t\"visible\": \"$linkInFlow\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"inputtable1\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Used to visually link in a flow\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"placeholder\": \"Used to visually link in a flow\",\n\t\t\t\t\t\"visible\": \"$linkInFlow\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"teams_endpoint\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Webhook of Teams channel:\",\n\t\t\t\t\t\"placeholder\": \"Please enter the endpoint of your Teams Channel\",\n\t\t\t\t\t\"required\": true\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"messageType\",\n\t\t\t\t\t\"type\": \"dropdown\",\n\t\t\t\t\t\"label\": \"Select the message type:\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"simple\",\n\t\t\t\t\t\t\t\"label\": \"Simple Text Message\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"info\",\n\t\t\t\t\t\t\t\"label\": \"Information Message\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"message\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Message text to be send to the channel:\",\n\t\t\t\t\t\"placeholder\": \"Please enter the message you want to sent\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$messageType\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"simple\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text2\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"You can make your text better looking by formatting it in markdown style:\\nBold: **This will be bold**\\nItalic: *This will be italic*\\nLink: [Display Text](actual link)\\n\\nFor more possibilities to customize your messages search for markdown styling.\\n\\nYour text can also include macro variables and their values will be displayed in the message.\",\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$messageType\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"info\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"msgTitle\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Message title:\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$messageType\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"info\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"msgBody\",\n\t\t\t\t\t\"type\": \"textarea\",\n\t\t\t\t\t\"label\": \"Message content:\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$messageType\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"info\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"msgThemeColor\",\n\t\t\t\t\t\"type\": \"colorpicker\",\n\t\t\t\t\t\"label\": \"Message theme color:\",\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$messageType\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"info\"\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"page1\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"how_to_webhook\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"To get the webhook of a Teams Channel:\\n- go to teams\\n- right click on the target channel\\n- Connectors\\n- Search for Incoming Webhook\\n- Click Add\\n- Go to Manage and Configure the Webhook\\n- It needs a name and nice logo\\n- Click create and copy the Webhook URL\\n\\nIf you have already created a Webhook before:\\n- go to teams\\n- right click on the target channel\\n- Connectors\\n- under Manage select Configured\\n- Open the dropdown Configured (x)\\n- click on Manage for the desired Webhook and copy the Webhook URL\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text1\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"This step was created by:\\nTamara.Fischer@sas.com\\nDavid.Weik@sas.com\\n\\nVersion 1.0 (12DEC2022)\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"linkInFlow\": false,\n\t\t\"inputtable1\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"teams_endpoint\": \"See About page\",\n\t\t\"messageType\": {\n\t\t\t\"value\": \"simple\",\n\t\t\t\"label\": \"Simple Text Message\"\n\t\t},\n\t\t\"msgTitle\": \"SAS Studio Notification\",\n\t\t\"msgBody\": \"\",\n\t\t\"msgThemeColor\": \"0075FF\"\n\t}\n}","templates":{"SAS":"%macro sendMessage();\n    %if &messageType. = simple %then %do;\n        * Creation of a simple message - just one line;\n        data work.message_creation;\n            schema = '\"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",';\n            type = '\"type\": \"AdaptiveCard\",';\n            version = '\"version\": \"1.0\",';\n            text = '\"text\": \"' || \"&message.\" || '\"';\n            message = \"'{\" || schema || type || version || text || \"}'\";\n            call symput('msg', message);\n        run;\n    \n        * Publish to Teams channel with a webhook;\n        proc http\n            method=\"POST\"\n            url=\"&teams_endpoint.\"\n            in=&msg.;\n        run;\n    %end;\n    %else %if &messageType. = info %then %do;\n\t\t* Creation of the info message - title, colored line and body content;\n        filename msgFile temp;\n    \n        data _null_;\n            file msgFile;\n            put '{';\n            put '    \"@type\": \"MessageCard\",';\n            put '    \"@context\": \"https://schema.org/extensions\",';\n            put '    \"summary\": \"This is the summary property\",';\n            color = '    \"themeColor\": \"'!! \"&msgThemeColor.\" !!'\",';\n            put color;\n            put '    \"sections\": [';\n            put '    {';\n            put '    \"startGroup\": true,';\n            header = '    \"title\": \"'!! \"&msgTitle.\" !!'\",';\n            put header;\n            put '   \"activityImage\": \"\",';\n            put '   \"activityTitle\": \"\",';\n            put '   \"activitySubtitle\": \"\",';\n            put '   \"facts\": [';\n            put '    {';\n            put '       \"name\": \"Content:\",';\n            content = '       \"value\": \"'!! \"&msgBody.\" !!'\"';\n            put content;\n            put '     }';\n            put '     ]';\n            put '    }' ;\n            put '  ]';\n            put '}';\n        run;\n    \n        proc http\n          method=\"POST\"\n          url=\"&teams_endpoint.\"\n          in=msgFile;\n        run;\n    %end;\n%mend sendMessage;\n\n%sendMessage();\n\n%sysmacdelete sendMessage;"}}